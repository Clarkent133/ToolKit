<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScriptingDex</title>

    <style>
        body {
            margin: 0;
            background-color: #848484;
        }
        #customHTML {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            scrollbar-width: none;
        }
        #options {
            min-width: calc(100% - 10px);
            min-height: auto;
            border: solid black 5px;
            background-color: #151515;
            display: flex;
            flex-direction: column;

        }
        #output {
            width: 100%;
            min-height: auto;
        }
        @media (min-width: 800px) {
            #customHTML {
                flex-direction: row;
            }
            #options {
                height: calc(100% - 10px);
                min-width: 360px;
                overflow-y: auto;
                scrollbar-width: none;
            }
            #output {
                overflow-y: auto;
                scrollbar-width: none;
            }
        }
    </style>
</head>
<body>
    
    <div id="customHTML">
        <div id="options"></div>
        <div id="output"></div>
    </div>

    <script>
        const customHTML = document.getElementById("customHTML");
        const optionsArea = document.getElementById("options");
        const outputArea = document.getElementById("output");
        let editMode = false;
        let path = [];
        let db;
        
//MARK
let notes = {
    "Study": {
        "Maths": {
            "Algebra I": "T:",
            "Geometry": "T:",
            "Algebra II": "T:",
            "Trigonometry": "T:",
            "Precalculus": "T:",
            "Calculus I": "T:",
            "Calculus II": "T:",
            "Calculus III": "T:",
            "Linear Algebra": "T:",
            "Differential Equations": "T:",
            "Real Analysis": "T:",
            "Abstract Algebra": "T:",
            "Complex Analysis": "T:",
            "Probability and Statistics": "T:",
            "Topology": "T:",
            "Number Theory": "T:",
            "Discrete Mathematics": "T:",
            "Numerical Analysis": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Physics": {
            "Motion and Forces": "T:",
            "Energy and Heat": "T:",
            "Light and Sound": "T:",
            "Electricity and Magnetism": "T:",
            "Classical Mechanics": "T:",
            "Thermodynamics": "T:",
            "Waves and Optics": "T:",
            "Electromagnetism": "T:",
            "Modern Physics": "T:",
            "Advanced Classical Mechanics": "T:",
            "Electrodynamics": "T:",
            "Quantum Mechanics": "T:",
            "Statistical Mechanics": "T:",
            "Solid-State Physics": "T:",
            "Nuclear and Particle Physics": "T:",
            "Astrophysics and Cosmology": "T:",
            "General Relativity": "T:",
            "Quantum Field Theory": "T:",
            "String Theory": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Biology": {
            "Cell Biology I": "T:",
            "Classification of Living Things": "T:",
            "Basic Human Biology": "T:",
            "Ecology I": "T:",
            "Cell Biology II": "T:",
            "Ecology II": "T:",
            "Genetics I": "T:",
            "Evolution I": "T:", 
            "Plant Biology": "T:",
            "Animal Biology": "T:",
            "Molecular Biology": "T:",
            "Microbiology": "T:",
            "Physiology": "T:",
            "Biochemistry": "T:",
            "Genetics II": "T:",
            "Ecology III": "T:", 
            "Evolution II": "T:",
            "Cell Biology II": "T:",
            "Neurobiology": "T:",
            "Immunology": "T:",
            "Development Biology": "T:",
            "Bioinformatics": "T:",
            "Biophysics": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Car Mechanics": {
            "Engine Fundamentals": "T:",
            "Fuel Systems": "T:",
            "Ignition Systems": "T:",
            "Emission Control Systems": "T:",
            "Transmissions": "T:",
            "Drive Systems": "T:",
            "Hydraulic Brake Systems": "T:",
            "Anti-lock Braking Systems (ABS)": "T:",
            "Parking Brakes": "T:",
            "Suspension Systems": "T:",
            "Steering Systems": "T:",
            "Electrical Systems": "T:",
            "Heating and Air  Conditioning (HVAC)": "T:",
            "Safety Systems": "T:",
            "General Systems": "T:",
            "General Maintenance": "T:",
            "Electric Vehicles": "T:",
            "Hybrid Vehicles": "T:",
            "Advanced Driver-Assistance Systems (ADAS)": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "First Aid": {
            "CPR": "T:",
            "AED": "T:",
            "Chocking": "T:",
            "Severe Bleeding": "T:",
            "Anaphylaxis Shock": "T:",
            "Wounds": "T:",
            "Burns": "T:",
            "Bone Injuries": "T:",
            "Head Injuries": "T:",
            "Heart Attack": "T:",
            "Stroke": "T:",
            "Seizures": "T:",
            "Fainting": "T:",
            "Diabetic Emergencies": "T:",
            "Asthma Attacks": "T:",
            "Poisoning": "T:",
            "Bites": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "IT": {
            "Computer Hardware": "T:",
            "Operating Systemes": "T:",
            "Networking": "T:",
            "Cybersecurity I": "T:",
            "Software Development": "T:",
            "Programming": {
                "HTML": "T:HTML",
                "CSS": "T:CSS",
                "JavaScript": "T:JavaScript",
                "CMD": "T:CMD",
                "PowerShell": "T:PowerShell",
                "Lua": "T:Lua",
                "Python": "T:Python",
                "Java": "T:Java",
                "Shell": "T:Shell",
                "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
                "Return": "J:path.pop(); showOption();"
            },
            "Cloud Computing": "T:",
            "Cybersecurity II": "T:",
            "Data Science and Analytics": "T:",
            "IT Support and Systems Administration": "T:",
            "Database Administration": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Languages": {
            "French": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Survival": {
            "Shelter I": "T:", 
            "Shelter II": "T:", 
            "Fire": "T:",
            "Water": "T:",
            "Food": "T:",
            "Navigation I": "T:",
            "Navigation II": "T:", 
            "Signaling and Communication": "T:<table border='1' style='width: 100%;'><tr><th style='width: 50%;'>Alphabet</th><th style='width: 50%;'>Morse Code</th></tr><tr><td>A</td><td>.-</td></tr></table>",
            "Foraging and Botany": "T:",
            "Hunting and Tracking": "T:",
            "Agriculture": "T:",
            "Tool Making and Repair": "T:",
            "Self-Defense and Security": "T:",
            "Leadership": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Return": "J:path.pop(); showOption();"
    },
    "Notes": "T:<center><h1><u>Notes</u></h1></center>\n<hr>\n<br>\n<ul>\n    <li>Random Note.</li>\n    <li>Random Note.</li>\n</ul>",
    "Tasks": "T:Tasks",
    "Card Game Creator": "T:Cards",
    "Text Adventure Game": "J:",
    "Dev": {
        "Toggle Edit Mode": "J:editMode = !editMode; showOption();",
        "Edit Notes": "J:editPath([]);",
        "Export": "J:optionsArea.innerHTML = \"\";\noutputArea.innerHTML = \"\";\nlet htmlContent = document.documentElement.outerHTML.split(\"//MARK\");\nconst last = htmlContent.pop();\nconst init = htmlContent.shift();\nconst newHTMLContent = init + \"//MARK\\nlet notes = \" + JSON.stringify(notes, null, 4) + \";\\n//MARK\" + last;\nconst blob = new Blob([newHTMLContent], {type: 'text/html'});\nconst a = document.createElement('a');\na.href = URL.createObjectURL(blob);\na.download = 'ScriptingDex.html';\na.click();\nURL.revokeObjectURL(a.href);\nshowOption();",
        "Reset": "J:resetData(); saveData();",
        "Return": "J:path.pop(); showOption();"
    }
};
//MARK



        function showOption(highlightButton = -1) {
            outputArea.style.height = "auto";
            let option = notes;
            for (let i=0; i<path.length; i++) {
                option = option[path[i]];   
            }
            if (typeof option === 'object' && option !== null && !Array.isArray(option)) {
                optionsArea.innerHTML = "";
                outputArea.innerHTML = "";
                for (let i=0; i<Object.keys(option).length; i++) {
                    const optionName = Object.keys(option)[i];
                    if (optionName[0] != "!") {
                        let buttonColour = (i%2 == 0) ? "#393939" : "#262626";
                        if (editMode) buttonColour = (i%2 == 0) ? "#0e2b00" : "#081a00";
                        if (optionName == highlightButton) buttonColour = "black";
                        newOptionButton(optionName, buttonColour, function() {
                            path.push(optionName);
                            showOption();
                            scrollToBottomSmooth();
                        });
                    }
                }
            } else {
                if (editMode) {
                    editPath([...path]);
                    path.pop();
                } else {
                    if (option.startsWith('J:')) {
                        path.pop();
                        let customJS = new Function(option.substring(2));
                        customJS();   
                    } else if (option.startsWith('T:')) {
                        const chosenOption = path.pop();
                        showOption(chosenOption);
                        outputArea.innerHTML = `<div style="margin: 10px; border: 5px solid black; width: calc(100% - 40px); min-height: calc(100% - 40px); padding: 5px; border-radius: 8px; background-color: white; font-size: 22px;">${option.substring(2)}</div>`;
                    } else {
                        path.pop();
                        showOption();
                    }
                }
            }

        }

        function newOptionButton(name, colour, click) {
            let newOption = document.createElement("button");
            newOption.innerHTML = name;
            newOption.style.color = "white";
            newOption.style.backgroundColor = colour;
            newOption.style.minHeight = "60px";
            newOption.style.fontSize = "22px";
            newOption.onclick = click;
            optionsArea.appendChild(newOption);
            return newOption;
        }
        
        function scrollToBottomSmooth() {
            const optionsAreaBottom = optionsArea.offsetTop + optionsArea.offsetHeight;
            customHTML.scrollTo({
                top: optionsAreaBottom,
                behavior: 'smooth'
            });
        }

        function editPath(p) {
            let o = notes, pr = null, lk = null;
            p.forEach(part => { pr = o; lk = part; o = o[part]; });
            const isObj = typeof o === 'object' && o && !Array.isArray(o);
            optionsArea.innerHTML = "";
            outputArea.style.height = "100%";
            outputArea.innerHTML = `<textarea id="ta" wrap="off" style="margin:10;border:5px solid black;width:calc(100% - 20px);min-height:calc(100% - 20px);padding:5;border-radius:8px;background-color:white;font-size:16px;"></textarea>`;
            const ta = document.getElementById("ta");
            ta.addEventListener('keydown', e => { if (e.key === 'Tab') { e.preventDefault(); const s = ta.selectionStart, en = ta.selectionEnd; ta.value = ta.value.substring(0, s) + '    ' + ta.value.substring(en); ta.selectionStart = ta.selectionEnd = s + 4; } });
            ta.value = isObj ? JSON.stringify(o, null, 4) : o.substring(2);
            const save = () => { try { if (isObj) pr ? pr[lk] = JSON.parse(ta.value) : notes = JSON.parse(ta.value); else if (pr) pr[lk] = `${o[0]}:${ta.value}`; saveData(); showOption(); } catch (e) { alert("Invalid format."); } };
            newOptionButton("Save", "#393939", save);
            if (!isObj && o.startsWith('J:')) newOptionButton("Run", "#393939", () => { save(); try { new Function(ta.value)(); } catch (e) { alert("Error."); } showOption(); });
        }
        
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open("ScriptingDexDB", 1);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    window.db = request.result;
                    resolve();
                };
                request.onupgradeneeded = (event) => {
                    window.db = event.target.result;
                    window.db.createObjectStore("data", { keyPath: "id" });
                };
            });
        }

        function saveData() {
            return window.openDB().then(() => {
                const transaction = window.db.transaction(["data"], "readwrite");
                const objectStore = transaction.objectStore("data");
                const request = objectStore.put({
                    id: "allData",
                    notes: JSON.stringify(notes)
                });
                console.log("Saved")
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }

        function loadData() {
            return window.openDB().then(() => {
                const transaction = window.db.transaction(["data"], "readonly");
                const objectStore = transaction.objectStore("data");
                const request = objectStore.get("allData");
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        if (request.result) {
                            notes = JSON.parse(request.result.notes);
                            resolve({
                                notes: true
                            });
                        } else {
                            resolve({ notes : null });
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
            });
        }

        function resetData() {
            return new Promise((resolve, reject) => {
                console.log("Data Reset")
                const request = indexedDB.deleteDatabase("ScriptingDexDB");
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve();
            });
        }

        loadData().then(data => {
            if (data.notes === null) {
                console.log("No notes found so using default.");
                window.saveData();
            }
            showOption();
        });

        //showOption();
    </script>

</body></html>
