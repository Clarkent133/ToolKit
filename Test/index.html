<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    <title>ScriptingDex</title>

    <style>
        body {
            margin: 0;
            background-color: #848484;
        }
        #customHTML {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            scrollbar-width: none;
        }
        #options {
            min-width: calc(100% - 10px);
            min-height: auto;
            border: solid black 5px;
            background-color: #151515;
            display: flex;
            flex-direction: column;

        }
        #output {
            width: 100%;
            min-height: auto;
        }
        @media (min-width: 800px) {
            #customHTML {
                flex-direction: row;
            }
            #options {
                height: calc(100% - 10px);
                min-width: 360px;
                overflow-y: auto;
                scrollbar-width: none;
            }
            #output {
                overflow-y: auto;
                scrollbar-width: none;
            }
        }
    </style>
</head>
<body>
    
    <div id="customHTML">
        <div id="options"></div>
        <div id="output" style="height: auto;"></div>
    </div>

    <script>
        const customHTML = document.getElementById("customHTML");
        const optionsArea = document.getElementById("options");
        const outputArea = document.getElementById("output");
        let editMode = false;
        let path = [];
        let db;
        
//MARK
let notes = {
    "Study": {
        "Maths": {
            "Algebra I": "T:",
            "Geometry": "T:",
            "Algebra II": "T:",
            "Trigonometry": "T:",
            "Precalculus": "T:",
            "Calculus I": "T:",
            "Calculus II": "T:",
            "Calculus III": "T:",
            "Linear Algebra": "T:",
            "Differential Equations": "T:",
            "Real Analysis": "T:",
            "Abstract Algebra": "T:",
            "Complex Analysis": "T:",
            "Probability and Statistics": "T:",
            "Topology": "T:",
            "Number Theory": "T:",
            "Discrete Mathematics": "T:",
            "Numerical Analysis": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Physics": {
            "Motion and Forces": "T:",
            "Energy and Heat": "T:",
            "Light and Sound": "T:",
            "Electricity and Magnetism": "T:",
            "Classical Mechanics": "T:",
            "Thermodynamics": "T:",
            "Waves and Optics": "T:",
            "Electromagnetism": "T:",
            "Modern Physics": "T:",
            "Advanced Classical Mechanics": "T:",
            "Electrodynamics": "T:",
            "Quantum Mechanics": "T:",
            "Statistical Mechanics": "T:",
            "Solid-State Physics": "T:",
            "Nuclear and Particle Physics": "T:",
            "Astrophysics and Cosmology": "T:",
            "General Relativity": "T:",
            "Quantum Field Theory": "T:",
            "String Theory": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Biology": {
            "Cell Biology I": "T:",
            "Classification of Living Things": "T:",
            "Basic Human Biology": "T:",
            "Ecology I": "T:",
            "Cell Biology II": "T:",
            "Ecology II": "T:",
            "Genetics I": "T:",
            "Evolution I": "T:",
            "Plant Biology": "T:",
            "Animal Biology": "T:",
            "Molecular Biology": "T:",
            "Microbiology": "T:",
            "Physiology": "T:",
            "Biochemistry": "T:",
            "Genetics II": "T:",
            "Ecology III": "T:",
            "Evolution II": "T:",
            "Neurobiology": "T:",
            "Immunology": "T:",
            "Development Biology": "T:",
            "Bioinformatics": "T:",
            "Biophysics": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Car Mechanics": {
            "Engine Fundamentals": "T:",
            "Fuel Systems": "T:",
            "Ignition Systems": "T:",
            "Emission Control Systems": "T:",
            "Transmissions": "T:",
            "Drive Systems": "T:",
            "Hydraulic Brake Systems": "T:",
            "Anti-lock Braking Systems (ABS)": "T:",
            "Parking Brakes": "T:",
            "Suspension Systems": "T:",
            "Steering Systems": "T:",
            "Electrical Systems": "T:",
            "Heating and Air  Conditioning (HVAC)": "T:",
            "Safety Systems": "T:",
            "General Systems": "T:",
            "General Maintenance": "T:",
            "Electric Vehicles": "T:",
            "Hybrid Vehicles": "T:",
            "Advanced Driver-Assistance Systems (ADAS)": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "First Aid": {
            "CPR": "T:",
            "AED": "T:",
            "Chocking": "T:",
            "Severe Bleeding": "T:",
            "Anaphylaxis Shock": "T:",
            "Wounds": "T:",
            "Burns": "T:",
            "Bone Injuries": "T:",
            "Head Injuries": "T:",
            "Heart Attack": "T:",
            "Stroke": "T:",
            "Seizures": "T:",
            "Fainting": "T:",
            "Diabetic Emergencies": "T:",
            "Asthma Attacks": "T:",
            "Poisoning": "T:",
            "Bites": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "IT": {
            "Computer Hardware": "T:",
            "Operating Systemes": "T:",
            "Networking": "T:",
            "Cybersecurity I": "T:",
            "Software Development": "T:",
            "Programming": {
                "HTML": "T:HTML",
                "CSS": "T:CSS",
                "JavaScript": "T:JavaScript",
                "CMD": "T:CMD",
                "PowerShell": "T:PowerShell",
                "Lua": "T:Lua",
                "Python": "T:Python",
                "Java": "T:Java",
                "Shell": "T:Shell",
                "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
                "Return": "J:path.pop(); showOption();"
            },
            "Cloud Computing": "T:",
            "Cybersecurity II": "T:",
            "Data Science and Analytics": "T:",
            "IT Support and Systems Administration": "T:",
            "Database Administration": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Languages": {
            "French": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Survival": {
            "Shelter I": "T:",
            "Shelter II": "T:",
            "Fire": "T:",
            "Water": "T:",
            "Food": "T:",
            "Navigation I": "T:",
            "Navigation II": "T:",
            "Signaling and Communication": "T:<table border='1' style='width: 100%;'><tr><th style='width: 50%;'>Alphabet</th><th style='width: 50%;'>Morse Code</th></tr><tr><td>A</td><td>.-</td></tr></table>",
            "Foraging and Botany": "T:",
            "Hunting and Tracking": "T:",
            "Agriculture": "T:",
            "Tool Making and Repair": "T:",
            "Self-Defense and Security": "T:",
            "Leadership": "T:",
            "Speak": "J:speechSynthesis.speak(new SpeechSynthesisUtterance(outputArea.textContent));",
            "Return": "J:path.pop(); showOption();"
        },
        "Return": "J:path.pop(); showOption();"
    },
    "Notes": "T:<center><h1><u>Notes</u></h1></center>\n<hr>\n<br>\n<ul>\n    <li>Random Note.</li>\n    <li>Random Note.</li>\n</ul>",
    "Tasks": "T:Tasks",
    "Card Game Creator": "J:const cardIcons = [\"Slow\" , \"Tap\" , \"Power\" , \"Agility\" , \"Wisdom\"];\nconst cardIconImage = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAQCAYAAACBSfjBAAAAAXNSR0IArs4c6QAAAORJREFUWIXtl+sOgyAMhWHZ+79y92cm2J1eaJkY0y8hIlIutT1ia0Wxk87uKWgn2aJ+j+IN2qxNa04ebYldV48fGcM7t9Tv5/nLuaAMfShZPBmi9fFmmBsUgdTsNzALgbrl0Ki8rLJ3wSPwmBRN5t04gts8RhtRCiMnZpzHx50Zg4YSIWPrskcpnMFabDbyroxcHkBwbkkD29eA1zV9lI42Xbla7HK4JmEneAoj5x3tmj5K8LSNpPFOzNODpIHSG5jduOTsv3wRF9OF+glJA1dFyEy63wm0PhhYK3/lEFkNLIpC5QPRVTgksfcGbAAAAABJRU5ErkJggg==\";\nconst cardFont = \"'Courier New', monospace\";\nconst xCoord = 4;\nconst yCoord = 15;\n\n\n\nfunction drawCard(deckName, cardTitle, x=0, y=0) {\n\n    cardCtx.fillStyle = \"black\";\n    cardCtx.fillRect(x, y, 512, 768);\n    cardCtx.fillStyle = \"white\";\n    cardCtx.fillRect(x+8, y+8, 512-16, 768-16);\n    const cardData = notes[\"!Decks\"][deckName][cardTitle];\n\n    if (cardData.durability == 0) {\n        drawShape([{x:x , y:y+16} , {x:x+436 , y:y+16} , {x:x+436-48 , y:y+16+48} , {x:x , y:y+16+48}], 4); // <---- T I T L E   A R E A   ---- T E X T   A R E A ----> X+0 -> X+388\n        drawCenteredAndWrappedText(cardCtx, cardData.title, x+4, y+40, 388-8, `bold 32px ${cardFont}`, \"black\", \"center\"); // <---- T I T L E   T E X T\n    } else {\n        drawShape([{x:x , y:y+16} , {x:x+342 , y:y+16} , {x:x+342-48 , y:y+16+48} , {x:x , y:y+16+48}], 4); // <---- T I T L E   A R E A   ---- T E X T   A R E A ----> X+0 -> X+294\n        drawShape([{x:x+436 , y:y+16} , {x:x+358 , y:y+16} , {x:x+358-48 , y:y+16+48} , {x:x+436-48 , y:y+16+48}], 4); // <---- D U R A B I L I T Y   A R E A   ---- T E X T   A R E A ----> X+358 -> X+388\n        drawCenteredAndWrappedText(cardCtx, cardData.title, x+4, y+40, 294-8, `bold 32px ${cardFont}`, \"black\", \"center\"); // <---- T I T L E   T E X T\n        drawCenteredAndWrappedText(cardCtx, `${cardData.durability}`, x+358, y+40, 30, `bold 32px ${cardFont}`, \"black\", \"center\"); // <---- D U R A B I L I T Y   T E X T\n    }\n\n\n    drawShape([{x:x+512 , y:y+16} , {x:x+452 , y:y+16} , {x:x+452-48 , y:y+16+48} , {x:x+512 , y:y+16+48}], 4); // <---- S U I T   V A L U E   A R E A   ---- T E X T   A R E A ----> X+452 -> X+512\n    drawCenteredAndWrappedText(cardCtx, `${cardData.suitValue}`, x+444, y+40, 60, `bold 32px ${cardFont}`, \"black\", \"left\"); // <---- S U I T   V A L U E   T E X T\n\n    for (let i=0; i<cardData.abilities.length; i++) {\n        const ability = cardData.abilities[cardData.abilities.length-1-i];\n        if (ability.textType == \"whole\") {\n            drawCenteredAndWrappedText(cardCtx, ability.text.replace(/\\\\n/g, '\\n'), x+12, y+400, 512-24, `bold 16px ${cardFont}`, \"black\", \"left\"); // <---- W H O L E   T E X T\n        } else {\n            cardCtx.fillStyle = \"black\";\n            cardCtx.fillRect(x+24, y+768-24-96-(i*112)-24, 464, 96); // <---- A B I L I T Y   O U T E R   A R E A\n            cardCtx.fillStyle = \"white\";\n            cardCtx.fillRect(x+24+4, y+768-24-96-(i*112)+4-24, 464-8, 96-8); // <---- A B I L I T Y   I N N E R   A R E A\n\n            for (let j=0; j<ability.cost.length; j++) {\n                drawCircle(x+40+(56*j) , y+768-24-96-(i*112)+16-24 , 24 , \"black\"); // <---- A B I L I T Y   C O S T   O U T E R   A R E A\n                drawCircle(x+40+(56*j) , y+768-24-96-(i*112)+16-24 , 20 , \"white\"); // <---- A B I L I T Y   C O S T   I N N E R   A R E A\n                cardCtx.imageSmoothingEnabled = false;\n                cardCtx.drawImage(icons[ability.cost[j]], x+40+(56*j)-16 , y+768-24-96-(i*112)+16-16-24, 32, 32); // <---- D R A W   A B I L I T Y   I C O N\n            }\n            drawCenteredAndWrappedText(cardCtx, ability.title, x+24+4+(ability.cost.length*56), y+768-24-96-(i*112)+4+16-24, 512-56-(ability.cost.length*56), `bold 24px ${cardFont}`, \"black\", \"left\"); // <---- A B I L I T Y   T I T L E   T E X T\n\n            if (ability.textType == \"normal\") drawCenteredAndWrappedText(cardCtx, ability.text.replace(/\\\\n/g, '\\n'), x+24+4+4, y+768-24-96-(i*112)+66-24, 512-64, `bold 14px ${cardFont}`, \"black\", \"left\"); // <---- A B I L I T Y   T E X T\n            if (ability.textType == \"italic\") drawCenteredAndWrappedText(cardCtx, ability.text.replace(/\\\\n/g, '\\n'), x+24+4+4, y+768-24-96-(i*112)+44-24, 512-64, `italic bold 14px ${cardFont}`, \"black\", \"center\"); // <---- A B I L I T Y   F L A V O U R   T E X T\n        }\n\n    }\n    drawShape([{x:x , y:y+768} , {x:x+32 , y:y+768-32} , {x:x+512-32 , y:y+768-32} , {x:x+512 , y:y+768}], 4); // <---- D R A W   F O O T E R   A R E A\n    drawCenteredAndWrappedText(cardCtx, cardData.footer, x+32, y+768-20, 512-64, `16px ${cardFont}`, \"black\", \"center\"); // <---- F O O T E R   T E X T\n}\n\n\n\n\nfunction splitBase64Image(base64String, numOfImages, deckName) {\n    var img = new Image();\n    img.onload = function() {\n        var tempCnv = document.createElement('canvas');\n        var tempCtx = tempCnv.getContext('2d');\n        tempCnv.width = img.width;\n        tempCnv.height = img.height;\n        tempCtx.drawImage(img, 0, 0);\n\n        var subWidth = Math.floor(img.width / numOfImages);\n        var loadedCount = 0;\n\n        for (let i = 0; i < numOfImages; i++) {\n            var subCnv = document.createElement('canvas');\n            var subCtx = subCnv.getContext('2d');\n            subCnv.width = subWidth;\n            subCnv.height = img.height;\n\n            subCtx.drawImage(tempCnv, \n                        i * subWidth, 0, \n                        subWidth, img.height, \n                        0, 0, \n                        subWidth, img.height);\n\n            var subImage = new Image();\n            subImage.onload = function() {\n                loadedCount++;\n                if (loadedCount === numOfImages) {\n                    downloadCardsFromDeck(deckName);\n                }\n            };\n            subImage.src = subCnv.toDataURL('image/png');\n            icons[Object.keys(icons)[i]] = subImage;\n        }\n    };\n    img.src = base64String;\n}\n\n\n\nfunction downloadCardsFromDeck(deckToDownload) {\n    cardCtx.clearRect(0, 0, cardCnv.width, cardCnv.height);\n    let snapTrack = 0;\n    let yTrack = 0;\n    let xTrack = 0;\n    cardCnv.width = xCoord*512;\n    cardCnv.height = yCoord*768;\n\n    for (const cardTitle in notes[\"!Decks\"][deckToDownload]) {\n        drawCard(deckToDownload , cardTitle , xTrack*512 , yTrack*768);\n        if (xTrack < (xCoord-1)) {\n            xTrack += 1;\n        } else {\n            xTrack = 0;\n            if (yTrack < (yCoord-1)) {\n                yTrack += 1;\n            } else {\n                snapCanvas(`Cards_${snapTrack}`);\n                snapTrack += 1;\n                cardCtx.clearRect(0, 0, cardCnv.width, cardCnv.height);\n                yTrack = 0;\n            }\n        } \n    }\n    if (!(xTrack == 0 && yTrack == 0)) {\n        snapCanvas(`Cards_${snapTrack}`);\n        cardCtx.clearRect(0, 0, cardCnv.width, cardCnv.height);\n    }\n}\n\n\n\n\nfunction snapCanvas(name) {\n    cardCtx.imageSmoothingEnabled = false;\n    let cardCnvImage = cardCnv.toDataURL(\"image/png\", 1.0);\n    let link = document.createElement('a');\n    link.download = `${name}.png`;\n    link.href = cardCnvImage;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}\n\n\n\nfunction drawCircle(centerX , centerY , radius , colour) {\n    cardCtx.beginPath();\n    cardCtx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n    cardCtx.fillStyle = colour;\n    cardCtx.fill();\n}\n\n\n\nfunction drawShape(locations, width) {\n    cardCtx.beginPath();\n    cardCtx.moveTo(locations[0].x, locations[0].y);\n    for (let i=1; i<locations.length; i++) {\n        cardCtx.lineTo(locations[i].x, locations[i].y);\n    }\n    cardCtx.closePath();\n    cardCtx.lineWidth = width;\n    cardCtx.strokeStyle = \"black\";\n    cardCtx.stroke();\n}\n\nfunction drawCenteredAndWrappedText(canvasCtx, text, x, y, maxWidth, font, textStyle, align) {\n    canvasCtx.fillStyle = textStyle;\n    let xCoord = (align == \"left\") ? x : x + (maxWidth / 2);\n    canvasCtx.font = font;\n    let fontSize = parseInt(font.match(/\\d+px/)[0]);\n    let lineHeight = fontSize * 1.2;\n    canvasCtx.textAlign = align;\n    canvasCtx.textBaseline = \"middle\";\n\n    // Split the text by \\n and keep track of empty lines for multiple newlines\n    let parts = text.split('\\n');\n    let lines = [];\n    \n    for (let part of parts) {\n        let words = part.split(' ');\n        let currentLine = '';\n\n        for (let word of words) {\n            let testLine = currentLine + word + ' ';\n            let metrics = canvasCtx.measureText(testLine);\n            \n            if (metrics.width > maxWidth) {\n                if (currentLine) lines.push(currentLine.trim());\n                currentLine = word + ' ';\n            } else {\n                currentLine = testLine;\n            }\n        }\n        \n        if (currentLine.trim().length > 0) lines.push(currentLine.trim());\n        // If there's an empty part (i.e., \\n\\n), just push a blank line\n        if (part === '') lines.push('');\n    }\n\n    // Calculate total height including any extra space for blank lines (multiple \\n)\n    let totalHeight = lines.length * lineHeight;\n    let startY = y - totalHeight / 2 + lineHeight / 2;\n    \n    lines.forEach((line, index) => {\n        // If the line is empty (for consecutive \\n), add more vertical space\n        let yOffset = line === '' ? lineHeight * 1.5 : lineHeight; // Increase the gap for blank lines\n        canvasCtx.fillText(line, xCoord, startY + index * yOffset);\n    });\n}\n\nconst cardCnv = document.createElement('canvas');\nconst cardCtx = cardCnv.getContext('2d');\nlet icons = {};\nfor (let i=0; i<cardIcons.length; i++) {\n    icons[cardIcons[i]] = \"\"\n}\n\nsplitBase64Image(cardIconImage, cardIcons.length, \"Deck 1\");\n\n\n",
    "Text Adventure Game": "J:",
    "!Decks": {
        "Deck 1": {
            "Ace of Clubs": {
                "title": "Bjaldor",
                "durability": "18",
                "suitValue": "AC",
                "footer": "Character",
                "abilities": [
                    {
                        "title": "Play",
                        "textType": "normal",
                        "text": "Play 1 Card from your Hand into your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Draw",
                        "textType": "normal",
                        "text": "Draw the top Card from your Deck into your Hand.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Untap",
                        "textType": "normal",
                        "text": "Untap all Cards in your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Attribute",
                        "textType": "normal",
                        "text": "Generate 2 Power Points and 1 Agility Point.",
                        "cost": [
                            "Tap"
                        ]
                    },
                    {
                        "title": "",
                        "textType": "italic",
                        "text": "Half-Orc Barbarian",
                        "cost": []
                    }
                ]
            },
            "2 of Clubs": {
                "title": "Warhammer",
                "durability": "0",
                "suitValue": "2C",
                "footer": "Item",
                "abilities": []
            },
            "3 of Clubs": {
                "title": "Battle Axe",
                "durability": "0",
                "suitValue": "3C",
                "footer": "Item",
                "abilities": []
            },
            "4 of Clubs": {
                "title": "Iron Shield",
                "durability": "0",
                "suitValue": "4C",
                "footer": "Item",
                "abilities": []
            },
            "5 of Clubs": {
                "title": "Chainmail Armour",
                "durability": "0",
                "suitValue": "5C",
                "footer": "Item",
                "abilities": []
            },
            "6 of Clubs": {
                "title": "Spiked Gauntlets",
                "durability": "0",
                "suitValue": "6C",
                "footer": "Item",
                "abilities": []
            },
            "7 of Clubs": {
                "title": "Greatsword",
                "durability": "0",
                "suitValue": "7C",
                "footer": "Item",
                "abilities": []
            },
            "8 of Clubs": {
                "title": "Reinforced Boots",
                "durability": "0",
                "suitValue": "8C",
                "footer": "Item",
                "abilities": []
            },
            "9 of Clubs": {
                "title": "Might Gauntlets",
                "durability": "0",
                "suitValue": "9C",
                "footer": "Item",
                "abilities": []
            },
            "10 of Clubs": {
                "title": "Heavy Crossbow",
                "durability": "0",
                "suitValue": "10C",
                "footer": "Item",
                "abilities": []
            },
            "Jack of Clubs": {
                "title": "Dragonone Mace",
                "durability": "0",
                "suitValue": "JC",
                "footer": "Item",
                "abilities": []
            },
            "Queen of Clubs": {
                "title": "Titan's Gauntlets",
                "durability": "0",
                "suitValue": "QC",
                "footer": "Item",
                "abilities": []
            },
            "King of Clubs": {
                "title": "Ironclad Bruiser",
                "durability": "0",
                "suitValue": "KC",
                "footer": "Ally",
                "abilities": []
            },
            "Ace of Hearts": {
                "title": "Tessa Vale",
                "durability": "14",
                "suitValue": "AH",
                "footer": "Character",
                "abilities": [
                    {
                        "title": "Play",
                        "textType": "normal",
                        "text": "Play 1 Card from your Hand into your Field.",
                        "cost": [
                            "Tap"
                        ]
                    },
                    {
                        "title": "Draw",
                        "textType": "normal",
                        "text": "Draw the top Card from your Deck into your Hand.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Untap",
                        "textType": "normal",
                        "text": "Untap all Cards in your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Attribute",
                        "textType": "normal",
                        "text": "Generate 2 Agility Points and 1 Wisdom Point.",
                        "cost": [
                            "Tap"
                        ]
                    },
                    {
                        "title": "",
                        "textType": "italic",
                        "text": "Tiefling Rogue",
                        "cost": []
                    }
                ]
            },
            "2 of Hearts": {
                "title": "Twin Daggers",
                "durability": "0",
                "suitValue": "2H",
                "footer": "Item",
                "abilities": []
            },
            "3 of Hearts": {
                "title": "Throwing Stars",
                "durability": "0",
                "suitValue": "3H",
                "footer": "Item",
                "abilities": []
            },
            "4 of Hearts": {
                "title": "Leather Armour",
                "durability": "0",
                "suitValue": "4H",
                "footer": "Item",
                "abilities": []
            },
            "5 of Hearts": {
                "title": "Grappling Hook",
                "durability": "0",
                "suitValue": "5H",
                "footer": "Item",
                "abilities": []
            },
            "6 of Hearts": {
                "title": "Climbing Rope",
                "durability": "0",
                "suitValue": "6H",
                "footer": "Item",
                "abilities": []
            },
            "7 of Hearts": {
                "title": "Silent Boots",
                "durability": "0",
                "suitValue": "7H",
                "footer": "Item",
                "abilities": []
            },
            "8 of Hearts": {
                "title": "Lockpicks",
                "durability": "0",
                "suitValue": "8H",
                "footer": "Item",
                "abilities": []
            },
            "9 of Hearts": {
                "title": "Shortbow",
                "durability": "0",
                "suitValue": "9H",
                "footer": "Item",
                "abilities": []
            },
            "10 of Hearts": {
                "title": "Smoke Bombs",
                "durability": "0",
                "suitValue": "10H",
                "footer": "Item",
                "abilities": []
            },
            "Jack of Hearts": {
                "title": "Phantom Cloak",
                "durability": "0",
                "suitValue": "JH",
                "footer": "Item",
                "abilities": []
            },
            "Queen of Hearts": {
                "title": "Shadow Blade",
                "durability": "0",
                "suitValue": "QH",
                "footer": "Item",
                "abilities": []
            },
            "King of Hearts": {
                "title": "The Elven Scout",
                "durability": "0",
                "suitValue": "KH",
                "footer": "Ally",
                "abilities": []
            },
            "Ace of Spades": {
                "title": "Victor Wren",
                "durability": "14",
                "suitValue": "AS",
                "footer": "Character",
                "abilities": [
                    {
                        "title": "Play",
                        "textType": "normal",
                        "text": "Play 1 Card from your Hand into your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Draw",
                        "textType": "normal",
                        "text": "Draw the top 2 Cards from your Deck into your Hand.",
                        "cost": [
                            "Slow",
                            "Tap"
                        ]
                    },
                    {
                        "title": "Untap",
                        "textType": "normal",
                        "text": "Untap all Cards in your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Attribute",
                        "textType": "normal",
                        "text": "Generate 2 Wisdom Points and 1 Power Point.",
                        "cost": [
                            "Tap"
                        ]
                    },
                    {
                        "title": "",
                        "textType": "italic",
                        "text": "Human Wizard",
                        "cost": []
                    }
                ]
            },
            "2 of Spades": {
                "title": "Simple Wand",
                "durability": "0",
                "suitValue": "2S",
                "footer": "Item",
                "abilities": []
            },
            "3 of Spades": {
                "title": "Crystal Orb",
                "durability": "0",
                "suitValue": "3S",
                "footer": "Item",
                "abilities": []
            },
            "4 of Spades": {
                "title": "Ancient Map",
                "durability": "0",
                "suitValue": "4S",
                "footer": "Item",
                "abilities": []
            },
            "5 of Spades": {
                "title": "Mystic Hourglass",
                "durability": "0",
                "suitValue": "5S",
                "footer": "Item",
                "abilities": []
            },
            "6 of Spades": {
                "title": "Grimoire of Spells",
                "durability": "0",
                "suitValue": "6S",
                "footer": "Item",
                "abilities": []
            },
            "7 of Spades": {
                "title": "Potion of Clarity",
                "durability": "0",
                "suitValue": "7S",
                "footer": "Item",
                "abilities": []
            },
            "8 of Spades": {
                "title": "Mystic Amulet",
                "durability": "0",
                "suitValue": "8S",
                "footer": "Item",
                "abilities": []
            },
            "9 of Spades": {
                "title": "Runestone",
                "durability": "0",
                "suitValue": "9S",
                "footer": "Item",
                "abilities": []
            },
            "10 of Spades": {
                "title": "Sage's Robes",
                "durability": "0",
                "suitValue": "10S",
                "footer": "Item",
                "abilities": []
            },
            "Jack of Spades": {
                "title": "Arcane Tome",
                "durability": "0",
                "suitValue": "JS",
                "footer": "Item",
                "abilities": []
            },
            "Queen of Spades": {
                "title": "Archmage's Robes",
                "durability": "0",
                "suitValue": "QS",
                "footer": "Item",
                "abilities": []
            },
            "King of Spades": {
                "title": "The Wise Sage",
                "durability": "0",
                "suitValue": "KS",
                "footer": "Ally",
                "abilities": []
            },
            "Ace of Diamonds": {
                "title": "Rosie Goodwin",
                "durability": "16",
                "suitValue": "AD",
                "footer": "Character",
                "abilities": [
                    {
                        "title": "Play",
                        "textType": "normal",
                        "text": "Play 1 Card from your Hand into your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Draw",
                        "textType": "normal",
                        "text": "Draw the top Card from your Deck into your Hand.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Untap",
                        "textType": "normal",
                        "text": "Untap all Cards in your Field.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Attribute",
                        "textType": "normal",
                        "text": "Generate 1 Power Point, 1 Agility Point and 1 Wisdom Point.",
                        "cost": [
                            "Tap"
                        ]
                    },
                    {
                        "title": "",
                        "textType": "italic",
                        "text": "Gnome Bard",
                        "cost": []
                    }
                ]
            },
            "2 of Diamonds": {
                "title": "Lucky Coin",
                "durability": "0",
                "suitValue": "2D",
                "footer": "Item",
                "abilities": []
            },
            "3 of Diamonds": {
                "title": "Multi-Tool",
                "durability": "0",
                "suitValue": "3D",
                "footer": "Item",
                "abilities": []
            },
            "4 of Diamonds": {
                "title": "Traveller's Cloak",
                "durability": "0",
                "suitValue": "4D",
                "footer": "Item",
                "abilities": []
            },
            "5 of Diamonds": {
                "title": "Versatile Sword",
                "durability": "0",
                "suitValue": "5D",
                "footer": "Item",
                "abilities": []
            },
            "6 of Diamonds": {
                "title": "Healing Salve",
                "durability": "0",
                "suitValue": "6D",
                "footer": "Item",
                "abilities": []
            },
            "7 of Diamonds": {
                "title": "Enchanted Lyre",
                "durability": "0",
                "suitValue": "7D",
                "footer": "Item",
                "abilities": []
            },
            "8 of Diamonds": {
                "title": "Rations",
                "durability": "0",
                "suitValue": "8D",
                "footer": "Item",
                "abilities": []
            },
            "9 of Diamonds": {
                "title": "Bag of Tricks",
                "durability": "0",
                "suitValue": "9D",
                "footer": "Item",
                "abilities": []
            },
            "10 of Diamonds": {
                "title": "Portable Tent",
                "durability": "0",
                "suitValue": "10D",
                "footer": "Item",
                "abilities": []
            },
            "Jack of Diamonds": {
                "title": "Ring of Adaptation",
                "durability": "0",
                "suitValue": "JD",
                "footer": "Item",
                "abilities": []
            },
            "Queen of Diamonds": {
                "title": "Chameleon Cloak",
                "durability": "0",
                "suitValue": "QD",
                "footer": "Item",
                "abilities": []
            },
            "King of Diamonds": {
                "title": "The Mercenary",
                "durability": "0",
                "suitValue": "KD",
                "footer": "Ally",
                "abilities": []
            },
            "Joker 1": {
                "title": "Bjaldor",
                "durability": "18",
                "suitValue": "Jo",
                "footer": "Character Placeholder",
                "abilities": []
            },
            "Joker 2": {
                "title": "Tessa Value",
                "durability": "14",
                "suitValue": "Jo",
                "footer": "Character Placeholder",
                "abilities": []
            },
            "Joker 3": {
                "title": "Victor Wren",
                "durability": "14",
                "suitValue": "Jo",
                "footer": "Character Placeholder",
                "abilities": []
            },
            "Joker 4": {
                "title": "Rosie Goodwin",
                "durability": "16",
                "suitValue": "Jo",
                "footer": "Character Placeholder",
                "abilities": []
            },
            "Joker 5": {
                "title": "Help Card",
                "durability": "0",
                "suitValue": "Jo",
                "footer": "Help Card",
                "abilities": [
                    {
                        "title": "",
                        "textType": "whole",
                        "text": "Setup for each player:\\n- Remove the 4 'Character' cards from your deck; place 1 in front of you (your Field) and set the rest aside. Your deck now has 48 'Item' and 'Ally' cards.\\n- Shuffle your deck and draw 5 cards from it. Players decide who goes first and turns proceed clockwise.\\n\\nDuring your Turn:\\n- Use abilities from cards in your field, most have costs. For what abilities look like and what their costs mean, see Help Card 2.\\n- If an abilities cost cannot be paid, the ability does not happen.\\n- Some cards have a durability value in the top-right of the card between its Name and Value-Suit (For use as standard playing cards).\\n\\nEnd of Turn:\\n- Any cards with no durability or Damage Counters (DC) at least equal to it, is destroyed.\\n- When a card is destroyed or discarded, it leaves your hand or field and moves next to it's owners Deck face-up (this is their Discard pile).\\n- Any player's with more than 5 cards in their hand has to discard cards from their hand until they have 5.\\n- Any player without a Character card in their field is out of the game and removes all cards they own from play.\\n- If you are the last remaining player, you win.",
                        "cost": []
                    }
                ]
            },
            "Joker 6": {
                "title": "Help Card 2",
                "durability": "0",
                "suitValue": "Jo",
                "footer": "Help Card",
                "abilities": [
                    {
                        "title": "Slow",
                        "textType": "normal",
                        "text": "After this ability fully resolves, your turn ends.",
                        "cost": [
                            "Slow"
                        ]
                    },
                    {
                        "title": "Tap",
                        "textType": "normal",
                        "text": "Tap a Card by turning it sideways. You can't use the ability if it's already tapped. Untapping resets this.",
                        "cost": [
                            "Tap"
                        ]
                    },
                    {
                        "title": "Power Point",
                        "textType": "normal",
                        "text": "Consume 1 Power Point generated from other abilities. The Power Points must have been generated this turn.",
                        "cost": [
                            "Power"
                        ]
                    },
                    {
                        "title": "Agility Point",
                        "textType": "normal",
                        "text": "Consume 1 Agility Point generated from other abilities. The Agility Points must have been generated this turn.",
                        "cost": [
                            "Agility"
                        ]
                    },
                    {
                        "title": "Wisdom Point",
                        "textType": "normal",
                        "text": "Consume 1 Wisdom Point generated from other abilities. The Wisdom Points must have been generated this turn.",
                        "cost": [
                            "Wisdom"
                        ]
                    }
                ]
            },
            "Joker 7": {
                "title": "Joker 7",
                "durability": 0,
                "suitValue": "Jo",
                "footer": "Joker",
                "abilities": []
            },
            "Joker 8": {
                "title": "Joker 8",
                "durability": 0,
                "suitValue": "Jo",
                "footer": "Joker",
                "abilities": []
            }
        }
    },
    "Dev": {
        "Toggle Edit Mode": "J:editMode = !editMode; showOption();",
        "Edit Notes": "J:editPath([]);",
        "Export": "J:optionsArea.innerHTML = \"\";\noutputArea.innerHTML = \"\";\nlet htmlContent = document.documentElement.outerHTML.split(\"//MARK\");\nconst last = htmlContent.pop();\nconst init = htmlContent.shift();\nconst newHTMLContent = init + \"//MARK\\nlet notes = \" + JSON.stringify(notes, null, 4) + \";\\n//MARK\" + last;\nconst blob = new Blob([newHTMLContent], {type: 'text/html'});\nconst a = document.createElement('a');\na.href = URL.createObjectURL(blob);\na.download = 'ScriptingDex.html';\na.click();\nURL.revokeObjectURL(a.href);\nshowOption();",
        "Reset": "J:resetData(); saveData();",
        "Return": "J:path.pop(); showOption();"
    }
};
//MARK

        function readNovel(novelTxt) {
            window.sections = {};
            window.textList = [];
            window.vars = {};
            window.currentSection = "";

            let currentSectionSearch = "";
            let currentPassageSearch = "";
            novelTxt.split("\n").forEach((elem) => {
                if (elem.includes("[[") && elem.includes("]]:")) {
                    currentSectionSearch = elem.split("[[")[1].split("]]:")[0];
                    sections[currentSectionSearch] = { "text": [], "shown": false, passages: {} };
                    currentPassageSearch = "";
                } else {
                    if (currentSectionSearch == "") return;

                    if (elem.includes("[") && elem.includes("]:")) {
                        currentPassageSearch = elem.split("[")[1].split("]:")[0];
                        sections[currentSectionSearch].passages[currentPassageSearch] = { shown: false, text: [] };
                    } else if (currentPassageSearch != "") {
                        sections[currentSectionSearch].passages[currentPassageSearch].text.push(elem);
                    }
                    if (currentPassageSearch == "") sections[currentSectionSearch].text.push(elem);

                }
            });

            outputArea.innerHTML = `<div id="novel" style="margin: 10px; border: 5px solid black; width: calc(100% - 40px); min-height: calc(100% - 40px); padding: 5px; border-radius: 8px; background-color: white; font-size: 22px;"></div>`;
            const novel = document.getElementById("novel");

            function processSection(obj) {
                obj.shown = true;
                obj.text.forEach((elem, index) => {
                    if (elem.startsWith("    ")) {
                        let customJS = new Function(elem);
                        customJS();
                    } else if (elem.startsWith("@clear")) {
                        obj.text.splice(index, 1)
                        textList = [];
                    } else if (elem.startsWith("@set")) {
                        const setBroken = elem.split(" ");
                        let output = (!isNaN(parseInt(setBroken[2]))) ? parseInt(setBroken[2]) : setBroken[2];
                        vars[setBroken[1]] = output;
                        obj.text.splice(index, 1)
                    } else if (elem.startsWith("@inc")) {
                        let output = (!isNaN(parseInt(setBroken[2]))) ? parseInt(setBroken[2]) : setBroken[2];
                        vars[setBroken[1]] += output;
                        obj.text.splice(index, 1)
                    } else if (elem.startsWith("@dec")) {
                        let output = (!isNaN(parseInt(setBroken[2]))) ? parseInt(setBroken[2]) : setBroken[2];
                        vars[setBroken[1]] -= output;
                        obj.text.splice(index, 1)
                    }
                })
            }

            window.showSection = function (section) {
                if (currentSection != "") {
                    for (const passage in sections[currentSection].passages) {
                        sections[currentSection].passages[passage].shown = true;
                    }
                }
                currentSection = section;
                processSection(sections[section]);
                textList.push({ section: section, text: sections[section].text.join("<br>") });
                showAllTexts();
            }

            window.showPassage = function (section, passage) {
                processSection(sections[section].passages[passage]);
                textList.push({ section: section, text: sections[section].passages[passage].text.join("<br>") });
                let tally = 0;
                for (const passageCheck in sections[section].passages) {
                    if (sections[section].passages[passageCheck].shown && !passageCheck.startsWith("@")) tally += 1;
                }
                showAllTexts();
                if (passage.startsWith("@")) return;
                if (`@${tally}` in sections[section].passages) showPassage(section, `@${tally}`);
            }

            window.showAllTexts = function () {
                novel.innerHTML = "<hr>";
                textList.forEach((elem) => {
                    let txt = elem.text;
                    let section = elem.section;
                    for (const passage in sections[section].passages) {
                        if (!sections[section].passages[passage].shown) {
                            txt = txt.replaceAll(`[${passage}]`, `<a style="cursor: pointer; color: blue; text-decoration: underline;" onclick="showPassage('${section}' , '${passage}')">${passage}</a>`);
                        } else {
                            txt = txt.replaceAll(`[${passage}]`, passage)
                        }
                    }
                    for (const newSection in sections) {
                        if (newSection != section) { // If any text box is looking at another section
                            if (section == currentSection && !sections[newSection].shown) {
                                // Modified Section: Handling [[Section]](Text) or [[Section]](Link)
                                const regex = new RegExp(`\\[\\[${newSection}\\]\\]\\((.*?)\\)`, 'g');
                                txt = txt.replaceAll(regex, (match, display) => {
                                    return `<a style="cursor: pointer; color: blue; text-decoration: underline;" onclick="showSection('${newSection}')">${display}</a>`;
                                });
                                txt = txt.replaceAll(`[[${newSection}]]`, `<a style="cursor: pointer; color: blue; text-decoration: underline;" onclick="showSection('${newSection}')">${newSection}</a>`);
                            } else {
                                const regex = new RegExp(`\\[\\[${newSection}\\]\\]\\((.*?)\\)`, 'g');
                                txt = txt.replaceAll(regex, "$1");
                                txt = txt.replaceAll(`[[${newSection}]]`, newSection);
                            }
                        } else {
                            const regex = new RegExp(`\\[\\[${newSection}\\]\\]\\((.*?)\\)`, 'g');
                            txt = txt.replaceAll(regex, "$1");
                            txt = txt.replaceAll(`[[${newSection}]]`, newSection);
                        }
                    }
                    novel.innerHTML += txt + "<hr>";
                });
            }

            showSection(Object.keys(sections)[0])
        }








        function showOption(highlightButton = -1) {
            outputArea.style.height = "auto";
            let option = notes;
            for (let i=0; i<path.length; i++) {
                option = option[path[i]];   
            }
            if (typeof option === 'object' && option !== null && !Array.isArray(option)) {
                optionsArea.innerHTML = "";
                outputArea.innerHTML = "";
                for (let i=0; i<Object.keys(option).length; i++) {
                    const optionName = Object.keys(option)[i];
                    if (optionName[0] != "!") {
                        let buttonColour = (i%2 == 0) ? "#393939" : "#262626";
                        if (editMode) buttonColour = (i%2 == 0) ? "#0e2b00" : "#081a00";
                        if (optionName == highlightButton) buttonColour = "black";
                        newOptionButton(optionName, buttonColour, function() {
                            path.push(optionName);
                            showOption();
                            scrollToBottomSmooth();
                        });
                    }
                }
            } else {
                if (editMode) {
                    editPath([...path]);
                    path.pop();
                } else {
                    if (option.startsWith('J:')) {
                        path.pop();
                        let customJS = new Function(option.substring(2));
                        customJS();   
                    } else if (option.startsWith('T:')) {
                        const chosenOption = path.pop();
                        showOption(chosenOption);
                        outputArea.innerHTML = `<div style="margin: 10px; border: 5px solid black; width: calc(100% - 40px); min-height: calc(100% - 40px); padding: 5px; border-radius: 8px; background-color: white; font-size: 22px;">${option.substring(2)}</div>`;
                    } else {
                        path.pop();
                        showOption();
                    }
                }
            }

        }

        function newOptionButton(name, colour, click) {
            let newOption = document.createElement("button");
            newOption.innerHTML = name;
            newOption.style.color = "white";
            newOption.style.backgroundColor = colour;
            newOption.style.minHeight = "60px";
            newOption.style.fontSize = "22px";
            newOption.onclick = click;
            optionsArea.appendChild(newOption);
            return newOption;
        }
        
        function scrollToBottomSmooth() {
            const optionsAreaBottom = optionsArea.offsetTop + optionsArea.offsetHeight;
            customHTML.scrollTo({
                top: optionsAreaBottom,
                behavior: 'smooth'
            });
        }

        function editPath(p) {
            let o = notes, pr = null, lk = null;
            p.forEach(part => { pr = o; lk = part; o = o[part]; });
            const isObj = typeof o === 'object' && o && !Array.isArray(o);
            optionsArea.innerHTML = "";
            outputArea.style.height = "100%";
            outputArea.innerHTML = `<textarea id="ta" wrap="off" style="margin:10;border:5px solid black;width:calc(100% - 20px);min-height:calc(100% - 20px);padding:5;border-radius:8px;background-color:white;font-size:16px;"></textarea>`;
            const ta = document.getElementById("ta");
            ta.addEventListener('keydown', e => { if (e.key === 'Tab') { e.preventDefault(); const s = ta.selectionStart, en = ta.selectionEnd; ta.value = ta.value.substring(0, s) + '    ' + ta.value.substring(en); ta.selectionStart = ta.selectionEnd = s + 4; } });
            ta.value = isObj ? JSON.stringify(o, null, 4) : o.substring(2);
            const save = () => { try { if (isObj) pr ? pr[lk] = JSON.parse(ta.value) : notes = JSON.parse(ta.value); else if (pr) pr[lk] = `${o[0]}:${ta.value}`; saveData(); showOption(); } catch (e) { alert("Invalid format."); } };
            newOptionButton("Save", "#393939", save);
            if (!isObj && o.startsWith('J:')) newOptionButton("Run", "#393939", () => { save(); try { new Function(ta.value)(); } catch (e) { alert("Error."); } showOption(); });
        }
        
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open("ScriptingDexDB", 1);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    window.db = request.result;
                    resolve();
                };
                request.onupgradeneeded = (event) => {
                    window.db = event.target.result;
                    window.db.createObjectStore("data", { keyPath: "id" });
                };
            });
        }

        function saveData() {
            return window.openDB().then(() => {
                const transaction = window.db.transaction(["data"], "readwrite");
                const objectStore = transaction.objectStore("data");
                const request = objectStore.put({
                    id: "allData",
                    notes: JSON.stringify(notes)
                });
                console.log("Saved")
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }

        function loadData() {
            return window.openDB().then(() => {
                const transaction = window.db.transaction(["data"], "readonly");
                const objectStore = transaction.objectStore("data");
                const request = objectStore.get("allData");
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        if (request.result) {
                            notes = JSON.parse(request.result.notes);
                            resolve({
                                notes: true
                            });
                        } else {
                            resolve({ notes : null });
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
            });
        }

        function resetData() {
            return new Promise((resolve, reject) => {
                console.log("Data Reset")
                const request = indexedDB.deleteDatabase("ScriptingDexDB");
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve();
            });
        }

        // loadData().then(data => {
        //     if (data.notes === null) {
        //         console.log("No notes found so using default.");
        //         window.saveData();
        //     }
        //     showOption();
        // });

        showOption();

readNovel(`
[[House]]:
You are in a house. You can go to the [Lounge] or [Kitchen].

[Lounge]:
You are in the Lounge, would you like to go to the [Kitchen] or [[Outside]](Text)?
@set toast 3

[Kitchen]:
You are in the Kitchen, would you like to go to the [Lounge] or [[Outside]]?

[@2]:
This is a timer.

[[Outside]]:
@clear
You are now outside. what would you like to do?

Go back to the [[House]]?

`);
    </script>
</body></html>
