<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <title>ToolKit</title>
    <style>
        * {
            font-family: "Rajdhani", sans-serif;
            font-weight: 500;
            font-style: normal;
        }
        body {
            margin: 0;
            background-color: #848484;
        }
        #customHTML {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            scrollbar-width: none;
        }
        #options {
            min-width: calc(100% - 10px);
            min-height: auto;
            border: solid black 5px;
            background-color: #151515;
            display: flex;
            flex-direction: column;
        }
        #output {
            width: 100%;
            min-height: auto;
        }
        @media (min-width: 800px) {
            #customHTML {
                flex-direction: row;
            }
            #options {
                height: calc(100% - 10px);
                min-width: 360px;
                overflow-y: auto;
                scrollbar-width: none;
            }
            #output {
                overflow-y: auto;
                scrollbar-width: none;
            }
        }
    </style>
    <!-- Default Styling -->
</head>
<body>
    
    <div id="customHTML">
        <div id="options" style="display: flex;"></div>
        <div id="output" style="height: auto;"></div>
    </div>


    <script>
        const customHTML = document.getElementById("customHTML");
        const optionsArea = document.getElementById("options");
        const outputArea = document.getElementById("output");
        let editMode = false;
        let path = [];
        let db;
        
//MARK
let notes = {
    "Games": {
        "Text Adventure Games": {
            "Tutorial": "J:window.adventureGameText = `\n\n[[Welcome]]:\n@clear\nThis is a simple Framework that I have created which allows you to make Text Adventure games as simply as possible.\n\nThis is played via going through sections of text such as this one and providing several options and paths for the reader to take for unique story-telling, such as the button below.\n\n[[Welcome1]](Continue)\n\n[[Welcome1]]:\n@show Welcome1\n@clear\nIt's as easy as that. Below are some more links that each showcase a different aspect of this Framework that allows you to create your own stories from scratch.\n\n[[Getting Started]]\n[[Sections and Passages]]\n[[Re-enabling Sections and Passages]]\n[[Clearing the Screen]]\n[[Using JavaScript]]\n[[Using Variables]]\n[[Variable Integration]]\n[[Asking for Input]]\n[[Turn Counting]]\n\n[[Exit]](Return)\n\n[[Getting Started]]:\n@show Getting Started\n@clear\nGetting Started\n\nFor creating your own stories you will first need to create an empty space to start writing some [JavaScript] code, don't worry, it's a lot less complicated than it sounds.\n\nTo learn how to create this space click [CreatingJavaScriptSpace](here).\n\n[[Welcome1]](Return)\n\n[JavaScript]:\nJavaScript is a fantastic coding language that pretty much runs the majority of the webs functionality.\n\nI have a pretty simple but quick guide in the Study section of this site.\n\n[CreatingJavaScriptSpace]:\nTo create the area for your JavaScript code. You can click the New Story Button alongside this Tutorial. This will create a blank template to work in, and to create future changes on the homepage of this site you can go to \"Extras\" -> \"Dev\" -> \"Toggle Edit Mode\". Then go back to the Story and select the \"Edit\" Button besides it.\n\nNote that in the \"Dev\" section you want the \"Toggle Save\" to be set to enabled, you can toggle it by clicking it. This means that any changes you make are saved to the device and arn't lost on closing the site or refreshing the page. \n\n[[Sections and Passages]]:\n@show Sections and Passages\n@clear\nSections and Passages\n\nMaking interactive stories involves 2 different types of text blocks, these are called Sections and Passages.\n\n[Sections] are the main blocks of text and [Passages] are smaller blocks of text contained within [Sections] and are opened via clickable links. When clicking a link to a [Passages](Passage) links to other [Passages] remain active. When you jump to another [Sections](Section) then [Passages] from the previous de-activate.\n\n[[Welcome1]](Return)\n\n[Sections]:\nSection names must be unique within the story and are setup by using double square brackets followed by a colon. To link to a Section, use the name of the Section in double square brackets, If you want a link to a Section but different text displayed to the reader, have the different text in brackets immediately after the link.\n\n[SectionExample](Example)\n\n[SectionExample]:\n\n &lsb&lsbStart&rsb&rsb:\n Would you like to turn &lsb&lsbTurn Left&rsb&rsb(Left) or &lsb&lsbTurn Right&rsb&rsb(Right)?\n\n &lsb&lsbTurn Left&rsb&rsb:\n You turn left.\n\n &lsb&lsbTurn Right&rsb&rsb:\n You turn right.\n\n[Passages]:\nSetup a Passages by using single brackets followed by a colon. Passages can link to further Passages. After the reader clicks a link to a Passages, that link is deactivated so the reader can only click it once. To link to a Passages, use the name of the Passage in single square brackets. If you want different text displayed to the reader put that text in brackets immediately after the link.\n\nPassage links can be explored in any order or not at all. Only after clicking a link to another Section will any remaining Passage links be deactivated. Passage names must also be unique within their Section.\n\n[PassageExample](Example)\n\n[PassageExample]:\n\n &lsb&lsbStart&rsb&rsb:\n Looking around the room, you can see a &lsbTV&rsb, a &lsbbook&rsb and a piece of &lsbpaper&rsb with some handwriting scribbled on it.\n\n &lsbTV&rsb:\n Covered in dust and the plug is missing.\n\n &lsbbook&rsb:\n It's a book of magic tricks. Maybe you should &lsbopen book&rsb(open) it?\n\n &lsbopen book&rsb:\n The cover opens up to reveal the pages all glued together, with an empty key-shaped hole cut out.\n\n &lsbpaper&rsb:\n \"Gone out for a walk. May be a while.\"\n\n[[Re-enabling Sections and Passages]]:\n@show Re-enabling Sections and Passages\n@clear\nRe-enabling Sections and Passages\n\nIf you want to reactivate a Section so that you can visit it again, you can use '@show SectionName', when this is on it's own line it will reactivate the Section and all of it's Passages to view again.\n\nThis is how the links to these Sections and Passages in this Tutorial can be revisited multiple times.\n\n[Example]\n\n[[Welcome1]](Return)\n\n[Example]:\n \n &lsb&lsbStart&rsb&rsb:\n This is a &lsblink&rsb\n \n &lsblink&rsb:\n @show Start\n\n[[Clearing the Screen]]:\n@show Clearing the Screen\n@clear\nClearing the Screen\n\nIf you want to clear the screen of all Sections and Passages in a similar way to this Tutorial is doing you can use '@clear' on a new line in a Section or Passage.\n\n[Example]\n\n[[Welcome1]](Return)\n\n[Example]:\n\n &lsb&lsbNew Section&rsb&rsb:\n @clear\n This is the start of a new section.\n\n[[Using JavaScript]]:\n@show Using JavaScript\n@clear\nUsing JavaScript\n\nAny Section or Passage can call some custom JavaScript when it is displayed. Simply begin the line with '@JS ' and all the JavaScript following.\n\n[Example]\n\n[[Welcome1]](Return)\n\n[Example]:\n\n &lsb&lsbStart&rsb&rsb:\n Clicking this &lsblink&rsb will use the built in function to send the reader to the Section with name 'Test'.\n\n &lsblink&rsb:\n @JS goTo('Test');\n Text for the Passage.\n\n[[Using Variables]]:\n@show Using Variables\n@clear\nUsing Variables\n\nYou can set Variables within Passages and Sections by using '@set VariableName VariableValue'.\n\nIf the Variable is a number you can quickly increase or decrease its value by using '@inc VariableName IncreaseValue' and '@dec VariableName DecreaseValue'.\n\nYou can also set a Variable via a Passage or Section link.\n\n[Example]\n\n[[Welcome1]](Return)\n\n[Example]:\n\n &lsbPassageName, Var1=Val1&rsb(Custom Text)\n\n This will show 'Custom Text' and when clicking it, it will take you to the Passage 'PassageName' and create the Variable Var1 with the value Val1.\n\n[[Variable Integration]]:\n@show Variable Integration\n@clear\nVariable Integration\n\nIf you want to include the value of a Variable within your text you can include the name of the Variable enclosed in curly brackets.\n\n[Example1](Example)\n\nAlso for some really interesting functionality you can have links to Passages and Sections link to alternative Passages and Sections depending on the value of a Variable..\n\n[Example2](Example)\n\n[[Welcome1]](Return)\n\n[Example1]:\n &lsb&lsbStart&rsb&rsb:\n You have &lcbCount&rcb Coins.\n\n[Example2]:\n &lsb&lsbStart&rsb&rsb:\n Click this &lsbTrueLink, Var1==Val1, FalseLink&rsb(Link) to Continue.\n\n In this example you have the text 'Link' be selectable and when clicked it checks if the value of Variable called 'Var1' is equal to the value 'val1'. If it is you are taken to the Passage with name 'TrueLink', otherwise you are taken to the Passage with name 'FalseLink'.\n\n Whilst == is used to determine 'is equal to', you can also use < for 'less than' and > for 'greater than'.\n\n[[Asking for Input]]:\n@show Asking for Input\n@clear\nAsking for Input\n\nYou can use '@prompt Var1 CustomText' on it's own line in a Section or Passage and will open a prompt window to the user with text 'CustomText' and the readers input becomes the value for Variable with name 'Var1'.\n\n[[Welcome1]](Return)\n\n[[Turn Counting]]:\n@show Turn Counting\n@clear\nTurn Counting\n\nYou can trigger a Passages after the reader has made a certain number of clicks within a Section. This is useful for giving a sense of time, for example you can easily have it load a Passage after you have viewed any 3 other Passages, or the Passage might run some custom JavaScript that could send the reader to another Section.\n\nThis is done via having a Passage with the name '@i SectionName' where i is the number of Passages you want to pass before this automatically sends the reader to a Section with name 'SectionName'.\n\n[Example]\n\n[[Welcome1]](Return)\n\n[Example]:\n &lsb@3 NextSection&rsb:\n\n &lsb&lsbNextSection&rsb&rsb:\n\n In this example after 3 Passage links have been clicked it will automatically take you to the Section called 'SectionName'.\n\n[[Exit]]:\n@JS path.pop(); showOption();\n`;\n\ntextAdventure(adventureGameText);\n\n\n\n\n\n\n\n\n\n\n/*\n@clear\n@show Passage1\n@JS CustomJS\n@set Var1 Val1\n@inc Var1 Val2\n@dec Var1 Val2\n@prompt Var1 CustomTextToDisplay\n@Number PassageToShowAfterNumberPassagesShown \n[[Section1]]:\n[Passage1]:\n[[Section1]](Custom Text)\n[Passage1](Custom Text)\n[Passage1, Var1=Val1](Custom Text)\n[Passage1, Var1==Val1, IfFalsePassage](Custom Text)\n\n*/",
            "Demo Story": "J:const story = `\n\n[[Start]]:\nThis is the text of the first Section.\n\n[Passage1](Click here to enter name)\n\n[[Exit]](Return)\n\n[Passage1]:\n@prompt name Please enter your name.\nYou have entered the name - {name}.\n\n[[Exit]]:\n@JS path.pop(); showOption();\n`;\n\n\n\ntextAdventure(story);",
            "Create New Story": "J:const askName = prompt(\"What would you like the name of the Story to be?\");\nlet storyName = (askName) ? askName : \"New Story\";\nconst newStoryFunction = notes[\"Games\"][\"Text Adventure Games\"][\"Create New Story\"];\ndelete notes[\"Games\"][\"Text Adventure Games\"][\"Create New Story\"];\nnotes[\"Games\"][\"Text Adventure Games\"][storyName] = \"J:const story = `\\n\\n[[Section]]:\\nThis is the text of the first Section.\\n\\n[Passage]:\\nThis is the text of the first Passage.\\n\\n`;\\n\\n\\n\\ntextAdventure(story);\";\nnotes[\"Games\"][\"Text Adventure Games\"][\"Create New Story\"] = newStoryFunction;\npath.pop();\npath.push(storyName);\neditPath(path);\npath.pop();"
        },
        "Chess": "J:let hiddenPieces = false;\nwindow.aiDepth = 1;\nwindow.playerMode = \"PvP\";\nwindow.playerSide = \"W\";\nconst Q_SEARCH_MAX_DEPTH = 5;\nconst piecePSTs = {\n    'P': [\n        [  0,  0,  0,  0,  0,  0,  0,  0],\n        [ 50, 50, 50, 50, 50, 50, 50, 50],\n        [ 10, 10, 20, 30, 30, 20, 10, 10],\n        [  5,  5, 10, 25, 25, 10,  5,  5],\n        [  0,  0,  0, 20, 20,  0,  0,  0],\n        [  5, -5,-10,  0,  0,-10, -5,  5],\n        [  5, 10, 10,-20,-20, 10, 10,  5],\n        [  0,  0,  0,  0,  0,  0,  0,  0]\n    ],\n    'N': [\n        [-50,-40,-30,-30,-30,-30,-40,-50],\n        [-40,-20,  0,  0,  0,  0,-20,-40],\n        [-30,  0, 10, 15, 15, 10,  0,-30],\n        [-30,  5, 15, 20, 20, 15,  5,-30],\n        [-30,  0, 15, 20, 20, 15,  0,-30],\n        [-30,  5, 10, 15, 15, 10,  5,-30],\n        [-40,-20,  0,  5,  5,  0,-20,-40],\n        [-50,-40,-30,-30,-30,-30,-40,-50]\n    ],\n    'B': [\n        [-20,-10,-10,-10,-10,-10,-10,-20],\n        [-10,  0,  0,  0,  0,  0,  0,-10],\n        [-10,  0,  5, 10, 10,  5,  0,-10],\n        [-10,  5,  5, 10, 10,  5,  5,-10],\n        [-10,  0, 10, 10, 10, 10,  0,-10],\n        [-10, 10, 10, 10, 10, 10, 10,-10],\n        [-10,  5,  0,  0,  0,  0,  5,-10],\n        [-20,-10,-10,-10,-10,-10,-10,-20]\n    ],\n    'R': [\n        [  0,  0,  0,  0,  0,  0,  0,  0],\n        [  5, 10, 10, 10, 10, 10, 10,  5],\n        [ -5,  0,  0,  0,  0,  0,  0, -5],\n        [ -5,  0,  0,  0,  0,  0,  0, -5],\n        [ -5,  0,  0,  0,  0,  0,  0, -5],\n        [ -5,  0,  0,  0,  0,  0,  0, -5],\n        [ -5,  0,  0,  0,  0,  0,  0, -5],\n        [  0,  0,  0,  5,  5,  0,  0,  0]\n    ],\n    'Q': [\n        [-20,-10,-10, -5, -5,-10,-10,-20],\n        [-10,  0,  0,  0,  0,  0,  0,-10],\n        [-10,  0,  5,  5,  5,  5,  0,-10],\n        [ -5,  0,  5,  5,  5,  5,  0, -5],\n        [  0,  0,  5,  5,  5,  5,  0, -5],\n        [-10,  5,  5,  5,  5,  5,  0,-10],\n        [-10,  0,  5,  0,  0,  0,  0,-10],\n        [-20,-10,-10, -5, -5,-10,-10,-20]\n    ],\n    'K_Mid': [\n        [-30,-40,-40,-50,-50,-40,-40,-30],\n        [-30,-40,-40,-50,-50,-40,-40,-30],\n        [-30,-40,-40,-50,-50,-40,-40,-30],\n        [-30,-40,-40,-50,-50,-40,-40,-30],\n        [-20,-30,-30,-40,-40,-30,-30,-20],\n        [-10,-20,-20,-20,-20,-20,-20,-10],\n        [ 20, 20,  0,  0,  0,  0, 20, 20],\n        [ 20, 30, 10,  0,  0, 10, 30, 20]\n    ],\n    'K_End': [\n        [-50,-40,-30,-20,-20,-30,-40,-50],\n        [-30,-20,-10,  0,  0,-10,-20,-30],\n        [-30,-10, 20, 30, 30, 20,-10,-30],\n        [-30,-10, 30, 40, 40, 30,-10,-30],\n        [-30,-10, 30, 40, 40, 30,-10,-30],\n        [-30,-10, 20, 30, 30, 20,-10,-30],\n        [-30,-30,  0,  0,  0,  0,-30,-30],\n        [-50,-30,-30,-30,-30,-30,-30,-50]\n    ]\n};\nfunction getPSTValue(pieceType, x, y, color, isEndgame) {\n    const tableKey = (pieceType === 'K') ? (isEndgame ? 'K_End' : 'K_Mid') : pieceType;\n    const table = piecePSTs[tableKey];\n    if (!table) return 0;\n    const pstRank = 7 - y;\n    const pstFile = x;\n    const valueFromWhitePerspective = table?.[pstRank]?.[pstFile] ?? 0;\n    return (color === 'W') ? valueFromWhitePerspective : -valueFromWhitePerspective;\n}\nconst pieces = {\"WP\":11, \"WR\":10, \"WN\":9, \"WB\":8, \"WQ\":7, \"WK\":6, \"BP\":5, \"BR\":4, \"BN\":3, \"BB\":2, \"BQ\":1, \"BK\":0};\nconst pieceValues = {\"P\": 100, \"N\": 320, \"B\": 330, \"R\": 500, \"Q\": 900, \"K\": 20000};\nconst CHECKMATE_SCORE = 100000;\nconst DRAW_SCORE = 0;\nconst ISOLATED_PAWN_PENALTY = -10;\nconst DOUBLED_PAWN_PENALTY = -10;\nconst BISHOP_PAIR_BONUS = 30;\nconst ROOK_ON_SEVENTH_BONUS = 20;\nconst KING_SAFETY_OPEN_FILE_PENALTY = 15;\nconst openingBook = {\n  \"4x64x4\": {\n    \"4x14x3\": {\n      \"6x75x5\": {\n        \"1x02x2\": {\n          \"5x71x3\": null,\n          \"5x72x4\": null,\n        },\n        \"6x05x2\": {\n          \"5x54x3\": null,\n          \"3x63x4\": null,\n        }\n      },\n      \"1x72x5\": {\n         \"1x02x2\": null,\n         \"6x05x2\": null,\n      }\n    },\n    \"2x13x3\": {\n      \"6x75x5\": {\n        \"3x13x2\": { \"3x63x4\": null },\n        \"1x02x2\": { \"3x63x4\": null },\n        \"4x13x2\": { \"3x63x4\": null },\n      },\n      \"1x72x5\": {\n        \"1x02x2\": null,\n        \"6x15x3\": null,\n        \"4x13x2\": null,\n      },\n      \"2x62x5\": {\n          \"3x13x3\": null,\n          \"6x05x2\": null,\n      }\n    },\n    \"4x13x2\": {\n      \"3x63x4\": {\n        \"3x13x3\": {\n          \"1x72x5\": null,\n          \"1x73x5\": null,\n          \"4x44x3\": null,\n        },\n      },\n    },\n    \"2x12x3\": {\n      \"3x63x4\": {\n          \"3x13x3\": {\n              \"1x72x5\": null,\n              \"4x44x3\": null,\n              \"4x64x5\": null,\n          }\n      }\n    },\n  },\n  \"3x63x4\": {\n    \"6x05x2\": {\n      \"2x62x4\": {\n        \"6x15x3\": {\n          \"1x72x5\": null,\n        },\n        \"4x13x2\": {\n          \"6x75x5\": null,\n          \"1x72x5\": null,\n        },\n        \"2x13x3\": {\n            \"3x43x3\": null,\n        }\n      },\n      \"6x75x5\": {\n          \"6x15x3\": null,\n          \"4x13x2\": null,\n      }\n    },\n    \"3x13x3\": {\n      \"2x62x4\": {\n        \"3x32x4\": {\n          \"6x75x5\": null,\n          \"4x64x4\": null,\n        },\n        \"4x13x2\": {\n          \"1x72x5\": null,\n          \"6x75x5\": null,\n        },\n        \"2x12x3\": {\n          \"6x75x5\": null,\n          \"1x72x5\": null,\n        }\n      },\n       \"6x75x5\": {\n           \"6x05x2\": null,\n           \"2x05x3\": null,\n       }\n    },\n    \"5x15x3\": {\n        \"6x75x5\": null,\n        \"2x62x4\": null,\n        \"6x15x3\": null,\n    }\n  },\n  \"6x75x5\": {\n      \"6x05x2\": null,\n      \"3x13x3\": null,\n      \"2x13x3\": null,\n  },\n  \"2x62x4\": {\n      \"4x14x3\": null,\n      \"2x13x3\": null,\n      \"6x05x2\": null,\n      \"6x15x3\": null,\n  }\n};\nlet grid = {};\nlet selectedPiece = \"\";\nlet turn = \"W\";\nlet moves = {};\nlet legalMovesCache = {};\nlet castlingRights = { WQ: true, WK: true, BQ: true, BK: true };\nlet enPassantTarget = null;\nlet moveHistory = [];\nlet gameStatus = \"ongoing\";\nlet isAiThinking = false;\nfunction deepCopyState(board, rights, epTarget) {\n    const newGrid = {};\n    for (const coord in board) {\n        newGrid[coord] = { ...board[coord] };\n    }\n    const newRights = { ...rights };\n    return { grid: newGrid, castlingRights: newRights, enPassantTarget: epTarget };\n}\nfunction getKingCoord(side, board) {\n    const kingPiece = side + \"K\";\n    for (const coord in board) {\n        if (board[coord]?.piece === kingPiece) {\n            return coord;\n        }\n    }\n    return null;\n}\nfunction isSquareAttacked(targetCoord, attackerSide, board) {\n    const [targetX, targetY] = targetCoord.split('x').map(Number);\n    const defenderSide = attackerSide === 'W' ? 'B' : 'W';\n    const pawnAttackDir = attackerSide === 'W' ? -1 : 1;\n    const pawnCheckY = targetY - pawnAttackDir;\n    if (pawnCheckY >= 0 && pawnCheckY <= 7) {\n        for (let dx of [-1, 1]) {\n            const pawnCheckX = targetX + dx;\n            if (pawnCheckX >= 0 && pawnCheckX <= 7) {\n                const attackerPawn = board[`${pawnCheckX}x${pawnCheckY}`]?.piece;\n                if (attackerPawn === attackerSide + 'P') return true;\n            }\n        }\n    }\n    const knightMoves = [[1, 2], [1, -2], [2, 1], [2, -1], [-1, 2], [-1, -2], [-2, 1], [-2, -1]];\n    for (const [dx, dy] of knightMoves) {\n        const knightX = targetX + dx;\n        const knightY = targetY + dy;\n        if (knightX >= 0 && knightX <= 7 && knightY >= 0 && knightY <= 7) {\n            const attackerKnight = board[`${knightX}x${knightY}`]?.piece;\n            if (attackerKnight === attackerSide + 'N') return true;\n        }\n    }\n    const kingMoves = [[-1, -1], [1, 1], [-1, 1], [1, -1], [-1, 0], [1, 0], [0, 1], [0, -1]];\n     for (const [dx, dy] of kingMoves) {\n        const kingX = targetX + dx;\n        const kingY = targetY + dy;\n        if (kingX >= 0 && kingX <= 7 && kingY >= 0 && kingY <= 7) {\n            const attackerKing = board[`${kingX}x${kingY}`]?.piece;\n            if (attackerKing === attackerSide + 'K') return true;\n        }\n    }\n    const checkLine = (directions, attackingPieceTypes) => {\n        for (const [dx, dy] of directions) {\n            for (let i = 1; i < 8; i++) {\n                const checkX = targetX + dx * i;\n                const checkY = targetY + dy * i;\n                if (checkX < 0 || checkX > 7 || checkY < 0 || checkY > 7) break;\n                const pieceOnLine = board[`${checkX}x${checkY}`]?.piece;\n                if (pieceOnLine) {\n                    if (pieceOnLine.startsWith(attackerSide) && attackingPieceTypes.includes(pieceOnLine[1])) {\n                        return true;\n                    }\n                    break;\n                }\n            }\n        }\n        return false;\n    };\n    if (checkLine([[-1, 0], [1, 0], [0, 1], [0, -1]], ['R', 'Q'])) return true;\n    if (checkLine([[-1, -1], [1, 1], [-1, 1], [1, -1]], ['B', 'Q'])) return true;\n    return false;\n}\nfunction isEndgamePhase(board) {\n    let whiteMaterial = 0;\n    let blackMaterial = 0;\n    let queens = 0;\n    for (const coord in board) {\n        const piece = board[coord]?.piece;\n        if (piece) {\n            const type = piece[1];\n            const value = pieceValues[type] || 0;\n            if (piece[0] === 'W') whiteMaterial += value;\n            else blackMaterial += value;\n            if (type === 'Q') queens++;\n        }\n    }\n    const totalMaterial = whiteMaterial + blackMaterial - 2 * pieceValues['K'];\n    return queens === 0 || (queens <= 1 && totalMaterial < 4000) || totalMaterial < 2500;\n}\nconst chessMain = {\n    init() {\n        grid = {};\n        for (let y = 0; y < 8; y++) {\n             for (let x = 0; x < 8; x++) {\n                 let pieceValue = \"\";\n                 if (y == 1) pieceValue = \"BP\";\n                 if (y == 6) pieceValue = \"WP\";\n                 if ((x == 0 || x == 7) && (y == 0)) pieceValue = \"BR\";\n                 if ((x == 0 || x == 7) && (y == 7)) pieceValue = \"WR\";\n                 if ((x == 1 || x == 6) && (y == 0)) pieceValue = \"BN\";\n                 if ((x == 1 || x == 6) && (y == 7)) pieceValue = \"WN\";\n                 if ((x == 2 || x == 5) && (y == 0)) pieceValue = \"BB\";\n                 if ((x == 2 || x == 5) && (y == 7)) pieceValue = \"WB\";\n                 if ((x == 3) && (y == 0)) pieceValue = \"BQ\";\n                 if ((x == 4) && (y == 0)) pieceValue = \"BK\";\n                 if ((x == 3) && (y == 7)) pieceValue = \"WQ\";\n                 if ((x == 4) && (y == 7)) pieceValue = \"WK\";\n                 grid[`${x}x${y}`] = { x: 2 + (x * 18), y: 2 + (y * 18), piece: pieceValue };\n             }\n          }\n        castlingRights = { WQ: true, WK: true, BQ: true, BK: true };\n        enPassantTarget = null;\n        moveHistory = [];\n        gameStatus = \"ongoing\";\n        isAiThinking = false;\n        turn = \"W\";\n        this.generateAllLegalMoves();\n        selectedPiece = \"\";\n        moves = {};\n        if (playerMode === 'PvAI' && turn !== playerSide) {\n             this.triggerAIMove();\n        }\n    },\n    makeMove(move) {\n        if (!move || !grid[move.from]?.piece || !grid[move.to]) {\n            if(isAiThinking) { isAiThinking = false; }\n            return false;\n        }\n        const { from, to, type, promotion } = move;\n        const piece = grid[from].piece;\n        const targetPiece = grid[to].piece;\n        const prevEnPassantTarget = enPassantTarget;\n        const prevCastlingRights = { ...castlingRights };\n        let capturedPiece = targetPiece;\n        grid[to].piece = piece;\n        grid[from].piece = \"\";\n        enPassantTarget = null;\n        if (type === \"castle\") {\n            const rookFromX = (to.split('x')[0] === '6') ? 7 : 0;\n            const rookToX = (to.split('x')[0] === '6') ? 5 : 3;\n            const rank = from.split('x')[1];\n            const rookFromCoord = `${rookFromX}x${rank}`;\n            const rookToCoord = `${rookToX}x${rank}`;\n            grid[rookToCoord].piece = grid[rookFromCoord].piece;\n            grid[rookFromCoord].piece = \"\";\n        } else if (type === \"enpassant\") {\n            const capturedPawnY = from.split('x')[1];\n            const capturedPawnX = to.split('x')[0];\n            const capturedCoord = `${capturedPawnX}x${capturedPawnY}`;\n            capturedPiece = grid[capturedCoord]?.piece;\n            if (grid[capturedCoord]) grid[capturedCoord].piece = \"\";\n        } else if (promotion) {\n            grid[to].piece = piece[0] + promotion;\n        }\n        const [fromX, fromY] = from.split('x').map(Number);\n        const [toX, toY] = to.split('x').map(Number);\n        const currentSide = piece[0];\n        if (piece[1] === 'P' && Math.abs(fromY - toY) === 2) {\n            const epRank = (currentSide === 'W') ? toY + 1 : toY - 1;\n            enPassantTarget = `${toX}x${epRank}`;\n        }\n        if (piece === \"WK\") { castlingRights.WK = false; castlingRights.WQ = false; }\n        else if (piece === \"BK\") { castlingRights.BK = false; castlingRights.BQ = false; }\n        else if (piece === \"WR\") {\n            if (from === \"0x7\") castlingRights.WQ = false; else if (from === \"7x7\") castlingRights.WK = false;\n        } else if (piece === \"BR\") {\n            if (from === \"0x0\") castlingRights.BQ = false; else if (from === \"7x0\") castlingRights.BK = false;\n        }\n        if (targetPiece === \"WR\") {\n             if (to === \"0x7\") castlingRights.WQ = false; else if (to === \"7x7\") castlingRights.WK = false;\n        } else if (targetPiece === \"BR\") {\n             if (to === \"0x0\") castlingRights.BQ = false; else if (to === \"7x0\") castlingRights.BK = false;\n        }\n        moveHistory.push({\n            ...move, piece, captured: capturedPiece,\n            prevEPTarget: prevEnPassantTarget,\n            prevCastlingRights: prevCastlingRights\n        });\n        this.nextTurn();\n        return true;\n    },\n    generateAllLegalMoves() {\n        legalMovesCache = this.getAllAvailableMoves(turn, grid, castlingRights, enPassantTarget, false);\n        if (gameStatus === \"ongoing\") {\n            const kingCoord = getKingCoord(turn, grid);\n            const opponentSide = (turn === 'W' ? 'B' : 'W');\n            const isInCheck = kingCoord ? isSquareAttacked(kingCoord, opponentSide, grid) : false;\n            let hasLegalMoves = Object.values(legalMovesCache).some(movesArray => movesArray.length > 0);\n            if (!hasLegalMoves) {\n                if (isInCheck) {\n                    gameStatus = \"checkmate\";\n                } else {\n                    gameStatus = \"stalemate\";\n                }\n            }\n        }\n    },\n    getAllAvailableMoves(side, currentGrid, currentCastlingRights, currentEnPassantTarget, skipCheckValidation = false) {\n        let availableMoves = {};\n        const opponentSide = (side === 'W') ? 'B' : 'W';\n        for (let y = 0; y < 8; y++) {\n            for (let x = 0; x < 8; x++) {\n                const coord = `${x}x${y}`;\n                const cell = currentGrid[coord];\n                if (!cell || !cell.piece.startsWith(side)) continue;\n                const piece = cell.piece;\n                const pieceType = piece[1];\n                availableMoves[coord] = [];\n                const currentX = x;\n                const currentY = y;\n                const potentialMoves = [];\n                const checkTarget = (tx, ty, moveProps = {}) => {\n                     if (tx < 0 || tx > 7 || ty < 0 || ty > 7) return null;\n                     const targetCoord = `${tx}x${ty}`;\n                     const targetCell = currentGrid[targetCoord];\n                     if (!targetCell) return null;\n                     if (targetCell.piece === \"\") {\n                         return { from: coord, to: targetCoord, ...moveProps };\n                     } else if (!targetCell.piece.startsWith(side)) {\n                         return { from: coord, to: targetCoord, ...moveProps };\n                     }\n                     return null;\n                 };\n                 const addSlidingMoves = (directions) => {\n                     directions.forEach(([dx, dy]) => {\n                         for (let i = 1; i < 8; i++) {\n                             const targetX = currentX + dx * i;\n                             const targetY = currentY + dy * i;\n                             const move = checkTarget(targetX, targetY);\n                             if (move) {\n                                 potentialMoves.push(move);\n                                 if (currentGrid[`${targetX}x${targetY}`]?.piece) {\n                                     break;\n                                 }\n                             } else {\n                                 break;\n                             }\n                         }\n                     });\n                  };\n                  const addSingleStepMoves = (directions) => {\n                       directions.forEach(([dx, dy]) => {\n                           const move = checkTarget(currentX + dx, currentY + dy);\n                           if(move) potentialMoves.push(move);\n                       });\n                   };\n                 if (pieceType === \"P\") {\n                     const dir = (side === \"W\") ? -1 : 1;\n                     const startRank = (side === \"W\") ? 6 : 1;\n                     const promotionRank = (side === \"W\") ? 0 : 7;\n                     const forward1Y = currentY + dir;\n                     const forward1Coord = `${currentX}x${forward1Y}`;\n                     if (forward1Y >= 0 && forward1Y <= 7 && currentGrid[forward1Coord]?.piece === \"\") {\n                         if (forward1Y === promotionRank) {\n                             ['Q', 'R', 'N', 'B'].forEach(p => potentialMoves.push({ from: coord, to: forward1Coord, promotion: p }));\n                         } else {\n                             potentialMoves.push({ from: coord, to: forward1Coord });\n                         }\n                         const forward2Y = currentY + dir * 2;\n                         const forward2Coord = `${currentX}x${forward2Y}`;\n                         if (currentY === startRank && currentGrid[forward2Coord]?.piece === \"\") {\n                             potentialMoves.push({ from: coord, to: forward2Coord });\n                         }\n                     }\n                     for (let dx of [-1, 1]) {\n                         const captureX = currentX + dx;\n                         const captureY = currentY + dir;\n                         if (captureX < 0 || captureX > 7 || captureY < 0 || captureY > 7) continue;\n                         const captureCoord = `${captureX}x${captureY}`;\n                         const targetCell = currentGrid[captureCoord];\n                         if (targetCell) {\n                            if (targetCell.piece !== \"\" && targetCell.piece.startsWith(opponentSide)) {\n                                if (captureY === promotionRank) {\n                                    ['Q', 'R', 'N', 'B'].forEach(p => potentialMoves.push({ from: coord, to: captureCoord, promotion: p }));\n                                } else {\n                                    potentialMoves.push({ from: coord, to: captureCoord });\n                                }\n                            }\n                            else if (captureCoord === currentEnPassantTarget && targetCell.piece === \"\") {\n                                potentialMoves.push({ from: coord, to: captureCoord, type: \"enpassant\" });\n                            }\n                         }\n                     }\n                 } else if (pieceType === \"R\") {\n                     addSlidingMoves([[-1, 0], [1, 0], [0, 1], [0, -1]]);\n                 } else if (pieceType === \"N\") {\n                     addSingleStepMoves([[1, 2], [1, -2], [2, 1], [2, -1], [-1, 2], [-1, -2], [-2, 1], [-2, -1]]);\n                 } else if (pieceType === \"B\") {\n                     addSlidingMoves([[-1, -1], [1, 1], [-1, 1], [1, -1]]);\n                 } else if (pieceType === \"Q\") {\n                     addSlidingMoves([[-1, -1], [1, 1], [-1, 1], [1, -1], [-1, 0], [1, 0], [0, 1], [0, -1]]);\n                 } else if (pieceType === \"K\") {\n                     addSingleStepMoves([[-1, -1], [1, 1], [-1, 1], [1, -1], [-1, 0], [1, 0], [0, 1], [0, -1]]);\n                     if (!skipCheckValidation) {\n                         const rank = (side === 'W') ? 7 : 0;\n                         const kingStartCoord = `4x${rank}`;\n                         if (coord === kingStartCoord && !isSquareAttacked(coord, opponentSide, currentGrid)) {\n                             const KSCastleRight = side + 'K';\n                             if (currentCastlingRights[KSCastleRight] &&\n                                 currentGrid[`5x${rank}`]?.piece === \"\" &&\n                                 currentGrid[`6x${rank}`]?.piece === \"\" &&\n                                 currentGrid[`7x${rank}`]?.piece === (side + 'R') &&\n                                 !isSquareAttacked(`5x${rank}`, opponentSide, currentGrid) &&\n                                 !isSquareAttacked(`6x${rank}`, opponentSide, currentGrid)) {\n                                 potentialMoves.push({ from: coord, to: `6x${rank}`, type: \"castle\" });\n                             }\n                              const QSCastleRight = side + 'Q';\n                              if (currentCastlingRights[QSCastleRight] &&\n                                  currentGrid[`3x${rank}`]?.piece === \"\" &&\n                                  currentGrid[`2x${rank}`]?.piece === \"\" &&\n                                  currentGrid[`1x${rank}`]?.piece === \"\" &&\n                                  currentGrid[`0x${rank}`]?.piece === (side + 'R') &&\n                                  !isSquareAttacked(`3x${rank}`, opponentSide, currentGrid) &&\n                                  !isSquareAttacked(`2x${rank}`, opponentSide, currentGrid)) {\n                                  potentialMoves.push({ from: coord, to: `2x${rank}`, type: \"castle\" });\n                              }\n                          }\n                     }\n                 }\n                 if (!skipCheckValidation) {\n                     potentialMoves.forEach(move => {\n                         let tempState = deepCopyState(currentGrid, currentCastlingRights, currentEnPassantTarget);\n                         this.applyTemporaryMove(tempState.grid, move, tempState.castlingRights, tempState.enPassantTarget, true);\n                         const kingCoordAfterMove = getKingCoord(side, tempState.grid);\n                         if (kingCoordAfterMove && !isSquareAttacked(kingCoordAfterMove, opponentSide, tempState.grid)) {\n                             availableMoves[coord].push(move);\n                         }\n                     });\n                 } else {\n                     availableMoves[coord].push(...potentialMoves);\n                 }\n            }\n        }\n        return availableMoves;\n    },\n    evalBoard(board, currentTurnCastlingRights) {\n        let totalScore = 0;\n        const endgame = isEndgamePhase(board);\n        let pawnCounts = { W: Array(8).fill(0), B: Array(8).fill(0) };\n        let pieceCounts = { W: {'B': 0}, B: {'B': 0}};\n        let fileHasPawn = { W: Array(8).fill(false), B: Array(8).fill(false) };\n        let whiteKingCoord = null;\n        let blackKingCoord = null;\n        for (const coord in board) {\n            const cell = board[coord];\n            if (!cell || cell.piece === \"\") continue;\n            const piece = cell.piece;\n            const pieceType = piece[1];\n            const pieceColor = piece[0];\n            const [x, y] = coord.split('x').map(Number);\n            const materialValue = pieceValues[pieceType] || 0;\n            totalScore += (pieceColor === 'W') ? materialValue : -materialValue;\n            totalScore += getPSTValue(pieceType, x, y, pieceColor, endgame);\n            if (pieceType === 'P') {\n                pawnCounts[pieceColor][x]++;\n                fileHasPawn[pieceColor][x] = true;\n            } else if (pieceType === 'B') {\n                pieceCounts[pieceColor]['B']++;\n            } else if (pieceType === 'K') {\n                if (pieceColor === 'W') whiteKingCoord = coord; else blackKingCoord = coord;\n            } else if (pieceType === 'R') {\n                const seventhRankY = (pieceColor === 'W') ? 1 : 6;\n                if (y === seventhRankY) {\n                    totalScore += (pieceColor === 'W') ? ROOK_ON_SEVENTH_BONUS : -ROOK_ON_SEVENTH_BONUS;\n                }\n            }\n        }\n        for (let x = 0; x < 8; x++) {\n            if (pawnCounts['W'][x] > 1) totalScore += DOUBLED_PAWN_PENALTY;\n            if (pawnCounts['B'][x] > 1) totalScore -= DOUBLED_PAWN_PENALTY;\n            const hasLeftNeighborW = (x > 0) && pawnCounts['W'][x - 1] > 0;\n            const hasRightNeighborW = (x < 7) && pawnCounts['W'][x + 1] > 0;\n            if (pawnCounts['W'][x] > 0 && !hasLeftNeighborW && !hasRightNeighborW) {\n                totalScore += ISOLATED_PAWN_PENALTY;\n            }\n            const hasLeftNeighborB = (x > 0) && pawnCounts['B'][x - 1] > 0;\n            const hasRightNeighborB = (x < 7) && pawnCounts['B'][x + 1] > 0;\n            if (pawnCounts['B'][x] > 0 && !hasLeftNeighborB && !hasRightNeighborB) {\n                totalScore -= ISOLATED_PAWN_PENALTY;\n            }\n        }\n        if (pieceCounts['W']['B'] >= 2) totalScore += BISHOP_PAIR_BONUS;\n        if (pieceCounts['B']['B'] >= 2) totalScore -= BISHOP_PAIR_BONUS;\n        if (!endgame) {\n            [whiteKingCoord, blackKingCoord].forEach((kCoord, index) => {\n                if (!kCoord) return;\n                const color = (index === 0) ? 'W' : 'B';\n                const opponentColor = (index === 0) ? 'B' : 'W';\n                const [kingX] = kCoord.split('x').map(Number);\n                for (let dx = -1; dx <= 1; dx++) {\n                    const fileX = kingX + dx;\n                    if (fileX < 0 || fileX > 7) continue;\n                    const isSemiOpenForOpponent = !fileHasPawn[color][fileX];\n                    const isOpen = isSemiOpenForOpponent && !fileHasPawn[opponentColor][fileX];\n                    if (isOpen || isSemiOpenForOpponent) {\n                         totalScore += (color === 'W') ? KING_SAFETY_OPEN_FILE_PENALTY : -KING_SAFETY_OPEN_FILE_PENALTY;\n                    }\n                }\n            });\n        }\n        return totalScore;\n    },\n     scoreMove(move, board, isEndgame) {\n        let score = 0;\n        const movingPiece = board[move.from]?.piece;\n        const capturedPieceDirect = board[move.to]?.piece;\n        if(!movingPiece) return 0;\n        const movingPieceType = movingPiece[1];\n        const movingColor = movingPiece[0];\n        let capturedPieceType = null;\n        if (capturedPieceDirect) {\n            capturedPieceType = capturedPieceDirect[1];\n        } else if (move.type === 'enpassant') {\n            capturedPieceType = 'P';\n        }\n        if (capturedPieceType) {\n            score += 10 * (pieceValues[capturedPieceType] || 0) - (pieceValues[movingPieceType] || 0);\n        }\n        if (move.promotion) {\n            score += pieceValues[move.promotion] || 0;\n        }\n        const [fromX, fromY] = move.from.split('x').map(Number);\n        const [toX, toY] = move.to.split('x').map(Number);\n        const fromValue = getPSTValue(movingPieceType, fromX, fromY, movingColor, isEndgame);\n        const toValue = getPSTValue(movingPieceType, toX, toY, movingColor, isEndgame);\n        const pstGain = toValue - fromValue;\n        score += pstGain * 0.1;\n        return score;\n    },\n    generateNoisyMoves(side, board, rights, epTarget) {\n        const allMovesMap = this.getAllAvailableMoves(side, board, rights, epTarget, true);\n        const noisyMoves = [];\n        const promotionRank = (side === 'W') ? 0 : 7;\n        for (const startSq in allMovesMap) {\n            allMovesMap[startSq].forEach(move => {\n                const isCapture = board[move.to]?.piece || move.type === 'enpassant';\n                const isPromotion = move.promotion || (board[move.from]?.piece?.[1] === 'P' && parseInt(move.to.split('x')[1]) === promotionRank);\n                if (isCapture || isPromotion) {\n                    noisyMoves.push(move);\n                }\n            });\n        }\n        return noisyMoves;\n    },\n     quiescenceSearch(board, depth, alpha, beta, maximizingPlayer, currentCastlingRights, currentEnPassantTarget) {\n        const standPatScore = this.evalBoard(board, currentCastlingRights);\n        if (maximizingPlayer) {\n            if (standPatScore >= beta) return beta;\n            alpha = Math.max(alpha, standPatScore);\n        } else {\n            if (standPatScore <= alpha) return alpha;\n            beta = Math.min(beta, standPatScore);\n        }\n        if (depth <= 0) {\n            return standPatScore;\n        }\n        const currentSide = maximizingPlayer ? 'W' : 'B';\n        const noisyMoves = this.generateNoisyMoves(currentSide, board, currentCastlingRights, currentEnPassantTarget);\n        const isEndgame = isEndgamePhase(board);\n        noisyMoves.sort((a, b) => this.scoreMove(b, board, isEndgame) - this.scoreMove(a, board, isEndgame));\n        for (const move of noisyMoves) {\n            let tempState = deepCopyState(board, currentCastlingRights, currentEnPassantTarget);\n            let newEpTarget = this.applyTemporaryMove(tempState.grid, move, tempState.castlingRights, tempState.enPassantTarget, true);\n            let score = this.quiescenceSearch(tempState.grid, depth - 1, alpha, beta, !maximizingPlayer, tempState.castlingRights, newEpTarget);\n            if (maximizingPlayer) {\n                alpha = Math.max(alpha, score);\n                if (alpha >= beta) break;\n            } else {\n                beta = Math.min(beta, score);\n                if (beta <= alpha) break;\n            }\n        }\n        return maximizingPlayer ? alpha : beta;\n    },\n    minimax(board, depth, alpha, beta, maximizingPlayer, currentCastlingRights, currentEnPassantTarget) {\n        const currentSide = maximizingPlayer ? 'W' : 'B';\n        const opponentSide = maximizingPlayer ? 'B' : 'W';\n        const allPossibleMovesForCurrent = this.getAllAvailableMoves(currentSide, board, currentCastlingRights, currentEnPassantTarget, false);\n        let hasLegalMoves = Object.values(allPossibleMovesForCurrent).some(m => m.length > 0);\n        if (!hasLegalMoves) {\n            const kingCoord = getKingCoord(currentSide, board);\n            const isInCheck = kingCoord ? isSquareAttacked(kingCoord, opponentSide, board) : false;\n            if (isInCheck) {\n                return maximizingPlayer ? (-CHECKMATE_SCORE - depth) : (CHECKMATE_SCORE + depth);\n            } else {\n                return DRAW_SCORE;\n            }\n        }\n        if (depth === 0) {\n            return this.quiescenceSearch(board, Q_SEARCH_MAX_DEPTH, alpha, beta, maximizingPlayer, currentCastlingRights, currentEnPassantTarget);\n        }\n        const moveList = [];\n        for (const startSq in allPossibleMovesForCurrent) { moveList.push(...allPossibleMovesForCurrent[startSq]); }\n        const isEndgame = isEndgamePhase(board);\n        moveList.sort((a, b) => this.scoreMove(b, board, isEndgame) - this.scoreMove(a, board, isEndgame));\n        if (maximizingPlayer) {\n            let maxEval = -Infinity;\n            for (const move of moveList) {\n                let tempState = deepCopyState(board, currentCastlingRights, currentEnPassantTarget);\n                let newEpTarget = this.applyTemporaryMove(tempState.grid, move, tempState.castlingRights, tempState.enPassantTarget, true);\n                let evalScore = this.minimax(tempState.grid, depth - 1, alpha, beta, false, tempState.castlingRights, newEpTarget);\n                maxEval = Math.max(maxEval, evalScore);\n                alpha = Math.max(alpha, evalScore);\n                if (beta <= alpha) {\n                    break;\n                }\n            }\n            return maxEval;\n        } else {\n            let minEval = Infinity;\n            for (const move of moveList) {\n                let tempState = deepCopyState(board, currentCastlingRights, currentEnPassantTarget);\n                let newEpTarget = this.applyTemporaryMove(tempState.grid, move, tempState.castlingRights, tempState.enPassantTarget, true);\n                let evalScore = this.minimax(tempState.grid, depth - 1, alpha, beta, true, tempState.castlingRights, newEpTarget);\n                minEval = Math.min(minEval, evalScore);\n                beta = Math.min(beta, evalScore);\n                if (beta <= alpha) {\n                    break;\n                }\n            }\n            return minEval;\n        }\n    },\n    applyTemporaryMove(tempGrid, move, tempRights, currentEpTarget, simulation = false) {\n        const { from, to, type, promotion } = move;\n        if (!tempGrid[from] || !tempGrid[to]) {\n            return currentEpTarget;\n        }\n        const piece = tempGrid[from].piece;\n        if (!piece) {\n            return currentEpTarget;\n        }\n        const targetPiece = tempGrid[to].piece;\n        let nextEpTarget = null;\n        tempGrid[to].piece = piece;\n        tempGrid[from].piece = \"\";\n        if (type === \"castle\") {\n            const rank = from.split('x')[1];\n            const rookFromX = (to.split('x')[0] === '6') ? 7 : 0;\n            const rookToX = (to.split('x')[0] === '6') ? 5 : 3;\n            const rookFromCoord = `${rookFromX}x${rank}`;\n            const rookToCoord = `${rookToX}x${rank}`;\n            if (tempGrid[rookFromCoord] && tempGrid[rookToCoord]) {\n                tempGrid[rookToCoord].piece = tempGrid[rookFromCoord].piece;\n                tempGrid[rookFromCoord].piece = \"\";\n            }\n        } else if (type === \"enpassant\") {\n            const capturedPawnY = from.split('x')[1];\n            const capturedPawnX = to.split('x')[0];\n            const capturedCoord = `${capturedPawnX}x${capturedPawnY}`;\n            if (tempGrid[capturedCoord]) {\n                 tempGrid[capturedCoord].piece = \"\";\n            }\n        } else if (promotion) {\n            tempGrid[to].piece = piece[0] + promotion;\n        }\n        const [fromX, fromY] = from.split('x').map(Number);\n        const [toX, toY] = to.split('x').map(Number);\n        const side = piece[0];\n        if (piece[1] === 'P' && Math.abs(fromY - toY) === 2) {\n            const epRank = (side === 'W') ? toY + 1 : toY - 1;\n            nextEpTarget = `${toX}x${epRank}`;\n        }\n        if (piece === \"WK\") { tempRights.WK = false; tempRights.WQ = false; }\n        else if (piece === \"BK\") { tempRights.BK = false; tempRights.BQ = false; }\n        else if (piece === \"WR\") {\n            if (from === \"0x7\") tempRights.WQ = false; else if (from === \"7x7\") tempRights.WK = false;\n        } else if (piece === \"BR\") {\n            if (from === \"0x0\") tempRights.BQ = false; else if (from === \"7x0\") tempRights.BK = false;\n        }\n        if (targetPiece === \"WR\") {\n            if (to === \"0x7\") tempRights.WQ = false; else if (to === \"7x7\") tempRights.WK = false;\n        } else if (targetPiece === \"BR\") {\n            if (to === \"0x0\") tempRights.BQ = false; else if (to === \"7x0\") tempRights.BK = false;\n        }\n        return nextEpTarget;\n    },\n    findBestMove(depth) {\n        const startTime = performance.now();\n        let bestMoves = [];\n        let bestValue = (turn === 'W') ? -Infinity : Infinity;\n        const currentLegalMoves = legalMovesCache;\n        const moveList = [];\n        for (const startSq in currentLegalMoves) { moveList.push(...currentLegalMoves[startSq]); }\n        if (moveList.length === 0) {\n            return null;\n        }\n        const isEndgameRoot = isEndgamePhase(grid);\n        moveList.sort((a, b) => this.scoreMove(b, grid, isEndgameRoot) - this.scoreMove(a, grid, isEndgameRoot));\n        for (const move of moveList) {\n            let tempState = deepCopyState(grid, castlingRights, enPassantTarget);\n            let newEpTarget = this.applyTemporaryMove(tempState.grid, move, tempState.castlingRights, tempState.enPassantTarget, true);\n            let boardValue = this.minimax(tempState.grid, depth - 1, -Infinity, Infinity, !(turn === 'W'), tempState.castlingRights, newEpTarget);\n            if (turn === 'W') {\n                if (boardValue > bestValue) {\n                    bestValue = boardValue;\n                    bestMoves = [move];\n                } else if (boardValue === bestValue) {\n                    bestMoves.push(move);\n                }\n            } else {\n                if (boardValue < bestValue) {\n                    bestValue = boardValue;\n                    bestMoves = [move];\n                } else if (boardValue === bestValue) {\n                    bestMoves.push(move);\n                }\n            }\n        }\n        const endTime = performance.now();\n        let chosenMove = null;\n        if (bestMoves.length > 0) {\n             chosenMove = bestMoves[Math.floor(Math.random() * bestMoves.length)];\n        }\n        return chosenMove;\n    },\n    triggerAIMove() {\n        if (isAiThinking || gameStatus !== 'ongoing') return;\n        let bookMovePlayed = false;\n        if (moveHistory.length < 6) {\n            let currentBookNode = openingBook;\n            const moveKeys = moveHistory.map(m => m.from + m.to);\n            let positionInBook = true;\n            for (const key of moveKeys) {\n                if (currentBookNode && typeof currentBookNode === 'object' && currentBookNode.hasOwnProperty(key)) {\n                    currentBookNode = currentBookNode[key];\n                } else {\n                    positionInBook = false;\n                    break;\n                }\n            }\n            if (positionInBook && typeof currentBookNode === 'object' && currentBookNode !== null) {\n                const possibleBookMoveKeys = Object.keys(currentBookNode);\n                let chosenBookMoveObject = null;\n                const shuffledKeys = possibleBookMoveKeys.sort(() => Math.random() - 0.5);\n                for (const bookMoveKey of shuffledKeys) {\n                    if (bookMoveKey.length === 6) {\n                       const fromSq = bookMoveKey.substring(0, 3);\n                       const toSq = bookMoveKey.substring(3);\n                       if (legalMovesCache[fromSq] && legalMovesCache[fromSq].some(legalMove => legalMove.to === toSq)) {\n                           chosenBookMoveObject = { from: fromSq, to: toSq };\n                           break;\n                       }\n                    }\n                }\n                if (chosenBookMoveObject) {\n                    isAiThinking = true;\n                    this.draw();\n                    bookMovePlayed = true;\n                    setTimeout(() => {\n                        if (gameStatus === 'ongoing') {\n                            this.makeMove(chosenBookMoveObject);\n                        } else {\n                           isAiThinking = false;\n                           this.draw();\n                        }\n                    }, 50);\n                    return;\n                }\n            }\n        }\n        if (!bookMovePlayed) {\n            isAiThinking = true;\n            this.draw();\n            setTimeout(() => {\n                const aiMove = this.findBestMove(window.aiDepth);\n                isAiThinking = false;\n                if (gameStatus === 'ongoing') {\n                    if (aiMove) {\n                        this.makeMove(aiMove);\n                    } else {\n                         this.draw();\n                    }\n                } else {\n                     this.draw();\n                }\n            }, 50);\n        }\n    },\n    nextTurn() {\n        turn = (turn === \"W\") ? \"B\" : \"W\";\n        selectedPiece = \"\";\n        moves = {};\n        isAiThinking = false;\n        this.generateAllLegalMoves();\n        if (playerMode === 'PvAI' && gameStatus === 'ongoing' && turn !== playerSide) {\n             this.triggerAIMove();\n        } else {\n            this.draw();\n        }\n    },\n    draw() {\n        cls(\"brown\");\n        const isPlayerTurnActive = !isAiThinking && gameStatus === 'ongoing' &&\n                                   ((playerMode === 'PvP') || (playerMode === 'PvAI' && turn === playerSide));\n        const opponentSide = (turn === 'W' ? 'B' : 'W');\n        for (let y = 0; y < 8; y++) {\n            for (let x = 0; x < 8; x++) {\n                const coord = `${x}x${y}`;\n                const cell = grid[coord];\n                if (!cell) continue;\n                const drawX = cell.x;\n                const drawY = cell.y;\n                ctx.fillStyle = ((x + y) % 2 === 0) ? \"#F0D9B5\" : \"#B58863\";\n                ctx.fillRect(drawX, drawY, 18, 18);\n                if (cell.piece !== \"\") {\n                    if (pieces[cell.piece] !== undefined) {\n                        ssh(hiddenPieces ? 16: pieces[cell.piece], drawX + 1, drawY + 1, 16, 16);\n                    } else {\n                        ctx.fillStyle = \"magenta\"; ctx.fillRect(drawX + 4, drawY + 4, 10, 10);\n                    }\n                }\n            }\n        }\n        const kingInCheckCoord = getKingCoord(turn, grid);\n         if (gameStatus === 'ongoing' && kingInCheckCoord && isSquareAttacked(kingInCheckCoord, opponentSide, grid)) {\n             const kingCell = grid[kingInCheckCoord];\n             ctx.strokeStyle = \"rgba(255, 0, 0, 0.8)\"; ctx.lineWidth = 2;\n             ctx.strokeRect(kingCell.x - 1, kingCell.y - 1, 20, 20);\n         }\n        if (isPlayerTurnActive) {\n            if (selectedPiece && grid[selectedPiece]) {\n                const selCell = grid[selectedPiece];\n                ctx.strokeStyle = \"rgba(255, 255, 0, 0.9)\"; ctx.lineWidth = 2;\n                ctx.strokeRect(selCell.x - 1, selCell.y - 1, 20, 20);\n            }\n            if (selectedPiece && moves[selectedPiece]) {\n                 moves[selectedPiece].forEach(move => {\n                     const targetCoord = move.to;\n                     if (!grid[targetCoord]) return;\n                     const moveCell = grid[targetCoord];\n                     const isCapture = grid[targetCoord].piece !== \"\" || move.type === 'enpassant';\n                     ctx.fillStyle = isCapture ? \"rgba(255, 0, 0, 0.4)\" : \"rgba(0, 255, 0, 0.4)\";\n                     ctx.beginPath();\n                     ctx.arc(moveCell.x + 9, moveCell.y + 9, 6, 0, 2 * Math.PI);\n                     ctx.fill();\n                 });\n             }\n        }\n        if (moveHistory.length > 0) {\n            ctx.fillStyle = \"black\";\n            const alpha = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\"];\n            const from = moveHistory[moveHistory.length-1].from.split(\"x\");\n            const to = moveHistory[moveHistory.length-1].to.split(\"x\");\n            if (gameStatus != 'checkmate' && gameStatus != 'stalemate') {\n                 ctx.fillText(`${alpha[parseInt(from[0])]}${8-parseInt(from[1])} > ${alpha[parseInt(to[0])]}${8-parseInt(to[1])}` , 10, 162);\n            } else {\n                 ctx.fillText(gameStatus.toUpperCase() , 10, 162);\n            }\n        }\n        ssh((turn == \"W\") ? 12 : 13, 129, 148, 16, 16)\n        if (clk({x:129 , y:148 , w:16 , h:16})) hiddenPieces = !hiddenPieces; \n    },\n    update() {\n        this.draw();\n        if (gameStatus !== 'ongoing' || isAiThinking) {\n            return;\n        }\n        const isPlayerTurnToAct = (playerMode === 'PvP') || (playerMode === 'PvAI' && turn === playerSide);\n        if (isPlayerTurnToAct) {\n            for (let y = 0; y < 8; y++) {\n                for (let x = 0; x < 8; x++) {\n                    const coord = `${x}x${y}`;\n                    const cell = grid[coord];\n                    if (!cell) continue;\n                    const clickArea = { x: cell.x, y: cell.y, w: 18, h: 18 };\n                    if (clk(clickArea)) {\n                        if (selectedPiece) {\n                            const possibleMove = moves[selectedPiece]?.find(m => m.to === coord);\n                            if (possibleMove) {\n                                this.makeMove(possibleMove);\n                            } else {\n                                if (cell.piece.startsWith(turn)) {\n                                    selectedPiece = coord;\n                                    moves = { [coord]: legalMovesCache[coord] || [] };\n                                } else {\n                                    selectedPiece = \"\";\n                                    moves = {};\n                                }\n                            }\n                        } else {\n                            if (cell.piece.startsWith(turn)) {\n                                selectedPiece = coord;\n                                moves = { [coord]: legalMovesCache[coord] || [] };\n                            }\n                        }\n                        return;\n                    }\n                }\n            }\n        }\n    }\n};\nconst chessPieces = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAwCAMAAADZyI/9AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJUExURQAAAP///wAAAHPGg3EAAAADdFJOU///ANfKDUEAAAAJcEhZcwAADsEAAA7BAbiRa+0AAAInSURBVFhHvVaLkuMwCHP2/z96h4dAgNOeb5JlOk2EQQLspF0/amutZXduDXa8riscknvppyfpqn1LAq8ywcRLEiJ+Xdcl63LJkFj1GMkojgJrB1YsEgRKeSKRXYWYXLJFMIUgeMtIhIkUHJFkK7i2qL17QOHgglGSO8K2AhlupCpn9SAFmO49KehKA2VEvqoZEIoEnxP0ALIE0A3+gEOARlqKjpSo/mGBZJDBnAsko83e9gxBRpAMjbELMN4QpmRWWM4IIu4ESsfRLmlCL0/CB4ItpnR/Dtjj28FDoZl+IxQctu2AN8VTage5bM9Bn8DsIB3q4Y6cAbDmx2NY8eigOr7jhK7fcLWN6x+Mj+wXQ1wX/4z1INCavBf1Mg1T6CW14LpuUw+HnrFyzij/RqDj/oNTFPoxLfly0QOmhw2eCCAOLlif+hSYe1wEEI6Dqz84CvIcUX12j+h01Z5pRN5udO1aXKRxJsgSwDL4qYMugHooBz06iqBHBSbDmQAxjncLCIihMXYBwvNlRy1khfWMoOuKG3SHlVwJoZeUHwi2mNJVoBK2tysoRgN7wr6+6SBgUtQORscjnATtq1YAOBw36x0X2/ketVS/sZ5wavwDqWPsuCecmr1Ikz3+4+mfipcFxP+SgKN6+v/PPgjYfU84NQjg67UOqsALe/DHAs+PyOp9cZN3Ag924Oz+/+jxPbBSUTEJqLMnnBrmDRu4J5xajOPOesKp/QKzqxc8nk0WlwAAAABJRU5ErkJggg==\";\nconst chessConfig = {\n    showBox(x, y, w, h, text, varToChange) {\n        if (clk({x:x , y:y , w:w , h:h})) {\n            window[varToChange] = (!isNaN(parseInt(text))) ? parseInt(text) : text;\n            if (varToChange == \"playerMode\") {\n                lvl(1);\n            }\n        }\n        const intX = Math.round(x);\n        const intY = Math.round(y);\n        const intW = Math.round(w);\n        const intH = Math.round(h);\n        ctx.fillStyle = \"white\";\n        ctx.fillRect(intX, intY, intW, intH);\n        ctx.strokeStyle = (text == window[varToChange] && varToChange != \"playerMode\") ? \"yellow\" : \"black\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(intX, intY, intW, intH);\n        ctx.fillStyle = \"black\";\n        ctx.font = \"16px CustomFont\";\n        const textWidth = ctx.measureText(`${text}`).width;\n        const textX = Math.round(intX + (intW - textWidth) / 2);\n        const textY = Math.round(intY + intH / 2 + 5);\n        ctx.fillText(`${text}`, textX, textY);\n    },\n    showOptions() {\n        this.showBox(12, 6, 124, 20, \"Player Side\");\n        this.showBox(77, 32, 48, 20, \"W\", \"playerSide\");\n        this.showBox(23, 32, 48, 20, \"B\", \"playerSide\");\n        this.showBox(12, 58, 124, 20, \"Difficulty\");\n        this.showBox(17, 84, 24, 20, 1, \"aiDepth\");\n        this.showBox(47, 84, 24, 20, 2, \"aiDepth\");\n        this.showBox(77, 84, 24, 20, 3, \"aiDepth\");\n        this.showBox(107, 84, 24, 20, 4, \"aiDepth\");\n        this.showBox(12, 114, 124, 20, \"Play\");\n        this.showBox(77, 140, 48, 20, \"PvP\", \"playerMode\");\n        this.showBox(23, 140, 48, 20, \"PvAI\", \"playerMode\");\n    },\n    init() {\n    },\n    update(delta) {\n        cls(\"brown\");\n        this.showOptions();\n    }\n};\ngameFramework({\n    width: 148,\n    height: 166,\n    spritesheet: [chessPieces, 6, 3],\n    levels: [chessConfig, chessMain]\n});",
        "Tetris": "J:let gridMaxSize = {w : 10 , h : 20};\nlet gameType = \"solo\";\nlet grid1 = {};\nlet grid2 = {};\nwindow.usingTouch = false;\nlet player1 = {tick:0 , rotation:0 , x:0 , y:0 , block:\"line\"};\nlet player2 = {tick:0 , rotation:0 , x:0 , y:0 , block:\"line\"};\nconst blocks = {\n    line : [[[0,0] , [1,0] , [2,0] , [3,0]],[[1,0] , [1,1] , [1,2] , [1,3]],[[0,0] , [1,0] , [2,0] , [3,0]],[[1,0] , [1,1] , [1,2] , [1,3]],\"red\"],\n    triangle : [[[1,0] , [0,1] , [1,1] , [2,1]],[[0,0] , [0,1] , [0,2] , [1,1]],[[1,1] , [0,0] , [1,0] , [2,0]],[[1,0] , [1,1] , [1,2] , [0,1]],\"green\"]\n}\n\nfunction drawSquare(x, y, w, h, colour, text=\"\") {\n    ctx.fillStyle = colour;\n    ctx.fillRect(x, y, w, h);\n    ctx.fillStyle = \"white\";\n    ctx.font = \"16px Ariel\";\n    ctx.fillText(text, (cnv.width/2)-(text.length*3)-4, y+15)\n}\n\nfunction drawCircle(x, y, radius, text=\"\") {\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, 2 * Math.PI);\n    ctx.fillStyle = 'grey';\n    ctx.fill();\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    ctx.fillStyle = \"white\";\n    ctx.font = \"32px Ariel\";\n    ctx.fillText(text, x-12, y+10)\n}\n\nfunction createTetrisGrid() {\n    let gridObj = {};\n    for (let j=0; j<gridMaxSize.h; j++) {\n        for (let i=0; i<gridMaxSize.w; i++) {\n            gridObj[`${i}x${j}`] = {x:i , y:j , colour:\"\"};\n        }\n    }\n    return gridObj;\n}\n\nfunction drawTetrisGrid(player, grid, xOffset, yOffset) {\n    for (let j=0; j<gridMaxSize.h+2; j++) {\n        for (let i=0; i<gridMaxSize.w+2; i++) {\n            if (j==0 || j>gridMaxSize.h || i==0 || i>gridMaxSize.w) {\n                drawSquare(i*8 + xOffset , j*8 + yOffset , 8 , 8 , \"#808080\");\n                drawSquare((i*8)+1 + xOffset , (j*8)+1 + yOffset , 6 , 6 , \"#A9A9A9\");\n            } else if (grid[`${i-1}x${j-1}`][\"colour\"]) {\n                drawSquare(i*8 + xOffset , j*8 + yOffset , 8 , 8 , grid[`${i-1}x${j-1}`].colour);\n            } else {\n                blocks[player.block][player.rotation].forEach((cell, index) => {\n                    if ((i-1)==(player.x+cell[0]) && (j-1)==(player.y+cell[1])) drawSquare(i*8 + xOffset , j*8 + yOffset , 8 , 8 , blocks[player.block][4]);\n                })\n                \n            }\n        }\n    }\n}\n\nfunction newBlock(player) {\n    player.x = 3;\n    player.y = 0;\n    player.rotation = 0;\n    player.block = Object.keys(blocks)[Math.floor(Math.random()*Object.keys(blocks).length)]\n}\n\nfunction checkMove(player, grid, direction) {\n    for (let i=0; i<blocks[player.block][player.rotation].length; i++) {\n        const cell = blocks[player.block][player.rotation][i];\n        if (player.x + cell[0]  >= gridMaxSize.w) player.x -= 1;\n        if (player.x + cell[0]  < 0) player.x += 1;\n        if (`${player.x+cell[0]+direction.x}x${player.y+cell[1]+direction.y}` in grid) {\n            if (grid[`${player.x+cell[0]+direction.x}x${player.y+cell[1]+direction.y}`].colour != \"\") return false;\n        }\n        if (player.x + cell[0] + direction.x >= gridMaxSize.w || player.x + cell[0] + direction.x < 0 || player.y + cell[1] + direction.y >= gridMaxSize.h) return false;\n    }\n    return true;\n}\n\nfunction placeBlock(player, grid) {\n    for (let i=0; i<blocks[player.block][player.rotation].length; i++) {\n        const cell = blocks[player.block][player.rotation][i];\n        grid[`${player.x+cell[0]}x${player.y+cell[1]}`].colour = blocks[player.block][4];\n    }\n    newBlock(player);\n}\n\n\n\n\n\nconst menuLevel = {\n    init() {\n        if (!host) {\n            onReceive = function(obj) {\n                if (!(\"player2\" in obj)) return;\n                player1 = obj.player1;\n                grid1 = obj.grid1;\n                player2 = obj.player2;\n                grid2 = obj.grid2;\n            }\n            gameType = \"multi\";\n            lvl(1);\n        }\n    },\n    update(delta) {\n        cls(\"black\");\n        if (host) {\n            ctx.font = \"32px Ariel\";\n            ctx.fillStyle = \"white\";\n            ctx.fillText(\"Tetris\", (cnv.width/2)-40, 60)\n            drawSquare(40, (cnv.height/2)-40, cnv.width-80, 20, \"grey\", \"Solo\");\n            drawSquare(40, (cnv.height/2)-10, cnv.width-80, 20, \"grey\", \"Local\");\n            drawSquare(40, (cnv.height/2)+20, cnv.width-80, 20, \"grey\", \"Multiplayer\");\n            if (clk({ x:40 , y:(cnv.height/2)-40 , w:cnv.width-80 , h:20 })) {\n                gameType = \"solo\";\n                lvl(1);\n            }\n            if (clk({ x:40 , y:(cnv.height/2)-10 , w:cnv.width-80 , h:20 })) {\n                gameType = \"local\";\n                lvl(1);\n            }\n            if (clk({ x:40 , y:(cnv.height/2)+20 , w:cnv.width-80 , h:20 })) {\n                gameType = \"multi\";\n                lvl(1);\n            }\n        }\n    }\n};\n\nfunction playerUpdates(player, grid) {\n    player.tick += 1;\n    if (player.tick%20 == 0) {\n        if (checkMove(player, grid, {x:0, y:1})) {\n            player.y += 1;\n        } else {\n            placeBlock(player, grid);\n        }\n    }\n\n\n}\n\n\nconst tetrisLevel = {\n    init() {\n        if (gameType == \"multi\" && !online && host) multiplayer(true);\n        grid1 = createTetrisGrid();\n        if (gameType != \"solo\") grid2 = createTetrisGrid();\n        newBlock(player1)\n        if (gameType != \"solo\") newBlock(player2);\n        if (host) {\n            keys[\"i\"] = { clicked: false, held: false };\n            keys[\"j\"] = { clicked: false, held: false };\n            keys[\"k\"] = { clicked: false, held: false };\n            keys[\"l\"] = { clicked: false, held: false };\n            onReceive = function(obj) {\n                function keySwap(key1, key2) {\n                    if (obj[key1] && !keys[key2].held) keys[key2].clicked = true;\n                    keys[key2].held = obj[key1];\n                }\n                keySwap(\"a\", \"j\");\n                keySwap(\"w\", \"i\");\n                keySwap(\"s\", \"k\");\n                keySwap(\"d\", \"l\");\n            }\n        }\n    },\n    update(delta) {\n        cls(\"black\");\n\n        if (!(\"w\" in keys)) keys[\"w\"] = { clicked: false, held: false };\n        if (!(\"a\" in keys)) keys[\"a\"] = { clicked: false, held: false };\n        if (!(\"s\" in keys)) keys[\"s\"] = { clicked: false, held: false };\n        if (!(\"d\" in keys)) keys[\"d\"] = { clicked: false, held: false };\n        function touchButton(x, y, radius, text, key) {\n            drawCircle(x, y, radius, text);\n            if (clk({ x:x-radius , y:y-radius , w:radius*2 , h:radius*2 })) {\n                keys[key].clicked = true;\n                usingTouch = true;\n            }\n            if (usingTouch ) keys[key].held = hld({ x:x-radius , y:y-radius , w:radius*2 , h:radius*2 });\n        }\n       touchButton(50, cnv.height - 50, 30, \"A\", \"a\");\n       touchButton(cnv.width - 50, cnv.height - 50, 30, \"D\", \"d\");\n       touchButton(50, cnv.height - 130, 30, \"W\", \"w\");\n       touchButton(cnv.width - 50, cnv.height - 130, 30, \"S\", \"s\");\n        \n\n        if (!host && online) {\n            const keyW = hld(\"w\") ? true : false;\n            const keyA = hld(\"a\") ? true : false;\n            const keyS = hld(\"s\") ? true : false;\n            const keyD = hld(\"d\") ? true : false;\n            sendObject({w:keyW , a:keyA , s:keyS , d:keyD})\n        }\n        \n        if (host) {\n            playerUpdates(player1, grid1);\n            if (clk(\"w\")) {\n                const initRotation = player1.rotation;\n                player1.rotation = (player1.rotation == 3) ? 0 : (player1.rotation+1);\n                if (!checkMove(player1, grid1, {x:0 , y:0})) player1.rotation = (player1.rotation == 0) ? 3 : (player1.rotation-1);\n            }\n            if (clk(\"a\") && checkMove(player1, grid1, {x:-1, y:0})) player1.x -= 1;\n            if (clk(\"d\") && checkMove(player1, grid1, {x:1, y:0})) player1.x += 1;\n            if (hld(\"s\") && checkMove(player1, grid1, {x:0, y:1})) player1.y += 1; \n        }\n\n        if (gameType != \"solo\" && host) {\n            playerUpdates(player2, grid2);\n            if (clk(\"i\")) {\n                const initRotation = player2.rotation;\n                player2.rotation = (player2.rotation == 3) ? 0 : (player2.rotation+1);\n                if (!checkMove(player2, grid2, {x:0 , y:0})) player2.rotation = (player2.rotation == 0) ? 3 : (player2.rotation-1);\n            }\n            if (clk(\"j\") && checkMove(player2, grid2, {x:-1, y:0})) player2.x -= 1;\n            if (clk(\"l\") && checkMove(player2, grid2, {x:1, y:0})) player2.x += 1;\n            if (hld(\"k\") && checkMove(player2, grid2, {x:0, y:1})) player2.y += 1; \n        }\n\n        if (host && online) sendObject({player1:player1 , grid1:grid1 , player2:player2 , grid2:grid2});\n\n\n\n        if (gameType == \"solo\") {\n            drawTetrisGrid(player1, grid1, Math.floor((cnv.width/2) - ((gridMaxSize.w+2)*4)), Math.floor((cnv.height/2) - ((gridMaxSize.h+2)*4)));\n        } else {\n            drawTetrisGrid(player1, grid1, Math.floor((cnv.width/2) - ((gridMaxSize.w+2)*8)) - 8, Math.floor((cnv.height/2) - ((gridMaxSize.h+2)*4)));\n            drawTetrisGrid(player2, grid2, Math.floor((cnv.width/2) + 8), Math.floor((cnv.height/2) - ((gridMaxSize.h+2)*4)));\n        }\n\n\n    }\n};\n\ngameFramework({\n    width: 400,\n    height: 250,\n    spritesheet: [notes[\"Files\"][\"SS\"][\"!Data\"], 49, 22],\n    levels: [menuLevel, tetrisLevel]\n});",
        "Three.js Test": "J:// Setup scene, camera, and renderer\nconst scene = new THREE.Scene();\nconst camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );\nconst renderer = new THREE.WebGLRenderer();\nrenderer.setSize( window.innerWidth, window.innerHeight );\ndocument.body.appendChild( renderer.domElement );\n\n// Create a simple cube\nconst geometry = new THREE.BoxGeometry( 1, 1, 1 );\nconst material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );\nconst cube = new THREE.Mesh( geometry, material );\nscene.add( cube );\n\n// Position the camera\ncamera.position.z = 5;\n\n// Animation loop\nfunction animate() {\n    requestAnimationFrame( animate );\n\n    cube.rotation.x += 0.01;\n    cube.rotation.y += 0.01;\n\n    renderer.render( scene, camera );\n}\n\nanimate();\n\n// Handle window resizing\nwindow.addEventListener( 'resize', () => {\n    camera.aspect = window.innerWidth / window.innerHeight;\n    camera.updateProjectionMatrix();\n    renderer.setSize( window.innerWidth, window.innerHeight );\n}, false );",
        "Godot Game Test": "J:path.pop(); showOption();\noutputArea.style.height = \"100%\";\noutputArea.innerHTML = `<iframe frameborder=\"0\" src=\"https://itch.io/embed-upload/13324018?color=333333\" allowfullscreen=\"\" style=\"margin: 10px; border: 5px solid black; width: calc(100% - 30px); min-height: calc(100% - 30px); border-radius: 8px;\"><a href=\"https://clarkekent.itch.io/platformertest\">Play PlatformerTest on itch.io</a></iframe>`;\n",
        "Platform Descent": "J:const gameWidth = Math.floor(innerWidth/2);\nconst gameHeight = Math.floor(innerHeight/2);\nconst mapData = notes[\"Tools\"][\"!Maps\"][\"!PlatformDescent\"];\nconst map = {};\nconst tempCnv = document.createElement(\"canvas\");\ntempCnv.width = gameWidth;\ntempCnv.height = gameHeight;\nconst tempCtx = tempCnv.getContext(\"2d\");\nlet usingObject = {};\nlet players = {\n    \"player1\" : { x:0 , y:-16 , w:16 , h:16 , flipped:false , v:{x:0 , y:0} , idleFrame: 20 , initFrame:20 , frames: [20] , inputs:{w:0 , a:-200, s:0 , d:200} , onGround:false , climbing:false , jumpHeight:450 , showingInventory:false , selectedItem:\"\" , highlightedItem :\"0x0\" , inventory:{\"0x0\":[38, 1] , \"1x0\":[] , \"4x0\":[39, 1] , \"5x0\":[] , \"0x1\":[] , \"1x1\":[] , \"2x1\":[] , \"3x1\":[] , \"4x1\":[] , \"5x1\":[] , \"0x2\":[] , \"1x2\":[] , \"2x2\":[] , \"3x2\":[] , \"4x2\":[] , \"5x2\":[] , \"0x3\":[] , \"1x3\":[] , \"2x3\":[] , \"3x3\":[] , \"4x3\":[] , \"5x3\":[] , \"0x4\":[] , \"1x4\":[] , \"2x4\":[] , \"3x4\":[] , \"4x4\":[] , \"5x4\":[]}}\n};\nfunction spawnPlayer2() {\n    players[\"player2\"] = { x:32 , y:-16 , w:16 , h:16 , flipped:false , v:{x:0 , y:0} , idleFrame: 30 , initFrame:30 , frames: [30] , inputs:{w:0 , a:-200, s:0 , d:200} , onGround:false , climbing:false , jumpHeight:450 , showingInventory:false , selectedItem:\"\" , highlightedItem :\"0x0\" , inventory:{\"0x0\":[38, 1] , \"1x0\":[] , \"4x0\":[39, 1] , \"5x0\":[] , \"0x1\":[] , \"1x1\":[] , \"2x1\":[] , \"3x1\":[] , \"4x1\":[] , \"5x1\":[] , \"0x2\":[] , \"1x2\":[] , \"2x2\":[] , \"3x2\":[] , \"4x2\":[] , \"5x2\":[] , \"0x3\":[] , \"1x3\":[] , \"2x3\":[] , \"3x3\":[] , \"4x3\":[] , \"5x3\":[] , \"0x4\":[] , \"1x4\":[] , \"2x4\":[] , \"3x4\":[] , \"4x4\":[] , \"5x4\":[]}};\n}\nif (!host) spawnPlayer2();\nlet activePlayer = (host) ? \"player1\" : \"player2\";\nlet dynamics = [];\nlet tick = 0;\nlet splitScreen = false;\nlet gravity = 45;\nwindow.touchController = false;\n\n\nconst layer4Details = {\n    8: {},\n    18: {},\n    19: {\n        name: \"Gold Deposit\",\n        maxStack: 1\n    },\n    28: {\n        name: \"Flower\",\n        maxStack: 3\n    },\n    29: {\n        name: \"Gold Ore\",\n        maxStack: 2\n    },\n    37: {\n        name: \"Bullet\",\n        maxStack: 1\n    },\n    38: {\n        name: \"PickAxe\",\n        maxStack: 1\n    },\n    39: {\n        name: \"Pistol\",\n        maxStack: 1\n    }\n}\n\nconst layer4JS = {\n    8: function(iD, delta) {},\n    18: function(iD, delta) {},\n    19: function(iD, delta) {},\n    28: function(iD, delta) {},\n    29: function(iD, delta) {},\n    37: function(iD, delta) {\n        const obj = dynamics[iD];\n        obj.x += obj.dir * delta * 300;\n        const solidCollision = isCollidingWithLayer(obj , 1);\n        if (solidCollision) dynamics.splice(iD, 1);\n    },\n    38: function(iD, delta) {},\n    39: function(iD, delta) {}\n}\n\nconst layer4OnInteract = {\n    8: function(objIndex, objUsing) {\n        objUsing.inputs = {w:-160 , a:0 , s:160 , d:0};\n        objUsing.v = {x:0 , y:0};\n        objUsing.onGround = true;\n        objUsing.climbing = true;\n        objUsing.idleFrame = objUsing.initFrame+2\n        objUsing.x = dynamics[objIndex].x;\n        objUsing.y = dynamics[objIndex].y+10;\n    },\n    18: function(objIndex, objUsing) {\n        objUsing.inputs = {w:-160 , a:0 , s:160 , d:0};\n        objUsing.v = {x:0 , y:0};\n        objUsing.onGround = true;\n        objUsing.climbing = true;\n        objUsing.idleFrame = objUsing.initFrame+2\n        objUsing.x = dynamics[objIndex].x;\n    },\n    19: function(objIndex, objUsing) {},\n    28: function(objIndex, objUsing) {\n        pickup(28, objUsing);\n        dynamics.splice(objIndex, 1);\n    },\n    29: function(objIndex, objUsing) {},\n    37: function(objIndex, objUsing) {},\n    38: function(objIndex, objUsing) {},\n    39: function(objIndex, objUsing) {}\n}\n\nconst layer4OnUse = {\n    38: function(invCoord, objUsing) { // PICKAXE\n        objUsing.x += (objUsing.flipped) ? -16 : 16;\n        const collidingWithDynamic = collidingWithDynamics(objUsing);\n        objUsing.x -= (objUsing.flipped) ? -16 : 16;\n        if (collidingWithDynamic != \"false\") {\n            if (dynamics[collidingWithDynamic].spr == 19) {\n                pickup(29, objUsing);\n                if (!(\"hp\" in dynamics[collidingWithDynamic])) dynamics[collidingWithDynamic][\"hp\"] = 4;\n                dynamics[collidingWithDynamic].hp -= 1;\n                if (dynamics[collidingWithDynamic].hp == 0) dynamics.splice(collidingWithDynamic, 1);\n            }\n        }\n    },\n    39: function(invCoord, objUsing) { // GUN\n        const dir = (objUsing.flipped) ? -1 : 1;\n        const rot = (objUsing.flipped) ? 0 : 180;\n        dynamics.push({ x:objUsing.x , y:objUsing.y , w:16 , h:16 , spr:37 , rotation:rot , dir:dir });\n    }\n}\n\n\n\n\nfunction pickup(spr, player) {\n    for (let y=1; y<5; y++) {\n        for (let x=0; x<6; x++) {\n            const cell = `${x}x${y}`;\n            if (player.inventory[cell].length > 0) {\n                if (player.inventory[cell][0] == spr && player.inventory[cell][1] < layer4Details[spr].maxStack) {\n                    player.inventory[cell][1] += 1;\n                    return;\n                }\n            } else {\n                player.inventory[cell] = [spr, 1]\n                return;\n            }\n        }\n    }\n}\n\n\n\n\n\n\n\nwindow.startSplitScreen = function() {\n    if (online) return;\n    if (splitScreen) {\n        delete players[\"player2\"];\n    } else {\n        spawnPlayer2();\n    }\n    splitScreen = !splitScreen;\n}\n\n\nwindow.startMultiplayer = function() {\n    if (online || splitScreen) return;\n    spawnPlayer2()\n    multiplayer();\n    onReceive = function(obj) {\n        function keySwap(key1, key2) {\n            if (obj[key1] && !keys[key2].held) keys[key2].clicked = true;\n            keys[key2].held = obj[key1];\n        }\n        let keyTranslations = {\"w\":\"i\" , \"a\":\"j\" , \"s\":\"k\" , \"d\":\"l\" , \"t\":\"ArrowUp\" , \"f\":\"ArrowLeft\" , \"g\":\"ArrowDown\" , \"h\":\"ArrowRight\"};\n        for (const key1 in keyTranslations) {\n            keys[keyTranslations[key1]] = { clicked: false, held: false };\n            keySwap(key1, keyTranslations[key1]);\n        }\n    }\n}\n\n\n\n\n\nfunction isCollidingWithLayer(obj1 , layer) {\n    for (let y=0; y<3; y++) {\n        for (let x=0; x<3; x++) {\n            const cell = `${x + Math.floor(obj1.x/16)}x${y + Math.floor(obj1.y/16)}`;\n            if (cell in map) {\n                const obj2 = map[cell];\n                if (((obj1.x+obj1.w) > obj2.x) && ((obj2.x+obj2.w) > obj1.x) && ((obj1.y+obj1.h) > obj2.y) && ((obj2.y+obj2.h) > obj1.y) && map[cell].images[layer].length > 0) return cell;\n            }\n        }\n    }\n    return false;\n}\n\n\nfunction collidingWithDynamics(obj1) {\n    for (let i=0; i<dynamics.length; i++) {\n        const obj2 = dynamics[i];\n        if (((obj1.x+obj1.w) > obj2.x) && ((obj2.x+obj2.w) > obj1.x) && ((obj1.y+obj1.h) > obj2.y) && ((obj2.y+obj2.h) > obj1.y)) return i;\n    }\n    return \"false\";\n}\n\n\n\nfunction createMap() {\n    for (const coord in mapData) {\n        const x = parseInt(coord.split(\"x\")[0])*16;\n        const y = parseInt(coord.split(\"x\")[1])*16;\n        map[coord] = {x:x , y:y , w:16 , h:16, images:[]};\n        for (let i=0; i<3; i++) {\n            map[coord].images.push((mapData[coord][i].length > 0) ? mapData[coord][i] : []);\n        }\n        if (mapData[coord][3].length > 0) dynamics.push({ x:x , y:y , w:16 , h:16 , spr:mapData[coord][3][0] , rotation:mapData[coord][3][1]});\n    }\n}\n\n\nfunction updatePlayer(delta, playerName, w, a, s, d, t, f, g, h, q, e, r, yKey) {\n    const player = players[playerName];\n    const idle = player.idleFrame;\n\n    // GRAVITY\n    if (!player.climbing) player.v.y += gravity;\n\n    if (!player.showingInventory) {\n\n        //PLAYER CONTROLS\n        if (hld(a) || hld(d)) player.flipped = hld(a);\n        if (player.inputs.w != 0 && hld(w)) player.v.y = player.inputs.w;\n        if (player.inputs.a != 0 && hld(a)) player.v.x = player.inputs.a;\n        if (player.inputs.s != 0 && hld(s)) player.v.y = player.inputs.s;\n        if (player.inputs.d != 0 && hld(d)) player.v.x = player.inputs.d;\n\n        // JUMPING\n        if (clk(g) && (player.onGround || player.climbing) && !player.showingInventory) {\n            if (player.climbing) {\n                player.idleFrame -= 2;\n                player.climbing = false;\n            }\n            player.inputs = {w:0 , a:-200, s:0 , d:200};\n            player.v.y = -player.jumpHeight;\n        }\n\n        // CLIMBING\n        if (clk(h) && player.y > 64 && !player.showingInventory) {\n            if (player.climbing) {\n                player.inputs = {w:0 , a:-200, s:0 , d:200};\n                player.idleFrame -= 2;\n            } else if (player.onGround) {\n                player.inputs = {w:-40, a:-40 , s:40 , d:40};\n                player.idleFrame += 2;\n            }\n            player.climbing = (!player.climbing && player.onGround);\n        }\n    }\n\n    // INVENTORY\n    if (clk(t)) player.showingInventory = !player.showingInventory;\n    if (player.showingInventory) {\n        const x = parseInt(player.highlightedItem .split(\"x\")[0]);\n        const y = parseInt(player.highlightedItem .split(\"x\")[1]);\n        if (clk(w) && (`${x}x${y-1}` in player.inventory)) player.highlightedItem = `${x}x${y-1}`;\n        if (clk(a)) {\n            if (`${x-1}x${y}` in player.inventory) {\n                player.highlightedItem = `${x-1}x${y}`;\n            } else if (player.highlightedItem == \"4x0\") {\n                player.highlightedItem = \"1x0\";\n            }\n        }\n        if (clk(s) && (`${x}x${y+1}` in player.inventory)) player.highlightedItem = `${x}x${y+1}`;\n        if (clk(d)) {\n            if (`${x+1}x${y}` in player.inventory) {\n                player.highlightedItem = `${x+1}x${y}`;\n            } else if (player.highlightedItem == \"1x0\") {\n                player.highlightedItem = \"4x0\";\n            }\n        }\n        function swapItem(first, second, amount=\"full\") {\n            if (first != \"\") {\n                if (player.inventory[first].length > 0) {\n                    if (player.inventory[second].length > 0) {\n                        if (player.inventory[first][0] == player.inventory[second][0] && (player.inventory[first][1] + player.inventory[second][1]) <= layer4Details[player.inventory[second][0]].maxStack) {\n                            player.inventory[first][1] += player.inventory[second][1];\n                            player.inventory[second] = [];\n                        }\n                        const selected = player.inventory[first];\n                        player.inventory[first] = player.inventory[second];\n                        player.inventory[second] = selected;\n                    } else {\n                        player.inventory[second] = player.inventory[first];\n                        player.inventory[first] = [];\n                    }\n                    player.selectedItem = \"\";\n                } else {player.selectedItem = second;}\n            } else {player.selectedItem = second;}\n        }\n        if (clk(g)) swapItem(player.selectedItem, player.highlightedItem);\n        if (clk(h)) {\n            if (player.selectedItem!= \"\") {\n                if (player.inventory[player.selectedItem].length > 0) {\n                    if (player.inventory[player.highlightedItem].length == 0) {\n                        player.inventory[player.highlightedItem] = [player.inventory[player.selectedItem][0], 1];\n                        player.inventory[player.selectedItem][1] -= 1;\n                        if (player.inventory[player.selectedItem][1] == 0) player.inventory[player.selectedItem] = [];\n                    } else if (player.inventory[player.highlightedItem][0] == player.inventory[player.selectedItem][0]) {\n                        player.inventory[player.highlightedItem][1] += 1;\n                        player.inventory[player.selectedItem][1] -= 1;\n                        if (player.inventory[player.selectedItem][1] == 0) player.inventory[player.selectedItem] = [];\n                    }\n                }\n            }\n        }\n        if (clk(q)) player.highlightedItem= \"0x0\";\n        if (clk(e)) player.highlightedItem= \"1x0\";\n        if (clk(r)) player.highlightedItem= \"4x0\";\n        if (clk(yKey)) player.highlightedItem= \"5x0\";\n    }\n\n    // VELOCITY\n    const previousX = player.x;\n    const previousY = player.y;\n    if (!hld(a) && !hld(d)) player.v.x = 0;\n    if (player.climbing && !hld(w) && !hld(s)) player.v.y = 0;\n    player.x += player.v.x * delta;\n    player.y += player.v.y * delta;\n\n    // LAYER 0 COLLISION\n    player.onGround = false;\n    const prePlatformCollision = isCollidingWithLayer({x:previousX , y:previousY , w:16 , h:16}, 0);\n    const platformCollision = isCollidingWithLayer(player, 0);\n    if (platformCollision) {\n        if (previousY + player.h <= map[platformCollision].y) {\n            player.y = map[platformCollision].y - player.h;\n            player.v.y = 0;\n            player.onGround = true;\n            if (player.climbing) {\n                player.idleFrame -= 2;\n                player.y = map[platformCollision].y - player.h;\n                player.v.y = 0;\n                player.inputs = {w:0 , a:-200, s:0 , d:200};\n                player.climbing = false;\n            }\n        }\n    }\n    if (prePlatformCollision) {\n        if (player.y + player.h <= map[prePlatformCollision].y && player.climbing) {\n            player.idleFrame -= 2;\n            player.y = map[prePlatformCollision].y - player.h;\n            player.v.y = 0;\n            player.inputs = {w:0 , a:-200, s:0 , d:200};\n            player.climbing = false;\n        }\n    }\n\n    // LAYER 1 COLLISION\n    const solidCollisionX = isCollidingWithLayer({x:player.x , y:previousY , w:16 , h:16}, 1);\n    const solidCollisionY = isCollidingWithLayer({x:previousX , y:player.y , w:16 , h:16}, 1);\n    if (solidCollisionX) {\n          player.x = previousX;\n          player.v.x = 0;\n    }\n    if (solidCollisionY) {\n        player.y = previousY;\n        player.v.y = 0;\n        player.onGround = true;\n    }\n\n    // INTERACT LAYER 4\n    player.x += (player.flipped) ? -16 : 16;\n    const collidingWithDynamic = collidingWithDynamics(player);\n    player.x -= (player.flipped) ? -16 : 16;\n    if (collidingWithDynamic != \"false\" && clk(f) && !player.showingInventory) {\n        layer4OnInteract[dynamics[collidingWithDynamic].spr](collidingWithDynamic, player);\n    }\n\n    // USING ITEMS\n    if (clk(q)) {\n        if (player.inventory[\"0x0\"].length > 0) {\n            if (player.inventory[\"0x0\"][0] in layer4OnUse) layer4OnUse[player.inventory[\"0x0\"][0]](\"0x0\", player);\n        }\n    }\n    if (clk(e)) {\n        if (player.inventory[\"1x0\"].length > 0) {\n            if (player.inventory[\"1x0\"][0] in layer4OnUse) layer4OnUse[player.inventory[\"1x0\"][0]](\"1x0\", player);\n        }\n    }\n    if (clk(r)) {\n        if (player.inventory[\"4x0\"].length > 0) {\n            if (player.inventory[\"4x0\"][0] in layer4OnUse) layer4OnUse[player.inventory[\"4x0\"][0]](\"4x0\", player);\n        }\n    }\n    if (clk(yKey)) {\n        if (player.inventory[\"5x0\"].length > 0) {\n            if (player.inventory[\"5x0\"][0] in layer4OnUse) layer4OnUse[player.inventory[\"5x0\"][0]](\"5x0\", player);\n        }\n    }\n    \n\n    // FALLING\n    if (player.v.y > 4000) {\n        player.x = 0;\n        player.y = -16;\n        player.v.y = 0;\n    }\n\n    // AMINATIONS\n    player.frames = (player.v.x != 0 || player.v.y != 0) ? [idle, idle+1] : [idle];\n}\n\nfunction sendButtons() {\n    const keyW = hld(\"w\") ? true : false;\n    const keyA = hld(\"a\") ? true : false;\n    const keyS = hld(\"s\") ? true : false;\n    const keyD = hld(\"d\") ? true : false;\n    const keyT = hld(\"t\") ? true : false;\n    const keyF = hld(\"f\") ? true : false;\n    const keyG = hld(\"g\") ? true : false;\n    const keyH = hld(\"h\") ? true : false;\n    sendObject({w:keyW , a:keyA , s:keyS , d:keyD , t:keyT , f:keyF , g:keyG , h:keyH});\n}\n\nfunction dynamicUpdates(delta) {\n    for (let i=dynamics.length-1; i>=0; i--) {\n        const obj = dynamics[i];\n        layer4JS[obj.spr](i, delta);\n    }\n}\n\n\n\n\n\nfunction drawMap(x, y, w, h, playerID, colour) {\n    tempCtx.imageSmoothingEnabled = false;\n    tempCtx.clearRect(0, 0, w, h);\n    const player = players[playerID];\n    const playerOffset = {x:(w/2)-8-player.x , y:(h/2)-8-player.y};\n    for (const coord in map) {\n        const objX = map[coord].x;\n        const objY = map[coord].y;\n        if (objX < (player.x + w) && objX > (player.x - w) && objY < (player.y + h) && objY > (player.y - h)) {\n            if (map[coord].images[0].length > 0) ssh(map[coord].images[0][0], objX+playerOffset.x, objY+playerOffset.y, 16, 16, map[coord].images[0][1], tempCtx);\n            if (map[coord].images[1].length > 0) ssh(map[coord].images[1][0], objX+playerOffset.x, objY+playerOffset.y, 16, 16, map[coord].images[1][1], tempCtx);\n            if (map[coord].images[2].length > 0) ssh(map[coord].images[2][0], objX+playerOffset.x, objY+playerOffset.y, 16, 16, map[coord].images[2][1], tempCtx);\n        }\n    }\n\n   for (let i=0; i<dynamics.length; i++) {\n        ssh(dynamics[i].spr, dynamics[i].x+playerOffset.x, dynamics[i].y+playerOffset.y, 16, 16, dynamics[i].rotation, tempCtx);\n    }\n\n    for (const playerName in players) {\n        const flipped = (players[playerName].flipped) ? -16 : 16;\n        const frame = Math.floor(tick/10)%players[playerName].frames.length;\n        if (playerName == playerID) {\n            ssh(players[playerName].frames[frame] , (w/2)-8 , (h/2)-8 , flipped , 16, 0, tempCtx);\n        } else {\n            ssh(players[playerName].frames[frame] , players[playerName].x+playerOffset.x , players[playerName].y+playerOffset.y , flipped , 16, 0, tempCtx);\n        }\n    }\n\n    ctx.drawImage(tempCnv, 0, 0, w, h, x, y, w, h);\n}\n\n\nfunction drawGUI() {\n    function drawSquare(x,y,w,h,outline) {\n        ctx.fillStyle = outline;\n        ctx.fillRect(x,y,w,h);\n        ctx.fillStyle = \"grey\";\n        ctx.fillRect(x+1,y+1,w-2,h-2);\n    }\n\n    // INVENTORY\n    function drawInventory(xOff, yOff, player) {\n        drawSquare(xOff, yOff, 138, 138, \"black\");\n        for (const cell in players[player].inventory) {\n            const x=parseInt(cell.split(\"x\")[0]);\n            const y=parseInt(cell.split(\"x\")[1]);\n            let outline = (cell == players[player].highlightedItem || cell == players[player].selectedItem) ? \"white\" : \"black\";\n            drawSquare(xOff+5+(x*22), yOff+5+(y*22), 18, 18, outline);\n            ctx.font = \"8px Arial\";\n            if (players[player].inventory[cell].length > 0) {\n                ssh(players[player].inventory[cell][0], xOff+6+(x*22), yOff+6+(y*22), 16, 16);\n                if (players[player].inventory[cell][1] > 1) {\n                    ctx.fillStyle = \"white\";\n                    ctx.fillText(`${players[player].inventory[cell][1]}`, Math.floor(xOff+7+(x*22)), Math.floor(yOff+13+(y*22)));\n                }\n            }\n        }\n        ctx.font = \"12px Arial\";\n        const x=parseInt(players[player].highlightedItem .split(\"x\")[0]);\n        const y=parseInt(players[player].highlightedItem .split(\"x\")[1]);\n        if (players[player].inventory[players[player].highlightedItem ].length > 0) {\n            ctx.fillStyle = \"black\";\n            ctx.fillRect(xOff+1+(x*22), yOff+23+(y*22), 48, 20);\n            ctx.fillStyle = \"white\";\n            ctx.fillText(layer4Details[players[player].inventory[players[player].highlightedItem ][0]].name , xOff+4+(x*22), yOff+36+(y*22));\n        }\n    }\n    if (players[\"player1\"].showingInventory && host) {\n        drawInventory(4, 24, \"player1\");\n    }\n    if (\"player2\" in players) {\n        if (players[\"player2\"].showingInventory && !online) {\n            drawInventory(gameWidth-142, 24, \"player2\");\n        } else if (players[\"player2\"].showingInventory) {\n            drawInventory(4, 24, \"player2\");\n        }\n    }\n\n    // QUICK ACTIONS AT BOTTOM\n    function actionBar(x, player) {\n        drawSquare(x-45, gameHeight-36, 18, 18, \"black\");\n        drawSquare(x-21, gameHeight-36, 18, 18, \"black\");\n        drawSquare(x+3, gameHeight-36, 18, 18, \"black\");\n        drawSquare(x+27, gameHeight-36, 18, 18, \"black\");\n        if (players[player].inventory[\"0x0\"].length > 0) ssh(players[player].inventory[\"0x0\"][0], x-44, gameHeight-35, 16, 16, 0);\n        if (players[player].inventory[\"1x0\"].length > 0) ssh(players[player].inventory[\"1x0\"][0], x-20, gameHeight-35, 16, 16, 0);\n        if (players[player].inventory[\"4x0\"].length > 0) ssh(players[player].inventory[\"4x0\"][0], x+4, gameHeight-35, 16, 16, 0);\n        if (players[player].inventory[\"5x0\"].length > 0) ssh(players[player].inventory[\"5x0\"][0], x+28, gameHeight-35, 16, 16, 0);\n    }\n    if (!(\"player2\" in players) || (online && host)) {\n        actionBar(Math.floor(gameWidth/2), \"player1\");\n    } else if (!host) {\n        actionBar(Math.floor(gameWidth/2), \"player2\");\n    } else {\n        actionBar(Math.floor(3*gameWidth/4), \"player1\");\n        actionBar(Math.floor(gameWidth/4), \"player2\");\n    }\n\n    // MENU BUTTON\n    ssh(9, gameWidth-20, 4, 16, 16);\n}\n\n\n\nfunction drawController(sprID, x, y, w, h, t, r, d, l) {\n    keys[t] = { clicked: false, held: false };\n    keys[r] = { clicked: false, held: false };\n    keys[d] = { clicked: false, held: false };\n    keys[l] = { clicked: false, held: false };\n    if (clk({ x:x+(w/3) , y:y , w:w/3 , h:h/3 })) { // TOP\n        keys[t].clicked = true;\n        ssh(sprID+1, x, y, w, h);\n    } else if (clk({ x:x+(2*w/3) , y:y+(h/3)  , w:w/3 , h:h/3 })) { // RIGHT\n        keys[r].clicked = true;\n        ssh(sprID+2, x, y, w, h);\n    } else if (clk({ x:x+(w/3) , y:y+(2*h/3) , w:w/3 , h:h/3 })) { // BOTTOM\n        keys[d].clicked = true;\n        ssh(sprID+3, x, y, w, h);\n    } else if (clk({ x:x , y:y+(h/3) , w:w/3 , h:h/3})) { // LEFT\n        keys[l].clicked = true;\n        ssh(sprID+4, x, y, w, h);\n    }\n    if (hld({ x:x+(w/3) , y:y , w:w/3 , h:h/3 })) { // TOP\n        keys[t].held = true;\n        ssh(sprID+1, x, y, w, h);\n    } else if (hld({ x:x+(2*w/3) , y:y+(h/3)  , w:w/3 , h:h/3 })) { // RIGHT\n        keys[r].held = true;\n        ssh(sprID+2, x, y, w, h);\n    } else if (hld({ x:x+(w/3) , y:y+(2*h/3) , w:w/3 , h:h/3 })) { // BOTTOM\n        keys[d].held = true;\n        ssh(sprID+3, x, y, w, h);\n    } else if (hld({ x:x , y:y+(h/3) , w:w/3 , h:h/3})) { // LEFT\n        keys[l].held = true;\n        ssh(sprID+4, x, y, w, h);\n    } else {\n        ssh(sprID, x, y, w, h);\n    }\n}\n\n\nconst mainLevel = {\n    init() {\n        createMap();\n        if (!host) {\n            onReceive = function(obj) {\n                players = obj.players;\n            }\n        }\n    },\n    update(delta) {\n        tick++;\n        cls(\"black\");\n        if (outputArea.children.length == 1) {\n            if (clk({ x:gameWidth-20 , y:4 , w:16 , h:16 })) { // WHEN CLICKING MENU BUTTON\n                window.menuArea = document.createElement(\"div\");\n                menuArea.style.cssText = `position: fixed; width: 200px; height; 200px; left: calc(50% - 124px); top: calc(50% - 124px); border: solid black 4px; border-radius: 8px; background-color: white; display: flex; flex-direction: column; gap: 20px; padding: 20px;`;\n                menuArea.innerHTML = `\n                    <button onclick=\"menuArea.remove();\">Return</button>\n                    <button onclick=\"touchController = !touchController; menuArea.remove();\">Touch Controls</button>\n                    <button onclick=\"menuArea.remove(); startSplitScreen();\">Local Split-Screen</button>\n                    <button onclick=\"menuArea.remove(); startMultiplayer();\">Multiplayer</button>\n                    <button onclick=\"path=[]; showOption();\">Exit</button>\n                `;\n                outputArea.appendChild(menuArea);\n            }\n            if (host) {\n                updatePlayer(delta, \"player1\", \"w\", \"a\", \"s\", \"d\", \"t\", \"f\", \"g\", \"h\", \"q\", \"e\", \"r\", \"y\");\n                if (online || splitScreen) {\n                    updatePlayer(delta, \"player2\", \"i\", \"j\", \"k\", \"l\", \"ArrowUp\", \"ArrowLeft\", \"ArrowDown\", \"ArrowRight\", \"u\", \"o\", \"p\", \"[\");\n                    if (online) sendObject({players: players});\n                }\n            } else {\n                if (!host) sendButtons();\n            }\n        }\n        dynamicUpdates(delta);\n        if (!splitScreen) {\n            drawMap(0, 0, gameWidth, gameHeight, activePlayer, \"black\");\n        } else {\n            drawMap(0, 0, (gameWidth/2) - 1, gameHeight, \"player1\", \"black\");\n            ctx.fillStyle = \"white\";\n            ctx.fillRect((gameWidth/2)-1, 0, 2, gameHeight);\n            drawMap((gameWidth/2)+1, 0, (gameWidth/2)-1, gameHeight, \"player2\", \"black\");\n        }\n        if (touchController) {\n            drawController(40, 16, gameHeight-80, 64, 64, \"w\", \"d\", \"s\", \"a\");\n            drawController(45, gameWidth-80, gameHeight-80, 64, 64, \"t\", \"h\", \"g\", \"f\");\n        }\n        drawGUI();\n    }\n}\n\ngameFramework({\n    width: gameWidth,\n    height: gameHeight,\n    spritesheet: [notes[\"Files\"][\"PD\"][\"!Data\"], 10, 5],\n    levels: [mainLevel]\n});",
        "Join Game": "J:optionsArea.style.display = \"none\";\nmultiplayer(false);",
        "!Game Framework QuickSetup": "J:\n/*\n\ngameFramework({\n    width: 200,\n    height: 300,\n    spritesheet: [base64String, quantX, quantY],\n    sprites: [ listOfBase64Strings ],\n    audio: [ listOfBase64Strings ],\n    levels: [\n        {\n            init() {},\n            update(delta) {}\n        },\n        {\n            init() {},\n            update(delta) {}\n        }\n    ]\n});\n\nAvailableFunctions\ncls(colour)\nspr(id, x, y, w, h, r)    !! w & h are in pixels !!\nssh(id, x, y, w, h, r)    !! w & h are in pixels !!\nsfx(id, loop)\nclk(str/int/{x, y, w, h} , controllerID)\nhld(str/int/{x, y, w, h} , controllerID)\nlvl(id)\n\n*/\n\n\n\n\n\n\n"
    },
    "Study": {
        "Archive": "T:<div id=\"header\" style=\"font-size: 52px;\">\n    <center><u>Header</u></center>\n</div>\n\n<br><hr><br>\n\n<div id=\"contents\">\n    <u style=\"font-size: 32px\">Contents</u>\n    <br><br>\n    <ul style=\"margin: 0;\">\n        <li>Maths</li>\n        <li>Physics</li>\n        <li>Bology</li>\n        <li>Car Mechanics</li>\n        <li>First Aid</li>\n        <li>IT\n            <ul style=\"margin: 0;\">\n                <li><a href=\"#IT_PowerShell\">PowerShell</a></li>\n            </ul>\n            <ul style=\"margin: 0;\">\n                <li><a href=\"#IT_NodeJS\">NodeJS</a></li>\n            </ul>\n        </li>\n        <li>Programming\n            <ul style=\"margin: 0;\">\n                <li><a href=\"#Programming_JavaScript\">JavaScript</a></li>\n            </ul>\n        </li>\n        <li>Games\n            <ul style=\"margin: 0;\">\n                <li><a href=\"#Games_Chess\">Chess</a></li>\n            </ul>\n        </li>\n        <li>Languages</li>\n        <li>Survival</li>\n    </ul>\n</div>\n\n<br><hr><br>\n\n<div id=\"IT_PowerShell\">\n    <u style=\"font-size: 32px\">PowerShell</u>\n    <br><br>\n    <u>What is PowerShell?</u>\n    <br><br>\n    PowerShell is both a command-line shell and a scripting language that you can use to automate administrative PC tasks.<br>It is cross platform and can be run on most Desktop Operating Systems and is built into Windows from the get go.\n    <br><br>\n    What makes PowerShell unique from other traditional command-line shells is that instead of dealing with text, it uses objects and names it's commands, cmdlets (pronounced command-lets).\n    <br><br>\n    <u>Getting Started</u>\n    <br><br>\n    To begin entering PowerShell commands, you can open the Terminal of choice and enter 'pwsh' to begin the PowerShell Shell.\n    <br><br>\n    Commands\n    <br><br>\n    <table border=1 style=\"margin: 0px; width: 100%;\">\n        <tr>\n            <th>Command</th>\n            <th>Explanation</th>\n        </tr>\n        <tr>\n            <td>$PSVersionTable</td>\n            <td>This command verifies the PowerShell Installation and provides information about the version, platform and edition. As this output/data is stored as an Object, it's very easy to extract data like from the following command.</td>\n        </tr>\n        <tr>\n            <td>$PSVersionTable.PSVersion</td>\n            <td>Running $PSVersionTable results in output that looks like a table, but is actually an object. For this reason, you can use a period (.) to access a specific property, such as PSVersion and it even provides some extra info.</td>\n        </tr>\n    </table>\n    <br><br>\n    <u>What are cmdlet's?</u>\n    <br><br>\n    A cmdlet are compiled commands, for convenience and consistency they are named with a verb-noun convention, such as 'Get-Help' for isntance. Here are some useful 'Get' commands :\n    <br><br>\n    <table border=1 style=\"margin: 0px; width: 100%;\">\n        <tr>\n            <th>Command</th>\n            <th>Explanation</th>\n        </tr>\n        <tr>\n            <td>Get-Verb</td>\n            <td>This cmdlet provides a list of all approved Verbs for cmdlet's.</td>\n        </tr>\n        <tr>\n            <td>Get-Command</td>\n            <td>This cmdlet lists all of the available cmdlet's on your system.</td>\n        </tr>\n        <tr>\n            <td>Get-Alias</td>\n            <td>This cmdlet lists all of the current Aliases in the session, so ones built in and ones you set. Aliases are just shorthand alternatives to common cmdlet's..</td>\n        </tr>\n        <tr>\n            <td>Get-Member</td>\n            <td>This cmdlet we'll come back to later on but is very useful for filtering the output of cmdlet's.</td>\n        </tr>\n        <tr>\n            <td>Get-Help</td>\n            <td>This cmdlet invokes the built-in help system, you can also use it's alias 'help' which does the exact same but breaks the output into pages for easier readability.</td>\n        </tr>\n    </table>\n    <br><br>\n    As Get-Command returns every command in PowerShell (thousands) you can use the flags -Verb and -Noun to search based on specific critera but adding them after the cmdlet, for example :\n    <br><br>\n    Get-Command -Verb Get -Noun alias*\n    <br>\n    Will return every command In PowerShell where the verb part matches 'Get' and the noun part relates to 'alias' in any way.\n    <br><br>\n    <u>The Power of Get-Help</u>\n    <br><br>\n    Every cmdlet in PowerShell has a wealth of knowledge and in-depth explanation stored along-side it. To access this you invoke the 'Get-Help' cmdlet and adding the '-Name' flag containing the name of the cmdlet you want to learn about, for example :\n    <br><br>\n    Get-Help -Name Get-Help\n    <br>\n    This will return all the information and examples for what the Get-Help cmdlet does and how to use it. If the help is out of date you can use the cmdlet 'Update-Help' to update to the latest information.\n    <br><br>\n    You'll notice that there are quite a few sections to the help it returns, there are 5 flags that you can use to alter what it returns, these are :\n    <ul style=\"margin: 0px;\">\n        <li>Full : Returns a full detailed help page, more than you get in the standard response.</li>\n        <li>Detailed : Returns a standard response but includes a section for parameters.</li>\n        <li>Examples : Returns only examples, if any exist.</li>\n        <li>Online : Opens a web page for your command.</li>\n        <li>Parameter : This flag requires a parameter name as an argument and lists it's specific properties.</li>\n    </ul>\n    <br><br>\n    <u>Utilising Cmdlet Outputs</u> \n    <br><br>\n    When you run a cmdlet, it returns an object where the data is strucutured and easier to work with. You can directly send the output of a cmdlet straight into another using a Pipe Symbol (|). This allows you to daisy chain cmdlet's together in a single line. The 'Get-Member' cmdlet shows you exactly this object, for example :\n    <br><br>\n    Get-Process -Name 'name-of-process' | Get-Member\n    <br>\n    First the 'Get-Process' cmdlet producess an object of processes with name 'name-of-process' and then forwards (pipes) that data as in input into 'Get-Member' which then displays it.\n    <br><br>\n    The output of Get-Member can be quite a lot to take in, if you wanted to filter the columns to only what you need, the following command is very useful :\n    <br><br>\n    <table border=1 style=\"margin: 0px; width: 100%;\">\n        <tr>\n            <th>Command</th>\n            <th>Explanation</th>\n        </tr>\n        <tr>\n            <td>Select-Object</td>\n            <td>When an object is piped into 'Select-Object' you can specifiy the names of specific columns that you want to see and disregard all the rest. For example : 'Select-Object Name, MemberType' will only show you the 2 columns called 'Name' and 'MemberType'</td>\n        </tr>\n    </table>\n    <br><br>\n    A good cmdlet to test 'Get-Member' and 'Select-Object' is using the following cmdlet :\n    <br><br>\n    <table border=1 style=\"margin: 0px; width: 100%;\">\n        <tr>\n            <th>Command</th>\n            <th>Explanation</th>\n        </tr>\n        <tr>\n            <td>Get-Process</td>\n            <td>When you run this cmdlet without any flags or parameters, it shows you a list of all running processes on your computer.</td>\n        </tr>\n    </table>\n    <br><br>\n    We can run 'Get_Process' again but this time apply a parameter and pipe the output into 'Get-Member' like so :\n    <br>\n    Get-Process -Name 'a-process-name' | Get-Member\n    <br><br>\n    You'll notice that when you run this command the first line of the output is the following :\n    <br>\n    TypeName: System.Diagnostics.Process\n    <br><br>\n    This tells us the type of cmdlet that we are using, in this case the type is a 'Process' cmdlet. If you want to learn more similar 'Process' cmdlets, we can use that as a parameter for 'Get-Command' like so :\n    <br>\n    Get-Command -ParameterType Process\n    <br><br>\n    You can use the 'Get-Help' system and 'Get-Member' to do some of your own research and digging into interesting cmdlet's and what they do.\n    <br><br>\n    <u>Scripting PowerShell</u> \n    <br><br>\n    Scripting is the process of taking multiple cmdlet's in a single text file and they are all run automatically one after the other, you can also use the following features for some extra funcitonality.\n    <br><br>\n    <table border=1 style=\"margin: 0px; width: 100%;\">\n        <tr>\n            <th>Feature</th>\n            <th>Explanation</th>\n        </tr>\n        <tr>\n            <td>Variables</td>\n            <td>You can use variables to store values. You can also use variables as arguments to commands.</td>\n        </tr>\n        <tr>\n            <td>Functions</td>\n            <td>Think of functions like turning a part of your script into a callable custom cmdlet. It can help when you want to use the same code multiple times, instead of having that code types multiple times, place it into a custom function and call the function multiple times as a cmdlet.</td>\n        </tr>\n        <tr>\n            <td>Flow Control</td>\n            <td>Flow control is how you control various execution paths by using things like 'If', 'ElseIf' and 'Else' statements.</td>\n        </tr>\n        <tr>\n            <td>Loops</td>\n            <td>Loops allow you to itterate over code multiple times, this makes it easy if you want to apply the same code to say multiple things one after the other, for example if you wanted to rename files in a folder, instead of having the rename code for each file, write it once and loop over each file.</td>\n        </tr>\n        <tr>\n            <td>Error Handling</td>\n            <td>It's important to write scripts that are robust and can handle various types of errors. You can use things like 'Try' and 'Catch' so that if code where to break, instead of stopping the whole flow, it uses the 'Catch' block of code instead and continues.</td>\n        </tr>\n    </table>\n    <br><br>\n</div>\n\n<br><hr><br>\n\n<div id=\"IT_NodeJS\">\n    <u style=\"font-size: 32px\">NodeJS</u>\n    <br><br>\n    <u>What is NodeJS?</u>\n    <br><br>\n    NodeJS is an incredibly popular JavaScript runtime designed to build scalable network applications. This means that you can run JavaScript free of the contraints of a web browser.\n    <br><br>\n    <u>NodeJS Basics</u>\n    <br><br>\n    To make sure that you are using the most recent version of NodeJS you can use the command 'node -v' in your terminal (CMD for Windows) to find your current version. \n    <br><br>\n    To initiate the Node REPL where you can start using it you can enter the command 'node' and begin entering JavaScript, alternatively you can do 'node index.js' to run the JavaScript from the index.js file in your current directory.\n    <br><br>\n    <a href=\"https://nodejs.org/docs/latest/api/synopsis.html\">Link to NodeJS Docs</a>\n    <br><br>\n    <br><br>\n    <br><br>\n    <br><br>\n    <br><br>\n    <br><br>\n    <br><br>\n</div>\n\n<br><hr><br>\n\n<div id=\"Programming_JavaScript\">\n    <u style=\"font-size: 32px\">Chess</u>\n    <br><br>\n    <u>What is JavaScript?</u>\n    <br><br>\n</div>\n\n<br><hr><br>\n\n<div id=\"Games_Chess\">\n    <u style=\"font-size: 32px\">Chess</u>\n    <br><br>\n    <u>What is Chess?</u>\n    <br><br>\n    Chess is a fantastic board game of patience and strategy with only a few simple rules.\n    <br>\n    Chess is played on a board of 8 by 8 squares labeled A -> H across and 1 -> 8 up. This is if you are playing as the White Pieces, so if you are playing with the Black, the board and coordiantes are effectively upside-down.\n    <br><br>\n    <u>Openings</u>\n    <br>\n</div>\n\n<br><hr><br>",
        "Maths": "J:studyFramework(\"Maths\", {\n    \"Algebra I\": [\n        [\"What is an algebraic expression?\", \"Reveal\", \"An algebraic expression is a combination of numbers (constants), variables (represented by letters), and mathematical operations (such as addition, subtraction, multiplication, division, and exponentiation) that does not contain an equals sign. It represents a mathematical quantity or relationship but does not state that it is equal to anything else. The goal with algebraic expressions is often to simplify them, evaluate them for specific values of the variables, or manipulate them in some way.<br>For example : \\(a^2 - 2ab +b^2\\)\"],\n        [\"What is the primary goal of simplifying an algebraic expression?\", \"To rewrite the expression in it's most compact and understandable form.\", \"To find the value of the variable.\", \"To make the expression longer and more complex.\", \"To introduce new variables into the expression.\", \"Simplifying an algebraic expression involves combining like terms and applying the order of operations to make the expression easier to work with and understand, not necessarily to solve for a specific variable.\"],\n        []\n    ],\n    \"Geometry\": [],\n    \"Algebra II\": [],\n    \"Trigonometry\": [],\n    \"Precalculus\": [],\n    \"Calculus I\": [],\n    \"Calculus II\": [],\n    \"Calculus III\": [],\n    \"Linear Algebra\": [],\n    \"Differential Equations\": [],\n    \"Real Analysis\": [],\n    \"Abstract Algebra\": [],\n    \"Complex Analysis\": [],\n    \"Probability and Statistics\": [],\n    \"Topology\": [],\n    \"Number Theory\": [],\n    \"Discrete Mathematics\": [],\n    \"Numerical Analysis\": []\n});",
        "Physics": "J:studyFramework(\"Physics\", {\n    \"Motion and Forces\" : [],\n    \"Energy and Heat\" : [],\n    \"Light and Sound\" : [],\n    \"Electricity and Magnetism\" : [],\n    \"Classical Mechanics\" : [],\n    \"Thermodynamics\" : [],\n    \"Waves and Optics\" : [],\n    \"Electromagnetism\" : [],\n    \"Modern Physics\" : [],\n    \"Advanced Classical Mechanics\" : [],\n    \"Electrodynamics\" : [],\n    \"Quantum Mechanics\" : [],\n    \"Statistical Mechanics\" : [],\n    \"Solid-State Physics\" : [],\n    \"Nuclear and Particle Physics\" : [],\n    \"Astrophysics and Cosmology\" : [],\n    \"General Relativity\" : [],\n    \"Quantum Field Theory\" : [],\n    \"String Theory\" : []\n});",
        "Biology": "J:studyFramework(\"Biology\", {\n    \"Cell Biology I\": [],\n    \"Classification of Living Things\": [],\n    \"Basic Human Biology\": [],\n    \"Ecology I\": [],\n    \"Cell Biology II\": [],\n    \"Ecology II\": [],\n    \"Genetics I\": [],\n    \"Evolution I\": [],\n    \"Plant Biology\": [],\n    \"Animal Biology\": [],\n    \"Molecular Biology\": [],\n    \"Microbiology\": [],\n    \"Physiology\": [],\n    \"Biochemistry\": [],\n    \"Genetics II\": [],\n    \"Ecology III\": [],\n    \"Evolution II\": [],\n    \"Neurobiology\": [],\n    \"Immunology\": [],\n    \"Development Biology\": [],\n    \"Bioinformatics\": [],\n    \"Biophysics\": []\n});",
        "Car Mechanics": "J:studyFramework(\"Car Mechanics\", {\n        \"Engine Fundamentals\": [],\n        \"Fuel Systems\": [],\n        \"Ignition Systems\": [],\n        \"Emission Control Systems\": [],\n        \"Transmissions\": [],\n        \"Drive Systems\": [],\n        \"Hydraulic Brake Systems\": [],\n        \"Anti-lock Braking Systems (ABS)\": [],\n        \"Parking Brakes\": [],\n        \"Suspension Systems\": [],\n        \"Steering Systems\": [],\n        \"Electrical Systems\": [],\n        \"Heating and Air  Conditioning (HVAC)\": [],\n        \"Safety Systems\": [],\n        \"General Systems\": [],\n        \"General Maintenance\": [],\n        \"Electric Vehicles\": [],\n        \"Hybrid Vehicles\": [],\n        \"Advanced Driver-Assistance Systems (ADAS)\": []\n});",
        "First Aid": "J:studyFramework(\"First Aid\", {\n    \"CPR\": [],\n    \"AED\": [],\n    \"Chocking\": [],\n    \"Severe Bleeding\": [],\n    \"Anaphylaxis Shock\": [],\n    \"Wounds\": [],\n    \"Burns\": [],\n    \"Bone Injuries\": [],\n    \"Head Injuries\": [],\n    \"Heart Attack\": [],\n    \"Stroke\": [],\n    \"Seizures\": [],\n    \"Fainting\": [],\n    \"Diabetic Emergencies\": [],\n    \"Asthma Attacks\": [],\n    \"Poisoning\": [],\n    \"Bites\": []\n});",
        "IT": "J:studyFramework(\"IT\", {\n    \"Component Hardware\": [\n        [\"What is Computer Hardware\", \"Reveal\", \"Computer Hardware refers to the physical components that a computer system requires to function. These are the tangible parts you can see and touch, as opposed to software, which are the programs and data.\"],\n        [\"What is a Motherboard?\", \"Reveal\", \"The motherboard is the main circuit board in a computer. It acts as the central connection point for all the computer's components, including the processor, memory, and graphics card. It distributes power and allows these components to communicate with each other, enabling the computer to function as a cohesive system.\"],\n        [\"Which of the following is not a valid form-factor of a Motherboard?\", \"Macro-ATX\", \"Micro-ATX\", \"ATX\", \"ITX\", \"ITX is the smallest form-factor of the 3 with dimensions 170mm x 170mm and is designed for very small form factors.<br>Micro-ATX is the mid-size option with a maximum size of 244mm x 244mm and generally has more expansion capabilities as ITX.<br>ATX is the largest of the 3 with dimensions 305mm x 244mm and offers the most expansion slots.<br>Macro-ATX is not a real form-factor.\"],\n        [\"What is a CPU (Central Processing Unit)?\", \"Reveal\", \"The CPU is the main 'brain' of a computer. It's a piece of hardware that carries out instructions from software by performing calculations, making decisions, and controlling the flow of information to other parts of the computer.\"],\n        [\"What is RAM (Random Access Memory)?\", \"Reveal\", \"RAM is a component in a computer that provides quick, temporary storage for data that is being actively used. This allows the computer's processor to access information rapidly, which is essential for running applications and keeping the system responsive. The data in RAM is only stored while the computer is powered on. This is called 'volatile' memory.\"],\n        [\"Which of the following describes your RAM?\", \"Volatile\", \"Non-Volatile\", \"RAM loses it's data once it loses power making it Volatile.\"],\n        [\"Which of the following describes your SSD or HDD?\", \"Non-Volatile\", \"Volatile\", \"Your computers SSD or HDD maintain their data once it loses power making it Non-Volatile.\"],\n        [\"What is a GPU (Graphics Processing Unit)?\", \"Reveal\", \"A GPU is a specialized electronic circuit designed to rapidly process and manipulate data for the purpose of accelerating the creation of images, videos, and other visual content. It excels at performing many calculations simultaneously, making it highly efficient for graphics rendering and certain types of complex computations. Most computers have a card dedicated to this called a Graphics Card.\"],\n        [\"What are the main types of Computer Storage?\", \"Reveal\", \"There are three main types of persistent computer storage. Hard Disk Drives (HDDs) store data magnetically on spinning platters. Solid State Drives (SSDs) use flash memory chips to store data electronically, offering faster speeds and greater durability. Optical Discs, such as CDs, DVDs, and Blu-ray discs, store data as microscopic pits read by a laser.\"],\n        [\"What is a PSU (Power Supply Unit)?\", \"Reveal\", \"A PSU is a crucial component in electronic devices, especially computers. Its primary function is to take the alternating current (AC) from a power outlet and convert it into a lower voltage direct current (DC) that the internal components of the device can use safely. It distributes this converted power through various cables to different parts, ensuring they receive the necessary electrical energy to operate.\"],\n        [\"What is a NIC (Network Interface Card)?\", \"Reveal\", \"A NIC is hardware enabling a computer to connect to a network. It translates computer data into network signals and vice versa for communication. Each NIC has a unique identifier for network recognition.\"],\n        [\"What is a BIOS (Basic Input/Output System)?\", \"Reveal\", \"The BIOS is a fundamental piece of software embedded on a computer's motherboard. It's the first program that runs when you power on your computer. Its primary job is to initialize and test the system's hardware components, ensuring everything is functioning correctly. After this initial check, the BIOS locates and loads the operating system so that you can begin using your computer.\"],\n        [\"What is a UEFI (Unified Extensible Firmware Interface)?\", \"Reveal\", \"UEFI is the modern start-up software for computers, replacing the older BIOS. It boots faster, supports larger drives, offers better security with Secure Boot, often has a graphical interface, and provides more advanced features.\"],\n        [\"What is a Core in the context of a CPU?\", \"Reveal\", \"A core in a CPU is an individual processing unit responsible for executing instructions. Modern CPUs contain multiple cores within a single chip, allowing them to perform multiple tasks simultaneously. Each core operates independently, fetching and executing instructions to carry out computations. The more cores a CPU has, the more tasks it can handle concurrently, leading to improved performance, especially in multitasking and demanding applications.\"],\n        [\"When a computer boots it POST's, what is this?\", \"Reveal\", \"When a computer boots it runs a Power-On-Self-Test or POST which is a simple diagnostics check to make sure that everything is working as it should.\"]\n    ],\n    \"Operating Systems\": [\n        [\"What is the primary role of an Operating System (OS)?\", \"Reveal\", \"To manage computer hardware resources, provide services for application software, and act as an interface between the user and the hardware.\"],\n        [\"What is the role of the kernel in an Operating System\", \"Reveal\", \"The Kernel is the core component of the OS that has complete control over the system's hardware. It manages resources like the CPU, memory, and I/O devices.\"],\n        [\"What is a UI (User Interface)?\", \"Reveal\", \"The user interface is how people interact with a computer system or device. It includes all the visual elements like screens, buttons, and icons that you see, as well as the ways you input information, such as through a keyboard or touch screen.\"],\n        [\"What is a 'Process' in the context of an OS?\", \"Reveal\", \"A process is an instance of a computer program that is being executed. It includes the program code and its current activity.\"],\n        [\"Name the two main types of user interfaces provided by operating systems.\", \"Reveal\", \"Graphical User Interface (GUI) and Command-Line Interface (CLI).\"],\n        [\"What is 'process management' in the context of an OS?\", \"Reveal\", \"The OS function responsible for creating, scheduling, terminating, and managing processes (running instances of programs).\"],\n        [\"What is 'memory management' in the context of an OS?\", \"Reveal\", \"The OS function responsible for allocating and deallocating memory space for processes, keeping track of memory usage, and managing virtual memory.\"],\n        [\"What technique allows an OS to use secondary storage (like an SSD or HDD) as an extension of physical RAM?\", \"Reveal\", \"Virtual Memory (often implemented using paging or segmentation).\"],\n        [\"How does the OS communicate with and control specific hardware components?\", \"Reveal\", \"Through Device Drivers, which are specialized software modules.\"],\n        [\"What term describes the ability of an OS to allow multiple programs to appear to run simultaneously on a single CPU core?\", \"Reveal\", \"Multitasking (or Concurrency).\"],\n        [\"What term describes the ability of an OS to execute multiple processes or threads truly simultaneously using multiple CPU cores?\", \"Reveal\", \"Multiprocessing.\"],\n        [\"Name three major families or examples of desktop operating systems.\", \"Reveal\", \"Microsoft Windows, Apple macOS, Linux (e.g., Ubuntu, Fedora, Debian).\"],\n        [\"Name two major mobile operating systems.\", \"Reveal\", \"Google Android, Apple iOS.\"],\n        [\"What is the 'shell' in an operating system?\", \"Reveal\", \"A program that provides the user interface (often CLI, but can be graphical) for accessing the OS services and running commands.\"],\n        [\"What mechanism does an OS use to control access rights (read, write, execute) to files and directories?\", \"Reveal\", \"Permissions (or Access Control).\"],\n        [\"What is the software that loads the main operating system kernel into memory after the initial hardware start-up (POST)?\", \"Reveal\", \"The Bootloader (e.g., GRUB, LILO, Windows Boot Manager).\"],\n        [\"What is a 'thread' within the context of an OS?\", \"Reveal\", \"A lightweight unit of execution within a process. Multiple threads can run within a single process, sharing its resources.\"],\n        [\"How do application programs typically request services from the OS kernel?\", \"Reveal\", \"Through System Calls, which are specific interfaces provided by the kernel.\"],\n        [\"What is an 'interrupt'?\", \"Reveal\", \"A signal generated by hardware or software to indicate an event that requires the immediate attention of the CPU/kernel.\"],\n        [\"What does API stand for, and how does it relate to an OS?\", \"Reveal\", \"Application Programming Interface. It defines how software components should interact; OS APIs allow applications to use OS functions (like file access or network communication).\"],\n        [\"Which major operating system family is known for being open-source and having many different 'distributions'?\", \"Reveal\", \"Linux.\"]\n    ],\n    \"Networking\": [\n        [\"What is a computer network?\", \"Reveal\", \"A collection of two or more computers and devices connected together to share resources (like files, printers) and communicate.\"],\n        [\"What is a LAN?\", \"Reveal\", \"Local Area Network. It typically covers a small geographic area, like a single building, office, or home.\"],\n        [\"What is the primary function of a network switch?\", \"To connect devices within the same network\", \"To forward data packets between networks\", \"To provide wireless internet access\", \"To manage IP addresses\", \"A switch connects devices within a local area network (LAN), using MAC addresses to forward data frames directly to the intended recipient.\"],\n        [\"What is the difference between a hub and a switch?\", \"A switch forwards data to specific devices based on MAC addresses, while a hub broadcasts data to all connected devices.\", \"A hub1 is faster than a switch.\", \"A switch is used for wireless networks, while a hub is used for wired networks.\", \"There is no functional difference between a hub and a switch.\", \"Switches are more efficient and secure than hubs because they learn MAC addresses and send data only to the intended port.\"],\n        [\"What is the purpose of a firewall in a network?\", \"To protect the network from unauthorized access and malicious traffic\", \"To increase internet speed\", \"To connect wireless devices\", \"To assign IP addresses automatically\", \"A firewall acts as a security barrier, monitoring incoming and outgoing network traffic and blocking anything that doesn't meet the configured security rules.\"],\n        [\"What is the role of an access point (AP) in a wireless network?\", \"To allow devices to connect wirelessly to a wired network\", \"To forward data between different wireless networks\", \"To manage network cables\", \"To amplify wireless signals\", \"An access point bridges the gap between wired and wireless networks, allowing devices with Wi-Fi capabilities to connect to the LAN.\"],\n        [\"What is a WAN?\", \"Reveal\", \"Wide Area Network. It covers a large geographic area, often connecting multiple LANs across cities or countries (e.g., the Internet).\"],\n        [\"What is the primary function of a network router?\", \"To forward data packets between networks\", \"To connect devices within the same network\", \"To provide wireless internet access\", \"To filter network traffic\", \"A router's main job is to direct network traffic between different networks, using IP addresses to determine the best path for data packets.\"],\n        [\"What is an IP (Internet Protocol) Address?\", \"Reveal\", \"An IP address is a numerical identifier to every device on the network and should be unique, this allows each device on a network to communicate with each other using their IP address.\"],\n        [\"Which type of IP Address allows the device to be directly reachable via the internet.\", \"Public IP Address\", \"Private IP Address\", \"Public IP Addresses are assigned to customers by their Internet Service Providers and are globally unique.\"],\n        [\"What is the use for Private IP Addresses?\", \"Reveal\", \"Private IP Addresses are assigned to devices within a Private Network such as a Home or Office Network. These addresses are not directly exposed to the internet but can be used for communications within the Private Network. \"],\n        [\"What is the difference between an IPv4 and IPv6 IP Address?\", \"Reveal\", \"IP Addresses are composed of bits with each bit being either a 1 or 0.<br>IPv4 Addresses are the most common today and is a collection of 4 groups (octets) each containing 8 bits, so 32 bits total.<br>IPv6 Addresses on the other hand are 8 groups of 16 bits with a total of 128 bits.<br>IPv4 addresses are usually displayed in a decimal format with each group a number between 0 and 255, IPv6 displaying each group in a hexadecimal format with a value between 0000 and ffff. Each group is separated by a period.\"],\n        [\"Which of the following is a valid IPv4 Address?\", \"192.168.0.1\", \"320.10.1.1\", \"0.100.200.300\", \"410.172.10.0\", \"192.168.0.1 is a valid IPv4 address as each octet lies between the range of 0 and 255.\"],\n        [\"Which of the following is a valid Class A IPv4 Address?\", \"80.192.0.1\", \"170.0.1.1\", \"198.10.0.1\", \"80.192.0.1 is a valid IPv4 Class A address because its first octet, 80 , falls within the Class A range of 1 to 127. In the binary representation of this address (01010000), the leading bit is 0, which is the defining characteristic of a Class A address.\"],\n        [\"Which of the following is a valid Class B IPv4 Address?\", \"170.0.1.1\", \"80.192.0.1\", \"198.10.0.1\", \"170.0.1.1 is a valid IPv4 Class B address because its first octet, 170, falls within the Class B range of 128 to 191. In the binary representation of this address (10101010), the leading bits are 10, which is the defining characteristic of a Class B address.\"],\n        [\"Which of the following is a valid Class C IPv4 Address?\", \"198.10.0.1\", \"170.0.1.1\", \"80.192.0.1\", \"198.10.0.1 is a valid IPv4 Class C address because its first octet, 198, falls within the Class C range of 192 to 223. In the binary representation of this address (11000110), the leading bits are 110, which is the defining characteristic of a Class C address.\"],\n        [\"What is a Subnet Mask?\", \"Reveal\", \"A subnet mask is a number that identifies the network and host portions of an IP address. It's used to determine which part of the IP address signifies the specific network a device belongs to, and which part identifies the individual device within that network. This helps in routing network traffic efficiently within local networks. It has the same layout as its IP counterpart but beings with a string of 1's designating which portions of the IP Address are for the network, and all following 0's designate which portions of the Address are for the host. It can be written in it's CIDR notation where you write the number of consecutive 1's.<br>For example: '/24' for 11111111 . 11111111 . 11111111 . 00000000.\"],\n        [\"What is the default Subnet Mask for a Class A IPv4 Address\", \"/8\", \"/16\", \"/24\", \"The /8 in a Class A network's default subnet mask (255.0.0.0) signifies that the first 8 bits (one octet) of the IP address are dedicated to identifying the network. This leaves the remaining 24 bits for host identification within that network, allowing for a vast number of hosts (over 16 million) in each Class A network.\"],\n        [\"What is the default Subnet Mask for a Class B IPv4 Address\", \"/16\", \"/8\", \"/24\", \"The /16 default subnet mask (255.255.0.0) for a Class B network means that the first 16 bits (two octets) of the IP address identify the network portion. This leaves the remaining 16 bits for host identification within that network, allowing for a moderate number of hosts (over 65,000) per Class B network.\"],\n        [\"What is the default Subnet Mask for a Class C IPv4 Address\", \"/24\", \"/8\", \"/16\", \"The /24 default subnet mask for Class C networks means the first 24 bits of the IP address are for the network, leaving the last 8 bits for hosts. This allows for 254 host addresses.\"],\n        [\"In a given Host IP Address range what IP Addresses are allocated to the network and which to the broadcast?\", \"Reveal\", \"Within a subnet's host address range, the first usable IP address is available for assignment to a network device, while the final IP address is invariably the broadcast address.\"],\n        [\"What is NAT (Network Address Translation)?\", \"Reveal\", \"NAT is a method that allows multiple devices on a private network to share a single public IP address when communicating with the internet. It works by modifying the network address information in the IP headers of packets as they pass through a router or firewall. This enables many devices to access the internet without needing their own unique public IP addresses.\"],\n        [\"What is a DHCP (Dynamic Host Configuration Protocol) Server?\", \"Reveal\", \"A DHCP Server is a network device that automatically assigns network configuration information, such as IP addresses, subnet masks, and default gateways, to devices on a network. This eliminates the need for manual configuration, ensuring devices can communicate effectively. These are built into most home Routers.\"],\n        [\"What is a DNS (Domain Name Server) Server?\", \"Reveal\", \"A DNS server translates human-readable website names into the IP address of the server hosting that website. When you type a web address, your computer asks the DNS server on the network for it's matching IP address, allowing your browser to connect to the correct website.<br>For example the DNS server would take the request 'google.com' and return '216.58.201.110'.\"],\n        [\"What is the OSI Model?\", \"Reveal\", \"The OSI Model is a conceptual framework that standardizes the communication functions of a networking system. It divides these functions into seven distinct layers, each with a specific role in transmitting data across a network. The layers are:<br><br>7. Application Layer<br>6. Presentation Layer<br>5. Session Layer<br>4. Transport Layer<br>3. Network Layer<br>2. Data Link Layer<br>1. Physical Layer\"],\n        [\"In the OSI Model, What is the name of Layer 7?\", \"Application\", \"Session\", \"Network\", \"Physical\", \"The Application Layer (layer 7) in the OSI Model is the interface between network services and end-user applications. It provides protocols that allow software to communicate across a network, enabling users to interact with network resources. This layer handles data in formats specific to the application, such as text, images, audio, and video. Common protocols operating at this layer include HTTP for web browsing, SMTP for email, FTP for file transfer, and DNS for domain name resolution.\"],\n        [\"In the OSI Model, What is the name of Layer 6?\", \"Presentation\", \"Transport\", \"Data-Link\", \"Session\", \"The Presentation Layer (layer 6) in the OSI model handles the formatting and translation of data so that applications on different systems can understand each other. It manages data representation, ensuring that information from a sending application is in a format that the receiving application can interpret. This layer also deals with data encryption and decryption for secure communication and data compression and decompression to optimize transmission efficiency. Common protocols at this layer include TLS/SSL for encryption and formats like JPEG, GIF, and MPEG for multimedia data.\"],\n        [\"In the OSI Model, What is the name of Layer 5?\", \"Session\", \"Application\", \"Transport\", \"Network\", \"The Session Layer (layer 5) manages the connections between applications. It establishes, coordinates, and terminates these connections, ensuring organized communication. This layer handles the flow of data during a session, managing aspects like synchronization and checkpoints for recovery. Protocols operating at this layer include SIP (Session Initiation Protocol) and NetBIOS. The Session Layer primarily deals with data streams and control information related to maintaining these connections.\"],\n        [\"In the OSI Model, What is the name of Layer 4?\", \"Transport\", \"Presentation\", \"Network\", \"Physical\", \"The Transport Layer (layer 4) manages the reliable transfer of data between applications on different devices. It divides data from the upper layers into segments and reassembles them at the destination. Key protocols at this layer are TCP and UDP and handles the data in the form of segments.\"],\n        [\"In the OSI Model, What is the name of Layer 3?\", \"Network\", \"Application\", \"Session\", \"Data-Link\", \"The Network Layer (layer 3) is responsible for routing data across different networks. It receives segments from the Transport Layer and assembles them into packets. This layer adds source and destination IP addresses to these packets, determining the best path for them to reach their final destination.\"],\n        [\"In the OSI Model, What is the name of Layer 2?\", \"Data-Link\", \"Physical\", \"Session\", \"Transport\", \"The Data-Link Layer (layer 2) is responsible for transferring data between two directly connected network nodes. It packages data from the Network Layer into frames and ensures reliable delivery across the physical link. This layer handles physical addressing (MAC addresses), manages access to the network medium, and can provide error detection and correction. Common protocols at this layer include Ethernet and PPP.\"],\n        [\"In the OSI Model, What is the name of Layer 1?\", \"Physical\", \"Network\", \"Application\", \"Session\", \"The Physical Layer (layer 1) is responsible for the physical transmission of data. It deals with the electrical and physical characteristics of the connection, defining how raw bits (0s and 1s) are represented as signals (electrical voltage, light pulses, radio waves) and transmitted over a physical medium like cables or air. This layer handles protocols such as Ethernet, Wi-Fi and Bluetooth.\"],\n        [\"Which OSI Model Layer handles the data in segments?\", \"Layer 4\", \"Layer 5\", \"Layer 3\", \"Layer 2\", \"Correct\"],\n        [\"Which OSI Model Layer handles the data in packets?\", \"Layer 3\", \"Layer 1\", \"Layer 4\", \"Layer 2\", \"Correct\"],\n        [\"Which OSI Model Layer handles the data in frames?\", \"Layer 2\", \"Layer 1\", \"Layer 3\", \"Layer 4\", \"Correct\"],\n        [\"Which OSI Model Layer handles the data in bits?\", \"Layer 1\", \"Layer 4\", \"Layer 3\", \"Layer 2\", \"Correct\"],\n        [\"For transmitting data, which route through the OSI Model does the data take?\", \"Layer 7 -> Layer 1\", \"Layer 1 -> Layer 7\", \"The Data goes from the users Application Layer and ends in the Physical Layer being transmitting as bits.\"],\n        [\"For receiving data, which route through the OSI Model does the data take?\", \"Layer 1 -> Layer 7\", \"Layer 7 -> Layer 1\", \"The Data arrives in bits and ends up at the end user in a readable format in the Application Layer.\"],\n        [\"Which OSI Model Layer would a Router typically reside in?\", \"Network Layer\", \"Data-Link Layer\", \"Transport Layer\", \"Routers are a prime example of a Layer 3 Network device as they make decisions on how to forward packets across networks based on their IP Address maintaining a routing table to determine the best path..\"],\n        [\"Which OSI Model Layer would a Network Switch typically reside in?\", \"Data-Link\", \"Physical Layer\", \"Transport Layer\", \"Network Switches are a prime example of a Layer 2 Network device as they use MAC addresses to forward data frames between devices within the same LAN. They learn the MAC addresses and build a MAC address table to direct traffic more efficiently, these are called Content Addressable Memory (CAM) \"],\n        [\"What is a MAC Address\", \"Reveal\", \"A MAC (Media Access Control) address is a unique physical identifier assigned to a network interface controller (NIC) in a device. It's a 48-bit hexadecimal address that serves to identify a specific device on a local network. This address is typically hardcoded into the hardware by the manufacturer and is used for data link layer communication within the same network segment.\"],\n        [\"What is TCP (Transmission Control Protocol)?\", \"Reveal\", \"TCP is a connection-oriented protocol that provides reliable, ordered, and error-checked delivery of a stream of bytes between applications running on hosts communicating via an IP network. Before data transmission, a connection is established through a three-way handshake. TCP segments the data, numbers each segment for reordering, and uses acknowledgements to ensure delivery. If segments are lost or arrive out of order, TCP handles retransmission and reassembly. It also manages flow control to prevent overwhelming the receiver and congestion control to adapt to network conditions.\"],\n        [\"What is UDP (User Datagram Protocol)?\", \"Reveal\", \"UDP is a connectionless protocol that sends data packets across networks without establishing a dedicated connection beforehand. It prioritizes speed over reliability, meaning packets may be lost or arrive out of order without the protocol attempting to fix these issues. This makes it suitable for applications where timely delivery is more important than guaranteed delivery of every piece of data.\"],\n        [\"Which communications protocol is faster?\", \"UDP\", \"TCP\", \"As UDP is connectionless there is a lower overhead leading to a faster transmission.\"],\n        [\"Which communications protocol is more reliable?\", \"TCP\", \"UDP\", \"TCP ensures reliability by numbering data segments for correct order, requiring acknowledgements for delivery confirmation, retransmitting lost or corrupted data detected by checksums, and managing data flow to prevent receiver overload.\"],\n        [\"Which of the following are best used for TCP?\", \"File Transfer's\", \"Streaming\", \"Gaming\", \"VoIP\", \"TCP guarantees complete and ordered data delivery for file transfers by establishing a reliable connection, tracking data segments, and retransmitting lost information, ensuring accuracy even if it takes a bit longer.\"],\n        [\"Which of the following are best used for UDP?\", \"Streaming\", \"File Transfer's\", \"Web Browsing\", \"Email\", \"UDP's speed and low overhead, achieved by skipping connection establishment and guaranteed delivery, minimize latency for smoother real-time streaming, even if it means occasional data loss.\"],\n        [\"What is QUIC?\", \"Reveal\", \"QUIC (Quick UDP Internet Connections) is a network protocol that aims to combine the speed of UDP and the reliability of TCP. Its used in about 10% of websites and can even maintain the connection when a device changes its network. It's more secure for the user as the headers and handshake are also encrypted with the data whereas they aren't with TCP.<br>This helps to prevent man-in-the-middle attacks and prevents the user from being observed but also makes it harder for security appliances such as firewalls to decrypt and manage the traffic.\"]\n    ],\n    \"Cybersecurity I\": [\n        [\"What are the three core principles of the CIA Triad in information security?\", \"Reveal\", \"Confidentiality, Integrity, and Availability.\"],\n        [\"What does 'Confidentiality' mean in the CIA Triad?\", \"Reveal\", \"Ensuring that information is not accessed by unauthorized individuals or systems.\"],\n        [\"What does 'Integrity' mean in the CIA Triad?\", \"Reveal\", \"Ensuring that data is accurate, complete, and has not been tampered with or altered without authorization.\"],\n        [\"What does 'Availability' mean in the CIA Triad?\", \"Reveal\", \"Ensuring that systems, networks, and data are accessible and operational for authorized users when needed.\"],\n        [\"What is a 'vulnerability' in cybersecurity?\", \"Reveal\", \"A weakness or flaw in a system, application, or process that could be exploited by a threat.\"],\n        [\"What is a 'threat' in cybersecurity?\", \"Reveal\", \"Any potential danger or event that could harm an asset by exploiting a vulnerability (e.g., malware, hacker, natural disaster).\"],\n        [\"What is 'risk' in cybersecurity?\", \"Reveal\", \"The likelihood that a specific threat will exploit a specific vulnerability, combined with the potential impact or damage.\"],\n        [\"What is 'malware'?\", \"Reveal\", \"Malicious Software: Software intentionally designed to cause damage, disrupt operations, or gain unauthorized access to a computer system.\"],\n        [\"What is a computer 'virus'?\", \"Reveal\", \"A type of malware that attaches itself to legitimate programs or files and requires human action (like running the program) to spread.\"],\n        [\"What is a computer 'worm'?\", \"Reveal\", \"A type of self-replicating malware that can spread across networks automatically without user intervention, often exploiting vulnerabilities.\"],\n        [\"What is a 'Trojan Horse' in malware terms?\", \"Reveal\", \"Malware disguised as legitimate software. It tricks users into installing it, then performs malicious actions in the background.\"],\n        [\"What does 'Ransomware' typically do?\", \"Reveal\", \"Encrypts a victim's files or locks their system, demanding a ransom payment (often cryptocurrency) for decryption or unlocking.\"],\n        [\"What is 'Spyware'?\", \"Reveal\", \"Malware designed to secretly monitor and collect information about a user's activities without their knowledge or consent.\"],\n        [\"What is 'Social Engineering'?\", \"Reveal\", \"The psychological manipulation of people into performing actions or divulging confidential information.\"],\n        [\"What is 'Phishing'?\", \"Reveal\", \"A common social engineering attack, usually via email, designed to trick victims into revealing sensitive information (like passwords or credit card numbers) by pretending to be a trustworthy entity.\"],\n        [\"What is 'Authentication'?\", \"Reveal\", \"The process of verifying the identity of a user, system, or service.\"],\n        [\"What is the most basic form of authentication?\", \"Reveal\", \"Something you know, typically a username and password combination.\"],\n        [\"What is the basic function of a network 'Firewall'?\", \"Reveal\", \"To monitor and filter incoming and outgoing network traffic based on predefined security rules, acting as a barrier between a trusted internal network and untrusted external networks.\"],\n        [\"What is the primary purpose of 'Antivirus' or 'Antimalware' software?\", \"Reveal\", \"To detect, prevent, quarantine, and remove malicious software from computer systems.\"],\n        [\"Why is 'Patch Management' crucial for security?\", \"Reveal\", \"It involves regularly applying updates (patches) to software and operating systems to fix known vulnerabilities, reducing the attack surface.\"],\n        [\"What is 'Encryption' in simple terms?\", \"Reveal\", \"The process of converting plain text data into a scrambled, unreadable format (ciphertext) using an algorithm and a key, to ensure confidentiality.\"]\n    ],\n    \"Software Development\": [\n        [\"What does SDLC stand for?\", \"Reveal\", \"Software Development Life Cycle.\"],\n        [\"Name at least three distinct phases of a typical SDLC.\", \"Reveal\", \"Examples: Planning, Requirements Analysis, Design, Implementation (Coding), Testing, Deployment, Maintenance.\"],\n        [\"What is the core difference between the Waterfall and Agile development methodologies?\", \"Reveal\", \"Waterfall is a linear, sequential process where each phase completes before the next begins. Agile is iterative and incremental, emphasizing flexibility, collaboration, and responding to change.\"],\n        [\"What is Scrum?\", \"Reveal\", \"A popular Agile framework that uses fixed-length iterations called sprints, specific roles (like Scrum Master, Product Owner), and ceremonies (like Daily Stand-ups, Sprint Reviews).\"],\n        [\"What is Object-Oriented Programming (OOP)?\", \"Reveal\", \"A programming paradigm based on the concept of 'objects', which encapsulate data (attributes) and behavior (methods).\"],\n        [\"Name two fundamental principles of OOP.\", \"Reveal\", \"Examples: Encapsulation, Inheritance, Polymorphism, Abstraction.\"],\n        [\"What is a 'variable' in programming?\", \"Reveal\", \"A named storage location in memory that holds a data value, which can potentially be changed during program execution.\"],\n        [\"What is the purpose of 'control structures' (like loops and conditionals)?\", \"Reveal\", \"To control the order and flow of execution of statements within a program based on conditions or repetitions.\"],\n        [\"Name two common programming languages and a typical application area for each.\", \"Reveal\", \"Examples: Python (web development, data science, scripting), JavaScript (front-end web development, Node.js backend), Java (enterprise applications, Android development), C# (.NET applications, game development).\"],\n        [\"What is the primary purpose of a Version Control System (VCS) like Git?\", \"Reveal\", \"To track changes to source code and other project files over time, enabling collaboration, branching, merging, and history tracking.\"],\n        [\"In Git, what does the 'commit' command do?\", \"Reveal\", \"It saves the current staged changes to the local repository, creating a new snapshot in the project's history.\"],\n        [\"In Git, what does the 'push' command do?\", \"Reveal\", \"It uploads local repository commits (and associated objects) to a remote repository (like GitHub or GitLab).\"],\n        [\"What is 'Unit Testing'?\", \"Reveal\", \"Testing individual, isolated parts (units or components) of the software, such as functions or methods, to ensure they work correctly.\"],\n        [\"What is 'User Acceptance Testing' (UAT)?\", \"Reveal\", \"The final phase of testing where end-users test the software in a realistic environment to ensure it meets their business requirements before deployment.\"],\n        [\"What does API stand for?\", \"Reveal\", \"Application Programming Interface.\"],\n        [\"What is the main function of an API?\", \"Reveal\", \"To define how different software components or systems should interact and exchange data with each other.\"],\n        [\"What does IDE stand for?\", \"Reveal\", \"Integrated Development Environment.\"],\n        [\"What typically constitutes an IDE?\", \"Reveal\", \"A software application providing comprehensive facilities like a source code editor, build automation tools, and a debugger.\"],\n        [\"What is the difference between compilation and interpretation?\", \"Reveal\", \"Compiled code is translated into machine code before runtime by a compiler. Interpreted code is executed line-by-line at runtime by an interpreter.\"]\n    ],\n    \"Cloud Computing\": [\n        [\"What is Cloud Computing?\", \"Reveal\", \"The delivery of on-demand computing services—including servers, storage, databases, networking, software, analytics, and intelligence—over the Internet ('the cloud').<br><br><img src='https://learn.microsoft.com/en-gb/training/wwl-azure/describe-cloud-service-types/media/shared-responsibility-b3829bfe.svg'></img>\"],\n        [\"What is a Public Cloud?\", \"Reveal\", \"Cloud infrastructure owned and operated by a third-party cloud provider, made available to the general public over the internet.\"],\n        [\"What is a Private Cloud?\", \"Reveal\", \"Cloud infrastructure operated solely for a single organization, essentially an evolution from a corporate datacentre, whether managed internally or by a third party, and hosted either internally or externally. Private clouds also come at a greater cost with fewer benefits than Public clouds.\"],\n        [\"What is a Hybrid Cloud?\", \"Reveal\", \"An environment that combines public and private clouds, allowing data and applications to be shared between them. Hybrid cloud can be used to provide an extra layer of security as users can flexibly choose which services to keep in public and which in private cloud.\"],\n        [\"What is a Multi-Cloud?\", \"Reveal\", \"In a multi-cloud scenario, you use multiple public cloud providers, either due to varying features or due to temporary cloud migration.\"],\n        [\"What is Azure Arc?\", \"Reveal\", \"Azure Arc is a set of technologies that helps manage your cloud environment, regardless of the cloud infrastructure you use and with who.\"],\n        [\"What is IaaS?\", \"Reveal\", \"IaaS (Infrastructure as a Service) provides on-demand access to fundamental IT resources like servers, storage, and networks over the internet. You rent these resources from a cloud provider, gaining flexibility and scalability without the cost and hassle of managing physical hardware. You control the software, while the provider manages the infrastructure.\"],\n        [\"Which of the following is an IaaS?\", \"AWS EC2\", \"Microsoft Word\", \"Gmail\", \"A Home Router\", \"AWS EC2 (Amazon Web Services, Elastic Compute Cloud) is a common IaaS because it offers virtual servers in the cloud where you control the operating system, storage, and networking. You manage the software, while AWS manages the underlying hardware.\"],\n        [\"What is PaaS?\", \"Reveal\", \"PaaS (Platform as a Service) offers a complete platform for building, running, and managing applications without managing the underlying infrastructure. It includes operating systems, development tools, and middleware, letting developers focus on coding while the provider handles the rest.\"],\n        [\"Which of the following is a PaaS?\", \"Google App Engine\", \"Dropbox\", \"Windows 11\", \"Microsoft Word\", \"Google App Script is indeed a PaaS because it lets developers deploy and run applications without managing any infrastructure. Google App Script automatically handles servers and scaling, allowing developers to focus solely on writing code.\"],\n        [\"What is SaaS?\", \"Reveal\", \"SaaS (Software as a Service) delivers software applications over the internet on a subscription basis. You access the software through a browser or app, and the provider manages all the underlying infrastructure, maintenance, and updates. You simply pay a recurring fee to use the software, like renting instead of buying.\"],\n        [\"Which of the following is a SaaS?\", \"Microsoft 365\", \"Windows 11\", \"Cloud Storage\", \"Desktop\", \"Microsoft 365 is indeed a SaaS because you access and use its applications (like Word, Excel, Outlook) over the internet on a subscription basis. Microsoft hosts and manages the software and infrastructure, so you don't install or maintain it yourself; you simply pay to use it.\"],\n        [\"What is FaaS?\", \"Reveal\", \"FaaS (Function as a Service or Serverless Computing) lets you run small pieces of code, called 'functions', without worrying about managing servers. Different to SaaS which provides a complete application to end-users.\"],\n        [\"What is CapEx (Captial Expenditure)?\", \"One-Time upfront expenditure for physical Resources.\", \"Paying for products over time.\", \"CapEx is indeed typically a one-time, up-front expenditure to purchase or secure tangible resources. A new building, repaving the parking lot, building a datacentre, or buying a company vehicle are examples of CapEx.\"],\n        [\"What is OpEx (Operational Expenditure)?\", \"Paying for products over time.\", \"One-Time upfront expenditure for physical Resources.\", \"OpEx is indeed spending money on services or products over time. Renting a convention centre, leasing a company vehicle, or signing up for cloud services are all examples of OpEx.\"],\n        [\"Which of the following does Cloud Computing fall under?\", \"OpEx\", \"CapEx\", \"Cloud computing falls under OpEx because cloud computing operates on a consumption-based model. With cloud computing, you don’t pay for the physical infrastructure, the electricity, the security, or anything else associated with maintaining a datacentre. Instead, you pay for the IT resources you use.\"],\n        [\"What are benefits to Cloud Computing being a pay-as-you-go pricing model?\", \"Reveal\", \"As you typically only pay for the services that you use, you can:<p><ul><li>Plan and manager operating costs.</li><li>Run your infrastructure more efficiently.</li><li>Scale as your business needs change.</li></ul></p>\"],\n        [\"What is Cloud Availability?\", \"Reveal\", \"Cloud availability means that the services and data you access in the cloud are accessible and working when you need them. It focuses on ensuring continuous operation with minimal interruptions. High availability indicates a very high percentage of uptime and a very low percentage of downtime. These are usually stated in Service Level Agreements (SLA's) and use multiple servers or data centres (Availability Zones).\"],\n        [\"What is Cloud Scalability?\", \"Reveal\", \"Cloud scalability is the ability of cloud services to easily handle more or fewer resources as needed. Imagine your website suddenly gets a lot more visitors; with cloud scalability, the system can automatically add more computing power to keep things running smoothly. When the rush is over, it can scale back down, so you're not paying for unused resources. It's about being flexible and efficient with computing power and storage in response to changing demands.\"],\n        [\"With Cloud Scalability, what is the difference between Vertical Scaling and Horizontal Scaling?\", \"Reveal\", \"In Cloud Computing, Vertical Scaling (scaling up) means increasing the resources of a single server or virtual machine, whilst Horizontal Scaling (scaling out) involves adding more servers or virtual machines to distribute the workload.\"],\n        [\"What is Cloud Reliability?\", \"Reveal\", \"Cloud reliability is about how consistently and dependably cloud services work without failing. It ensures that your data and applications are available when you need them and that the cloud environment can handle issues without causing major disruptions. Think of it as the cloud's ability to keep running smoothly and recover quickly from any problems.\"],\n        [\"What is Cloud Predictability?\", \"Reveal\", \"Cloud predictability refers to the ability to forecast with reasonable accuracy how cloud resources will behave in terms of performance and cost. It allows users to anticipate resource needs, understand potential expenses, and plan their cloud usage effectively, leading to better budgeting and more reliable application performance.\"],\n        [\"Why are VM's (Virtual Machines) used in Cloud Computing?\", \"Reveal\", \"Virtual machines in cloud computing allow a single physical server to run multiple isolated operating systems and applications. This creates efficient use of hardware, enabling cloud providers to offer scalable and cost-effective computing resources to numerous users simultaneously. Each virtual machine acts as its own independent computer, providing users with flexibility and control over their computing environment in the cloud.\"],\n        [\"What are Containers used for in Cloud Computing?\", \"Reveal\", \"Containers in cloud computing are like lightweight, self-contained boxes that hold everything an application needs to run, such as code, libraries, and settings. These boxes can easily be moved and run consistently across different cloud environments without worrying about compatibility issues. This makes deploying and managing applications in the cloud more efficient and flexible.\"],\n        [\"What are Kubernetes?\", \"Reveal\", \"Kubernetes, often called K8s, is like a smart manager for containers. Imagine you have many of these program-boxes that need to work together. Kubernetes helps start, stop, move, and scale these boxes automatically, making sure everything runs smoothly and efficiently, even if some boxes have problems or you need more of them.\"],\n        [\"What is IAM in Cloud Computing?\", \"Reveal\", \"IAM (Identity and Access Management) is like a security guard for your digital resources. It makes sure that only the right people (or services) can access the specific things they need, and nothing more. Think of it as managing who has the keys to different rooms in a building, ensuring everyone can do their job without stepping into areas they shouldn't. This helps keep your cloud environment secure and organized.\"]\n    ],\n    \"Microsoft 365\": [\n        [\"What is Microsoft 365?\", \"Reveal\", \"Microsoft 365 is a cloud-powered productivity platform. It brings together the best-in-class productivity apps from Office 365 with advanced device management, intelligent security, and innovative online services.\"]\n    ],\n    \"Cybersecurity II\": [\n        [\"What is a Denial-of-Service (DoS) attack?\", \"Reveal\", \"An attack aimed at making a machine or network resource unavailable to its intended users by overwhelming it with traffic or requests.\"],\n        [\"What distinguishes a Distributed Denial-of-Service (DDoS) attack from a DoS attack?\", \"Reveal\", \"A DDoS attack uses multiple compromised computers (a botnet) to launch the attack, making it harder to block and more powerful.\"],\n        [\"What is a 'Man-in-the-Middle' (MitM) attack?\", \"Reveal\", \"An attack where the attacker secretly intercepts and potentially alters communications between two parties who believe they are communicating directly.\"],\n        [\"What is an 'SQL Injection' attack?\", \"Reveal\", \"A web security vulnerability where an attacker inserts malicious SQL statements into data entry fields to manipulate a backend database.\"],\n        [\"What is a 'Cross-Site Scripting' (XSS) attack?\", \"Reveal\", \"An attack where malicious scripts are injected into otherwise benign and trusted websites, which are then executed in the victim's browser when they visit the site.\"],\n        [\"What is 'Spear Phishing'?\", \"Reveal\", \"A highly targeted phishing attack aimed at a specific individual, group, or organization, often using personalized information to appear more credible.\"],\n        [\"What does MFA stand for, and why is it recommended?\", \"Reveal\", \"Multi-Factor Authentication. It's recommended because it requires two or more different verification methods (e.g., something you know, have, or are), providing significantly stronger security than passwords alone.\"],\n        [\"Give an example of each of the three common MFA factor types.\", \"Reveal\", \"Something you know (password, PIN), Something you have (smartphone app code, hardware token), Something you are (fingerprint, facial recognition).\"],\n        [\"What does RBAC stand for in access control?\", \"Reveal\", \"Role-Based Access Control. Access permissions are assigned based on defined roles within an organization, rather than directly to individual users.\"],\n        [\"What is the difference between an IDS and an IPS?\", \"Reveal\", \"An Intrusion Detection System (IDS) monitors network traffic for suspicious activity and alerts administrators. An Intrusion Prevention System (IPS) also monitors traffic but can automatically take action to block detected threats.\"],\n        [\"What does VPN stand for and what is its primary security benefit?\", \"Reveal\", \"Virtual Private Network. It creates a secure, encrypted tunnel over a public network (like the internet), protecting data confidentiality and masking the user's IP address.\"],\n        [\"What is 'Hashing' primarily used for in security?\", \"Reveal\", \"To create a unique, fixed-size string (hash) from input data for integrity verification (checking if data has changed) and secure password storage (storing hashes instead of plain text passwords).\"],\n        [\"How does hashing differ fundamentally from encryption?\", \"Reveal\", \"Hashing is a one-way process (you cannot easily recover the original data from the hash), while encryption is a two-way process (ciphertext can be decrypted back to plaintext with the correct key).\"],\n        [\"What is a 'Risk Assessment' in cybersecurity?\", \"Reveal\", \"The process of identifying potential security threats and vulnerabilities, analyzing the likelihood and potential impact of them occurring, and determining the overall risk level.\"],\n        [\"Name three key phases of an Incident Response plan.\", \"Reveal\", \"Examples: Preparation, Identification (Detection), Containment, Eradication, Recovery, Lessons Learned (Post-Incident Activity).\"],\n        [\"Why are formal Security Policies important for an organization?\", \"Reveal\", \"They establish clear rules, guidelines, and expectations for employees regarding the protection of information assets and acceptable use of systems.\"],\n        [\"What is the core principle behind the 'Zero Trust' security model?\", \"Reveal\", \"'Never trust, always verify.' It assumes that threats can exist both inside and outside the network, requiring strict verification for every user and device attempting to access resources.\"],\n        [\"What is 'Penetration Testing' (or Pen Testing)?\", \"Reveal\", \"An authorized, simulated cyberattack against a computer system or network to evaluate its security posture by identifying and exploiting vulnerabilities.\"]\n    ],\n    \"Data Science and Analytics\": [\n        [\"What is the primary goal of data science?\", \"To extract knowledge and insights from data.\", \"To develop new software applications.\", \"To manage and maintain IT infrastructure.\", \"To secure computer networks from cyber threats.\", \"Data science uses scientific methods, processes, algorithms, and systems to extract knowledge and insights from noisy, structured, and unstructured data.\"],\n        [\"Define 'Big Data.'\", \"Reveal\", \"Big Data refers to extremely large and complex datasets that are difficult to process with traditional data processing applications. It is often characterized by the three Vs (Volume, Velocity, Variety) and sometimes more (Veracity, Value).\"],\n        [\"Which of the following is a key component of the data science process?\", \"Data cleaning and pre-processing\", \"Network configuration\", \"Software testing\", \"Hardware maintenance\", \"Data cleaning and preprocessing are crucial steps to ensure the quality and usability of data for analysis.\"],\n        [\"What is the difference between structured and unstructured data?\", \"Reveal\", \"Structured data is organized and has a defined format (e.g., relational databases), while unstructured data does not have a predefined format (e.g., text documents, images, videos).\"],\n        [\"Which of the following is an example of structured data?\", \"Relational database tables\", \"Email messages\", \"Social media posts\", \"Video recordings\", \"Relational database tables have a predefined schema with rows and columns, making them structured.\"],\n        [\"What type of data represents measurements or counts?\", \"Numerical data\", \"Categorical data\", \"Ordinal data\", \"Boolean data\", \"Numerical data (also known as quantitative data) represents values that can be measured or counted.\"],\n        [\"What are some common methods for collecting data?\", \"Reveal\", \"Common methods include web scraping, APIs, surveys, sensors, transaction logs, and database queries.\"],\n        [\"What is the purpose of data cleaning?\", \"To identify and correct errors, inconsistencies, and missing values in data.\", \"To visualize data for presentation.\", \"To transform data into a different format.\", \"To encrypt sensitive data for security.\", \"Data cleaning aims to improve the quality of data by handling missing values, correcting errors, and resolving inconsistencies.\"],\n        [\"Which of the following is a common data pre-processing technique?\", \"Feature scaling\", \"Software deployment\", \"Network monitoring\", \"System administration\", \"Feature scaling, such as normalization or standardization, is used to bring numerical features to a similar scale.\"],\n        [\"What is Exploratory Data Analysis (EDA)?\", \"Reveal\", \"EDA is an approach to analysing datasets to summarize their main characteristics, often using visual methods. It helps to understand the data's structure, identify patterns, and formulate hypotheses.\"],\n        [\"Which of the following is a common statistical measure used in data analysis?\", \"Standard deviation\", \"CPU utilization\", \"Network latency\", \"Disk I/O\", \"Standard deviation measures the dispersion or spread of a dataset around its mean.\"],\n        [\"What type of visualization is best suited for showing the distribution of a single numerical variable?\", \"Histogram\", \"Scatter plot\", \"Bar chart\", \"Line chart\", \"A histogram is a graphical representation of the distribution of numerical data, where the height of each bar represents the frequency of data points within a specific range.\"],\n        [\"What is the difference between supervised and unsupervised learning?\", \"Reveal\", \"Supervised learning uses labeled data to train models to predict outcomes, while unsupervised learning works with unlabeled data to find patterns and structures.\"],\n        [\"Which of the following is a common supervised learning algorithm for classification?\", \"Decision Trees\", \"K-Means clustering\", \"Principal Component Analysis (PCA)\", \"Linear Regression\", \"Decision Trees are a supervised learning algorithm used for both classification and regression tasks, building a tree-like structure of decisions.\"],\n        [\"What is the purpose of training a machine learning model?\", \"To learn patterns and relationships from the training data.\", \"To deploy the model to a production environment.\", \"To evaluate the model's performance on unseen data.\", \"To collect new data for analysis.\", \"The training process involves feeding the model with labeled data (in supervised learning) or unlabeled data (in unsupervised learning) so that it can learn the underlying patterns and relationships.\"],\n        [\"Why is data visualization important in data science?\", \"Reveal\", \"Data visualization helps to communicate complex data insights effectively, making it easier for stakeholders to understand patterns, trends, and anomalies.\"],\n        [\"Which of the following is a consideration when creating effective data visualizations?\", \"Choosing the right type of chart for the data and message.\", \"Using as many colors as possible for visual appeal.\", \"Making sure the visualization is overly complex to show all the data.\", \"Avoiding labels and legends to keep the visualization clean.\", \"Selecting an appropriate chart type that clearly and accurately represents the data and conveys the intended message is crucial for effective visualization.\"],\n        [\"What is the goal of data interpretation in the data science process?\", \"To translate the results of the analysis into actionable insights.\", \"To build more complex machine learning models.\", \"To collect more data for further analysis.\", \"To optimize the performance of data processing pipelines.\", \"Data interpretation involves making sense of the results of the data analysis and drawing meaningful conclusions that can inform decision-making.\"],\n        [\"What is Natural Language Processing (NLP)?\", \"Reveal\", \"NLP is a field of artificial intelligence that enables computers to understand, interpret, and generate human language.\"],\n        [\"Which of the following is a common application of time series analysis in IT?\", \"Predicting future server load based on historical data.\", \"Sentiment analysis of customer reviews.\", \"Identifying clusters of similar user behavior.\", \"Recommending products to online shoppers.\", \"Time series analysis is used to analyze data points indexed in time order, making it suitable for predicting future trends like server load.\"],\n        [\"What is the role of a data engineer in a data science team?\", \"To design, build, and maintain the data infrastructure.\", \"To build and deploy machine learning models.\", \"To communicate findings to business stakeholders.\", \"To perform statistical analysis on datasets.\", \"Data engineers are responsible for the infrastructure needed for data storage, processing, and delivery, ensuring that data scientists have access to clean and usable data.\"]\n    ],\n    \"IT Support and Systems Admin\": [\n        [\"What is the first step a user should typically take when encountering a technical issue?\", \"Restart their computer.\", \"Call the IT support hotline immediately.\", \"Replace the network cable.\", \"Reinstall the operating system.\", \"Often, a simple restart can resolve temporary software glitches and is a good first troubleshooting step.\"],\n        [\"What is the purpose of a ticketing system in IT support?\", \"Reveal\", \"A ticketing system is used to track, manage, and resolve user-reported IT issues. It helps organize support requests and ensures timely responses.\"],\n        [\"Which of the following is a common task for an IT support technician?\", \"Developing new software applications.\", \"Managing network infrastructure.\", \"Troubleshooting user hardware and software problems.\", \"Designing database schemas.\", \"IT support technicians primarily focus on assisting users with their technical difficulties related to hardware and software.\"],\n        [\"What does 'DNS' stand for?\", \"Domain Name System\", \"Digital Network Service\", \"Dynamic Node Server\", \"Distributed Network System\", \"DNS translates human-readable domain names (like 'google.com') into IP addresses that computers use to communicate.\"],\n        [\"What is the purpose of DHCP?\", \"Reveal\", \"Dynamic Host Configuration Protocol (DHCP) automatically assigns IP addresses and other network configuration parameters to devices on a network.\"],\n        [\"Which of the following is a common operating system for servers?\", \"Windows Server\", \"Windows Home\", \"macOS Ventura\", \"Chrome OS\", \"Windows Server is a line of server operating systems designed by Microsoft.\"],\n        [\"What is a 'user account' on a computer system?\", \"A physical component of the computer.\", \"A software application for browsing the internet.\", \"A collection of settings and permissions associated with a specific user.\", \"A type of network cable.\", \"A user account allows individuals to log in to a computer system and access resources based on their assigned permissions.\"],\n        [\"What is the principle of least privilege in systems administration?\", \"Reveal\", \"The principle of least privilege states that users and processes should have only the minimum level of access necessary to perform their required tasks.\"],\n        [\"Which of the following is a common method for securing a wireless network?\", \"Using an Ethernet cable.\", \"Disabling the Wi-Fi adapter.\", \"Enabling WPA2/WPA3 encryption.\", \"Unplugging the router.\", \"WPA2 and WPA3 are security protocols that encrypt the data transmitted over a wireless network.\"],\n        [\"What is the purpose of a firewall?\", \"To physically protect computer hardware.\", \"To manage user accounts.\", \"To prevent unauthorized access to or from a network.\", \"To optimize internet speed.\", \"A firewall acts as a barrier, monitoring and controlling network traffic based on security rules.\"],\n        [\"What is 'malware'?\", \"Reveal\", \"Malware is a general term for malicious software designed to harm or disrupt computer systems, networks, or devices. Examples include viruses, worms, and ransomware.\"],\n        [\"Which of the following is a critical aspect of data backup?\", \"Storing backups on the same physical drive as the original data.\", \"Never testing the restoration process.\", \"Regularly scheduling and testing backups.\", \"Only backing up executable files.\", \"Regular backups and testing the restoration process are essential to ensure data can be recovered in case of data loss.\"],\n        [\"What is 'patch management' in systems administration?\", \"A method for physically organizing network cables.\", \"The process of installing updates and security fixes to software and operating systems.\", \"Managing user passwords.\", \"Setting up new user accounts.\", \"Patch management is crucial for maintaining system security and stability by addressing vulnerabilities and bugs.\"],\n        [\"What is the function of a server in a network?\", \"Reveal\", \"A server is a computer system that provides resources, data, services, or programs to other computers (clients) on a network.\"],\n        [\"Which of the following is a common remote access tool used by IT support?\", \"Microsoft Word.\", \"Adobe Photoshop.\", \"TeamViewer or Remote Desktop.\", \"Google Chrome.\", \"Tools like TeamViewer and Remote Desktop allow IT support to remotely connect to a user's computer to provide assistance.\"],\n        [\"What is 'Active Directory' primarily used for in a Windows environment?\", \"Managing network printing services.\", \"Providing internet access to users.\", \"Centralized management of users, computers, and security policies.\", \"Monitoring network traffic.\", \"Active Directory is a directory service developed by Microsoft for managing user accounts, computer resources, and security policies in a network.\"],\n        [\"What is 'CPU utilization'?\", \"Reveal\", \"CPU utilization refers to the percentage of time the computer's central processing unit (CPU) is actively processing instructions.\"],\n        [\"Which of the following is a common method for user authentication?\", \"Connecting a USB drive.\", \"Typing a username and password.\", \"Adjusting the monitor brightness.\", \"Deleting temporary files.\", \"Username and password combinations are a fundamental method for verifying a user's identity.\"],\n        [\"What is 'network latency'?\", \"The physical distance between network devices.\", \"The speed at which data is transferred over a network.\", \"The delay in data transfer across a network.\", \"The number of devices connected to a network.\", \"Network latency is the time it takes for data to travel across a network connection.\"],\n        [\"What is the purpose of RAID (Redundant Array of Independent Disks)?\", \"Reveal\", \"RAID is a data storage virtualization technology that combines multiple physical disk drive components into one or more logical units for data redundancy, performance improvement, or both.\"],\n        [\"Which of the following is a common command-line tool in Windows?\", \"Safari\", \"Finder\", \"Command Prompt (cmd)\", \"Terminal (bash)\", \"Command Prompt (cmd) is the command-line interpreter available in Windows operating systems.\"],\n        [\"What is 'system monitoring' in IT?\", \"The process of physically cleaning computer hardware.\", \"Tracking and analyzing the performance and health of IT systems.\", \"Managing software licenses.\", \"Training new IT staff.\", \"System monitoring involves observing system metrics like CPU usage, memory utilization, and network traffic to ensure optimal performance and identify potential issues.\"],\n        [\"What is 'ITIL'?\", \"Reveal\", \"ITIL (Information Technology Infrastructure Library) is a framework of best practices for IT service management.\"],\n        [\"Which of the following is a common type of network cable?\", \"Power cable.\", \"HDMI cable.\", \"Ethernet cable (RJ45).\", \"USB cable.\", \"Ethernet cables with RJ45 connectors are commonly used for wired network connections.\"],\n        [\"What is 'virtualization' in the context of systems administration?\", \"Running multiple operating systems on a single physical machine.\", \"Physically separating network segments.\", \"Managing user accounts through a web interface.\", \"Optimizing database performance.\", \"Virtualization allows for the creation of virtual versions of hardware and operating systems, enabling multiple systems to run on one physical server.\"],\n        [\"What is 'disaster recovery' planning?\", \"Reveal\", \"Disaster recovery planning involves creating strategies and procedures for responding to and recovering from disruptive events like hardware failures, natural disasters, or cyberattacks to minimize downtime and data loss.\"],\n        [\"Which of the following is a key aspect of endpoint security?\", \"Securing the physical server room.\", \"Implementing strong passwords and malware protection on user devices.\", \"Managing network routing protocols.\", \"Optimizing database query performance.\", \"Endpoint security focuses on protecting individual user devices (endpoints) that connect to the network.\"],\n        [\"What is 'load balancing' in a server environment?\", \"Distributing network traffic or workload across multiple servers.\", \"Physically balancing the weight of servers in a rack.\", \"Managing the temperature of a server room.\", \"Optimizing database storage capacity.\", \"Load balancing helps to improve performance and availability by distributing tasks across multiple servers.\"],\n        [\"What is 'SSH'?\", \"Reveal\", \"Secure Shell (SSH) is a cryptographic network protocol for operating network services securely over an unsecured network. It's commonly used for remote server administration.\"],\n        [\"Which of the following is a common task related to user account management?\", \"Configuring network switches.\", \"Installing operating system updates.\", \"Creating, modifying, and deleting user accounts.\", \"Troubleshooting printer issues.\", \"Managing user accounts involves tasks like setting up new accounts, changing passwords, and managing user permissions.\"]\n    ],\n    \"Database Admin\": [\n        [\"What is the primary role of a Database Administrator (DBA)?\", \"To develop new software applications.\", \"To manage and maintain database systems.\", \"To provide end-user IT support.\", \"To design computer networks.\", \"A DBA is responsible for the performance, integrity, security, and availability of databases.\"],\n        [\"What is a 'DBMS'?\", \"Reveal\", \"DBMS stands for Database Management System. It is software that allows users to define, manipulate, retrieve, and manage data in a database.\"],\n        [\"Which of the following is a common type of database?\", \"Word Processor Document\", \"Spreadsheet Software\", \"Relational Database\", \"Presentation Software\", \"Relational databases organize data into tables with relationships between them.\"],\n        [\"What does 'SQL' stand for?\", \"Structured Query Language\", \"Simple Question Language\", \"System Query Logic\", \"Standard Query Method\", \"SQL is the standard language for managing and manipulating data in relational databases.\"],\n        [\"What is the purpose of a 'primary key' in a database table?\", \"Reveal\", \"A primary key is a column or set of columns in a database table that uniquely identifies each row in that table.\"],\n        [\"What is a 'foreign key' used for in a relational database?\", \"To encrypt data within the table.\", \"To define the data type of a column.\", \"To establish and enforce relationships between tables.\", \"To improve the speed of data retrieval within a single table.\", \"A foreign key is a column or set of columns in one table that refers to the primary key in another table, establishing a link between them.\"],\n        [\"What is 'data normalization'?\", \"The process of encrypting sensitive data.\", \"The process of organizing data in a database to reduce redundancy and improve data integrity.\", \"The process of backing up database files.\", \"The process of optimizing database hardware.\", \"Data normalization involves structuring database tables in a way that minimizes data duplication and ensures data dependencies make sense.\"],\n        [\"What is the purpose of a 'database index'?\", \"Reveal\", \"A database index is a data structure that improves the speed of data retrieval operations on a database table.\"],\n        [\"Which of the following is a common database management system?\", \"Microsoft Excel\", \"Adobe Acrobat\", \"MySQL\", \"Mozilla Firefox\", \"MySQL is a popular open-source relational database management system.\"],\n        [\"What is a 'database transaction'?\", \"A physical storage unit for database files.\", \"A sequence of operations performed as a single logical unit of work.\", \"A graphical tool for visualizing database schemas.\", \"A type of user account with limited database access.\", \"A database transaction is a series of operations that must be either entirely completed or entirely rolled back to maintain data integrity.\"],\n        [\"What is 'ACID' in the context of database transactions?\", \"Reveal\", \"ACID is an acronym that stands for Atomicity, Consistency, Isolation, and Durability. These are properties that guarantee database transactions are processed reliably.\"],\n        [\"What is the purpose of a 'database backup'?\", \"To improve the real-time performance of the database.\", \"To create a copy of the database for recovery in case of data loss.\", \"To restrict user access to sensitive information.\", \"To optimize the storage space used by the database.\", \"Database backups are essential for recovering data after a system failure, data corruption, or other data loss events.\"],\n        [\"What is 'database security' concerned with?\", \"The physical security of the server hardware.\", \"Preventing unauthorized access, modification, or deletion of database data.\", \"Optimizing database query performance.\", \"Ensuring the database software is up to date.\", \"Database security encompasses measures to protect the confidentiality, integrity, and availability of the data stored in a database.\"],\n        [\"What is 'data integrity'?\", \"Reveal\", \"Data integrity refers to the accuracy, consistency, and reliability of data stored in a database.\"],\n        [\"Which of the following is a common SQL command for retrieving data?\", \"CREATE TABLE\", \"INSERT INTO\", \"SELECT\", \"DELETE FROM\", \"The SELECT command is used to query and retrieve data from one or more tables in a database.\"],\n        [\"What is the purpose of the 'WHERE' clause in an SQL statement?\", \"To specify the table to retrieve data from.\", \"To sort the results of a query.\", \"To filter the rows returned by a query based on a specified condition.\", \"To group rows with the same values into summary rows.\", \"The WHERE clause is used to filter records based on specified conditions.\"],\n        [\"What is a 'database schema'?\", \"Reveal\", \"A database schema is the organization and structure of a database, including the tables, columns, relationships, and constraints.\"],\n        [\"What is 'database performance tuning'?\", \"The process of physically moving database servers.\", \"Optimizing the database system to improve its speed and efficiency.\", \"Creating new database users.\", \"Designing the logical structure of the database.\", \"Database performance tuning involves analyzing and optimizing database queries, configurations, and sometimes hardware to improve responsiveness and throughput.\"],\n        [\"What is a 'stored procedure'?\", \"A physical backup of the database.\", \"A pre-compiled collection of SQL statements stored in the database.\", \"A type of database user with administrative privileges.\", \"A tool for visually designing database tables.\", \"A stored procedure is a set of SQL statements with an assigned name, which is stored in the database and can be executed by calling its name.\"],\n        [\"What is 'data warehousing' typically used for?\", \"Reveal\", \"Data warehousing is primarily used for business intelligence (BI) and analytics, involving the storage of large amounts of historical data from various sources for reporting and analysis.\"],\n        [\"Which of the following is a concept related to ensuring data consistency across multiple related tables?\", \"Data redundancy\", \"Data anomaly\", \"Referential integrity\", \"Data independence\", \"Referential integrity is a property of relational data stating that table relationships must always be consistent.\"],\n        [\"What is 'database replication'?\", \"Creating a compressed archive of the database.\", \"Copying and maintaining database objects and data in multiple databases to enhance availability and performance.\", \"Restricting user access to specific tables.\", \"Automatically generating reports from database data.\", \"Database replication involves creating and maintaining copies of a database on multiple servers.\"],\n        [\"What is 'NoSQL'?\", \"Reveal\", \"NoSQL (Not Only SQL) is a category of database management systems that do not adhere to the traditional relational database structure. They are often used for handling large volumes of unstructured or semi-structured data.\"],\n        [\"Which of the following is an example of a NoSQL database?\", \"Microsoft SQL Server\", \"Oracle Database\", \"MongoDB\", \"PostgreSQL\", \"MongoDB is a popular document-oriented NoSQL database.\"],\n        [\"What is 'database sharding'?\", \"Dividing a database into smaller, more manageable pieces that are stored on multiple servers.\", \"Creating multiple identical copies of the entire database.\", \"Encrypting the entire database with a single key.\", \"Optimizing the physical storage of the database.\", \"Database sharding (or horizontal partitioning) distributes data across multiple machines to improve performance and scalability.\"],\n        [\"What is 'data masking'?\", \"Reveal\", \"Data masking is the process of obscuring sensitive data in a non-production environment to protect it while still allowing realistic testing and development.\"],\n        [\"Which of the following is a common task related to database user management?\", \"Configuring network security settings.\", \"Installing operating system patches.\", \"Creating, modifying, and deleting database user accounts and their permissions.\", \"Troubleshooting hardware failures.\", \"Managing database users involves controlling who has access to the database and what actions they are allowed to perform.\"],\n        [\"What is a 'view' in SQL?\", \"A physical copy of a database table.\", \"A virtual table based on the result-set of an SQL statement.\", \"A tool for automatically generating SQL queries.\", \"A method for encrypting specific columns in a table.\", \"A view acts as a virtual table, providing a specific perspective on the data without storing it physically.\"],\n        [\"What is 'database auditing'?\", \"Reveal\", \"Database auditing involves tracking and recording database activities, such as user logins, data modifications, and schema changes, for security and compliance purposes.\"],\n        [\"Which of the following is a key consideration for database disaster recovery?\", \"The color of the server racks.\", \"The brand of the network switches.\", \"Having a well-tested plan for restoring the database from backups.\", \"The number of monitors connected to the database server.\", \"A comprehensive and tested disaster recovery plan is crucial for minimizing downtime and data loss in the event of a failure.\"]\n    ]\n});",
        "Programming": "J:studyFramework(\"Programming\", {\n    \"HTML\": [],\n    \"CSS\": [],\n    \"JavaScript\": [],\n    \"CMD\": [],\n    \"PowerShell\": [],\n    \"Lua\": [],\n    \"Python\": [],\n    \"Java\": [],\n    \"Shell\": []\n});",
        "Games": {
            "Chess": "J:studyFramework(\"Chess\", {\n    \"Board Positions\" : [\n        [\"a1\", \"White\", \"Black\", \"Correct.\"],\n        [\"a2\", \"Black\", \"White\", \"Correct.\"],\n        [\"a3\", \"White\", \"Black\", \"Correct.\"],\n        [\"a4\", \"Black\", \"White\", \"Correct.\"],\n        [\"a5\", \"White\", \"Black\", \"Correct.\"],\n        [\"a6\", \"Black\", \"White\", \"Correct.\"],\n        [\"a7\", \"White\", \"Black\", \"Correct.\"],\n        [\"a8\", \"Black\", \"White\", \"Correct.\"],\n        [\"b1\", \"Black\", \"White\", \"Correct.\"],\n        [\"b2\", \"White\", \"Black\", \"Correct.\"],\n        [\"b3\", \"Black\", \"White\", \"Correct.\"],\n        [\"b4\", \"White\", \"Black\", \"Correct.\"],\n        [\"b5\", \"Black\", \"White\", \"Correct.\"],\n        [\"b6\", \"White\", \"Black\", \"Correct.\"],\n        [\"b7\", \"Black\", \"White\", \"Correct.\"],\n        [\"b8\", \"White\", \"Black\", \"Correct.\"],\n        [\"c1\", \"White\", \"Black\", \"Correct.\"],\n        [\"c2\", \"Black\", \"White\", \"Correct.\"],\n        [\"c3\", \"White\", \"Black\", \"Correct.\"],\n        [\"c4\", \"Black\", \"White\", \"Correct.\"],\n        [\"c5\", \"White\", \"Black\", \"Correct.\"],\n        [\"c6\", \"Black\", \"White\", \"Correct.\"],\n        [\"c7\", \"White\", \"Black\", \"Correct.\"],\n        [\"c8\", \"Black\", \"White\", \"Correct.\"],\n        [\"d1\", \"Black\", \"White\", \"Correct.\"],\n        [\"d2\", \"White\", \"Black\", \"Correct.\"],\n        [\"d3\", \"Black\", \"White\", \"Correct.\"],\n        [\"d4\", \"White\", \"Black\", \"Correct.\"],\n        [\"d5\", \"Black\", \"White\", \"Correct.\"],\n        [\"d6\", \"White\", \"Black\", \"Correct.\"],\n        [\"d7\", \"Black\", \"White\", \"Correct.\"],\n        [\"d8\", \"White\", \"Black\", \"Correct.\"],\n        [\"e1\", \"White\", \"Black\", \"Correct.\"],\n        [\"e2\", \"Black\", \"White\", \"Correct.\"],\n        [\"e3\", \"White\", \"Black\", \"Correct.\"],\n        [\"e4\", \"Black\", \"White\", \"Correct.\"],\n        [\"e5\", \"White\", \"Black\", \"Correct.\"],\n        [\"e6\", \"Black\", \"White\", \"Correct.\"],\n        [\"e7\", \"White\", \"Black\", \"Correct.\"],\n        [\"e8\", \"Black\", \"White\", \"Correct.\"],\n        [\"f1\", \"Black\", \"White\", \"Correct.\"],\n        [\"f2\", \"White\", \"Black\", \"Correct.\"],\n        [\"f3\", \"Black\", \"White\", \"Correct.\"],\n        [\"f4\", \"White\", \"Black\", \"Correct.\"],\n        [\"f5\", \"Black\", \"White\", \"Correct.\"],\n        [\"f6\", \"White\", \"Black\", \"Correct.\"],\n        [\"f7\", \"Black\", \"White\", \"Correct.\"],\n        [\"f8\", \"White\", \"Black\", \"Correct.\"],\n        [\"g1\", \"White\", \"Black\", \"Correct.\"],\n        [\"g2\", \"Black\", \"White\", \"Correct.\"],\n        [\"g3\", \"White\", \"Black\", \"Correct.\"],\n        [\"g4\", \"Black\", \"White\", \"Correct.\"],\n        [\"g5\", \"White\", \"Black\", \"Correct.\"],\n        [\"g6\", \"Black\", \"White\", \"Correct.\"],\n        [\"g7\", \"White\", \"Black\", \"Correct.\"],\n        [\"g8\", \"Black\", \"White\", \"Correct.\"],\n        [\"h1\", \"Black\", \"White\", \"Correct.\"],\n        [\"h2\", \"White\", \"Black\", \"Correct.\"],\n        [\"h3\", \"Black\", \"White\", \"Correct.\"],\n        [\"h4\", \"White\", \"Black\", \"Correct.\"],\n        [\"h5\", \"Black\", \"White\", \"Correct.\"],\n        [\"h6\", \"White\", \"Black\", \"Correct.\"],\n        [\"h7\", \"Black\", \"White\", \"Correct.\"],\n        [\"h8\", \"White\", \"Black\", \"Correct.\"]\n    ],\n    \"King's Pawn Openings (1. e4)\" : [\n        [\"Ruy Lopez\", \"Reveal\", \"1. e4 e5 2. Nf3 Nc6 3. Bb5\"],\n        [\"Italian Game\", \"Reveal\", \"1. e4 e5 2. Nf3 Nc6 3. Bc4 Nf6\"],\n        [\"Scotch Game\", \"Reveal\", \"1. e4 e5 2. Nf3 Nc6 3. d4 exd4 4. Nxd4\"],\n        [\"Vienna Game\", \"Reveal\", \"1. e4 e5 2. Nc3\"],\n        [\"Kings Gambit\", \"Reveal\", \"1. e4 e5 2. f4<br>Accepted : 2... exf4<br>Declined : 2... Bc5\"],\n        [\"Bishop's Opening\", \"Reveal\", \"1. e4 e5 2. Bc4\"],\n        [\"Petrov's Defense (Russian Game)\", \"Reveal\", \"1. e4 e5 2. Nf3 Nf6\"],\n        [\"Philidor Defense\", \"Reveal\", \"1. e4 e5 2. Nf3 d6\"],\n        [\"Center Game\", \"Reveal\", \"1. e4 e5 2. d4 exd4 3. Qxd4\"],\n        [\"Danish Gambit\", \"Reveal\", \"1. e4 e5 2. d4 exd4 3. c3\"]\n    ],\n    \"King's Pawn Defense\" : [\n        [\"Sicilian Najdorf Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 a6\"],\n        [\"Sicilian Dragon Variation\", \"Reveal\", \"e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 g6\"],\n        [\"Sicilian Classical Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 Nc6\"],\n        [\"Sicilian Scheveningen Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5.1 Nc3 e6\"],\n        [\"Sicilian Accelerated Dragon Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 Nc6 3. d4 cxd4 4. Nxd4 g6\"],\n        [\"Sicilian Taimanov Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 e6 3. d4 cxd4 4. Nxd4 Nc6\"],\n        [\"Sicilian Kan Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 e6 3. d4 cxd4 4. Nxd4 a6\"],\n        [\"Sicilian Sveshnikov Variation\", \"Reveal\", \"1. e4 c5 2. Nf3 Nc6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 e5\"],\n        [\"French Exchange Variation\", \"Reveal\", \"1. e4 e6 2. d4 d5 3. exd5 exd5\"],\n        [\"French Advance Variation\", \"Reveal\", \"1. e4 e6 2. d4 d5 3. e5\"],\n        [\"French Tarrasch Variation\", \"Reveal\", \"1. e4 e6 2. d4 d5 3. Nd2\"],\n        [\"French Winawer Variation\", \"Reveal\", \"1. e4 e6 2. d4 d5 3. Nc3 Bb4\"],\n        [\"French Classical Variation\", \"Reveal\", \"1. e4 e6 2. d4 d5 3. Nc3 Nf6\"],\n        [\"Caro-Kann Classical Variation\", \"Reveal\", \"1. e4 c6 2. d4 d5 3. Nc3 dxe4 4. Nxe4 Bf5\"],\n        [\"Caro-Kann Advance Variation\", \"Reveal\", \"1. e4 c6 2. d4 d5 3. e5 Bf5\"],\n        [\"Caro-Kann Exchange Variation\", \"Reveal\", \"1. e4 c6 2. d4 d5 3. exd5 cxd5\"],\n        [\"Caro-Kann Panov-Botvinnik Attack Variation\", \"Reveal\", \"1. e4 c6 2. d4 d5 3. exd5 cxd5 4. c4\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"],\n        [\"\", \"Reveal\", \"\"]\n    ],\n});"
        },
        "Languages": "J:studyFramework(\"Languages\", {\n    \"French\": []\n});",
        "Survival": "J:studyFramework(\"Survival\", {\n    \"Shelter I\": [],\n    \"Shelter II\": [],\n    \"Fire\": [],\n    \"Water\": [],\n    \"Food\": [],\n    \"Navigation I\": [],\n    \"Navigation II\": [],\n    \"Signaling and Communication\": [],\n    \"Foraging and Botany\": [],\n    \"Hunting and Tracking\": [],\n    \"Agriculture\": [],\n    \"Tool Making and Repair\": [],\n    \"Self-Defense and Security\": [],\n    \"Leadership\": []\n});"
    },
    "Files": {
        "SS": {
            "Preview": "J:previewFile();",
            "Rename": "J:renameFile();",
            "Edit": "J:editFile();",
            "Download": "J:downloadFile();",
            "Delete": "J:deleteFile();",
            "!Name": "monochrome-transparent_packed.png",
            "!Data": "data:image/png;base64,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",
            "!Type": "Image",
            "!Size": 60878
        },
        "PD": {
            "Preview": "J:previewFile();",
            "Rename": "J:renameFile();",
            "Edit": "J:editFile();",
            "Download": "J:downloadFile();",
            "Delete": "J:deleteFile();",
            "!Name": "CustomImage.png",
            "!Data": "data:image/png;base64,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",
            "!Type": "Image",
            "!Size": "Unknown"
        },
        "Upload": "J:const input = document.createElement('input');\ninput.type = 'file';\n\ninput.onchange = function (event) {\n    const file = event.target.files[0];\n\n    if (!file) {\n        callback(null, 'No file selected.');\n        return;\n    }\n\n    const reader = new FileReader();\n\n    reader.onload = function (e) {\n        const base64String = e.target.result;\n        let fileType = 'Unknown';\n\n        if (file.type.startsWith('image/')) {\n            fileType = 'Image';\n        } else if (file.type.startsWith('audio/')) {\n            fileType = 'Audio';\n        } else if (file.type.startsWith('video/')) {\n            fileType = 'Video';\n        } else if (file.type === 'text/plain') {\n            fileType = 'Text';\n        } else if (file.type === 'text/html') {\n            fileType = 'HTML';\n        } else if (file.type === 'application/javascript' || file.type === 'text/javascript') {\n            fileType = 'JS';\n        }\n        if (file.type.startsWith('image/')) {\n            notes[\"Files\"][file.name] = {\n                \"Preview\": \"J:previewFile();\",\n                \"Rename\": \"J:renameFile();\",\n                \"Edit\": \"J:editFile();\",\n                \"Download\": \"J:downloadFile();\",\n                \"Delete\": \"J:deleteFile();\",\n                \"!Name\": file.name,\n                \"!Data\": base64String,\n                \"!Type\": fileType,\n                \"!Size\": file.size\n            };\n        } else {\n            notes[\"Files\"][file.name] = {\n                \"Preview\": \"J:previewFile();\",\n                \"Rename\": \"J:renameFile();\",\n                \"Download\": \"J:downloadFile();\",\n                \"Delete\": \"J:deleteFile();\",\n                \"!Name\": file.name,\n                \"!Data\": base64String,\n                \"!Type\": fileType,\n                \"!Size\": file.size\n            };\n        }\n        input.remove();\n        const tempUpload = notes[\"Files\"][\"Upload\"];\n        const tempCustomImage = notes[\"Files\"][\"Create Image\"];\n        const tempCustomSFX = notes[\"Files\"][\"Create SFX\"];\n        delete notes[\"Files\"][\"Upload\"];\n        delete notes[\"Files\"][\"Create Image\"];\n        delete notes[\"Files\"][\"Create SFX\"];\n        notes[\"Files\"][\"Create Image\"] = tempCustomImage;\n        notes[\"Files\"][\"Create SFX\"] = tempCustomSFX;\n        notes[\"Files\"][\"Upload\"] = tempUpload;\n        showOption();\n    };\n\n    reader.readAsDataURL(file);\n};\n\ninput.click();\n\npath.pop();\nshowOption();"
    },
    "Tools": {
        "Tapper": "J:optionsArea.innerHTML = \"\";\nnewOptionButton(\"Return\", \"#393939\", function() {\n    path.pop();\n    showOption();\n});\noutputArea.style.height = \"100%\";\nwindow.clicks = 0;\n\n\noutputArea.innerHTML = `\n    <div style=\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\">\n        <button id=\"click\" style=\"width: 80%; height: 80%; border: 8px solid black; border-radius: 8px; font-size: 80px;\">Click Me!</button>\n    </div>\n`;\n\nconst clickButton = document.getElementById('click');\nclickButton.onclick = () => {\n    clicks += 1;\n    clickButton.innerHTML = `${clicks}`;\n    clickButton.animate([\n        { transform: 'scale(1.03)' },\n        { transform: 'scale(1)' }\n    ], { duration: 300, easing: 'ease-in-out' });\n}\n",
        "Task Tracker": "J:optionsArea.innerHTML = \"\";\nnewOptionButton(\"Return\", \"#393939\", function() {\n    path.pop();\n    showOption();\n});\noutputArea.style.height = \"100%\";\n\n\nconst daysOfWeek = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\nconst months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"]\nconst fullDate = new Date();\nconst day = daysOfWeek[fullDate.getDay()];\nconst date = fullDate.getDate()\nconst month = months[fullDate.getMonth()];\nconst year = fullDate.getFullYear();\nconst today = `${date}_${month}_${year}`;\n\nwindow.tasks = notes[\"Tools\"][\"!Tasks\"];\nwindow.calender = notes[\"Tools\"][\"!Calender\"];\n\n\nwindow.newTask = function() {\n    const taskDateUnformated = document.getElementById(\"newTaskDate\").value;\n    const dateSplit = taskDateUnformated.split(\"-\");\n    const taskDate = `${parseInt(dateSplit[2])}_${months[parseInt(dateSplit[1]) - 1]}_${dateSplit[0]}`\n    const taskName = document.getElementById(\"newTaskName\").value;\n    if (!(taskDate in tasks[\"OneShots\"])) tasks[\"OneShots\"][taskDate] = [];\n    tasks[\"OneShots\"][taskDate].push(taskName);\n    if (taskDate == today) calender[today][taskName] = false;\n    saveData();\n    showTasks();\n}\n\nwindow.showTasks = function() {\n\n    if (!(today in calender)) calender[today] = {};\n    tasks[date].forEach((task) => {if (!(task in calender[today])) calender[today][task] = false;}); // <---- FOR DATE OF MONTH\n    tasks[day].forEach((task) => {if (!(task in calender[today])) calender[today][task] = false;}); // <---- FOR DAY OF WEEK\n    if (today in tasks[\"OneShots\"]) {\n        tasks[\"OneShots\"][today].forEach((task) => {if (!(task in calender[today])) calender[today][task] = false;}); // <---- ONESHOTS\n    }\n    let taskText = \"\";\n    for (const taskName in calender[today]) {\n        let strike = (calender[today][taskName]) ? \"line-through\" : \"none\";\n        let checked = (calender[today][taskName]) ? \"checked\" : \"\";\n        taskText += `<div style=\"font-size: 24px; text-decoration:${strike}\"><input id=\"${taskName}\" ${checked} onchange=\"calender['${today}']['${taskName}'] = !calender['${today}']['${taskName}']; saveData(); showTasks();\" type=\"checkbox\"><label for=\"${taskName}\" style=\"text-decoration: ${strike};\">${taskName}</label></div>`;\n    }\n    outputArea.innerHTML = `\n    <div style=\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\">\n        <div id=\"taskArea\" style=\"width: 80%; max-height: 80%; overflow-y: auto; border: 8px solid black; border-radius: 8px; display: flex; flex-direction: column; gap: 20px; align-items: center; background-color: white; overflow-y: auto;\">\n            <div></div>\n            <u style=\"font-size: 48px;\">Tasks</u>\n            <hr style=\"width: 90%\">\n            ${taskText}\n            <hr style=\"width: 90%;\">\n            <div style=\"display: flex; gap: 20px; width: 80%\"><input id=\"newTaskDate\" type=\"date\" style=\"font-size: 24px; width: 140px;\"><input id=\"newTaskName\" type=\"text\" placeholder=\"Task Name\" style=\"font-size: 24px; width: 100%\"></div>\n            <button onclick=\"newTask();\" style=\"font-size: 24px; width: 160px;\">New Task</button>\n            <br>\n        </div>\n    </div>\n    `;\n};\n\nshowTasks();\n\n",
        "Encrypted Notes": "E:",
        "Image Studio": "J:",
        "Text to Speech": "J:const speech = prompt(\"Please enter text to speak.\");\n\nif ('speechSynthesis' in window) {\n    const utterance = new SpeechSynthesisUtterance(speech);\n    speechSynthesis.speak(utterance);\n} else {\n    alert(\"Sorry, your browser doesn't support text to speech!\");\n}\n\npath.pop();\nshowOption();",
        "Time Between": "J:optionsArea.innerHTML = \"\";\nnewOptionButton(\"Return\", \"#393939\", function() {\n    path.pop();\n    showOption();\n});\noutputArea.style.height = \"100%\";\n\n\nfunction showDates(dateText=\"\") {\n    outputArea.innerHTML = `\n        <div style=\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\">\n        <div id=\"taskArea\" style=\"width: 80%; max-height: 80%; overflow-y: auto; border: 8px solid black; border-radius: 8px; display: flex; flex-direction: column; gap: 20px; align-items: center; background-color: white; overflow-y: auto;\">\n            <div></div>\n            <u style=\"font-size: 48px;\">Time Between</u>\n            <hr style=\"width: 90%\">\n            <div style=\"display: flex; gap: 20px; font-size: 24px;\"><label for=\"date1\">Date 1 :</label><input id=\"date1\" type=\"date\"></div>\n            <div style=\"display: flex; gap: 20px; font-size: 24px;\"><label for=\"date2\">Date 2 :</label><input id=\"date2\" type=\"date\"></div>\n            <button id=\"calculateButton\" onclick=\"calculate();\" style=\"font-size: 24px;\">Calculate</button>\n            <hr style=\"width: 90%\">\n            <div id=\"days\" style=\"font-size: 24px;\">Days : </div>\n            <div id=\"seconds\" style=\"font-size: 24px;\">Seconds : </div>\n            <br>\n        </div>\n        </div>\n    `;\n}\n\nshowDates();\n\nwindow.calculate = function() {\n    document.getElementById(\"calculateButton\").disabled = true;\n    document.getElementById(\"days\").innerHTML += timeBetweenDates(\"days\");\n    document.getElementById(\"seconds\").innerHTML += timeBetweenDates(\"seconds\");\n}\n\nfunction timeBetweenDates(outputUnit) {\n    const d1 = new Date(document.getElementById(\"date1\").value);\n    const d2 = new Date(document.getElementById(\"date2\").value);\n    const differenceInMilliseconds = Math.abs(d2.getTime() - d1.getTime());\n\n    switch (outputUnit.toLowerCase()) {\n        case 'seconds':\n            return Math.floor(differenceInMilliseconds / 1000);\n        case 'days':\n            return parseFloat((differenceInMilliseconds / (1000 * 60 * 60 * 24)).toFixed(2)); // Rounded to 2 decimal places\n    }\n}\n\n\n\n",
        "Run Custom JavaScript": "J:const custom = prompt(\"Please enter your custom JavaScript.\");\nlet newFunc = new Function(custom);\nnewFunc();\npath.pop();\nshowOption();",
        "Create Image": "J:const widthInput = prompt(\"Enter the desired width of the blank image in pixels:\");\nlet base64String = null;\n\nif (widthInput !== null) {\n    const width = parseInt(widthInput, 10);\n    if (!isNaN(width) && width > 0) {\n        const heightInput = prompt(\"Enter the desired height of the blank image in pixels:\");\n        if (heightInput !== null) {\n            const height = parseInt(heightInput, 10);\n            if (!isNaN(height) && height > 0) {\n                const canvas = document.createElement('canvas');\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext('2d');\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                try {\n                    base64String = canvas.toDataURL();\n                    notes[\"Files\"][\"Custom Image\"] = {\n                        \"Preview\": \"J:previewFile();\",\n                        \"Rename\": \"J:renameFile();\",\n                        \"Edit\": \"J:editFile();\",\n                        \"Download\": \"J:downloadFile();\",\n                        \"Delete\": \"J:deleteFile();\",\n                        \"!Name\": \"CustomImage.png\",\n                        \"!Data\": base64String,\n                        \"!Type\": \"Image\",\n                        \"!Size\": \"Unknown\"\n                    };\n\n                    const tempUpload = notes[\"Files\"][\"Upload\"];\n                    const tempCustomImage = notes[\"Files\"][\"Create Image\"];\n                    const tempCustomSFX = notes[\"Files\"][\"Create SFX\"];\n                    delete notes[\"Files\"][\"Upload\"];\n                    delete notes[\"Files\"][\"Create Image\"];\n                    delete notes[\"Files\"][\"Create SFX\"];\n                    notes[\"Files\"][\"Create Image\"] = tempCustomImage;\n                    notes[\"Files\"][\"Create SFX\"] = tempCustomSFX;\n                    notes[\"Files\"][\"Upload\"] = tempUpload;\n                    path.pop();\n                    showOption();\n\n                } catch (e) {\n                    console.error(\"Error generating Base64 string:\", e);\n                    alert(`Error generating image data. The requested dimensions (${width}x${height}) might be too large.`);\n                }\n            } else {\n                alert(\"Invalid height entered. Please enter a positive whole number.\");\n            }\n        } else {\n            alert(\"Operation cancelled by user.\");\n        }\n    } else {\n        alert(\"Invalid width entered. Please enter a positive whole number.\");\n    }\n} else {\n    alert(\"Operation cancelled by user.\");\n}\n\nif (base64String === null) {\n    console.log(\"Base64 string generation was cancelled or failed.\");\n}",
        "Create SFX": "J:optionsArea.innerHTML = \"\";\noutputArea.innerHTML = \"\";\n\nlet audioCtx;\ntry {\n    audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n} catch (e) {\n    console.error(\"Web Audio API is not supported in this browser\", e);\n    outputArea.innerHTML = \"<p style='color: #ff5555; text-align: center; font-weight: bold;'>Web Audio API is required for the SFX editor and is not supported by your browser.</p>\";\n    throw new Error(\"Web Audio API not supported.\");\n}\n\nconst NUM_STEPS = 32;\nconst MAX_FREQ = 5000;\nconst MAX_VOL = 1.0;\nconst DEFAULT_FREQ = 440;\nconst DEFAULT_VOL = 0.5;\nconst VOL_STEP = 0.1; // Define the volume step increment\n\nlet sfxParams = {\n    waveform: 'sine',\n    frequencySteps: Array(NUM_STEPS).fill(DEFAULT_FREQ),\n    volumeSteps: Array(NUM_STEPS).fill(DEFAULT_VOL),\n    duration: 0.5,\n};\n\nconst styles = {\n    container: `padding: 15px; font-family: sans-serif; display: flex; flex-direction: column; gap: 20px; height: calc(100% - 30px); overflow-y: auto; background-color: #282a36; color: #f8f8f2;`,\n    h3: `color: #50fa7b; margin-bottom: 10px; text-align: center;`,\n    controlsRow: `display: flex; gap: 25px; align-items: center; flex-wrap: wrap; justify-content: center; background-color: #44475a; padding: 15px; border-radius: 5px;`,\n    controlGroup: `display: flex; flex-direction: column; gap: 5px; align-items: flex-start;`,\n    label: `font-size: 0.9em; color: #bd93f9; margin-bottom: 3px;`,\n    select: `padding: 5px 8px; border: 1px solid #6272a4; background-color: #282a36; color: #f8f8f2; border-radius: 4px; min-width: 120px;`,\n    rangeInput: `cursor: pointer; padding: 0; border: 1px solid #6272a4; background-color: #282a36; border-radius: 4px; min-width: 120px; accent-color: #bd93f9;`,\n    valueSpan: `font-size: 0.85em; color: #f1fa8c; min-width: 60px; display: inline-block; text-align: right;`,\n    canvasEditorsContainer: `display: flex; gap: 20px; justify-content: space-around; margin-top: 15px; flex-wrap: wrap;`,\n    canvasEditor: `display: flex; flex-direction: column; align-items: center; gap: 8px; background-color: #44475a; padding: 10px; border-radius: 5px;`,\n    canvasLabel: `font-weight: bold; color: #8be9fd;`,\n    canvas: `border: 1px solid #6272a4; background-color: #282a36; cursor: crosshair; image-rendering: pixelated; width: 320px; height: 100px; display: block;`,\n    canvasHoverInfo: `font-size: 0.8em; min-height: 1em; color: #f8f8f2;`,\n    buttonsContainer: `display: flex; gap: 15px; justify-content: center; margin-top: 15px;`,\n    button: `padding: 10px 20px; background-color: #bd93f9; color: #282a36; font-weight: bold; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;`,\n    infoText: `font-size: 0.85em; color: #f8f8f2; text-align: center; margin-top: 10px;`,\n    statusText: `font-size: 0.85em; color: #50fa7b; text-align: center; margin-top: 10px; min-height: 1.2em;`,\n};\n\noutputArea.innerHTML = `\n    <div style=\"${styles.container}\">\n        <h3 style=\"${styles.h3}\">SFX Creator</h3>\n        <div style=\"${styles.controlsRow}\">\n            <div style=\"${styles.controlGroup}\">\n                <label for=\"sfxWaveform\" style=\"${styles.label}\">Waveform:</label>\n                <select id=\"sfxWaveform\" style=\"${styles.select}\">\n                    <option value=\"sine\">Sine</option>\n                    <option value=\"square\">Square</option>\n                    <option value=\"sawtooth\">Sawtooth</option>\n                    <option value=\"triangle\">Triangle</option>\n                    <option value=\"noise\">Noise</option>\n                </select>\n            </div>\n            <div style=\"${styles.controlGroup}\">\n                <label for=\"sfxDuration\" style=\"${styles.label}\">Duration (s):</label>\n                <input type=\"range\" id=\"sfxDuration\" min=\"0.05\" max=\"4\" step=\"0.01\" value=\"${sfxParams.duration}\" style=\"${styles.rangeInput}\">\n                <span id=\"sfxDurationValue\" style=\"${styles.valueSpan}\">${sfxParams.duration.toFixed(2)}s</span>\n            </div>\n        </div>\n        <div style=\"${styles.canvasEditorsContainer}\">\n            <div style=\"${styles.canvasEditor}\">\n                <label for=\"freqCanvas\" style=\"${styles.canvasLabel}\">Frequency (Pitch)</label>\n                <canvas id=\"freqCanvas\" width=\"320\" height=\"100\" style=\"${styles.canvas}\"></canvas>\n                 <span id=\"freqHoverInfo\" style=\"${styles.canvasHoverInfo}\">&nbsp;</span>\n            </div>\n            <div style=\"${styles.canvasEditor}\">\n                <label for=\"volCanvas\" style=\"${styles.canvasLabel}\">Volume (0.1 steps)</label>\n                <canvas id=\"volCanvas\" width=\"320\" height=\"100\" style=\"${styles.canvas}\"></canvas>\n                <span id=\"volHoverInfo\" style=\"${styles.canvasHoverInfo}\">&nbsp;</span>\n            </div>\n        </div>\n        <div style=\"${styles.buttonsContainer}\">\n             <button id=\"playSfxButton\" style=\"${styles.button}\">Play Sound</button>\n        </div>\n        <p style=\"${styles.infoText}\">Click and drag on the graphs to edit steps. Saving creates a NEW '.wav' file in '${path.join('/') || '/'}'.</p>\n        <div id=\"saveStatus\" style=\"${styles.statusText}\"></div>\n    </div>\n`;\n\nconst waveformSelect = document.getElementById('sfxWaveform');\nconst durationSlider = document.getElementById('sfxDuration');\nconst durationValueSpan = document.getElementById('sfxDurationValue');\nconst playButton = document.getElementById('playSfxButton');\nconst saveStatus = document.getElementById('saveStatus');\nconst freqCanvas = document.getElementById('freqCanvas');\nconst volCanvas = document.getElementById('volCanvas');\nconst freqCtx = freqCanvas.getContext('2d');\nconst volCtx = volCanvas.getContext('2d');\nconst freqHoverInfo = document.getElementById('freqHoverInfo');\nconst volHoverInfo = document.getElementById('volHoverInfo');\n\nlet isDrawingFreq = false;\nlet isDrawingVol = false;\nconst barWidth = freqCanvas.width / NUM_STEPS;\nconst FREQ_COLOR = \"#ffb86c\";\nconst VOL_COLOR = \"#ff79c6\";\nconst DISABLED_COLOR = \"#6272a4\";\n\nfunction drawGraph(ctx, canvas, steps, maxVal, color, isDisabled = false, stepIncrement = null) {\n    const { width, height } = canvas;\n    ctx.fillStyle = '#282a36';\n    ctx.fillRect(0, 0, width, height);\n\n    for (let i = 0; i < NUM_STEPS; i++) {\n        const value = steps[i];\n        const barHeight = Math.max(1, (value / maxVal) * height);\n        const x = i * barWidth;\n        const y = height - barHeight;\n\n        ctx.fillStyle = isDisabled ? DISABLED_COLOR : color;\n        ctx.fillRect(x, y, barWidth - 1, barHeight);\n    }\n\n    if (canvas.id === 'freqCanvas') {\n        canvas.style.opacity = isDisabled ? '0.6' : '1';\n        canvas.style.cursor = isDisabled ? 'not-allowed' : 'crosshair';\n    }\n}\n\nfunction updateStepFromEvent(event, canvas, steps, maxVal, isFreqEditor) {\n    if (isFreqEditor && sfxParams.waveform === 'noise') return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    const stepIndex = Math.floor(x / barWidth);\n    let value = Math.max(0, Math.min(maxVal, (1 - (y / canvas.height)) * maxVal));\n\n    if (!isFreqEditor) {\n        value = Math.round(value / VOL_STEP) * VOL_STEP;\n    }\n\n    if (stepIndex >= 0 && stepIndex < NUM_STEPS) {\n        steps[stepIndex] = isFreqEditor ? Math.round(value) : parseFloat(value.toFixed(2)); // Store volume with precision\n        return { index: stepIndex, value: steps[stepIndex] };\n    }\n    return null;\n}\n\nfunction setupCanvasListeners(canvas, steps, maxVal, isDrawingFlagSetter, hoverInfoSpan, isFreqEditor) {\n    let isDrawing = false;\n\n    const redraw = () => {\n        const isDisabled = isFreqEditor && sfxParams.waveform === 'noise';\n        const color = isFreqEditor ? FREQ_COLOR : VOL_COLOR;\n        drawGraph(isFreqEditor ? freqCtx : volCtx, canvas, steps, maxVal, color, isDisabled, isFreqEditor ? null : VOL_STEP);\n    };\n\n    canvas.addEventListener('mousedown', (e) => {\n        if (isFreqEditor && sfxParams.waveform === 'noise') return;\n        isDrawing = true;\n        isDrawingFlagSetter(true);\n        const update = updateStepFromEvent(e, canvas, steps, maxVal, isFreqEditor);\n        if (update) redraw();\n    });\n\n    canvas.addEventListener('mousemove', (e) => {\n         const rect = canvas.getBoundingClientRect();\n         const x = e.clientX - rect.left;\n         const y = e.clientY - rect.top;\n         const stepIndex = Math.floor(x / barWidth);\n         let hoverValue = Math.max(0, Math.min(maxVal, (1 - (y / canvas.height)) * maxVal));\n\n         if (!isFreqEditor) {\n            hoverValue = Math.round(hoverValue / VOL_STEP) * VOL_STEP;\n         }\n\n         if (stepIndex >= 0 && stepIndex < NUM_STEPS) {\n              const displayValue = isFreqEditor ? `${Math.round(hoverValue)} Hz` : hoverValue.toFixed(1); // Display vol with 1 decimal place\n              hoverInfoSpan.style.color = '#f8f8f2';\n              hoverInfoSpan.textContent = `Step ${stepIndex + 1}: ~${displayValue}`;\n         } else {\n              hoverInfoSpan.textContent = '\\u00A0';\n         }\n\n\n        if (isDrawing) {\n            const update = updateStepFromEvent(e, canvas, steps, maxVal, isFreqEditor);\n            if (update) redraw();\n        }\n    });\n\n    canvas.addEventListener('mouseup', () => {\n        if (isDrawing) {\n            isDrawing = false;\n            isDrawingFlagSetter(false);\n        }\n    });\n\n    canvas.addEventListener('mouseleave', () => {\n         hoverInfoSpan.textContent = '\\u00A0';\n        if (isDrawing) {\n            isDrawing = false;\n            isDrawingFlagSetter(false);\n        }\n    });\n\n     redraw();\n     canvas.addEventListener('redraw', redraw);\n}\n\nwaveformSelect.value = sfxParams.waveform;\nwaveformSelect.addEventListener('change', (e) => {\n    sfxParams.waveform = e.target.value;\n    freqCanvas.dispatchEvent(new Event('redraw'));\n});\n\ndurationSlider.addEventListener('input', (e) => {\n    sfxParams.duration = parseFloat(e.target.value);\n    durationValueSpan.textContent = `${sfxParams.duration.toFixed(2)}s`;\n});\n\nsetupCanvasListeners(freqCanvas, sfxParams.frequencySteps, MAX_FREQ, (val) => isDrawingFreq = val, freqHoverInfo, true);\nsetupCanvasListeners(volCanvas, sfxParams.volumeSteps, MAX_VOL, (val) => isDrawingVol = val, volHoverInfo, false);\n\nplayButton.addEventListener('click', playSound);\n\nconst defaultButtonBg = '#bd93f9';\nconst hoverButtonBg = '#ff79c6';\nconst disabledButtonBg = '#6272a4';\n\nfunction applyButtonStyles(button) {\n    if (button.disabled) {\n        button.style.backgroundColor = disabledButtonBg;\n        button.style.cursor = 'not-allowed';\n    } else {\n        button.style.backgroundColor = defaultButtonBg;\n        button.style.cursor = 'pointer';\n    }\n}\n\napplyButtonStyles(playButton);\nplayButton.addEventListener('mouseover', () => {\n    if (!playButton.disabled) {\n        playButton.style.backgroundColor = hoverButtonBg;\n    }\n});\nplayButton.addEventListener('mouseout', () => {\n    applyButtonStyles(playButton);\n});\n\n\nlet currentSource = null;\n\nfunction playSound() {\n    if (!audioCtx || audioCtx.state === 'suspended') {\n       audioCtx.resume();\n    }\n    if (!audioCtx) return;\n\n    if (currentSource) {\n        try {\n            currentSource.stop();\n            if (currentSource.disconnect) currentSource.disconnect();\n        } catch (e) {}\n        currentSource = null;\n    }\n\n    const now = audioCtx.currentTime;\n    const duration = sfxParams.duration;\n\n    const gainNode = audioCtx.createGain();\n    gainNode.connect(audioCtx.destination);\n    gainNode.gain.setValueAtTime(sfxParams.volumeSteps[0] > 0 ? sfxParams.volumeSteps[0] : 0.0001, now);\n    const volCurve = new Float32Array(sfxParams.volumeSteps);\n    gainNode.gain.setValueCurveAtTime(volCurve, now, duration);\n\n    let sourceNode;\n    if (sfxParams.waveform === 'noise') {\n        const bufferSize = Math.ceil(audioCtx.sampleRate * duration);\n        const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);\n        const output = noiseBuffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n            output[i] = Math.random() * 2 - 1;\n        }\n        sourceNode = audioCtx.createBufferSource();\n        sourceNode.buffer = noiseBuffer;\n        sourceNode.loop = false;\n    } else {\n        sourceNode = audioCtx.createOscillator();\n        sourceNode.type = sfxParams.waveform;\n        sourceNode.frequency.setValueAtTime(sfxParams.frequencySteps[0], now);\n        const freqCurve = new Float32Array(sfxParams.frequencySteps);\n        sourceNode.frequency.setValueCurveAtTime(freqCurve, now, duration);\n    }\n\n    sourceNode.connect(gainNode);\n    sourceNode.start(now);\n    sourceNode.stop(now + duration);\n\n    currentSource = sourceNode;\n\n    sourceNode.onended = () => {\n        if (currentSource === sourceNode) {\n             currentSource = null;\n        }\n        try { sourceNode.disconnect(); } catch(e) {}\n        try { gainNode.disconnect(); } catch(e) {}\n    };\n     setTimeout(() => { try { gainNode.disconnect(); } catch(e) {} }, (duration + 0.1) * 1000);\n}\n\nasync function saveGeneratedSound() {\n    if (!audioCtx) {\n        alert(\"AudioContext not available. Cannot save.\");\n        return;\n    }\n    saveStatus.textContent = 'Rendering audio...';\n    saveStatus.style.color = '#50fa7b';\n    playButton.disabled = true;\n    applyButtonStyles(playButton);\n\n    try {\n        const duration = sfxParams.duration;\n        const sampleRate = audioCtx.sampleRate;\n        const offlineCtx = new OfflineAudioContext(1, Math.ceil(sampleRate * duration), sampleRate);\n\n        const gainNode = offlineCtx.createGain();\n        gainNode.connect(offlineCtx.destination);\n        gainNode.gain.setValueAtTime(sfxParams.volumeSteps[0] > 0 ? sfxParams.volumeSteps[0] : 0.0001, 0);\n        const volCurve = new Float32Array(sfxParams.volumeSteps);\n        gainNode.gain.setValueCurveAtTime(volCurve, 0, duration);\n\n        let sourceNode;\n        if (sfxParams.waveform === 'noise') {\n             const bufferSize = offlineCtx.length;\n             const noiseBuffer = offlineCtx.createBuffer(1, bufferSize, sampleRate);\n             const output = noiseBuffer.getChannelData(0);\n             for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;\n             sourceNode = offlineCtx.createBufferSource();\n             sourceNode.buffer = noiseBuffer;\n        } else {\n            sourceNode = offlineCtx.createOscillator();\n            sourceNode.type = sfxParams.waveform;\n            sourceNode.frequency.setValueAtTime(sfxParams.frequencySteps[0], 0);\n            const freqCurve = new Float32Array(sfxParams.frequencySteps);\n            sourceNode.frequency.setValueCurveAtTime(freqCurve, 0, duration);\n        }\n        sourceNode.connect(gainNode);\n        sourceNode.start(0);\n\n        const renderedBuffer = await offlineCtx.startRendering();\n\n        saveStatus.textContent = 'Encoding WAV...';\n        const wavDataUrl = await audioBufferToWavDataUrl(renderedBuffer);\n\n\n         const baseName = \"New SFX\";\n         const extension = \".wav\";\n         let newFileName = baseName + extension;\n\n         notes[\"Files\"][newFileName] = {\n             \"Preview\": \"J:previewFile();\", \"Rename\": \"J:renameFile();\", \"Download\": \"J:downloadFile();\", \"Delete\": \"J:deleteFile();\",\n             \"!Name\": newFileName, \"!Data\": wavDataUrl, \"!Type\": \"Audio\", \"!Size\": \"Generated\"\n         };\n\n         const tempUpload = notes[\"Files\"][\"Upload\"];\n         delete notes[\"Files\"][\"Upload\"];\n         if (tempUpload) notes[\"Files\"][\"Upload\"] = tempUpload;\n\n         saveStatus.textContent = 'Saving data...';\n         saveData();\n         path.pop();\n         showOption();\n\n         alert(`Generated sound saved as: ${newFileName}`);\n         saveStatus.textContent = '';\n\n    } catch (error) {\n        console.error(\"Error saving generated sound:\", error);\n        alert(`Error saving sound: ${error.message || error}`);\n        saveStatus.textContent = `Error saving sound: ${error.message || 'Unknown error'}`;\n        saveStatus.style.color = '#ff5555';\n    } finally {\n         playButton.disabled = false;\n         applyButtonStyles(playButton);\n    }\n};\n\nasync function audioBufferToWavDataUrl(buffer) {\n    const wavBlob = generateWavBlob(buffer);\n    return await blobToDataURL(wavBlob);\n}\n\nfunction generateWavBlob(buffer) {\n    const numOfChan = buffer.numberOfChannels;\n    const bytesPerSample = 2;\n    const format = 1;\n    const sampleRate = buffer.sampleRate;\n    const blockAlign = numOfChan * bytesPerSample;\n    const byteRate = sampleRate * blockAlign;\n    const dataSize = buffer.length * numOfChan * bytesPerSample;\n    const bufferLength = 44 + dataSize;\n\n    const wavBuffer = new ArrayBuffer(bufferLength);\n    const view = new DataView(wavBuffer);\n\n    let pos = 0;\n\n    const writeString = (s) => { for (let i = 0; i < s.length; i++) view.setUint8(pos++, s.charCodeAt(i)); };\n    const writeUint16 = (d) => { view.setUint16(pos, d, true); pos += 2; };\n    const writeUint32 = (d) => { view.setUint32(pos, d, true); pos += 4; };\n\n    writeString('RIFF');\n    writeUint32(36 + dataSize);\n    writeString('WAVE');\n    writeString('fmt ');\n    writeUint32(16);\n    writeUint16(format);\n    writeUint16(numOfChan);\n    writeUint32(sampleRate);\n    writeUint32(byteRate);\n    writeUint16(blockAlign);\n    writeUint16(bytesPerSample * 8);\n    writeString('data');\n    writeUint32(dataSize);\n\n    const channels = [];\n    for (let i = 0; i < numOfChan; i++) {\n        channels.push(buffer.getChannelData(i));\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        for (let chan = 0; chan < numOfChan; chan++) {\n            let sample = channels[chan][i];\n            sample = Math.max(-1, Math.min(1, sample));\n            sample = sample < 0 ? sample * 32768 : sample * 32767;\n            view.setInt16(pos, sample, true);\n            pos += bytesPerSample;\n        }\n    }\n\n    return new Blob([view], { type: 'audio/wav' });\n}\n\nfunction blobToDataURL(blob) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onloadend = () => resolve(reader.result);\n        reader.onerror = (e) => reject(new Error(`FileReader error: ${e.target.error}`));\n        reader.readAsDataURL(blob);\n    });\n}\n\nnewOptionButton(\"Save New SFX\", \"#393939\", saveGeneratedSound);",
        "Map Maker": "J:optionsArea.style.display = \"none\";\noutputArea.style.height = \"100%\";\n\nwindow.showMaps = function() {\n    let mapButtons = \"\";\n    for (const mapName in notes[\"Tools\"][\"!Maps\"]) {\n        if (mapName.startsWith(\"!\")) mapButtons += `<button onclick=\"mapEditor('${mapName}');\" style=\"font-size: 24px; width: 80%;\">${mapName.substring(1)}</button>`\n    }\n    let fileButtons = \"\";\n    for (const fileName in notes[\"Files\"]) {\n        if (fileName != \"Upload\") fileButtons += `<option value=\"${fileName}\" style=\"font-size: 24px;\">${fileName}</option>`;\n    }\n\n    outputArea.innerHTML = `\n        <div style=\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\">\n        <div style=\"width: 80%; max-height: 80%; overflow-y: auto; border: 8px solid black; border-radius: 8px; display: flex; flex-direction: column; gap: 20px; align-items: center; background-color: white;\">\n            <div></div>\n            <u style=\"font-size: 48px;\">Maps</u>\n            <hr style=\"width: 90%\">\n            ${mapButtons}\n            <hr style=\"width: 90%\">\n            <div style=\"display: flex; width: 90%; justify-content: center; align-items: center; gap: 20px;\">\n                <div style=\"font-size: 24px;\">SpriteSheet File :</div>\n                <select id=\"fileSelection\" style=\"font-size: 24px;\">${fileButtons}</select>\n            </div>\n            <div style=\"display: flex; width: 90%; justify-content: center; align-items: center; gap: 20px;\">\n                <div style=\"font-size: 24px;\">Sprite Size :</div>\n                <input id=\"spriteSize\" type=\"number\" value=\"16\" style=\"font-size: 24px; width: 60px;\"></input>\n            </div>\n            <button onclick=\"const newName = prompt('Please enter the name of the new Map.'); notes['Tools']['!Maps']['!' + newName] = {}; showMaps();\" style=\"font-size: 24px; width: 80%;\">New Map</button>\n            <button onclick=\"path.pop(); showOption();\" style=\"font-size: 24px; width: 80%;\">Return</button>\n            <div></div>\n        </div>\n        </div>\n    `;\n}\n\nshowMaps();\n\n\n\nwindow.mapEditor = function(mapName) {\n    let mapObject = notes[\"Tools\"][\"!Maps\"][mapName];\n    const spriteSheetBase64 = notes[\"Files\"][document.getElementById(\"fileSelection\").value][\"!Data\"];\n\n\n    if (!spriteSheetBase64) {\n        alert(\"Spritesheet data not found!\");\n        return;\n    }\n    optionsArea.style.display = \"flex\";\n    const SPRITE_SIZE = document.getElementById(\"spriteSize\").value;\n    const GRID_CELL_SIZE = 16;\n    const NUM_LAYERS = 4;\n    const SPRITE_PALETTE_BG_COLOR = '#363737';\n\n    let sprites = [];\n    let spriteSheetImage = null;\n    let selectedSpriteId = 0;\n    let currentRotation = 0;\n    let currentLayer = 1;\n\n    let zoomLevel = 1;\n    const minZoom = 0.25;\n    const maxZoom = 32;\n    let panX = 0;\n    let panY = 0;\n    let isMouseLeftDown = false;\n    let isMouseMiddlePanning = false;\n    let isMouseLeftPanning = false;\n    let lastPointerX = 0;\n    let lastPointerY = 0;\n    let hoverGridX = null;\n    let hoverGridY = null;\n    let isPanModeActive = false;\n    let isEraseModeActive = false;\n\n    let touchPoints = {};\n    let isPinching = false;\n    let initialPinchDistance = 0;\n    let pinchStartZoom = 1;\n    let touchActionIdentifier = null;\n    let isTouchPanning = false;\n    let potentialTap = false;\n    const tapThreshold = 10;\n    let isTouchDrawing = false;\n    let lastPinchMidpoint = null;\n\n    optionsArea.innerHTML = \"\";\n    outputArea.innerHTML = `\n        <div style=\"display: flex; flex-direction: column; align-items: center; padding: 10px; height: calc(100vh - 120px);\">\n            <div id=\"canvasContainer\" style=\"overflow: hidden; border: 1px solid black; margin-bottom: 10px; width: 90%; height: 85%; position: relative; background-color: #333333; touch-action: none;\">\n                <canvas id=\"displayCanvas\" style=\"position: absolute; top: 0; left: 0; image-rendering: pixelated; image-rendering: crisp-edges; cursor: crosshair; display: block;\"></canvas>\n            </div>\n            <div style=\"display: flex; justify-content: center; align-items: flex-start; margin-bottom: 5px; flex-wrap: wrap; width: 90%;\">\n                <div id=\"spritePaletteContainer\" style=\"line-height: 0; margin-right: 15px; border: 1px solid #ccc; padding: 2px; max-height: 150px; overflow-y: auto; background-color: ${SPRITE_PALETTE_BG_COLOR};\">\n                    Loading Sprites...\n                </div>\n                <div style=\"display: flex; flex-direction: column; gap: 5px;\">\n                    <button id=\"panModeButton\" style=\"padding: 5px 10px; border: 1px solid #888; border-radius: 4px; background-color: #f0f0f0; cursor: pointer;\">Pan: OFF</button>\n                    <button id=\"eraseModeButton\" style=\"padding: 5px 10px; border: 1px solid #888; border-radius: 4px; background-color: #f0f0f0; cursor: pointer;\">Erase: OFF</button>\n                    <button id=\"rotateButton\" style=\"padding: 5px 10px; border: 1px solid #888; border-radius: 4px; background-color: #f0f0f0; cursor: pointer;\">Rotate: 0°</button>\n                    <div id=\"layerSelector\" style=\"display: flex; gap: 3px;\">\n                    </div>\n                </div>\n            </div>\n            <div id=\"editorInfo\" style=\"font-size: 0.8em; color: #ccc; min-height: 1.2em; text-align: center; width: 90%;\"></div>\n        </div>\n    `;\n\n    const canvasContainer = document.getElementById('canvasContainer');\n    const displayCanvas = document.getElementById('displayCanvas');\n    const displayCtx = displayCanvas.getContext('2d');\n    displayCtx.imageSmoothingEnabled = false;\n    const spritePaletteContainer = document.getElementById('spritePaletteContainer');\n    const editorInfo = document.getElementById('editorInfo');\n    const panModeButton = document.getElementById('panModeButton');\n    const eraseModeButton = document.getElementById('eraseModeButton');\n    const rotateButton = document.getElementById('rotateButton');\n    const layerSelector = document.getElementById('layerSelector');\n\n    function loadAndSliceSpriteSheet(base64Data, spriteWidth, spriteHeight) {\n        return new Promise((resolve, reject) => {\n            spriteSheetImage = new Image();\n            spriteSheetImage.onload = () => {\n                const sheetWidth = spriteSheetImage.naturalWidth;\n                const sheetHeight = spriteSheetImage.naturalHeight;\n                const cols = Math.floor(sheetWidth / spriteWidth);\n                const rows = Math.floor(sheetHeight / spriteHeight);\n                const loadedSprites = [];\n                let spriteId = 0;\n\n                for (let y = 0; y < rows; y++) {\n                    for (let x = 0; x < cols; x++) {\n                        const canvas = document.createElement('canvas');\n                        canvas.width = spriteWidth;\n                        canvas.height = spriteHeight;\n                        const ctx = canvas.getContext('2d');\n                        ctx.imageSmoothingEnabled = false;\n                        ctx.drawImage(\n                            spriteSheetImage,\n                            x * spriteWidth, y * spriteHeight,\n                            spriteWidth, spriteHeight,\n                            0, 0,\n                            spriteWidth, spriteHeight\n                        );\n                        loadedSprites.push({ id: spriteId++, canvas: canvas });\n                    }\n                }\n                resolve(loadedSprites);\n            };\n            spriteSheetImage.onerror = (err) => {\n                reject(`Error loading spritesheet image: ${err}`);\n            };\n            spriteSheetImage.src = base64Data;\n        });\n    }\n\n    function buildSpritePaletteUI() {\n        spritePaletteContainer.innerHTML = '';\n        sprites.forEach(spriteData => {\n            const swatch = spriteData.canvas.cloneNode();\n            const swatchCtx = swatch.getContext('2d');\n            swatchCtx.drawImage(spriteData.canvas, 0, 0);\n            swatch.style.width = `${SPRITE_SIZE * 2}px`;\n            swatch.style.height = `${SPRITE_SIZE * 2}px`;\n            swatch.style.border = '1px solid #ccc';\n            swatch.style.display = 'inline-block';\n            swatch.style.margin = '1px';\n            swatch.style.cursor = 'pointer';\n            swatch.style.imageRendering = 'pixelated';\n            if (spriteData.id === selectedSpriteId) {\n                swatch.style.border = '2px solid blue';\n                swatch.style.backgroundColor = '#aaf';\n            }\n            swatch.addEventListener('click', () => {\n                isEraseModeActive = false;\n                eraseModeButton.textContent = `Erase: OFF`;\n                eraseModeButton.style.backgroundColor = '#f0f0f0';\n\n                selectedSpriteId = spriteData.id;\n                Array.from(spritePaletteContainer.children).forEach((child, index) => {\n                    const childSpriteId = sprites[index]?.id;\n                    if (childSpriteId === selectedSpriteId) {\n                        child.style.border = '2px solid blue';\n                        child.style.backgroundColor = '#aaf';\n                    } else {\n                        child.style.border = '1px solid #ccc';\n                        child.style.backgroundColor = 'transparent';\n                    }\n                });\n                if (!isPanModeActive) {\n                    displayCanvas.style.cursor = 'crosshair';\n                }\n                redrawDisplayCanvas();\n            });\n            spritePaletteContainer.appendChild(swatch);\n        });\n    }\n\n    function buildLayerSelectorUI() {\n        layerSelector.innerHTML = '';\n        for (let i = 1; i <= NUM_LAYERS; i++) {\n            const btn = document.createElement('button');\n            btn.textContent = `L${i}`;\n            btn.style.padding = '3px 6px';\n            btn.style.fontSize = '0.9em';\n            btn.style.border = '1px solid #888';\n            btn.style.borderRadius = '3px';\n            btn.style.cursor = 'pointer';\n            if (i === currentLayer) {\n                btn.style.backgroundColor = '#a0d0ff';\n                btn.style.fontWeight = 'bold';\n            } else {\n                btn.style.backgroundColor = '#f0f0f0';\n                btn.style.fontWeight = 'normal';\n            }\n            btn.addEventListener('click', () => {\n                currentLayer = i;\n                buildLayerSelectorUI();\n                redrawDisplayCanvas();\n            });\n            layerSelector.appendChild(btn);\n        }\n    }\n\n    panModeButton.addEventListener('click', () => {\n        isPanModeActive = !isPanModeActive;\n        panModeButton.textContent = `Pan: ${isPanModeActive ? 'ON' : 'OFF'}`;\n        panModeButton.style.backgroundColor = isPanModeActive ? '#a0d0a0' : '#f0f0f0';\n        if (isPanModeActive) {\n            displayCanvas.style.cursor = 'grab';\n        } else {\n            displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n        }\n        isMouseLeftDown = false; isTouchDrawing = false; isMouseLeftPanning = false; isTouchPanning = false;\n    });\n\n    eraseModeButton.addEventListener('click', () => {\n        isEraseModeActive = !isEraseModeActive;\n        eraseModeButton.textContent = `Erase: ${isEraseModeActive ? 'ON' : 'OFF'}`;\n        eraseModeButton.style.backgroundColor = isEraseModeActive ? '#ffaaaa' : '#f0f0f0';\n        if (isEraseModeActive) {\n            Array.from(spritePaletteContainer.children).forEach(child => {\n                child.style.border = '1px solid #ccc';\n                child.style.backgroundColor = 'transparent';\n            });\n        } else if (selectedSpriteId !== null) {\n        const swatchIndex = sprites.findIndex(s => s.id === selectedSpriteId);\n        if (swatchIndex !== -1) {\n            const swatch = spritePaletteContainer.children[swatchIndex];\n            if(swatch){\n                swatch.style.border = '2px solid blue';\n                swatch.style.backgroundColor = '#aaf';\n            }\n        }\n        }\n\n        if (!isPanModeActive) {\n            displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n        }\n        redrawDisplayCanvas();\n    });\n\n    rotateButton.addEventListener('click', () => {\n        currentRotation = (currentRotation + 90) % 360;\n        rotateButton.textContent = `Rotate: ${currentRotation}°`;\n        redrawDisplayCanvas();\n    });\n\n    function resizeAndRedraw() {\n        displayCanvas.width = canvasContainer.clientWidth;\n        displayCanvas.height = canvasContainer.clientHeight;\n        displayCtx.imageSmoothingEnabled = false;\n        redrawDisplayCanvas();\n    }\n\n    function redrawDisplayCanvas() {\n        if (!spriteSheetImage || sprites.length === 0) return;\n\n        const viewWidth = displayCanvas.width;\n        const viewHeight = displayCanvas.height;\n\n        displayCtx.imageSmoothingEnabled = false;\n        displayCtx.fillStyle = '#333333';\n        displayCtx.fillRect(0, 0, viewWidth, viewHeight);\n\n        displayCtx.save();\n        displayCtx.translate(viewWidth / 2, viewHeight / 2);\n        displayCtx.scale(zoomLevel, zoomLevel);\n        displayCtx.translate(-panX, -panY);\n        // Removed initial centering translation\n\n        const viewLeft = ((-viewWidth / 2) / zoomLevel) + panX;\n        const viewTop = ((-viewHeight / 2) / zoomLevel) + panY;\n        const viewRight = viewLeft + viewWidth / zoomLevel;\n        const viewBottom = viewTop + viewHeight / zoomLevel;\n\n        const startCol = Math.floor(viewLeft / GRID_CELL_SIZE);\n        const endCol = Math.ceil(viewRight / GRID_CELL_SIZE);\n        const startRow = Math.floor(viewTop / GRID_CELL_SIZE);\n        const endRow = Math.ceil(viewBottom / GRID_CELL_SIZE);\n\n\n        for (let layer = 1; layer <= NUM_LAYERS; layer++) {\n            for (let gy = startRow; gy < endRow; gy++) {\n                for (let gx = startCol; gx < endCol; gx++) {\n                    const key = `${gx}x${gy}`;\n                    if (mapObject[key] && mapObject[key][layer - 1] && mapObject[key][layer - 1].length === 2) {\n                        const [spriteId, rotation] = mapObject[key][layer - 1];\n                        const spriteData = sprites.find(s => s.id === spriteId);\n\n                        if (spriteData) {\n                            const drawX = gx * GRID_CELL_SIZE;\n                            const drawY = gy * GRID_CELL_SIZE;\n\n                            displayCtx.save();\n\n                            if (layer !== currentLayer) {\n                                displayCtx.globalAlpha = 0.35;\n                            } else {\n                                displayCtx.globalAlpha = 1.0;\n                            }\n\n                            const centerX = drawX + GRID_CELL_SIZE / 2;\n                            const centerY = drawY + GRID_CELL_SIZE / 2;\n                            displayCtx.translate(centerX, centerY);\n                            displayCtx.rotate(rotation * Math.PI / 180);\n                            displayCtx.translate(-centerX, -centerY);\n\n                            displayCtx.drawImage(spriteData.canvas, drawX, drawY, GRID_CELL_SIZE, GRID_CELL_SIZE);\n\n                            displayCtx.restore();\n                        }\n                    }\n                }\n            }\n        }\n\n        displayCtx.globalAlpha = 1.0;\n\n\n        if (zoomLevel * GRID_CELL_SIZE > 4) {\n            displayCtx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n            displayCtx.lineWidth = 1 / zoomLevel;\n\n            for (let gx = startCol; gx <= endCol; gx++) {\n                displayCtx.beginPath();\n                displayCtx.moveTo(gx * GRID_CELL_SIZE, startRow * GRID_CELL_SIZE);\n                displayCtx.lineTo(gx * GRID_CELL_SIZE, endRow * GRID_CELL_SIZE);\n                displayCtx.stroke();\n            }\n            for (let gy = startRow; gy <= endRow; gy++) {\n                displayCtx.beginPath();\n                displayCtx.moveTo(startCol * GRID_CELL_SIZE, gy * GRID_CELL_SIZE);\n                displayCtx.lineTo(endCol * GRID_CELL_SIZE, gy * GRID_CELL_SIZE);\n                displayCtx.stroke();\n            }\n        }\n\n        // Removed Map Border drawing\n\n        const showHover = hoverGridX !== null && hoverGridY !== null && !isPinching && Object.keys(touchPoints).length <= 1 && !isMouseMiddlePanning && !isMouseLeftPanning && !isTouchPanning && !isTouchDrawing && !isMouseLeftDown;\n\n        if (showHover) {\n            const hx = hoverGridX * GRID_CELL_SIZE;\n            const hy = hoverGridY * GRID_CELL_SIZE;\n\n            if (isEraseModeActive) {\n                displayCtx.strokeStyle = \"rgba(255, 0, 0, 0.8)\";\n                displayCtx.lineWidth = 2 / zoomLevel;\n                displayCtx.strokeRect(hx + 1 / zoomLevel, hy + 1 / zoomLevel, GRID_CELL_SIZE - 2 / zoomLevel, GRID_CELL_SIZE - 2 / zoomLevel);\n                displayCtx.beginPath();\n                displayCtx.moveTo(hx + 2 / zoomLevel, hy + 2 / zoomLevel);\n                displayCtx.lineTo(hx + GRID_CELL_SIZE - 2 / zoomLevel, hy + GRID_CELL_SIZE - 2 / zoomLevel);\n                displayCtx.moveTo(hx + GRID_CELL_SIZE - 2 / zoomLevel, hy + 2 / zoomLevel);\n                displayCtx.lineTo(hx + 2 / zoomLevel, hy + GRID_CELL_SIZE - 2 / zoomLevel);\n                displayCtx.stroke();\n            } else if (selectedSpriteId !== null) {\n                const spriteData = sprites.find(s => s.id === selectedSpriteId);\n                if (spriteData) {\n                    displayCtx.save();\n                    displayCtx.globalAlpha = 0.7;\n\n                    const centerX = hx + GRID_CELL_SIZE / 2;\n                    const centerY = hy + GRID_CELL_SIZE / 2;\n                    displayCtx.translate(centerX, centerY);\n                    displayCtx.rotate(currentRotation * Math.PI / 180);\n                    displayCtx.translate(-centerX, -centerY);\n\n                    displayCtx.drawImage(spriteData.canvas, hx, hy, GRID_CELL_SIZE, GRID_CELL_SIZE);\n                    displayCtx.restore();\n\n                    displayCtx.strokeStyle = \"rgba(255, 255, 0, 0.9)\";\n                    displayCtx.lineWidth = 1.5 / zoomLevel;\n                    displayCtx.strokeRect(hx, hy, GRID_CELL_SIZE, GRID_CELL_SIZE);\n                }\n            }\n        }\n\n        displayCtx.restore();\n\n        const hoverCoordsText = (hoverGridX !== null && hoverGridY !== null) ? `(${hoverGridX}, ${hoverGridY})` : '(N/A)';\n        editorInfo.textContent = `Layer: ${currentLayer} | Zoom: ${zoomLevel.toFixed(2)}x | View: (${Math.round(panX)}, ${Math.round(panY)}) | Hover: ${hoverCoordsText} | Sel: ${selectedSpriteId !== null ? selectedSpriteId : 'None'}@${currentRotation}° ${isEraseModeActive ? '(Erase)' : ''}`;\n    }\n\n    function getGridCoords(clientX, clientY) {\n        const rect = displayCanvas.getBoundingClientRect();\n        const canvasX = clientX - rect.left;\n        const canvasY = clientY - rect.top;\n\n        const worldX = ((canvasX - displayCanvas.width / 2) / zoomLevel) + panX;\n        const worldY = ((canvasY - displayCanvas.height / 2) / zoomLevel) + panY;\n\n        const gridX = Math.floor(worldX / GRID_CELL_SIZE);\n        const gridY = Math.floor(worldY / GRID_CELL_SIZE);\n\n        // Return coords directly, no bounds check for infinite map\n        return { x: gridX, y: gridY };\n    }\n\n    function placeOrEraseSprite(gridX, gridY) {\n        // No need to check gridX/gridY against -1 as getGridCoords no longer returns it for out of bounds\n        if (gridX === null || gridY === null) return; // Should not happen if called correctly, but safety check\n\n        const key = `${gridX}x${gridY}`;\n\n        if (!mapObject[key]) {\n            mapObject[key] = [];\n            for(let i = 0; i < NUM_LAYERS; i++) mapObject[key].push([]);\n        } else if (!Array.isArray(mapObject[key])){\n            console.warn(`Invalid data format for key ${key}, resetting.`);\n            mapObject[key] = [];\n            for(let i = 0; i < NUM_LAYERS; i++) mapObject[key].push([]);\n        } else {\n            while(mapObject[key].length < NUM_LAYERS) {\n                mapObject[key].push([]);\n            }\n        }\n\n        const currentCellData = mapObject[key][currentLayer - 1];\n        let needsRedraw = false;\n\n        if (isEraseModeActive) {\n            if (currentCellData && currentCellData.length > 0) {\n                mapObject[key][currentLayer - 1] = [];\n                needsRedraw = true;\n            }\n        } else if (selectedSpriteId !== null) {\n            const newData = [selectedSpriteId, currentRotation];\n            if (!currentCellData || currentCellData.length === 0 || currentCellData[0] !== newData[0] || currentCellData[1] !== newData[1]) {\n                mapObject[key][currentLayer - 1] = newData;\n                needsRedraw = true;\n            }\n        }\n\n        // Optional cleanup - remove fully empty keys\n        // if (mapObject[key].every(layerData => !layerData || layerData.length === 0)) {\n        //     delete mapObject[key];\n        //     // Deleting might cause issues if you expect keys to persist?\n        //     // Keep this commented unless sure it's desired behavior.\n        // }\n\n        if (needsRedraw) {\n            redrawDisplayCanvas();\n        }\n    }\n\n    function getDistance(p1, p2) {\n        const dx = p1.clientX - p2.clientX;\n        const dy = p1.clientY - p2.clientY;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    function getMidpoint(p1, p2) {\n        return {\n            clientX: (p1.clientX + p2.clientX) / 2,\n            clientY: (p1.clientY + p2.clientY) / 2,\n        };\n    }\n\n    function handlePointerDown(identifier, clientX, clientY, isPrimary, eventSource) {\n        touchPoints[identifier] = { clientX, clientY, startX: clientX, startY: clientY, startTime: performance.now() };\n        const touchCount = Object.keys(touchPoints).length;\n\n        if (touchCount === 1 && isPrimary) {\n            touchActionIdentifier = identifier;\n            lastPointerX = clientX;\n            lastPointerY = clientY;\n            isTouchPanning = false;\n            isMouseLeftPanning = false;\n            isTouchDrawing = false;\n            potentialTap = true;\n\n            if (isPanModeActive) {\n                if (eventSource === 'touch') { isTouchPanning = true; }\n                if (eventSource === 'mouse') { isMouseLeftPanning = true; }\n                displayCanvas.style.cursor = 'grabbing';\n            } else {\n                const coords = getGridCoords(clientX, clientY);\n                // Check if coords are valid numbers before placing\n                if (coords.x !== null && coords.y !== null) {\n                    if (eventSource === 'mouse') {\n                        isMouseLeftDown = true;\n                        placeOrEraseSprite(coords.x, coords.y);\n                    } else if (eventSource === 'touch') {\n                        isTouchDrawing = true;\n                        // Don't place on touch down for drawing, wait for move/up\n                    }\n                }\n                displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n            }\n            if (hoverGridX !== null || hoverGridY !== null) {\n                hoverGridX = null; hoverGridY = null;\n            }\n\n        } else if (touchCount === 2) {\n            isMouseLeftDown = false; isTouchDrawing = false;\n            isTouchPanning = false; isMouseLeftPanning = false;\n            isPinching = true;\n            potentialTap = false;\n            const touches = Object.values(touchPoints);\n            initialPinchDistance = getDistance(touches[0], touches[1]);\n            pinchStartZoom = zoomLevel;\n            lastPinchMidpoint = getMidpoint(touches[0], touches[1]);\n            displayCanvas.style.cursor = 'move';\n            hoverGridX = null; hoverGridY = null;\n            redrawDisplayCanvas();\n        }\n        if(!isPanModeActive && (isMouseLeftDown || isTouchDrawing)){\n            redrawDisplayCanvas();\n        }\n    }\n\n    function handlePointerMove(identifier, clientX, clientY) {\n        if (identifier === 'mouse' && !isMouseLeftDown && !isMouseMiddlePanning && !isMouseLeftPanning && Object.keys(touchPoints).length === 0 && !isPinching && !isTouchDrawing && !isTouchPanning) {\n            const coords = getGridCoords(clientX, clientY);\n            let needsRedraw = false;\n            // Only update if coords are valid numbers\n            if (coords.x !== null && coords.y !== null && (coords.x !== hoverGridX || coords.y !== hoverGridY)) {\n                hoverGridX = coords.x; hoverGridY = coords.y; needsRedraw = true;\n            } else if ((coords.x === null || coords.y === null) && (hoverGridX !== null || hoverGridY !== null)) {\n                // Moved off valid grid area\n                hoverGridX = null; hoverGridY = null; needsRedraw = true;\n            }\n            if (needsRedraw) redrawDisplayCanvas();\n            return;\n        }\n\n        if (!touchPoints[identifier]) return;\n\n        const currentPointer = touchPoints[identifier];\n        const startInfo = touchPoints[identifier];\n        currentPointer.clientX = clientX;\n        currentPointer.clientY = clientY;\n\n        const touchCount = Object.keys(touchPoints).length;\n\n        if (isPinching && touchCount === 2) {\n            potentialTap = false;\n            const touches = Object.values(touchPoints);\n            const currentDistance = getDistance(touches[0], touches[1]);\n            const currentMidpoint = getMidpoint(touches[0], touches[1]);\n\n            if (initialPinchDistance > 0 && lastPinchMidpoint) {\n                const zoomRatio = currentDistance / initialPinchDistance;\n                const newZoomLevelTarget = pinchStartZoom * zoomRatio;\n                const newZoomLevel = Math.max(minZoom, Math.min(maxZoom, newZoomLevelTarget));\n\n                const rect = displayCanvas.getBoundingClientRect();\n                const canvasMidX = currentMidpoint.clientX - rect.left;\n                const canvasMidY = currentMidpoint.clientY - rect.top;\n\n                const worldXUnderMidpoint = ((canvasMidX - displayCanvas.width / 2) / zoomLevel) + panX;\n                const worldYUnderMidpoint = ((canvasMidY - displayCanvas.height / 2) / zoomLevel) + panY;\n\n                let zoomCorrectedPanX = worldXUnderMidpoint - ((canvasMidX - displayCanvas.width / 2) / newZoomLevel);\n                let zoomCorrectedPanY = worldYUnderMidpoint - ((canvasMidY - displayCanvas.height / 2) / newZoomLevel);\n\n\n                const deltaMidX = currentMidpoint.clientX - lastPinchMidpoint.clientX;\n                const deltaMidY = currentMidpoint.clientY - lastPinchMidpoint.clientY;\n\n                let finalPanX = zoomCorrectedPanX - (deltaMidX / newZoomLevel);\n                let finalPanY = zoomCorrectedPanY - (deltaMidY / newZoomLevel);\n\n\n                if (Math.abs(newZoomLevel - zoomLevel) > 0.001 || Math.abs(finalPanX - panX) > 0.1 || Math.abs(finalPanY - panY) > 0.1) {\n                    zoomLevel = newZoomLevel;\n                    panX = finalPanX;\n                    panY = finalPanY;\n                    redrawDisplayCanvas();\n                }\n            }\n            lastPinchMidpoint = currentMidpoint;\n\n        }\n        else if (identifier === touchActionIdentifier && !isPinching) {\n            const dxPanDelta = clientX - lastPointerX;\n            const dyPanDelta = clientY - lastPointerY;\n\n            if (potentialTap) {\n                const dxMoveTotal = clientX - startInfo.startX;\n                const dyMoveTotal = clientY - startInfo.startY;\n                const distanceMoved = Math.sqrt(dxMoveTotal * dxMoveTotal + dyMoveTotal * dyMoveTotal);\n                if (distanceMoved > tapThreshold) {\n                    potentialTap = false;\n                    if (isPanModeActive && !isTouchPanning && !isMouseLeftPanning) {\n                        if (identifier === 'mouse') isMouseLeftPanning = true;\n                        else isTouchPanning = true;\n                        displayCanvas.style.cursor = 'grabbing';\n                    }\n                    if (!isPanModeActive && !isTouchDrawing && !isMouseLeftDown) {\n                        if (identifier === 'mouse') isMouseLeftDown = true;\n                        else isTouchDrawing = true;\n                        displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n                    }\n                }\n            }\n\n            if ((isTouchPanning || isMouseLeftPanning) && isPanModeActive) {\n                potentialTap = false;\n                panX -= dxPanDelta / zoomLevel;\n                panY -= dyPanDelta / zoomLevel;\n                if (displayCanvas.style.cursor !== 'grabbing') { displayCanvas.style.cursor = 'grabbing';}\n                redrawDisplayCanvas();\n            }\n            else if (isMouseLeftDown && !isPanModeActive) {\n                potentialTap = false;\n                const coords = getGridCoords(clientX, clientY);\n                placeOrEraseSprite(coords.x, coords.y);\n            }\n            else if (isTouchDrawing && !isPanModeActive && !potentialTap) {\n                const coords = getGridCoords(clientX, clientY);\n                placeOrEraseSprite(coords.x, coords.y);\n            }\n\n            lastPointerX = clientX;\n            lastPointerY = clientY;\n        }\n    }\n\n    function handlePointerUp(identifier, clientX, clientY) {\n        const startInfo = touchPoints[identifier];\n        const touchCountBeforeEnd = Object.keys(touchPoints).length;\n\n        delete touchPoints[identifier];\n        const touchCountAfterEnd = Object.keys(touchPoints).length;\n\n        let cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n\n        if (isPinching && touchCountBeforeEnd === 2 && touchCountAfterEnd < 2) {\n            isPinching = false;\n            initialPinchDistance = 0;\n            lastPinchMidpoint = null;\n            if (touchCountAfterEnd === 1) {\n                const remainingTouchId = Object.keys(touchPoints)[0];\n                const remainingTouch = touchPoints[remainingTouchId];\n                touchActionIdentifier = remainingTouchId;\n                lastPointerX = remainingTouch.clientX;\n                lastPointerY = remainingTouch.clientY;\n                isTouchPanning = false; isTouchDrawing = false; potentialTap = false;\n\n                if (isPanModeActive) {\n                    isTouchPanning = true;\n                    cursor = 'grabbing';\n                } else {\n                    isTouchDrawing = false;\n                    cursor = isEraseModeActive ? 'cell' : 'crosshair';\n                }\n                remainingTouch.startX = remainingTouch.clientX;\n                remainingTouch.startY = remainingTouch.clientY;\n                remainingTouch.startTime = performance.now();\n                potentialTap = true;\n\n            } else {\n                touchActionIdentifier = null;\n            }\n        }\n        else if (identifier === touchActionIdentifier) {\n\n            if (!isPanModeActive && potentialTap && startInfo) {\n                const dxMoveTotal = clientX - startInfo.startX;\n                const dyMoveTotal = clientY - startInfo.startY;\n                const distanceMoved = Math.sqrt(dxMoveTotal * dxMoveTotal + dyMoveTotal * dyMoveTotal);\n\n                if (distanceMoved <= tapThreshold) {\n                    const coords = getGridCoords(clientX, clientY);\n                    placeOrEraseSprite(coords.x, coords.y);\n                }\n            }\n\n            isTouchPanning = false;\n            isMouseLeftDown = false;\n            isMouseLeftPanning = false;\n            isTouchDrawing = false;\n            potentialTap = false;\n            touchActionIdentifier = null;\n        }\n\n        if (touchCountAfterEnd === 0) {\n            isTouchPanning = false; isMouseLeftDown = false; isMouseLeftPanning = false;\n            isTouchDrawing = false; isPinching = false; potentialTap = false;\n            touchActionIdentifier = null; lastPinchMidpoint = null;\n            cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n        }\n\n        displayCanvas.style.cursor = cursor;\n        redrawDisplayCanvas();\n    }\n\n\n    displayCanvas.addEventListener('mousedown', (e) => {\n        if (e.button === 0) {\n            handlePointerDown('mouse', e.clientX, e.clientY, true, 'mouse');\n        } else if (e.button === 1) {\n            isMouseMiddlePanning = true;\n            lastPointerX = e.clientX;\n            lastPointerY = e.clientY;\n            displayCanvas.style.cursor = 'grabbing';\n            e.preventDefault();\n        }\n    });\n\n    displayCanvas.addEventListener('mousemove', (e) => {\n        if (isMouseMiddlePanning && (e.buttons & 4)) {\n            const dx = e.clientX - lastPointerX;\n            const dy = e.clientY - lastPointerY;\n            panX -= dx / zoomLevel;\n            panY -= dy / zoomLevel;\n            lastPointerX = e.clientX;\n            lastPointerY = e.clientY;\n            redrawDisplayCanvas();\n        } else if (isMouseMiddlePanning && !(e.buttons & 4)) {\n            isMouseMiddlePanning = false;\n            displayCanvas.style.cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n            handlePointerMove('mouse', e.clientX, e.clientY);\n        }\n        else {\n            handlePointerMove('mouse', e.clientX, e.clientY);\n        }\n    });\n\n    displayCanvas.addEventListener('mouseup', (e) => {\n        if (e.button === 0) {\n            handlePointerUp('mouse', e.clientX, e.clientY);\n        } else if (e.button === 1) {\n            isMouseMiddlePanning = false;\n            displayCanvas.style.cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n            const coords = getGridCoords(e.clientX, e.clientY);\n            hoverGridX = coords.x; hoverGridY = coords.y;\n            redrawDisplayCanvas();\n        }\n    });\n\n    displayCanvas.addEventListener('mouseleave', (e) => {\n        if (touchPoints['mouse']) {\n            handlePointerUp('mouse', e.clientX, e.clientY);\n        }\n        if (isMouseMiddlePanning) {\n            isMouseMiddlePanning = false;\n            displayCanvas.style.cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n        }\n        if (hoverGridX !== null || hoverGridY !== null) {\n            hoverGridX = null; hoverGridY = null;\n            redrawDisplayCanvas();\n        }\n    });\n\n    displayCanvas.addEventListener('wheel', (e) => {\n        e.preventDefault();\n        const rect = displayCanvas.getBoundingClientRect();\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n\n        const worldXBefore = ((mouseX - displayCanvas.width / 2) / zoomLevel) + panX;\n        const worldYBefore = ((mouseY - displayCanvas.height / 2) / zoomLevel) + panY;\n\n        const zoomFactor = 1.2;\n        let newZoomLevel;\n        if (e.deltaY < 0) {\n            newZoomLevel = Math.min(maxZoom, zoomLevel * zoomFactor);\n        } else {\n            newZoomLevel = Math.max(minZoom, zoomLevel / zoomFactor);\n        }\n\n        if(Math.abs(newZoomLevel - zoomLevel) < 0.001) return;\n\n        panX = worldXBefore - ((mouseX - displayCanvas.width / 2) / newZoomLevel);\n        panY = worldYBefore - ((mouseY - displayCanvas.height / 2) / newZoomLevel);\n\n        zoomLevel = newZoomLevel;\n\n        const coords = getGridCoords(e.clientX, e.clientY);\n        hoverGridX = coords.x; hoverGridY = coords.y;\n\n        redrawDisplayCanvas();\n    });\n\n    displayCanvas.addEventListener('touchstart', (e) => {\n        e.preventDefault();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            const isPrimary = Object.keys(touchPoints).length === 0 && i === 0;\n            handlePointerDown(touch.identifier, touch.clientX, touch.clientY, isPrimary, 'touch');\n        }\n    }, { passive: false });\n\n    displayCanvas.addEventListener('touchmove', (e) => {\n        e.preventDefault();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            if (touchPoints[touch.identifier]) {\n                handlePointerMove(touch.identifier, touch.clientX, touch.clientY);\n            }\n        }\n    }, { passive: false });\n\n    displayCanvas.addEventListener('touchend', (e) => {\n        e.preventDefault();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            if (touchPoints[touch.identifier]) {\n                handlePointerUp(touch.identifier, touch.clientX, touch.clientY);\n            }\n        }\n    }, { passive: false });\n\n    displayCanvas.addEventListener('touchcancel', (e) => {\n        e.preventDefault();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            if (touchPoints[touch.identifier]) {\n                handlePointerUp(touch.identifier, touch.clientX, touch.clientY);\n            }\n        }\n    }, { passive: false });\n\n    const saveMap = () => {\n        try {\n            // Optional: Clean up empty keys before saving\n            Object.keys(mapObject).forEach(key => {\n                if (Array.isArray(mapObject[key]) && mapObject[key].every(layerData => !layerData || layerData.length === 0)) {\n                    delete mapObject[key];\n                }\n            });\n            saveData();\n            path.pop(); showOption();\n            alert(\"Map saved successfully!\");\n        } catch (error) {\n            console.error(\"Error saving map:\", error);\n            alert(\"Error saving map.\");\n        }\n    };\n    newOptionButton(\"Save Map\", \"#393939\", saveMap);\n\n    loadAndSliceSpriteSheet(spriteSheetBase64, SPRITE_SIZE, SPRITE_SIZE)\n        .then(loadedSprites => {\n            sprites = loadedSprites;\n            buildSpritePaletteUI();\n            buildLayerSelectorUI();\n            resizeAndRedraw();\n            window.addEventListener('resize', resizeAndRedraw);\n        })\n        .catch(error => {\n            console.error(error);\n            outputArea.innerHTML = `<p style=\"color: red;\">${error}</p>`;\n            alert(\"Could not load the spritesheet for editing.\");\n        });\n}",
        "FullScreen": "J:if (document.documentElement.requestFullscreen) {\n    document.documentElement.requestFullscreen();\n} else if (document.documentElement.mozRequestFullScreen) { /* Firefox */\n    document.documentElement.mozRequestFullScreen();\n} else if (document.documentElement.webkitRequestFullscreen) { /* Chrome, Safari and Opera */\n    document.documentElement.webkitRequestFullscreen();\n} else if (document.documentElement.msRequestFullscreen) { /* IE/Edge */\n    document.documentElement.msRequestFullscreen();\n}\npath.pop();\nshowOption();",
        "!Maps": {
            "!PlatformDescent": {
                "0x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-2x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-1x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "1x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "2x1": [
                    [],
                    [
                        6,
                        90
                    ],
                    [],
                    []
                ],
                "-3x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "3x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "4x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "6x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "7x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "5x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "8x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "9x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "10x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "14x1": [
                    [],
                    [
                        6,
                        0
                    ],
                    [],
                    []
                ],
                "16x2": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "17x2": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "18x2": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "19x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "20x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "22x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "21x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "2x2": [
                    [
                        7,
                        90
                    ],
                    [],
                    [],
                    []
                ],
                "11x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "14x2": [
                    [
                        7,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "17x14": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x3": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x4": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x5": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x6": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x7": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x8": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x9": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x10": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x11": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x12": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x13": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "15x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "16x1": [
                    [
                        2,
                        0
                    ],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "13x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "12x2": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-4x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-5x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-6x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-7x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-8x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-9x1": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x0": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-1": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-2": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-3": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-4": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-5": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-6": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-7": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-8": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-9": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x-10": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x2": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-9x3": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "-8x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-7x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-6x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-5x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-4x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-3x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-2x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "-1x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "0x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "4x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "3x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "2x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "1x4": [
                    [],
                    [
                        16,
                        90
                    ],
                    [],
                    []
                ],
                "5x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "6x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "7x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "8x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "9x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "10x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "11x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "12x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "13x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "14x5": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "15x5": [
                    [],
                    [
                        15,
                        0
                    ],
                    [],
                    []
                ],
                "20x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "21x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "22x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "23x4": [
                    [],
                    [
                        17,
                        0
                    ],
                    [],
                    []
                ],
                "18x1": [
                    [
                        2,
                        0
                    ],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "17x1": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "-8x-4": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-7x-4": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-6x-4": [
                    [
                        2,
                        0
                    ],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "-5x-4": [
                    [
                        3,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-6x-2": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "-6x-3": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "-6x-1": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "-6x0": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "-9x4": [
                    [],
                    [
                        17,
                        90
                    ],
                    [],
                    []
                ],
                "1x5": [
                    [],
                    [
                        17,
                        90
                    ],
                    [],
                    []
                ],
                "19x4": [
                    [],
                    [
                        12,
                        0
                    ],
                    [],
                    []
                ],
                "23x3": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x2": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x1": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x0": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-1": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-2": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-3": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-4": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-5": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-6": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-7": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-8": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-9": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "23x-10": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "18x3": [
                    [],
                    [
                        12,
                        270
                    ],
                    [],
                    []
                ],
                "16x4": [
                    [],
                    [
                        15,
                        0
                    ],
                    [],
                    []
                ],
                "16x3": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    []
                ],
                "18x4": [
                    [],
                    [
                        14,
                        0
                    ],
                    [],
                    []
                ],
                "17x0": [
                    [],
                    [],
                    [],
                    [
                        8,
                        0
                    ]
                ],
                "-6x-5": [
                    [],
                    [],
                    [],
                    [
                        8,
                        0
                    ]
                ],
                "15x4": [
                    [],
                    [
                        14,
                        90
                    ],
                    [],
                    []
                ],
                "14x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "15x18": [
                    [
                        11,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "16x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "17x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "18x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "19x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "20x18": [
                    [
                        11,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "13x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "12x18": [
                    [
                        11,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "11x18": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "21x18": [
                    [
                        13,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "10x18": [
                    [
                        10,
                        0
                    ],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "11x25": [
                    [
                        13,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "10x25": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "9x25": [
                    [
                        11,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "8x25": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "7x25": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "6x25": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "5x25": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "3x25": [
                    [
                        10,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "4x25": [
                    [
                        11,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "2x22": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "1x22": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "0x22": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "4x22": [
                    [
                        13,
                        0
                    ],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "3x22": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-1x22": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-2x22": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-3x22": [
                    [
                        17,
                        90
                    ],
                    [],
                    [],
                    []
                ],
                "-3x21": [
                    [],
                    [
                        12,
                        90
                    ],
                    [],
                    [
                        19,
                        0
                    ]
                ],
                "-3x20": [
                    [],
                    [
                        16,
                        90
                    ],
                    [],
                    []
                ],
                "-4x20": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-5x20": [
                    [
                        12,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "-6x20": [
                    [
                        10,
                        0
                    ],
                    [],
                    [],
                    []
                ],
                "4x21": [
                    [],
                    [],
                    [],
                    [
                        8,
                        0
                    ]
                ],
                "4x23": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "4x24": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "10x17": [
                    [],
                    [],
                    [],
                    [
                        8,
                        0
                    ]
                ],
                "10x24": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "10x23": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "10x22": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "10x21": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "10x20": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "10x19": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x15": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x16": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "17x17": [
                    [],
                    [],
                    [],
                    [
                        18,
                        0
                    ]
                ],
                "0x0": [
                    [],
                    [],
                    [],
                    [
                        28,
                        0
                    ]
                ],
                "5x1": [
                    [],
                    [],
                    [],
                    [
                        28,
                        0
                    ]
                ],
                "14x0": [
                    [],
                    [],
                    [],
                    [
                        28,
                        0
                    ]
                ],
                "21x0": [
                    [],
                    [],
                    [],
                    [
                        28,
                        0
                    ]
                ]
            }
        },
        "!Calender": {
            "10_May_2025": {}
        },
        "!Tasks": {
            "1": [],
            "2": [],
            "3": [],
            "4": [],
            "5": [],
            "6": [],
            "7": [],
            "8": [],
            "9": [],
            "10": [],
            "11": [],
            "12": [],
            "13": [],
            "14": [],
            "15": [],
            "16": [],
            "17": [],
            "18": [],
            "19": [],
            "20": [],
            "21": [],
            "22": [],
            "23": [],
            "24": [],
            "25": [],
            "26": [],
            "27": [],
            "28": [],
            "29": [],
            "30": [],
            "31": [],
            "Monday": [],
            "Tuesday": [],
            "Wednesday": [],
            "Thursday": [],
            "Friday": [],
            "Saturday": [],
            "Sunday": [],
            "OneShots": {}
        }
    },
    "Extra": {
        "Personal": {
            "Download": "J:optionsArea.innerHTML = \"\";\nnewOptionButton(\"Return\", \"#393939\", function() {\n    path.pop();\n    showOption();\n});\noutputArea.style.height = \"100%\";\noutputArea.innerHTML = `\n    <div style=\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\">\n        <form id=\"loginForm\" style=\"border: 5px solid black; width: calc(80% - 40px); min-height: calc(80% - 40px); padding: 20px; border-radius: 8px; background-color: white; font-size: 16px; display: flex; flex-direction: column; justify-content: center;\" onsubmit=\"event.preventDefault(); login();\">\n            <div style=\"width:100%; text-align: center; font-size: 52px; margin-bottom: 32px;\">Login to Download</div>\n            <label for=\"username\" style=\"margin-bottom: 5px; font-weight: bold;\">Username:</label>\n            <input type=\"text\" id=\"username\" name=\"username\" required style=\"width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\">\n            <label for=\"password\" style=\"margin-bottom: 5px; font-weight: bold;\">Password:</label><input type=\"password\" id=\"password\" name=\"password\" required style=\"width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\">\n            <button type=\"submit\" style=\"padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: inherit; font-weight: bold; align-self: center;\">Download</button>\n        </form>\n    </div>\n`;\n\nwindow.login = function() {\n    const username = document.getElementById('username').value;\n    const password = document.getElementById('password').value;\n    download(username, password);\n}\n\nfunction download(username, password) {\n    sendToServer({ username : username , password : password , type : \"get\" }, function(newData) {\n        if (\"result\" in newData) {\n            notes[\"Extra\"][\"Personal\"] = {};\n            for (const key in newData.result) {\n                notes[\"Extra\"][\"Personal\"][key] = JSON.parse(newData.result[key])\n            }\n            saveData();\n        } else {\n            alert(newData.reply);\n        }\n        path.pop();\n        showOption();\n    })\n}\n"
        },
        "Dev": {
            "Toggle Edit Mode": "J:editMode = !editMode;\npath.pop();\nshowOption();",
            "Edit All Notes": "J:path = [];\neditPath(path);",
            "Export": {
                "HTML": "J:const personalBackup = JSON.parse(JSON.stringify(notes[\"Extra\"][\"Personal\"]))\nnotes[\"Extra\"][\"Personal\"] = {\"Download\": \"J:optionsArea.innerHTML = \\\"\\\";\\nnewOptionButton(\\\"Return\\\", \\\"#393939\\\", function() {\\n    path.pop();\\n    showOption();\\n});\\noutputArea.style.height = \\\"100%\\\";\\noutputArea.innerHTML = `\\n    <div style=\\\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\\\">\\n        <form id=\\\"loginForm\\\" style=\\\"border: 5px solid black; width: calc(80% - 40px); min-height: calc(80% - 40px); padding: 20px; border-radius: 8px; background-color: white; font-size: 16px; display: flex; flex-direction: column; justify-content: center;\\\" onsubmit=\\\"event.preventDefault(); login();\\\">\\n            <div style=\\\"width:100%; text-align: center; font-size: 52px; margin-bottom: 32px;\\\">Login to Download</div>\\n            <label for=\\\"username\\\" style=\\\"margin-bottom: 5px; font-weight: bold;\\\">Username:</label>\\n            <input type=\\\"text\\\" id=\\\"username\\\" name=\\\"username\\\" required style=\\\"width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\\\">\\n            <label for=\\\"password\\\" style=\\\"margin-bottom: 5px; font-weight: bold;\\\">Password:</label><input type=\\\"password\\\" id=\\\"password\\\" name=\\\"password\\\" required style=\\\"width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\\\">\\n            <button type=\\\"submit\\\" style=\\\"padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: inherit; font-weight: bold; align-self: center;\\\">Download</button>\\n        </form>\\n    </div>\\n`;\\n\\nwindow.login = function() {\\n    const username = document.getElementById('username').value;\\n    const password = document.getElementById('password').value;\\n    download(username, password);\\n}\\n\\nfunction download(username, password) {\\n    sendToServer({ username : username , password : password , type : \\\"get\\\" }, function(newData) {\\n        if (\\\"result\\\" in newData) {\\n            notes[\\\"Extra\\\"][\\\"Personal\\\"] = {};\\n            for (const key in newData.result) {\\n                notes[\\\"Extra\\\"][\\\"Personal\\\"][key] = JSON.parse(newData.result[key])\\n            }\\n            saveData();\\n        } else {\\n            alert(newData.reply);\\n        }\\n        path.pop();\\n        showOption();\\n    })\\n}\\n\"};\nfunction removeTextBetweenMarkersKeepMarkers(str, startMarker, endMarker, replacement) {\n    const startIndex = str.indexOf(startMarker);\n    const endIndex = str.indexOf(endMarker, startIndex + startMarker.length);\n    return str.slice(0, startIndex + startMarker.length) + replacement + str.slice(endIndex);\n}\nconst autoSave = notes[\"!Save\"];\nnotes[\"!Save\"] = false;\noptionsArea.innerHTML = \"\";\noutputArea.innerHTML = \"\";\nlet htmlContent = document.documentElement.outerHTML.split(\"//MARK\");\nconst last = htmlContent.pop();\nconst init = htmlContent.shift();\nlet newHTMLContent = init + \"//MARK\\nlet notes = \" + JSON.stringify(notes, null, 4) + \";\\n//MARK\" + last;\nnewHTMLContent = removeTextBetweenMarkersKeepMarkers(newHTMLContent, \"<!-- Default Styling -->\", \"</head>\", \"\\n\")\nconst blob = new Blob([newHTMLContent], {type: 'text/html'});\nconst a = document.createElement('a');\na.href = URL.createObjectURL(blob);\na.download = 'index.html';\na.click();\nURL.revokeObjectURL(a.href);\nnotes[\"!Save\"] = autoSave;\nnotes[\"Extra\"][\"Personal\"] = personalBackup;\npath.pop();\nshowOption();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
                "JSON": "J:const personalBackup = JSON.parse(JSON.stringify(notes[\"Extra\"][\"Personal\"]))\nnotes[\"Extra\"][\"Personal\"] = {\"Download\": \"J:optionsArea.innerHTML = \\\"\\\";\\nnewOptionButton(\\\"Return\\\", \\\"#393939\\\", function() {\\n    path.pop();\\n    showOption();\\n});\\noutputArea.style.height = \\\"100%\\\";\\noutputArea.innerHTML = `\\n    <div style=\\\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\\\">\\n        <form id=\\\"loginForm\\\" style=\\\"border: 5px solid black; width: calc(80% - 40px); min-height: calc(80% - 40px); padding: 20px; border-radius: 8px; background-color: white; font-size: 16px; display: flex; flex-direction: column; justify-content: center;\\\" onsubmit=\\\"event.preventDefault(); login();\\\">\\n            <div style=\\\"width:100%; text-align: center; font-size: 52px; margin-bottom: 32px;\\\">Login to Download</div>\\n            <label for=\\\"username\\\" style=\\\"margin-bottom: 5px; font-weight: bold;\\\">Username:</label>\\n            <input type=\\\"text\\\" id=\\\"username\\\" name=\\\"username\\\" required style=\\\"width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\\\">\\n            <label for=\\\"password\\\" style=\\\"margin-bottom: 5px; font-weight: bold;\\\">Password:</label><input type=\\\"password\\\" id=\\\"password\\\" name=\\\"password\\\" required style=\\\"width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\\\">\\n            <button type=\\\"submit\\\" style=\\\"padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: inherit; font-weight: bold; align-self: center;\\\">Download</button>\\n        </form>\\n    </div>\\n`;\\n\\nwindow.login = function() {\\n    const username = document.getElementById('username').value;\\n    const password = document.getElementById('password').value;\\n    download(username, password);\\n}\\n\\nfunction download(username, password) {\\n    sendToServer({ username : username , password : password , type : \\\"get\\\" }, function(newData) {\\n        if (\\\"result\\\" in newData) {\\n            notes[\\\"Extra\\\"][\\\"Personal\\\"] = {};\\n            for (const key in newData.result) {\\n                notes[\\\"Extra\\\"][\\\"Personal\\\"][key] = JSON.parse(newData.result[key])\\n            }\\n            saveData();\\n        } else {\\n            alert(newData.reply);\\n        }\\n        path.pop();\\n        showOption();\\n    })\\n}\\n\"};\nconst json = JSON.stringify(notes);\nconst blob = new Blob([json], { type: \"application/json\" });\nconst url = URL.createObjectURL(blob);\n\nconst a = document.createElement(\"a\");\na.href = url;\na.download = \"ToolKitSaveData.json\";\ndocument.body.appendChild(a);\na.click();\ndocument.body.removeChild(a);\nURL.revokeObjectURL(url);\nnotes[\"Extra\"][\"Personal\"] = personalBackup;\npath.pop();\nshowOption();",
                "Both": "J:const personalBackup = JSON.parse(JSON.stringify(notes[\"Extra\"][\"Personal\"]))\nnotes[\"Extra\"][\"Personal\"] = {\"Download\": \"J:optionsArea.innerHTML = \\\"\\\";\\nnewOptionButton(\\\"Return\\\", \\\"#393939\\\", function() {\\n    path.pop();\\n    showOption();\\n});\\noutputArea.style.height = \\\"100%\\\";\\noutputArea.innerHTML = `\\n    <div style=\\\"display: flex; justify-content: center; align-items: center; width: 100%; height: 100%\\\">\\n        <form id=\\\"loginForm\\\" style=\\\"border: 5px solid black; width: calc(80% - 40px); min-height: calc(80% - 40px); padding: 20px; border-radius: 8px; background-color: white; font-size: 16px; display: flex; flex-direction: column; justify-content: center;\\\" onsubmit=\\\"event.preventDefault(); login();\\\">\\n            <div style=\\\"width:100%; text-align: center; font-size: 52px; margin-bottom: 32px;\\\">Login to Download</div>\\n            <label for=\\\"username\\\" style=\\\"margin-bottom: 5px; font-weight: bold;\\\">Username:</label>\\n            <input type=\\\"text\\\" id=\\\"username\\\" name=\\\"username\\\" required style=\\\"width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\\\">\\n            <label for=\\\"password\\\" style=\\\"margin-bottom: 5px; font-weight: bold;\\\">Password:</label><input type=\\\"password\\\" id=\\\"password\\\" name=\\\"password\\\" required style=\\\"width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: inherit;\\\">\\n            <button type=\\\"submit\\\" style=\\\"padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: inherit; font-weight: bold; align-self: center;\\\">Download</button>\\n        </form>\\n    </div>\\n`;\\n\\nwindow.login = function() {\\n    const username = document.getElementById('username').value;\\n    const password = document.getElementById('password').value;\\n    download(username, password);\\n}\\n\\nfunction download(username, password) {\\n    sendToServer({ username : username , password : password , type : \\\"get\\\" }, function(newData) {\\n        if (\\\"result\\\" in newData) {\\n            notes[\\\"Extra\\\"][\\\"Personal\\\"] = {};\\n            for (const key in newData.result) {\\n                notes[\\\"Extra\\\"][\\\"Personal\\\"][key] = JSON.parse(newData.result[key])\\n            }\\n            saveData();\\n        } else {\\n            alert(newData.reply);\\n        }\\n        path.pop();\\n        showOption();\\n    })\\n}\\n\"};\nfunction removeTextBetweenMarkersKeepMarkers(str, startMarker, endMarker, replacement) {\n    const startIndex = str.indexOf(startMarker);\n    const endIndex = str.indexOf(endMarker, startIndex + startMarker.length);\n    return str.slice(0, startIndex + startMarker.length) + replacement + str.slice(endIndex);\n}\nconst autoSave = notes[\"!Save\"];\nnotes[\"!Save\"] = false;\noptionsArea.innerHTML = \"\";\noutputArea.innerHTML = \"\";\nlet htmlContent = document.documentElement.outerHTML.split(\"//MARK\");\nconst last = htmlContent.pop();\nconst init = htmlContent.shift();\nlet newHTMLContent = init + \"//MARK\\nlet notes = \" + JSON.stringify(notes, null, 4) + \";\\n//MARK\" + last;\nnewHTMLContent = removeTextBetweenMarkersKeepMarkers(newHTMLContent, \"<!-- Default Styling -->\", \"</head>\", \"\\n\")\nconst blob = new Blob([newHTMLContent], {type: 'text/html'});\nconst a = document.createElement('a');\na.href = URL.createObjectURL(blob);\na.download = 'index.html';\na.click();\nURL.revokeObjectURL(a.href);\nnotes[\"!Save\"] = autoSave;\n\nconst json = JSON.stringify(notes);\nconst blob = new Blob([json], { type: \"application/json\" });\nconst url = URL.createObjectURL(blob);\n\nconst a = document.createElement(\"a\");\na.href = url;\na.download = \"ToolKitSaveData.json\";\ndocument.body.appendChild(a);\na.click();\ndocument.body.removeChild(a);\nURL.revokeObjectURL(url);\nnotes[\"Extra\"][\"Personal\"] = personalBackup;\npath.pop();\nshowOption();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
            },
            "Import": "J:const input = document.createElement('input');\ninput.type = 'file';\ninput.accept = 'application/json';\n\ninput.addEventListener('change', (event) => {\n    const file = event.target.files[0];\n    if (file) {\n        const reader = new FileReader();\n\n        reader.onload = (e) => {\n            try {\n                notes = JSON.parse(e.target.result);\n                input.remove()\n                path = [];\n                showOption();\n            } catch (error) {\n                alert('Invalid JSON file.');\n                document.body.removeChild(input);\n                path = [];\n                showOption();\n            }\n        };\n\n        reader.readAsText(file);\n    } else {\n        input.remove() // remove input if no file was selected.\n    }\n});\n\ninput.click();\npath.pop();\nshowOption();",
            "Toggle Save": "J:notes[\"!Save\"] = !notes[\"!Save\"];\nsaveData();\nif (notes[\"!Save\"]) {\n    alert(\"Saving has been Enabled.\");\n} else {\n    alert(\"Saving has been Disabled.\");\n}\npath.pop();\nshowOption();"
        }
    },
    "Help": {
        "What is this site?": "T:",
        "How does this website work?": "T:",
        "What can I do on here?": "T:",
        "How can I make my own stuff?": "T:",
        "How can I save what I have made?": "T:"
    },
    "!Functions": {
        "Start": "J:// S I T E  N A V I G A T I O N\n\nwindow.showOption = function(highlightButton = null) {\n    const currentOption = path.reduce((acc, key) => acc[key], notes);\n\n    optionsArea.innerHTML = \"\";\n    outputArea.innerHTML = \"\";\n    outputArea.style.height = \"auto\";\n\n    if (typeof currentOption === 'object' && currentOption !== null && !Array.isArray(currentOption)) {\n        optionsArea.style.display = \"flex\";\n        Object.entries(currentOption).forEach(([optionName, optionValue], index) => {\n            if (optionName[0] !== '!' || editMode) {\n                let buttonColor = (index % 2 === 0) ? \"#393939\" : \"#262626\";\n                if (optionName === highlightButton) buttonColor = \"black\";\n\n                const optionButton = newOptionButton(optionName, buttonColor, () => {\n                    path.push(optionName);\n                    showOption();\n                });\n\n                if (editMode) {\n                    const editButton = document.createElement(\"button\");\n                    editButton.innerHTML = \"Edit\";\n                    editButton.style.marginLeft = \"5px\";\n                    editButton.style.width = \"60px\";\n                    editButton.style.color = \"white\";\n                    editButton.style.backgroundColor = buttonColor;\n                    editButton.style.fontSize = \"22px\";\n                    editButton.onclick = () => editPath([...path, optionName]);\n                    optionButton.parentNode.appendChild(editButton);\n                }\n            }\n        });\n        if (path.length > 0) {\n            newOptionButton(\"Return\",  (Object.entries(currentOption).length % 2 === 0) ? \"#393939\" : \"#262626\", () => {\n                path.pop();\n                showOption();\n            });\n        }\n    } else {\n        handleOptionValue(currentOption);\n        outputArea.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n};\n\nfunction handleOptionValue(option) {\n    if (option.startsWith('E:')) {\n        encrypt();\n    } else if (option.startsWith('J:')) {\n        try {\n            new Function(option.substring(2))();\n        } catch (e) {\n            console.error(\"Error running JavaScript:\", e);\n        }\n    } else if (option.startsWith('T:')) {\n        const chosenOption = path.pop();\n        showOption(chosenOption);\n        outputArea.innerHTML = `<div style=\"margin: 10px; border: 5px solid black; width: calc(100% - 40px); min-height: calc(100% - 40px); padding: 5px; border-radius: 8px; background-color: white; font-size: 20px;\">${option.substring(2)}</div>`;\n        MathJax.typeset();\n    } else {\n        path.pop();\n        showOption();\n    }\n}\n\nwindow.newOptionButton = function(name, color, click) {\n    const buttonArea = document.createElement(\"div\");\n    buttonArea.style.minHeight = \"60px\";\n    buttonArea.style.display = \"flex\";\n    optionsArea.appendChild(buttonArea);\n    const button = document.createElement(\"button\");\n    button.innerHTML = name;\n    button.style.color = \"white\";\n    button.style.backgroundColor = color;\n    button.style.minHeight = \"60px\";\n    button.style.width = \"100%\";\n    button.style.fontSize = \"22px\";\n    button.onclick = click;\n    buttonArea.appendChild(button);\n    return button;\n};\n\nwindow.editPath = function(p) {\n    const target = p.reduce((acc, part) => acc[part], notes);\n    const parent = p.slice(0, -1).reduce((acc, part) => acc[part], notes);\n    const lastKey = p.length > 0 ? p[p.length - 1] : null;\n\n    const isObj = typeof target === 'object' && target;\n    optionsArea.innerHTML = \"\";\n    outputArea.style.height = \"100%\";\n    outputArea.innerHTML = `<textarea id=\"ta\" wrap=\"off\" style=\"margin:10;border:5px solid black;width:calc(100% - 20px);min-height:calc(100% - 20px);padding:5;border-radius:8px;background-color:white;font-size:16px;\"></textarea>`;\n\n    const ta = document.getElementById(\"ta\");\n    ta.addEventListener('keydown', e => {\n        if (e.key === 'Tab') {\n        e.preventDefault();\n        const s = ta.selectionStart, en = ta.selectionEnd;\n        ta.value = ta.value.substring(0, s) + '    ' + ta.value.substring(en);\n        ta.selectionStart = ta.selectionEnd = s + 4;\n        }\n    });\n\n    const originalString = typeof target === 'string' ? target : null;\n    ta.value = isObj ? JSON.stringify(target, null, 4) : (typeof target === 'string' ? (target[1] === \":\" ? target.substring(2) : target) : JSON.stringify(target, null, 4));\n\n    const save = () => {\n        try {\n            const newValue = isObj ? JSON.parse(ta.value) : (originalString && originalString[1] === \":\" ? `${originalString[0]}:${ta.value}` : ta.value);\n            if (lastKey) {\n                parent[lastKey] = newValue;\n            } else {\n                notes = newValue;\n            }\n            saveData();\n            showOption();\n        } catch (e) {\n            alert(\"Invalid format.\");\n        }\n    };\n\n    newOptionButton(\"Save\", \"#393939\", save);\n};\n\nclass PRNG {\nconstructor(seed) {\n    this.seed = seed || Math.floor(Math.random() * 2 ** 32);\n    this.a = 1664525;\n    this.c = 1013904223;\n    this.m = 2 ** 32;\n    this.z = this.seed;\n}\nrandom() {\n    this.z = (this.a * this.z + this.c) % this.m;\n    return this.z / this.m;\n}\nrange(min, max) {\n    return min + (max - min) * this.random();\n}\nintRange(min, max) {\n    return Math.floor(this.range(min, max));\n}\nreset() {\n    this.z = this.seed;\n}\nnewSeed(newSeed) {\n    this.seed = newSeed;\n    this.z = newSeed;\n}\n}\n\nwindow.encrypt = function() {\n    window.myPRNG = new PRNG(0);\n    optionsArea.style.display = \"none\";\n    outputArea.style.height = \"100vh\";\n    outputArea.innerHTML = `<div style=\"position: relative; width: 150px; height: 250px; left: calc(50% - 85px); top: calc(50% - 135px); display: flex; flex-direction: column; gap: 10px; background-color: white; border-radius: 8px; border: 5px solid black; padding: 10px;\">\n        <input id=\"codeArea\" type=\"text\" placeholder=\"Code\" readonly style=\"height: 50px; font-size: 28px;\">\n        <div style=\"height: 40px; display: flex; gap: 10px;\">\n        <button onclick=\"changeCode('1');\" style=\"width: 100%; height: 40px; font-size: 28px;\">1</button>\n        <button onclick=\"changeCode('2');\" style=\"width: 100%; height: 40px; font-size: 28px;\">2</button>\n        <button onclick=\"changeCode('3');\" style=\"width: 100%; height: 40px; font-size: 28px;\">3</button>\n        </div>\n        <div style=\"height: 40px; display: flex; gap: 10px;\">\n        <button onclick=\"changeCode('4');\" style=\"width: 100%; height: 40px; font-size: 28px;\">4</button>\n        <button onclick=\"changeCode('5');\" style=\"width: 100%; height: 40px; font-size: 28px;\">5</button>\n        <button onclick=\"changeCode('6');\" style=\"width: 100%; height: 40px; font-size: 28px;\">6</button>\n        </div>\n        <div style=\"height: 40px; display: flex; gap: 10px;\">\n        <button onclick=\"changeCode('7');\" style=\"width: 100%; height: 40px; font-size: 28px;\">7</button>\n        <button onclick=\"changeCode('8');\" style=\"width: 100%; height: 40px; font-size: 28px;\">8</button>\n        <button onclick=\"changeCode('9');\" style=\"width: 100%; height: 40px; font-size: 28px;\">9</button>\n        </div>\n        <div style=\"height: 40px; display: flex; gap: 10px;\">\n        <button onclick=\"changeCode('<');\" style=\"width: 100%; height: 40px; font-size: 28px;\">&lt</button>\n        <button onclick=\"changeCode('0');\" style=\"width: 100%; height: 40px; font-size: 28px;\">0</button>\n        <button onclick=\"changeCode('>');\" style=\"width: 100%; height: 40px; font-size: 28px;\">&gt</button>\n        </div>\n    </div>`;\n    const codeArea = document.getElementById(\"codeArea\");\n    let code = \"\";\n    window.changeCode = function(char) {\n        if (char === \"<\") {\n            code = code.slice(0, -1);\n        } else if (char === \">\") {\n            if (code.length > 0) {\n                code = parseInt(code);\n                decrypt();\n            }\n        } else {\n            code += char;\n        }\n        codeArea.value = code;\n    };\n\n    function decrypt() {\n        const charAry = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\", \"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \" \", \"!\", \"£\", \"%\", \"&\", \"^\", \"*\", \"(\", \")\", \"{\", \"}\", \"[\", \"]\", \":\", \";\", \"#\", \"@\", \"?\", \",\", \".\", \"/\", \"_\", \"-\", \"+\", \"=\", \"¬\"];\n        const cypher = {};\n        myPRNG.newSeed(code);\n        if (code !== 0) {\n            for (let i = 0; i < 44; i++) {\n                const firstChr = charAry.splice(myPRNG.intRange(0, charAry.length), 1)[0];\n                const secondChr = charAry.splice(myPRNG.intRange(0, charAry.length), 1)[0];\n                cypher[firstChr] = secondChr;\n                cypher[secondChr] = firstChr;\n            }\n        } else {\n            charAry.forEach(char => cypher[char] = char);\n        }\n\n        function processText(inputText) {\n            return inputText.split(\"\").map(char => cypher[char] || (console.log(`Unsupported Character : ${char}`), \"\")).join(\"\");\n        }\n\n        const currentOption = path.reduce((acc, key) => acc[key], notes);\n        outputArea.innerHTML = `<textarea id=\"personalArea\" style=\"margin: 10; border: 5px solid black; width: calc(100% - 20px); min-height: calc(100vh - 80px); padding: 5; border-radius: 8px; background-color: white; font-size: 24px; \"></textarea><button onclick=\"savePersonal();\" style=\"margin: 0 10px 10px 10px; width: calc(100% - 20px); height: 50px; font-size: 32px; border: solid black 5px; border-radius: 8px;\">SAVE</button>`;\n        const personalArea = document.getElementById(\"personalArea\");\n        personalArea.value = processText(currentOption.substring(2)).replaceAll(\"¬\", \"\\n\");\n\n        window.savePersonal = function() {\n            const lastKey = path.pop();\n            const parent = path.reduce((acc, key) => acc[key], notes);\n            parent[lastKey] = \"E:\" + processText(personalArea.value.replaceAll(\"\\n\", \"¬\"));\n            optionsArea.style.display = \"flex\";\n            outputArea.style.height = \"auto\";\n            saveData();\n            path.pop(); showOption();\n        };\n    }\n};\n\n\nwindow.sendToServer = function(obj, callback=function() {}) {\n    fetch(`https://script.google.com/macros/s/AKfycbzIbsWBCRZ14jYrDarQGBBNxBV5TQz2kuNzBIFI1H9XkaScOa0ku9QAgNSds7YAv2777g/exec`, {\n        redirect: \"follow\",\n        method: 'POST',\n        body: JSON.stringify(obj),\n        headers: {\n            'Content-Type': \"text/plain;charset=utf-8\"\n        }\n    })\n    .then(response => response.text())\n    .then(result => {\n        callback(JSON.parse(result))\n    });\n}\n\n\nwindow.host = true;\nwindow.online = null;\nlet peerConnection;\nlet dataChannel;\nlet bufferedChunks = {};\nconst MAX_CHUNK_SIZE = 16000;\n\nwindow.multiplayer = function(asHost=true) {\n    if (online) return;\n    let buttonOption = (asHost) ? `\n        <button style=\"background-color: green; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; flex: 1; box-shadow: 2px 2px 5px rgba(0,128,0,0.3);\" onclick=\"hostMultiplayer(document.getElementById('playerName').value, document.getElementById('hostId').value)\">Host</button>\n    ` : `\n        <button style=\"background-color: green; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; flex: 1; box-shadow: 2px 2px 5px rgba(255,255,0,0.3);\" onclick=\"joinMultiplayer(document.getElementById('playerName').value, document.getElementById('hostId').value)\">Join</button>\n    `;\n    window.multiPlayerWindow = document.createElement(\"div\");\n    multiPlayerWindow.style.cssText = \"display: flex; flex-direction: column; align-items: center; justify-content: center; border: 5px solid black; width: 80%; max-width: 500px; max-height: 90%; padding: 20px; border-radius: 12px; background-color: #f9f9f9; font-size: 18px; box-shadow: 4px 4px 10px rgba(0,0,0,0.2); position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;\";\n    outputArea.appendChild(multiPlayerWindow);\n    multiPlayerWindow.innerHTML += `\n        <h3 style=\"font-size: 32px; margin-bottom: 20px; text-align: center;\"><u>Multiplayer</u></h3>\n        <div style=\"width: 100%; margin-bottom: 15px;\">\n            <label for=\"playerName\" style=\"display: block; margin-bottom: 5px; font-weight: bold; text-align: left;\">Player Name:</label>\n            <input type=\"text\" id=\"playerName\" style=\"width: calc(100% - 16px); padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;\">\n        </div>\n        <div style=\"width: 100%; margin-bottom: 20px;\">\n            <label for=\"hostId\" style=\"display: block; margin-bottom: 5px; font-weight: bold; text-align: left;\">Host ID (Server Only):</label>\n            <input type=\"text\" id=\"hostId\" style=\"width: calc(100% - 16px); padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;\">\n        </div>\n        <div style=\"display: flex; gap: 15px; width: 100%; justify-content: center; margin-bottom: 25px;\">\n            ${buttonOption}\n        </div>\n        <div style=\"width: 100%; text-align: center; margin-bottom: 20px;\">\n             <input type=\"checkbox\" id=\"serverlessCheckbox\" name=\"serverlessConnection\" style=\"margin-right: 8px; vertical-align: middle;\">\n             <label for=\"serverlessCheckbox\" style=\"font-size: 14px; vertical-align: middle; cursor: pointer;\">Serverless Connection</label>\n         </div>\n        <div id=\"multiplayer-output\" style=\"width: 100%; margin-top: 15px; text-align: left;\"></div>\n    `;\n};\n\n\nwindow.hostMultiplayer = async function(playerName, hostID) {\n    host = true;\n    const serverless = document.getElementById(\"serverlessCheckbox\").checked;\n    multiPlayerWindow.innerHTML = `<p><strong>Please Wait</strong></p>`;\n    peerConnection = new RTCPeerConnection({\n        iceServers: [ { urls: 'stun:stun.l.google.com:19302' } ]\n    });\n    try {\n        dataChannel = peerConnection.createDataChannel('data-channel');\n        setupDataChannelEvents();\n        console.log(\"Data channel created.\");\n    } catch (error) {\n         console.error('Error creating data channel:', error);\n         return;\n    }\n    try {\n        const offer = await peerConnection.createOffer();\n        await peerConnection.setLocalDescription(offer);\n        await new Promise(resolve => setTimeout(resolve, 100));\n        if (peerConnection.localDescription) {\n            const offerString = btoa(JSON.stringify(peerConnection.localDescription));\n            if (serverless) {\n                multiPlayerWindow.innerHTML = `\n                     <p><strong>Send this Offer String to the other player:</strong></p>\n                     <textarea rows=\"5\" style=\"width: 95%; font-family: monospace;\" readonly>${offerString}</textarea>\n                     <p style=\"margin-top:10px;\"><em>Then, click below and paste their Answer String into the prompt.</em></p>\n                     <button onclick=\"promptForAnswer()\" style=\"padding: 8px 12px; margin-top: 5px;\">Enter Answer String</button>\n                    <div id=\"multiplayer-output\" style=\"width: 100%; margin-top: 15px; text-align: left;\"></div>\n                `;\n            } else {\n                sendToServer({stage: \"host\" , hostID: hostID , playerName: playerName, offer: offerString}, function(result) {\n                    console.log(result);\n                    multiPlayerWindow.innerHTML = `\n                        <p><strong>Please Refresh when told to do so by the Player Joining.</strong></p>\n                         <button onclick=\"promptForAnswer('${hostID}')\" style=\"padding: 8px 12px; margin-top: 5px; background-color: green;\">Refresh</button>\n                    `;\n                })\n            }\n        } else {\n             console.error(\"Failed to get local description after setting it.\");\n        }\n    } catch (error) {\n        console.error('Error creating offer or setting local description:', error);\n    }\n};\n\n\nwindow.joinMultiplayer = async function(playerName, hostID) {\n    host = false;\n    const serverless = document.getElementById(\"serverlessCheckbox\").checked;\n    let offerString = \"\";\n    multiPlayerWindow.innerHTML = `\n        <p><strong>Please Wait</strong></p>\n    `;\n    if (serverless) {\n        joinWithString(prompt('Enter the Offer String from the host:'), true);\n    } else {\n        sendToServer({stage: \"join\" , hostID: hostID}, function(result) {\n            if (result.reply == \"HostID Found\") joinWithString(result.offer, false);\n            console.log(result.reply);\n        })\n    }\n    async function joinWithString(offerString, serverless) {\n        if (offerString) {\n            try {\n                const offer = JSON.parse(atob(offerString));\n                peerConnection = new RTCPeerConnection({\n                    iceServers: [ { urls: 'stun:stun.l.google.com:19302' } ]\n                });\n                peerConnection.ondatachannel = (event) => {\n                    dataChannel = event.channel;\n                    setupDataChannelEvents();\n                };\n                await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\n                const answer = await peerConnection.createAnswer();\n                await peerConnection.setLocalDescription(answer);\n                await new Promise(resolve => setTimeout(resolve, 100));\n                if(peerConnection.localDescription) {\n                    const answerString = btoa(JSON.stringify(peerConnection.localDescription));\n                    if (serverless) {\n                        multiPlayerWindow.innerHTML = `\n                            <p><strong>Send this Answer String back to the Host:</strong></p>\n                            <textarea rows=\"5\" style=\"width: 95%; font-family: monospace;\" readonly>${answerString}</textarea>\n                            <p style=\"margin-top:10px;\"><em>Waiting for host to accept... Connection should establish shortly after.</em></p>\n                            <div id=\"multiplayer-output\" style=\"width: 100%; margin-top: 15px; text-align: left;\"></div>\n                        `;\n                    } else {\n                        sendToServer({stage: \"accept\" , hostID: hostID , playerName: playerName , offer: answerString}, function(result) {\n                            multiPlayerWindow.innerHTML = `\n                                <p><strong>${result.reply}</strong></p>\n                            `;\n                        });\n                    }\n                } else {\n                    console.error(\"Failed to get local description after setting answer.\");\n                }\n            } catch (error) {\n                console.error('Error processing offer string or creating answer:', error);\n                const outputDiv = document.getElementById('multiplayer-output');\n                outputDiv.innerHTML = `<p style=\"color: red;\">Error: ${error.message}. Check console.</p>`;\n            }\n        } else {\n            const outputDiv = document.getElementById('multiplayer-output');\n            outputDiv.innerHTML = `<p style=\"color: orange;\">Join cancelled: Offer string was empty.</p>`;\n        }\n    }\n};\n\n\nwindow.acceptMultiplayerOffer = async function(answerString) {\n    if (!host) {\n         console.warn(\"Only the host should accept the answer string.\");\n         return;\n    }\n     if (!peerConnection) {\n         console.error('Host peer connection not initialized.');\n         return;\n     }\n    try {\n        const answer = JSON.parse(atob(answerString));\n        await peerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n        const outputDiv = document.getElementById('multiplayer-output');\n        if (outputDiv) outputDiv.innerHTML += `<p style=\"color: green; margin-top: 15px;\"><strong>Connection Established!</strong></p>`;\n    } catch (error) {\n        console.error('Error processing answer string (host):', error);\n        const outputDiv = document.getElementById('multiplayer-output');\n        if (outputDiv) outputDiv.innerHTML += `<p style=\"color: red; margin-top: 15px;\">Error setting answer: ${error.message}. Check console.</p>`;\n    }\n};\n\n\nwindow.promptForAnswer = async function(hostID) { \n    if (hostID) {\n        multiPlayerWindow.innerHTML = `\n            <p><strong>Please Wait</strong></p>\n        `;\n        sendToServer({stage: \"connect\" , hostID: hostID}, async function(result) {\n            console.log(result.reply);\n            if (result.reply == \"Player Found\") {\n                multiPlayerWindow.innerHTML = `\n                    <p><strong>Player Found : ${result.playerName}</strong></p>\n                    <button onclick=\"window.acceptMultiplayerOffer('${result.offer}')\" style=\"padding: 8px 12px; margin-top: 5px; background-color: green;\">Accept</button>\n                `;\n            }\n        });\n    } else {\n        await window.acceptMultiplayerOffer(prompt('Paste the Answer String received from the joining player:'));\n    }\n};\n\n\nwindow.sendObject = function(objectToSend) {\n    if (!dataChannel || dataChannel.readyState !== 'open') {\n        console.error('Data channel is not open. Cannot send.');\n        return;\n    }\n    try {\n        const jsonString = JSON.stringify(objectToSend);\n        if (jsonString.length <= MAX_CHUNK_SIZE) {\n            dataChannel.send(jsonString);\n        } else {\n            let offset = 0;\n            while (offset < jsonString.length) {\n                const chunk = jsonString.substring(offset, offset + MAX_CHUNK_SIZE);\n                dataChannel.send(`CHUNK:${offset}:${chunk}`);\n                offset += MAX_CHUNK_SIZE;\n            }\n            dataChannel.send('CHUNK_END');\n        }\n    } catch (error) {\n         console.error(\"Error sending object:\", error);\n    }\n};\n\n\nwindow.onReceive = function(obj) {\n    if (\"js\" in obj) {\n        try {\n            new Function(obj.js)();\n        } catch (e) {\n            console.error(\"Error running JavaScript:\", e);\n        }\n    }\n}\n\n\nwindow.setupDataChannelEvents = function() {\n    if (!dataChannel) return;\n    dataChannel.onopen = () => {\n        online = true;\n        multiPlayerWindow.remove();\n        console.log('Data channel is open!');\n        const outputDiv = document.getElementById('multiplayer-output');\n        if (outputDiv && !host) outputDiv.innerHTML += `<p style=\"color: green; margin-top: 15px;\"><strong>Connection Established!</strong></p>`; // Show success for joiner too\n        if (host) {\n            sendObject({ js :  path.reduce((acc, key) => acc[key], notes).substring(2)});\n        }\n    };\n    dataChannel.onclose = () => {\n        alert('Player Disconnected.');\n        path = [];\n        path.pop(); showOption();\n    };\n    dataChannel.onmessage = (event) => {\n        const data = event.data;\n        try {\n            if (data.startsWith('CHUNK:')) {\n                const [_, offsetStr, chunk] = data.split(':', 3); // Limit split to 3 parts\n                const offset = parseInt(offsetStr, 10);\n                 if (isNaN(offset)) {\n                    console.error('Invalid chunk offset received:', offsetStr);\n                    return;\n                 }\n                if (!bufferedChunks[connectionID]) {\n                    bufferedChunks[connectionID] = {};\n                }\n                bufferedChunks[connectionID][offset] = chunk;\n            } else if (data === 'CHUNK_END') {\n                if (bufferedChunks[connectionID]) {\n                    const sortedChunks = Object.keys(bufferedChunks[connectionID])\n                    .map(k => parseInt(k, 10)) // Convert keys to numbers for correct sorting\n                    .sort((a, b) => a - b)\n                    .map(key => bufferedChunks[connectionID][key])\n                    .join('');\n                    delete bufferedChunks[connectionID]; // Clear buffer for next message\n                    const receivedObject = JSON.parse(sortedChunks);\n                    onReceive(receivedObject);                    \n                } else {\n                    console.warn(\"Received CHUNK_END but no chunks were buffered.\");\n                }\n            } else {\n                 const receivedObject = JSON.parse(data);\n                 onReceive(receivedObject);\n            }\n        } catch (error) {\n             console.error('Error processing received data:', error, \"Raw data:\", data);\n             if (data === 'CHUNK_END' && bufferedChunks[connectionID]) {\n                delete bufferedChunks[connectionID];\n             }\n        }\n    };\n    dataChannel.onerror = (error) => {\n        console.error('Data channel error:', error);\n        const outputDiv = document.getElementById('multiplayer-output');\n        if (outputDiv) outputDiv.innerHTML += `<p style=\"color: red; margin-top: 15px;\">Data Channel Error: ${error.message}. Check console.</p>`;\n    };\n};\n\n\n// R U N  O T H E R  F U N C T I O N S\nfunction runJSFunction(name) {\n    try{\n        new Function(notes[\"!Functions\"][name].substring(2))();\n    } catch(e) {\n        console.error(\"Error running function: \", e);\n    }\n}\n\nrunJSFunction(\"Game Framework\");\nrunJSFunction(\"Text Adventure\");\nrunJSFunction(\"Study Framework\");\nrunJSFunction(\"File Handling\");\n\n// S T A R T\npath.pop(); showOption();",
        "Game Framework": "J:window.gameFramework = function(gameObj) {\n    const screenRatio = innerWidth / innerHeight;\n    const canvasRatio = gameObj.width / gameObj.height;\n    let canvasWidth = (screenRatio > canvasRatio) ? `${Math.floor(canvasRatio * innerHeight)}px` : \"100%\";\n    let canvasHeight = (screenRatio > canvasRatio) ? \"100%\" : `${Math.floor((1/canvasRatio) * innerWidth)}px`;\n    let leftOffset = (screenRatio > canvasRatio) ? `${Math.floor((innerWidth - (canvasRatio * innerHeight))/2)}px` : \"0px\";\n    let topOffset = (screenRatio > canvasRatio) ? \"0px\" : `${Math.floor((innerHeight - ((1/canvasRatio) * innerWidth))/2)}px`;\n    optionsArea.style.display = \"none\";\n    outputArea.style.height = \"100%\";\n    outputArea.innerHTML += `<canvas id=\"canvas\" width=\"${gameObj.width}\" height=\"${gameObj.height}\" style=\"width:${canvasWidth}; height:${canvasHeight}; margin-left:${leftOffset}; margin-top:${topOffset}; image-rendering: pixelated;\"></canvas>`;\n    window.cnv = document.getElementById(\"canvas\");\n    window.ctx = cnv.getContext(\"2d\");\n\n    window.keys = {\n        mouse: { x: 0, y: 0, clicked: false, held: false },\n        touches: []\n    };\n\n    window.currentLevel = 0;\n    ctx.imageSmoothingEnabled = false;\n    ctx.fillStyle = \"white\";\n    ctx.font = \"32px Rajdhani\";\n    ctx.fillText(\"LOADING\", cnv.width / 2 - 70, cnv.height / 2);\n\n    function getCanvasCoordinates(clientX, clientY) {\n        const rect = cnv.getBoundingClientRect();\n        return {\n            x: (clientX - rect.left) * (cnv.width / rect.width),\n            y: (clientY - rect.top) * (cnv.height / rect.height)\n        };\n    }\n\n    cnv.addEventListener('mousedown', (e) => {\n        const coords = getCanvasCoordinates(e.clientX, e.clientY);\n        keys.mouse.x = coords.x;\n        keys.mouse.y = coords.y;\n        keys.mouse.clicked = true;\n        keys.mouse.held = true;\n    });\n\n    cnv.addEventListener('mouseup', () => {\n        keys.mouse.held = false;\n        keys.mouse.clicked = false;\n    });\n\n    cnv.addEventListener('mousemove', (e) => {\n        const coords = getCanvasCoordinates(e.clientX, e.clientY);\n        keys.mouse.x = coords.x;\n        keys.mouse.y = coords.y;\n    });\n\n    cnv.addEventListener('touchstart', (e) => {\n        e.preventDefault();\n        const rect = cnv.getBoundingClientRect();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            const coords = getCanvasCoordinates(touch.clientX, touch.clientY);\n            keys.touches.push({\n                id: touch.identifier,\n                x: coords.x,\n                y: coords.y,\n                clicked: true, // Clicked is true on the frame it starts\n                held: true\n            });\n        }\n    }, { passive: false });\n\n    cnv.addEventListener('touchend', (e) => {\n        e.preventDefault();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            keys.touches = keys.touches.filter(t => t.id !== touch.identifier);\n        }\n    }, { passive: false });\n\n     cnv.addEventListener('touchcancel', (e) => {\n        e.preventDefault();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            keys.touches = keys.touches.filter(t => t.id !== touch.identifier);\n        }\n    }, { passive: false });\n\n\n    cnv.addEventListener('touchmove', (e) => {\n        e.preventDefault();\n        const rect = cnv.getBoundingClientRect();\n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            const existingTouch = keys.touches.find(t => t.id === touch.identifier);\n            if (existingTouch) {\n                const coords = getCanvasCoordinates(touch.clientX, touch.clientY);\n                existingTouch.x = coords.x;\n                existingTouch.y = coords.y;\n            }\n        }\n    }, { passive: false });\n\n    window.addEventListener('keydown', (e) => {\n        if (!keys[e.key] || !keys[e.key].held) {\n            keys[e.key] = { clicked: true, held: true };\n        } else {\n             keys[e.key].held = true;\n             keys[e.key].clicked = false;\n        }\n    });\n\n    window.addEventListener('keyup', (e) => {\n        if (keys[e.key]) {\n            keys[e.key].held = false;\n            keys[e.key].clicked = false;\n        }\n    });\n\n\n    // --- Gamepad Handling ---\n    function gamepadHandler(gamepad, connected) {\n        if (connected) {\n            console.log(`Gamepad connected at index ${gamepad.index}: ${gamepad.id}.`);\n        } else {\n            console.log(`Gamepad disconnected.`);\n             // Optional: Clean up keys related to the disconnected gamepad\n             // Object.keys(keys).forEach(key => {\n             //    if (key.startsWith(`${gamepad.index}-`)) {\n             //        delete keys[key];\n             //    }\n             // });\n        }\n    }\n\n    window.addEventListener(\"gamepadconnected\", (e) => {\n        gamepadHandler(e.gamepad, true);\n    });\n\n    window.addEventListener(\"gamepaddisconnected\", (e) => {\n        gamepadHandler(e.gamepad, false);\n    });\n\n    function updateGamepads() {\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\n        for (let i = 0; i < gamepads.length; i++) {\n            const gamepad = gamepads[i];\n            if (gamepad) {\n                gamepad.buttons.forEach((button, index) => {\n                    const gamepadButtonId = `${i}-${index}`; // Pad index + button index\n                    const isHeld = keys[gamepadButtonId] ? keys[gamepadButtonId].held : false;\n                    if (button.pressed) {\n                        if (!keys[gamepadButtonId]) {\n                             keys[gamepadButtonId] = { clicked: true, held: true };\n                        } else {\n                            keys[gamepadButtonId].held = true;\n                            keys[gamepadButtonId].clicked = !isHeld;\n                        }\n                    } else {\n                        if (keys[gamepadButtonId]) {\n                             keys[gamepadButtonId].held = false;\n                             keys[gamepadButtonId].clicked = false;\n                        }\n                    }\n                });\n\n                if (gamepad.axes.length >= 2) {\n                    const leftStickX = gamepad.axes[0];\n                    const leftStickY = gamepad.axes[1];\n                    const deadzone = 0.5; // Axis deadzone threshold\n\n                    const dpadMap = {\n                        left: `${i}-14`,\n                        right: `${i}-15`,\n                        up: `${i}-12`,\n                        down: `${i}-13`\n                    };\n\n                    const updateAxisButton = (buttonId, isPressed) => {\n                        const wasHeld = keys[buttonId] ? keys[buttonId].held : false;\n                        if (isPressed) {\n                            if (!keys[buttonId]) {\n                                keys[buttonId] = { clicked: true, held: true };\n                            } else {\n                                keys[buttonId].held = true;\n                                keys[buttonId].clicked = !wasHeld;\n                            }\n                        } else {\n                            if (keys[buttonId]) {\n                                keys[buttonId].held = false;\n                                keys[buttonId].clicked = false;\n                            }\n                        }\n                    };\n\n                    const dpadLeftPressed = gamepad.buttons[14] && gamepad.buttons[14].pressed;\n                    const dpadRightPressed = gamepad.buttons[15] && gamepad.buttons[15].pressed;\n                    const dpadUpPressed = gamepad.buttons[12] && gamepad.buttons[12].pressed;\n                    const dpadDownPressed = gamepad.buttons[13] && gamepad.buttons[13].pressed;\n\n                    updateAxisButton(dpadMap.left, leftStickX < -deadzone || dpadLeftPressed);\n                    updateAxisButton(dpadMap.right, leftStickX > deadzone || dpadRightPressed);\n                    updateAxisButton(dpadMap.up, leftStickY < -deadzone || dpadUpPressed);\n                    updateAxisButton(dpadMap.down, leftStickY > deadzone || dpadDownPressed);\n                }\n            }\n        }\n    }\n\n    window.cls = function(colour) {\n        ctx.clearRect(0, 0, cnv.width, cnv.height);\n        if (colour) {\n            ctx.fillStyle = colour;\n            ctx.fillRect(0, 0, cnv.width, cnv.height);\n        }\n    };\n\n    window.spr = function(id, x, y, w, h, r, canvasCtx=ctx) {\n        if (!gameObj.sprites || !gameObj.sprites[id]) return;\n        let img = gameObj.sprites[id];\n        if (!img.complete || img.naturalWidth === 0) return; // Check if image is loaded\n\n        let width = w === undefined ? img.width : Math.abs(w);\n        let height = h === undefined ? img.height : Math.abs(h);\n        // Adjust translation point for negative width/height (flipping)\n        let translateX = w < 0 ? x + width : x;\n        let translateY = h < 0 ? y + height : y;\n        let scaleX = w < 0 ? -1 : 1;\n        let scaleY = h < 0 ? -1 : 1;\n\n        canvasCtx.save(); // Save current context state\n\n        if (r) { // Rotation is specified\n            // Translate to the center of the sprite, rotate, scale, then draw from center\n            canvasCtx.translate(x + width / 2, y + height / 2);\n            canvasCtx.rotate(r * Math.PI / 180); // Convert degrees to radians\n            canvasCtx.scale(scaleX, scaleY); // Apply flipping if needed\n            canvasCtx.drawImage(img, -width / 2, -height / 2, width, height);\n        } else if (scaleX !== 1 || scaleY !== 1) { // Flipping without rotation\n            // Translate to the drawing position, scale, then draw\n            canvasCtx.translate(translateX, translateY);\n            canvasCtx.scale(scaleX, scaleY);\n            canvasCtx.drawImage(img, 0, 0, width, height);\n        } else { // Simple draw (no rotation, no flipping)\n            canvasCtx.drawImage(img, x, y, width, height);\n        }\n        canvasCtx.restore(); // Restore context state\n    };\n\n    // SSH (SpriteSheet) - Renders a specific sprite from the processed spritesheet array\n    window.ssh = function(id, x, y, w, h, r, canvasCtx=ctx) {\n        // Check if spritesheet exists, is an array, and the ID is valid\n        if (!gameObj.spritesheet || !Array.isArray(gameObj.spritesheet) || !gameObj.spritesheet[id]) return;\n        let img = gameObj.spritesheet[id]; // Get the pre-rendered Image object for this tile\n        if (!img || !img.complete || img.naturalWidth === 0) return; // Check if image is loaded\n\n        // Default width/height to the image's dimensions if not provided\n        let width = w === undefined ? img.width : Math.abs(w);\n        let height = h === undefined ? img.height : Math.abs(h);\n\n        // Handle flipping using negative width/height\n        let translateX = w < 0 ? x + width : x;\n        let translateY = h < 0 ? y + height : y;\n        let scaleX = w < 0 ? -1 : 1;\n        let scaleY = h < 0 ? -1 : 1;\n\n        canvasCtx.save(); // Save current context state\n\n        if (r) { // Rotation is specified\n             // Translate to the center of the sprite, rotate, scale, draw from center\n            canvasCtx.translate(x + width / 2, y + height / 2);\n            canvasCtx.rotate(r * Math.PI / 180); // Convert degrees to radians\n            canvasCtx.scale(scaleX, scaleY); // Apply flipping\n            canvasCtx.drawImage(img, -width / 2, -height / 2, width, height);\n        } else if (scaleX !== 1 || scaleY !== 1) { // Flipping without rotation\n            canvasCtx.translate(translateX, translateY);\n            canvasCtx.scale(scaleX, scaleY);\n            canvasCtx.drawImage(img, 0, 0, width, height);\n        } else { // Simple draw (no rotation, no flipping)\n            canvasCtx.drawImage(img, x, y, width, height);\n        }\n\n        canvasCtx.restore(); // Restore context state\n    };\n\n\n    window.sfx = function(audioIndex, loop = false) {\n        if (!(\"audioBuffers\" in window) || !window.audioBuffers || !window.audioBuffers[audioIndex]) return null;\n        if (!window.audioContexts || window.audioContexts.length === 0) return null;\n\n        // Cycle through available audio contexts to allow multiple sounds\n        window.audioContextIndex = (window.audioContextIndex + 1) % window.audioContexts.length;\n        const audioContext = window.audioContexts[window.audioContextIndex];\n\n        // Ensure context is running (browsers often require user interaction first)\n        if (audioContext.state === 'suspended') {\n            audioContext.resume();\n        }\n\n        // Play the sound if context is running\n        if (audioContext.state === 'running') {\n            const source = audioContext.createBufferSource();\n            source.buffer = window.audioBuffers[audioIndex];\n            source.connect(audioContext.destination);\n            source.loop = loop;\n            source.start(0);\n            return source;\n        } else {\n             console.warn(\"Audio context not running, cannot play sound.\");\n             return null;\n        }\n    };\n\n    window.clk = function(id, pad = 0) {\n        if (typeof id === 'object' && id !== null && 'x' in id && 'y' in id && 'w' in id && 'h' in id) { // IF TOUCH OR MOUSE CLICK\n            if (keys.touches.length > 0) {\n                for (let i = 0; i < keys.touches.length; i++) {\n                    const touch = keys.touches[i];\n                    const isInside = (touch.x >= id.x && touch.x <= id.x + id.w && touch.y >= id.y && touch.y <= id.y + id.h);\n                    if (isInside && touch.clicked) {\n                        touch.clicked = false;\n                        return true;\n                    }\n                }\n            } else {\n                const isInside = (keys.mouse.x >= id.x && keys.mouse.x <= id.x + id.w && keys.mouse.y >= id.y && keys.mouse.y <= id.y + id.h);\n                if (isInside && keys.mouse.clicked) {\n                    keys.mouse.clicked = false;\n                    return true; \n                }\n            }\n        }\n        if (typeof id === 'number') { // IF GAMEPAD BUTTON CLICK\n            const gamepadButtonId = `${pad}-${id}`;\n            if (keys[gamepadButtonId] && keys[gamepadButtonId].clicked) {\n                keys[gamepadButtonId].clicked = false;\n                return true;\n            }\n        }\n        if (typeof id === 'string' && keys[id]) { // IF KEYBOARD BUTTON CLICK\n            if (keys[id].clicked) {\n                keys[id].clicked = false;\n                return true;\n            }\n        }\n        return false;\n    };\n\n    window.hld = function(id, pad = 0) {\n         if (typeof id === 'object' && id !== null && 'x' in id && 'y' in id && 'w' in id && 'h' in id) { // IF TOUCH OR MOUSE HELD\n            if (keys.touches.length > 0) {\n                for (let i = 0; i < keys.touches.length; i++) {\n                    const touch = keys.touches[i];\n                    const isInside = (touch.x >= id.x && touch.x <= id.x + id.w && touch.y >= id.y && touch.y <= id.y + id.h);\n                    if (isInside) {\n                        return true;\n                    }\n                }\n            } else {\n                const isInside = (keys.mouse.x >= id.x && keys.mouse.x <= id.x + id.w && keys.mouse.y >= id.y && keys.mouse.y <= id.y + id.h);\n                if (isInside) {\n                    return keys.mouse.held;\n                }\n            }\n            return false; // No held touch found in the area\n        }\n        if (typeof id === 'number') { // IF GAMEPAD BUTTON HELD\n            const gamepadButtonId = `${pad}-${id}`;\n            return keys[gamepadButtonId] ? keys[gamepadButtonId].held : false;\n        }\n        if (typeof id === 'string' && keys[id]) { // IF KEYBOARD BUTTON HELD\n            return keys[id].held;\n        }\n        return false;\n    };\n\n    // --- End Core API Functions ---\n\n\n    // --- Level Management ---\n    window.lvl = function(levelID) {\n        if (!(\"levels\" in gameObj) || !Array.isArray(gameObj.levels)) return console.log(\"You have no Levels defined to run.\");\n        if (levelID >= gameObj.levels.length || levelID < 0) return console.log(`Level ${levelID} does not exist.`);\n\n        console.log(`Switching to level ${levelID}`);\n        currentLevel = levelID;\n\n        // Stop the previous game loop if it's running\n        if (window.currentGameLoopId) {\n            cancelAnimationFrame(window.currentGameLoopId);\n            window.currentGameLoopId = null;\n            console.log(\"Previous game loop cancelled.\");\n        }\n\n        // Initialize the new level\n        if (gameObj.levels[currentLevel] && typeof gameObj.levels[currentLevel].init === 'function') {\n            try {\n                gameObj.levels[currentLevel].init();\n            } catch (error) {\n                console.error(`Error during init of level ${levelID}:`, error);\n                 // Optional: Stop the framework or show an error message on canvas\n                return;\n            }\n        } else {\n            console.error(`Level ${levelID} exists but does not have an init function.`);\n            return; // Don't start the loop if init is missing\n        }\n\n        // --- Game Loop ---\n        let previousTimestamp = 0;\n        function updateLevel(currentTimestamp) {\n            // Schedule the next frame\n            window.currentGameLoopId = requestAnimationFrame(updateLevel);\n\n             // If the level changed mid-frame (e.g., inside the update function), stop this loop\n            if (currentLevel !== levelID) {\n                 // The new lvl() call would have already cancelled this loop,\n                 // but this is an extra safeguard.\n                console.log(`Loop for level ${levelID} stopped due to level change.`);\n                return;\n            }\n\n            // Calculate delta time (time since last frame in seconds)\n            if (previousTimestamp === 0) previousTimestamp = currentTimestamp; // First frame\n            const deltaTime = Math.min((currentTimestamp - previousTimestamp) / 1000, 0.1); // Cap DT to prevent large jumps\n            previousTimestamp = currentTimestamp;\n\n            // --- Update Input States ---\n            updateGamepads(); // Poll gamepad state\n\n            // --- Execute Level Update ---\n            if (outputArea.contains(cnv) && // Ensure canvas is still in the DOM\n                gameObj.levels[currentLevel] &&\n                typeof gameObj.levels[currentLevel].update === 'function')\n            {\n                try {\n                     gameObj.levels[currentLevel].update(deltaTime);\n                } catch (error) {\n                     console.error(`Error during update of level ${levelID}:`, error);\n                     cancelAnimationFrame(window.currentGameLoopId); // Stop the loop on error\n                     window.currentGameLoopId = null;\n                     // Optional: Display error on canvas\n                     ctx.fillStyle = \"red\";\n                     ctx.font = \"16px Rajdhani\";\n                     ctx.fillText(`RUNTIME ERROR in level ${levelID}. Check console.`, 10, cnv.height / 2);\n                     return;\n                }\n            } else if (!gameObj.levels[currentLevel] || typeof gameObj.levels[currentLevel].update !== 'function') {\n                console.error(`Level ${levelID} does not have an update function. Stopping loop.`);\n                cancelAnimationFrame(window.currentGameLoopId);\n                window.currentGameLoopId = null;\n                return;\n            }\n        }\n        // --- End Game Loop ---\n\n        // Start the game loop for the new level\n        previousTimestamp = 0; // Reset timestamp for the new loop\n        window.currentGameLoopId = requestAnimationFrame(updateLevel);\n        console.log(`Game loop started for level ${levelID}.`);\n    };\n    // --- End Level Management ---\n\n\n    // --- Asset Loading ---\n    function loadAssetsAndStart() {\n        loadSpritesPromise()\n            .then(loadSpriteSheetPromise) // Chain promises\n            .then(loadAudioPromise)\n            .then(() => {\n                console.log(\"All assets loaded successfully.\");\n                // Automatically start level 0 after loading\n                lvl(0);\n            })\n            .catch(error => {\n                console.error(\"Asset loading failed:\", error);\n                 // Display error on canvas if loading fails\n                ctx.fillStyle = \"red\";\n                ctx.font = \"16px Rajdhani\";\n                ctx.fillText(\"ERROR LOADING ASSETS. Check console.\", 10, cnv.height / 2);\n            });\n    }\n\n    // Loads individual sprites\n     function loadSpritesPromise() {\n        return new Promise((resolve, reject) => {\n            if (!gameObj.sprites || !Array.isArray(gameObj.sprites) || gameObj.sprites.length === 0) {\n                console.log(\"No individual sprites defined or array is empty.\");\n                resolve(); // Nothing to load\n                return;\n            }\n\n            let loadedCount = 0;\n            const totalSprites = gameObj.sprites.length;\n            let loadErrors = false;\n            console.log(`Loading ${totalSprites} individual sprites...`);\n\n            gameObj.sprites.forEach((src, index) => {\n                 // Ensure the entry is a string (URL/path) before creating Image\n                if (typeof src !== 'string' || src.trim() === '') {\n                    console.warn(`Sprite at index ${index} has invalid source:`, src);\n                    // Replace invalid entry with null or a placeholder? For now, just skip.\n                    gameObj.sprites[index] = null; // Mark as invalid/unloaded\n                    loadedCount++;\n                     if (loadedCount === totalSprites) {\n                        if (loadErrors) reject(new Error(\"One or more sprites failed to load.\"));\n                        else resolve();\n                    }\n                    return; // Skip this iteration\n                }\n\n                let img = new Image();\n                img.src = src;\n                // Replace the source string with the Image object\n                gameObj.sprites[index] = img;\n\n                img.onload = () => {\n                    loadedCount++;\n                    // console.log(`Sprite ${index} loaded: ${src}`);\n                    if (loadedCount === totalSprites) {\n                        console.log(\"All individual sprites finished loading attempt.\");\n                        if (loadErrors) reject(new Error(\"One or more sprites failed to load.\"));\n                        else resolve();\n                    }\n                };\n                img.onerror = (error) => {\n                    console.error(`Failed to load sprite ${index}: ${src}`, error);\n                    gameObj.sprites[index] = null; // Mark as failed\n                    loadedCount++;\n                    loadErrors = true;\n                    if (loadedCount === totalSprites) {\n                         console.log(\"All individual sprites finished loading attempt (with errors).\");\n                        reject(new Error(`Failed to load sprite: ${src}`)); // Reject on first error or collect errors?\n                    }\n                };\n            });\n             // Handle the case where the array was empty from the start\n             if (totalSprites === 0) {\n                 resolve();\n             }\n        });\n    }\n\n\n    // Loads and processes the spritesheet\n     function loadSpriteSheetPromise() {\n        return new Promise((resolve, reject) => {\n             // Check if spritesheet definition exists and has the correct structure [source, gridWidth, gridHeight]\n            if (!gameObj.spritesheet || !Array.isArray(gameObj.spritesheet) || gameObj.spritesheet.length !== 3) {\n                console.log(\"No valid spritesheet definition found [source, gridWidth, gridHeight].\");\n                resolve(); // Resolve successfully if no spritesheet is defined\n                return;\n            }\n\n            const [ssSource, ssGridWidth, ssGridHeight] = gameObj.spritesheet;\n\n             // Validate the parameters\n            if (typeof ssSource !== 'string' || typeof ssGridWidth !== 'number' || typeof ssGridHeight !== 'number' || ssGridWidth <= 0 || ssGridHeight <= 0 || !Number.isInteger(ssGridWidth) || !Number.isInteger(ssGridHeight)) {\n                console.error(\"Invalid spritesheet definition parameters:\", gameObj.spritesheet);\n                reject(new Error(\"Invalid spritesheet definition parameters. Expected [string, positive_integer, positive_integer].\"));\n                return;\n            }\n\n            console.log(`Loading spritesheet from ${ssSource} (${ssGridWidth}x${ssGridHeight} grid)...`);\n            const img = new Image();\n            img.src = ssSource;\n\n            img.onload = () => {\n                 console.log(`Spritesheet image loaded: ${img.width}x${img.height}`);\n                 // Calculate individual sprite dimensions\n                const spriteWidth = img.width / ssGridWidth;\n                const spriteHeight = img.height / ssGridHeight;\n\n                 // Check for non-integer dimensions or zero size (division issues)\n                if (spriteWidth <= 0 || spriteHeight <= 0 || !Number.isInteger(spriteWidth) || !Number.isInteger(spriteHeight)) {\n                    reject(new Error(`Spritesheet dimensions (${img.width}x${img.height}) not evenly divisible by grid size (${ssGridWidth}x${ssGridHeight}), or result in zero size.`));\n                    return;\n                }\n\n                console.log(`Calculated tile size: ${spriteWidth}x${spriteHeight}`);\n\n                const sprites = []; // Array to hold the individual Image objects cut from the sheet\n                const tempCanvas = document.createElement('canvas');\n                const tempCtx = tempCanvas.getContext('2d');\n                 // Set the temporary canvas size to one sprite tile\n                tempCanvas.width = spriteWidth;\n                tempCanvas.height = spriteHeight;\n                tempCtx.imageSmoothingEnabled = false; // Keep pixelated rendering\n\n                let spritesProcessed = 0;\n                const totalSpritesToProcess = ssGridWidth * ssGridHeight;\n                let processingErrors = false;\n\n                 // Iterate through the grid and cut out each sprite\n                for (let y = 0; y < ssGridHeight; y++) {\n                    for (let x = 0; x < ssGridWidth; x++) {\n                         // Clear the temp canvas\n                        tempCtx.clearRect(0, 0, spriteWidth, spriteHeight);\n                         // Draw the specific tile onto the temp canvas\n                        tempCtx.drawImage(\n                            img,            // Source image (the whole spritesheet)\n                            x * spriteWidth, // Source x\n                            y * spriteHeight, // Source y\n                            spriteWidth,    // Source width\n                            spriteHeight,   // Source height\n                            0,              // Destination x (on temp canvas)\n                            0,              // Destination y (on temp canvas)\n                            spriteWidth,    // Destination width\n                            spriteHeight    // Destination height\n                        );\n\n                         // Create a new Image object from the temp canvas data\n                        const spriteImg = new Image();\n                        spriteImg.src = tempCanvas.toDataURL(); // Get base64 representation\n                        const currentIndex = y * ssGridWidth + x; // Calculate linear index\n                        sprites[currentIndex] = spriteImg; // Add to the array (or use push if order doesn't matter initially)\n\n                        // We need to wait for *this* extracted image to load as well\n                        spriteImg.onload = () => {\n                            spritesProcessed++;\n                            //console.log(`Processed sprite ${currentIndex}`);\n                            if (spritesProcessed === totalSpritesToProcess) {\n                                console.log(\"Spritesheet processed into individual images.\");\n                                if (processingErrors) {\n                                    reject(new Error(\"Errors occurred while processing spritesheet tiles.\"));\n                                } else {\n                                    gameObj.spritesheet = sprites; // Replace original definition with the array of Images\n                                    resolve();\n                                }\n                            }\n                        };\n                        spriteImg.onerror = (error) => {\n                             console.error(`Failed to load processed spritesheet tile at index ${currentIndex} (grid ${x},${y})`, error);\n                             sprites[currentIndex] = null; // Mark as failed\n                             spritesProcessed++;\n                             processingErrors = true;\n                             if (spritesProcessed === totalSpritesToProcess) {\n                                 console.log(\"Spritesheet processing finished (with errors).\");\n                                 reject(new Error(`Failed to process spritesheet tile at index ${currentIndex}.`));\n                             }\n                        };\n                    }\n                }\n            };\n\n            img.onerror = (error) => {\n                 console.error(`Failed to load spritesheet image: ${ssSource}`, error);\n                 reject(new Error(`Failed to load spritesheet image: ${ssSource}`));\n            };\n        });\n    }\n\n\n    // Loads audio files into buffers\n     function loadAudioPromise() {\n        return new Promise((resolve, reject) => {\n            if (!(\"audio\" in gameObj) || !Array.isArray(gameObj.audio) || gameObj.audio.length === 0) {\n                console.log(\"No audio files defined or array is empty.\");\n                resolve(); // Nothing to load\n                return;\n            }\n\n             // Initialize Web Audio API contexts (use multiple for potentially better performance)\n             // Browsers might limit the number of simultaneous sounds otherwise.\n            try {\n                window.audioContexts = [new AudioContext(), new AudioContext(), new AudioContext(), new AudioContext()]; // Pool of contexts\n                window.audioContextIndex = 0; // Index for round-robin usage\n                window.audioBuffers = new Array(gameObj.audio.length).fill(null); // Initialize buffer array\n                console.log(`Initializing ${window.audioContexts.length} audio contexts.`);\n            } catch (e) {\n                console.error(\"Web Audio API is not supported by this browser.\", e);\n                 // Fallback or disable audio\n                window.audioContexts = [];\n                window.audioBuffers = [];\n                 // Decide whether to reject or resolve with audio disabled\n                 // Rejecting might be better as audio features will fail.\n                reject(new Error(\"Web Audio API not supported. Cannot load audio.\"));\n                return;\n            }\n\n            let audioLoadedCount = 0;\n            const totalAudio = gameObj.audio.length;\n            let loadErrors = false;\n            console.log(`Loading ${totalAudio} audio files...`);\n\n            gameObj.audio.forEach((audioSrc, index) => {\n                 // Basic validation\n                if (typeof audioSrc !== 'string' || audioSrc.trim() === '') {\n                    console.warn(`Audio at index ${index} has invalid source:`, audioSrc);\n                    audioLoadedCount++;\n                    if (audioLoadedCount === totalAudio) {\n                        if (loadErrors) reject(new Error(\"One or more audio files failed to load/decode.\"));\n                        else resolve();\n                    }\n                    return; // Skip this iteration\n                }\n\n                fetch(audioSrc)\n                    .then(response => {\n                        if (!response.ok) {\n                             // Throw an error to be caught by the .catch block\n                            throw new Error(`HTTP error! Status: ${response.status} for ${audioSrc}`);\n                        }\n                        return response.arrayBuffer(); // Get audio data as ArrayBuffer\n                    })\n                    .then(arrayBuffer => {\n                         // Decode the audio data using the *first* context (they share buffer capabilities)\n                         // Using decodeAudioData is asynchronous\n                        return window.audioContexts[0].decodeAudioData(arrayBuffer);\n                    })\n                    .then(audioBuffer => {\n                        // Store the decoded buffer\n                        window.audioBuffers[index] = audioBuffer;\n                        audioLoadedCount++;\n                        //console.log(`Audio ${index} loaded and decoded: ${audioSrc}`);\n                        if (audioLoadedCount === totalAudio) {\n                             console.log(\"All audio files finished loading attempt.\");\n                             if (loadErrors) reject(new Error(\"One or more audio files failed to load/decode.\"));\n                             else resolve();\n                        }\n                    })\n                    .catch(error => {\n                        console.error(`Error loading or decoding audio ${index}: ${audioSrc}`, error);\n                        // Don't store anything for this index, or mark as null\n                        window.audioBuffers[index] = null;\n                        audioLoadedCount++;\n                        loadErrors = true;\n                        if (audioLoadedCount === totalAudio) {\n                            console.log(\"All audio files finished loading attempt (with errors).\");\n                            reject(new Error(`Failed to load/decode audio: ${audioSrc}`));\n                        }\n                    });\n            });\n             // Handle the case where the audio array was empty from the start\n             if (totalAudio === 0) {\n                 resolve();\n             }\n        });\n    }\n\n    // --- End Asset Loading ---\n\n    // Start the asset loading process\n    loadAssetsAndStart();\n};",
        "Text Adventure": "J:// T E X T   A D V E N T U R E\n\nwindow.textAdventure = function(novelTxt) {\n    optionsArea.style.display = \"none\";\n    window.sections = {};\n    window.textList = [];\n    window.vars = {};\n    window.currentSection = \"\";\n\n    const textOffset = countLeadingSpaces(novelTxt.split(\"\\n\")[1]);\n\n    function countLeadingSpaces(str) {\n        let count = 0;\n        for (let i = 0; i < str.length; i++) {\n            if (str[i] === ' ') {\n                count++;\n            } else {\n                break;\n            }\n        }\n        return count;\n    }\n\n    let currentSectionSearch = \"\";\n    let currentPassageSearch = \"\";\n    novelTxt.split(\"\\n\").forEach((elem) => {\n        elem = elem.substring(textOffset);\n        if (elem.includes(\"[[\") && elem.includes(\"]]:\")) {\n            currentSectionSearch = elem.split(\"[[\")[1].split(\"]]:\")[0];\n            sections[currentSectionSearch] = { \"text\": [], \"shown\": false, passages: {} };\n            currentPassageSearch = \"\";\n        } else {\n            if (currentSectionSearch == \"\") return;\n\n            if (elem.includes(\"[\") && elem.includes(\"]:\")) {\n                currentPassageSearch = elem.split(\"[\")[1].split(\"]:\")[0];\n                sections[currentSectionSearch].passages[currentPassageSearch] = { shown: false, text: [] };\n            } else if (currentPassageSearch != \"\") {\n                sections[currentSectionSearch].passages[currentPassageSearch].text.push(elem);\n            }\n            if (currentPassageSearch == \"\") sections[currentSectionSearch].text.push(elem);\n\n        }\n    });\n\n    outputArea.innerHTML = `<div id=\"novel\" style=\"margin: 10px; border: 5px solid black; width: calc(100% - 40px); min-height: calc(100% - 40px); padding: 5px; border-radius: 8px; background-color: white; font-size: 22px; white-space: pre-wrap;\"></div>`;\n    const novel = document.getElementById(\"novel\");\n\n\n    function addObject(sectionName, obj) {\n        obj.shown = true;\n        let sectionText = [];\n        obj.text.forEach((elem, index) => {\n            if (elem.startsWith(\"@JS\")) {\n                let customJS = new Function(elem.substring(4));\n                customJS();\n            } else if (elem.startsWith(\"@clear\")) {\n                textList = [];\n            } else if (elem.startsWith(\"@set\")) {\n                const setBroken = elem.split(\" \");\n                let output = (!isNaN(parseInt(setBroken[2]))) ? parseInt(setBroken[2]) : setBroken[2];\n                vars[setBroken[1]] = output;\n            } else if (elem.startsWith(\"@inc\")) {\n                const setBroken = elem.split(\" \");\n                let output = (!isNaN(parseInt(setBroken[2]))) ? parseInt(setBroken[2]) : setBroken[2];\n                vars[setBroken[1]] += output;\n            } else if (elem.startsWith(\"@dec\")) {\n                const setBroken = elem.split(\" \");\n                let output = (!isNaN(parseInt(setBroken[2]))) ? parseInt(setBroken[2]) : setBroken[2];\n                vars[setBroken[1]] -= output;\n            } else if (elem.startsWith(\"@prompt\")) {\n                const setBroken = elem.split(\" \");\n                setBroken.shift();\n                const varKey = setBroken.shift();\n                let promptValue = prompt(setBroken.join(\" \"));\n                let output = (!isNaN(parseInt(promptValue))) ? parseInt(promptValue) : promptValue;\n                vars[varKey] = output;\n            } else if (elem.startsWith(\"@show\")) {\n                const setBroken = elem.split(\" \");\n                setBroken.shift();\n                const sectionNameToShow = setBroken.join(\" \");\n                if (sectionNameToShow in sections) {\n                    sections[sectionNameToShow].shown = false;\n                    for (const passageName in sections[sectionNameToShow].passages) {\n                        sections[sectionNameToShow].passages[passageName].shown = false;\n                    }\n                }\n            } else {\n                sectionText.push(elem);\n            }\n        })\n        sectionText.push(\"<hr>\");\n        textList.push({section:sectionName, text:sectionText.join(\"<br>\")});\n        showTexts();\n    }\n\n    function checkConditions (checkAry) {\n        for (let i=1; i<checkAry.length; i++) {\n            if (checkAry[i].includes(\"<\")) {\n                if (vars[checkAry[i].split(\"<\")[0]] >= parseInt(checkAry[i].split(\"<\")[1])) return false;\n            } else if (checkAry[i].includes(\">\")) {\n                if (vars[checkAry[i].split(\">\")[0]] <= parseInt(checkAry[i].split(\">\")[1])) return false;\n            } else if (checkAry[i].includes(\"==\")) {\n                let output = (!isNaN(parseInt(checkAry[i].split(\"==\")[1]))) ? parseInt(checkAry[i].split(\"==\")[1]) : checkAry[i].split(\"==\")[1];\n                if (vars[checkAry[i].split(\"==\")[0]] != output) return false;\n            } else if (checkAry[i].includes(\"=\")) {\n                let output = (!isNaN(parseInt(checkAry[i].split(\"=\")[1]))) ? parseInt(checkAry[i].split(\"=\")[1]) : checkAry[i].split(\"=\")[1];\n                vars[checkAry[i].split(\"=\")[0]] = output;\n            }\n        }\n        return true;\n    }\n\n    window.showSection = function(sectionArray) {\n        let conditionsMet = checkConditions(sectionArray);\n        if (conditionsMet) {\n            currentSection = sectionArray[0];\n        } else {\n            sections[sectionArray[0]].shown = true;\n            currentSection = sectionArray.pop();\n        }\n        addObject(currentSection, sections[currentSection]);\n    }\n\n    window.showPassage = function(passageArray) {\n        let conditionsMet = checkConditions(passageArray);\n        if (conditionsMet) {\n            addObject(currentSection, sections[currentSection].passages[passageArray[0]]);\n        } else {\n            sections[currentSection].passages[passageArray[0]].shown = true;\n            addObject(currentSection, sections[currentSection].passages[passageArray.pop()]);\n        }\n        let count = 0;\n        for (const passageName in sections[currentSection].passages) {\n            if (sections[currentSection].passages[passageName].shown) count += 1;\n        }\n        for (const passageName in sections[currentSection].passages) {\n            if (passageName.startsWith(`@${count}`)) {\n                let newPassage = passageName.split(\" \");\n                newPassage.shift();\n                goTo(newPassage.join(\" \"));\n            }\n        }\n    }\n\n    window.goTo = function(destination) {\n        if (destination in sections[currentSection].passages) {\n            showPassage([destination]);\n        } else if (destination in sections) {\n            showSection([destination]);\n        }\n    }\n\n    function showTexts() {\n        let totalText = \"\";\n        for (let i=0; i<textList.length; i++) {\n\n            let brokenTxt = breakText(textList[i].text);\n\n            for (let j=0; j<brokenTxt.length; j++) {\n                if (brokenTxt[j].startsWith(\"[[\") && brokenTxt[j+1].startsWith(\"(\")) { // IF SECTION & ()\n                    let newSec = brokenTxt[j].slice(2, -2).split(\", \");\n                    brokenTxt[j] = (textList[i].section == currentSection && !sections[newSec[0]].shown) ? `<a style=\"cursor: pointer; color: blue; text-decoration: underline;\" onclick='showSection(${JSON.stringify(newSec)})'>${brokenTxt[j+1].slice(1, -1)}</a>` : brokenTxt[j+1].slice(1, -1);\n                    brokenTxt[j+1] = \"\";\n\n                } else if (brokenTxt[j].startsWith(\"[[\")) { // IF SECTION no ()\n                    let newSec = brokenTxt[j].slice(2, -2).split(\", \");\n                    brokenTxt[j] = (textList[i].section == currentSection && !sections[newSec[0]].shown) ? `<a style=\"cursor: pointer; color: blue; text-decoration: underline;\" onclick='showSection(${JSON.stringify(newSec)})'>${newSec[0]}</a>` : newSec[0];\n\n                } else if (brokenTxt[j].startsWith(\"[\") && brokenTxt[j+1].startsWith(\"(\")) { // IF PASSAGE & ()\n                    let newPass = brokenTxt[j].slice(1, -1).split(\", \");\n                    brokenTxt[j] = (textList[i].section == currentSection && !sections[currentSection].passages[newPass[0]].shown) ? `<a style=\"cursor: pointer; color: blue; text-decoration: underline;\" onclick='showPassage(${JSON.stringify(newPass)})'>${brokenTxt[j+1].slice(1, -1)}</a>` : brokenTxt[j+1].slice(1, -1);\n                    brokenTxt[j+1] = \"\";\n\n                } else if (brokenTxt[j].startsWith(\"[\")) { // IF PASSAGE no ()\n                    let newPass = brokenTxt[j].slice(1, -1).split(\", \");\n                    brokenTxt[j] = (textList[i].section == currentSection && !sections[currentSection].passages[newPass[0]].shown) ? `<a style=\"cursor: pointer; color: blue; text-decoration: underline;\" onclick='showPassage(${JSON.stringify(newPass)})'>${newPass[0]}</a>` : newPass[0];\n\n                } else if (brokenTxt[j].startsWith(\"{\")) {\n                    brokenTxt[j] = vars[brokenTxt[j].slice(1, -1)];\n                }\n            }\n            totalText += \"<br>\" + brokenTxt.join(\"\").replaceAll(\"&lsb\", \"[\").replaceAll(\"&rsb\", \"]\").replaceAll(\"&lcb\", \"{\").replaceAll(\"&rcb\", \"}\")\n        }\n        novel.innerHTML = \"<hr>\" + totalText;\n        outputArea.scrollIntoView({ behavior: 'smooth', block: 'end' });\n    }\n\n    function breakText(txt) {\n        let brokenTxt = [];\n        let brokenPlaceholder = \"\";\n        const pattern = /\\n@.*?\\n/gs;\n        txt = txt.replace(pattern, '')\n        \n        for (let i=0; i<txt.length; i++) {\n            let char = txt[i];\n            if (char == \"[\" && brokenPlaceholder != \"[\") {\n                brokenTxt.push(brokenPlaceholder);\n                brokenPlaceholder = \"[\"; \n            } else if (char == \"]\" && txt[i+1] != \"]\") {\n                brokenPlaceholder += char;\n                brokenTxt.push(brokenPlaceholder);\n                brokenPlaceholder = \"\";\n            } else if (char == \")\" && brokenPlaceholder.startsWith(\"(\")) {\n                brokenPlaceholder += char;\n                brokenTxt.push(brokenPlaceholder);\n                brokenPlaceholder = \"\";\n            } else if (i == txt.length-1) {\n                brokenPlaceholder += char;\n                brokenTxt.push(brokenPlaceholder);\n                brokenPlaceholder = \"\"; \n            } else if (char == \"{\") {\n                brokenTxt.push(brokenPlaceholder);\n                brokenPlaceholder = \"{\";\n            } else if (char == \"}\") {\n                brokenPlaceholder += char;\n                brokenTxt.push(brokenPlaceholder);\n                brokenPlaceholder = \"\";\n            } else {\n                brokenPlaceholder += char;\n            }\n        }\n        return brokenTxt\n    }\n\n    showSection([Object.keys(sections)[0]])\n}",
        "Study Framework": "J:window.studyFramework = function(topicTitle, topicObject) {\n    path.pop();\n    showOption();\n    let studyArea = null;\n    let questionTextEl = null;\n    let answerButtonsEl = null;\n    let navigationEl = null;\n    let scoreOverlayEl = null;\n    let subTopicDisplayEl = null; // <--- Added: Element for sub-topic display\n\n    window.studyData = {\n        originalQuestions: [], // Will store objects: { subTopic: \"Name\", data: [...] }\n        questions: [],         // The shuffled/working array of question objects\n        currentIndex: 0,\n        correctCount: 0,\n        incorrectCount: 0,\n        config: {\n            looping: false,\n            randomOrder: false\n        }\n    };\n\n    function shuffleArray(array) {\n        let currentIndex = array.length, randomIndex;\n        const newArray = [...array];\n        while (currentIndex !== 0) {\n            randomIndex = Math.floor(Math.random() * currentIndex);\n            currentIndex--;\n            [newArray[currentIndex], newArray[randomIndex]] = [\n                newArray[randomIndex], newArray[currentIndex]\n            ];\n        }\n        return newArray;\n    }\n\n    function updateScoreOverlay() {\n        if (scoreOverlayEl) {\n            if (window.studyData.config.looping) {\n                scoreOverlayEl.innerHTML = `Correct: ${window.studyData.correctCount} | Incorrect: ${window.studyData.incorrectCount}`;\n                scoreOverlayEl.style.display = 'block';\n            } else {\n                scoreOverlayEl.style.display = 'none';\n            }\n        }\n    }\n\n    function showFinalScore() {\n        if (!studyArea) return;\n        const totalAttempts = window.studyData.correctCount + window.studyData.incorrectCount;\n        const scorePercent = totalAttempts > 0 ?\n            ((window.studyData.correctCount / totalAttempts) * 100).toFixed(1) :\n            0;\n        studyArea.innerHTML = `<div style=\"font-size: 24px; font-weight: bold; text-align: center; margin-top: 30px;\">Study Session Finished!<br><br>Correct Answers: ${window.studyData.correctCount}<br>Incorrect Clicks: ${window.studyData.incorrectCount}<br>${scorePercent}% Correct<br><br></div>`;\n        const backButton = document.createElement('button');\n        backButton.textContent = 'Study Again (Select Topics)';\n        backButton.style.cssText = \"padding: 12px 20px; font-size: 16px; cursor: pointer; border: 1px solid #ccc; background-color: #f8f9fa; border-radius: 5px; margin-top: 20px;\";\n        backButton.onclick = () => showTopicSelection();\n        studyArea.appendChild(backButton);\n        if (scoreOverlayEl) scoreOverlayEl.style.display = 'none';\n        if (subTopicDisplayEl) subTopicDisplayEl.style.display = 'none'; // <--- Hide sub-topic on final score\n    }\n\n    function handleAnswerClick(isCorrect, buttonElement) {\n        buttonElement.disabled = true;\n        buttonElement.style.opacity = '0.7';\n        buttonElement.style.cursor = 'default';\n        buttonElement.style.boxShadow = 'none';\n\n        if (isCorrect) {\n            window.studyData.correctCount++;\n            const buttons = answerButtonsEl.querySelectorAll('button');\n            buttons.forEach(btn => {\n                btn.disabled = true;\n                btn.style.cursor = 'default';\n                btn.style.boxShadow = 'none';\n                if (btn === buttonElement) {\n                    btn.style.backgroundColor = '#d4edda';\n                    btn.style.borderColor = '#c3e6cb';\n                    btn.style.opacity = '1';\n                } else {\n                    btn.style.opacity = '0.6';\n                }\n            });\n\n            // Retrieve current question object to get feedback\n            const currentQuestionObject = window.studyData.questions[window.studyData.currentIndex];\n            if (!currentQuestionObject || !currentQuestionObject.data || currentQuestionObject.data.length < 1) {\n                 console.error(\"Could not retrieve feedback for current question:\", window.studyData.currentIndex);\n                 questionTextEl.innerHTML = \"<i>Feedback unavailable.</i>\"; // Default feedback\n            } else {\n                const currentQuestionData = currentQuestionObject.data;\n                const feedbackText = currentQuestionData[currentQuestionData.length - 1]; // Feedback is last item\n                questionTextEl.innerHTML = feedbackText;\n                MathJax.typeset();\n                questionTextEl.style.fontStyle = 'italic';\n                questionTextEl.style.fontWeight = 'bold';\n            }\n\n            answerButtonsEl.style.display = 'none';\n            navigationEl.innerHTML = '';\n\n            const nextButton = document.createElement('button');\n            nextButton.textContent = 'Continue';\n            nextButton.style.cssText = \"padding: 12px 20px; font-size: 16px; cursor: pointer; border: 1px solid #ccc; background-color: #f8f9fa; border-radius: 5px; transition: background-color 0.2s, border-color 0.2s; width: 100%; max-width: 200px; box-sizing: border-box; margin-top: 20px;\";\n            nextButton.onmouseover = () => { nextButton.style.backgroundColor = '#e2e6ea'; nextButton.style.borderColor = '#adb5bd'; };\n            nextButton.onmouseout = () => { nextButton.style.backgroundColor = '#f8f9fa'; nextButton.style.borderColor = '#ccc'; };\n            nextButton.onclick = () => studyFramework_nextQuestion();\n            navigationEl.appendChild(nextButton);\n            navigationEl.style.display = 'flex';\n            navigationEl.style.justifyContent = 'center';\n            navigationEl.style.width = '100%';\n\n        } else {\n            window.studyData.incorrectCount++;\n            buttonElement.style.backgroundColor = '#f8d7da';\n            buttonElement.style.borderColor = '#f5c6cb';\n            buttonElement.style.borderWidth = '2px';\n\n            buttonElement.style.transition = 'transform 0.1s ease-in-out';\n            buttonElement.animate([\n                { transform: 'translateX(-5px)' },\n                { transform: 'translateX(5px)' },\n                { transform: 'translateX(-5px)' },\n                { transform: 'translateX(0)' }\n            ], { duration: 300, easing: 'ease-in-out' });\n        }\n        updateScoreOverlay();\n    }\n\n    function showQuestion() {\n        if (window.studyData.currentIndex >= window.studyData.questions.length) {\n            if (window.studyData.config.looping) {\n                window.studyData.currentIndex = 0;\n                if (window.studyData.config.randomOrder) {\n                    window.studyData.questions = shuffleArray(window.studyData.originalQuestions);\n                } else {\n                    // No need to reset if not random, just loop index\n                }\n            } else {\n                showFinalScore();\n                return;\n            }\n        }\n\n        if (!questionTextEl || !answerButtonsEl || !navigationEl || !subTopicDisplayEl) { // <--- Added check for subTopicDisplayEl\n            console.error(\"Study elements not initialized correctly.\");\n            if (studyArea) initializeInnerStructure(studyArea);\n            else return;\n        }\n\n        // Now retrieve the object containing subTopic and data\n        const currentQuestionObject = window.studyData.questions[window.studyData.currentIndex];\n\n        if (!currentQuestionObject || !currentQuestionObject.data || currentQuestionObject.data.length < 3) {\n            console.error(\"Invalid question data format at index:\", window.studyData.currentIndex, currentQuestionObject);\n            studyFramework_nextQuestion(); // Attempt to skip to the next question\n            return;\n        }\n\n        const subTopicName = currentQuestionObject.subTopic;\n        const currentQuestionData = currentQuestionObject.data; // The actual question array\n\n        const question = currentQuestionData[0];\n        const correctAnswer = currentQuestionData[1];\n        const incorrectAnswers = currentQuestionData.slice(2, -1); // Exclude question, correct answer, and feedback\n\n        // --- Update Sub-topic Display ---\n        subTopicDisplayEl.textContent = subTopicName;\n        subTopicDisplayEl.style.display = 'block'; // Ensure it's visible\n        // -------------------------------\n\n        questionTextEl.innerHTML = question;\n        MathJax.typeset();\n        questionTextEl.style.fontSize = '22px';\n        questionTextEl.style.fontWeight = 'normal';\n        questionTextEl.style.marginBottom = '30px';\n        questionTextEl.style.textAlign = 'center';\n        questionTextEl.style.width = '100%';\n        questionTextEl.style.fontStyle = 'normal';\n\n\n        answerButtonsEl.innerHTML = '';\n        answerButtonsEl.style.display = 'grid';\n        answerButtonsEl.style.gap = '10px';\n        answerButtonsEl.style.width = '100%';\n        answerButtonsEl.style.maxWidth = '600px';\n        answerButtonsEl.style.marginTop = '0';\n        answerButtonsEl.style.marginBottom = '20px';\n\n        const allAnswers = [correctAnswer, ...incorrectAnswers];\n        const shuffledAnswers = shuffleArray(allAnswers);\n\n        if (incorrectAnswers.length > 0) {\n            answerButtonsEl.style.gridTemplateColumns = 'repeat(auto-fit, minmax(150px, 1fr))';\n        } else { // True/False or single correct answer case (Flashcard style)\n            answerButtonsEl.style.gridTemplateColumns = '1fr';\n            answerButtonsEl.style.maxWidth = '300px'; // Make single button narrower\n        }\n\n\n        shuffledAnswers.forEach(answerText => {\n            const button = document.createElement('button');\n            button.textContent = answerText;\n            button.style.cssText = \"padding: 12px 20px; font-size: 16px; cursor: pointer; border: 1px solid #ccc; background-color: #e7e7e7; border-radius: 5px; transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s, opacity 0.2s; width: 100%; box-sizing: border-box; text-align: center;\";\n            button.onmouseover = () => { if (!button.disabled) { button.style.backgroundColor = '#ddd'; button.style.borderColor = '#bbb'; button.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)'; } };\n            button.onmouseout = () => { if (!button.disabled) { button.style.backgroundColor = '#e7e7e7'; button.style.borderColor = '#ccc'; button.style.boxShadow = 'none'; } };\n\n            const isCorrect = (answerText === correctAnswer);\n            button.onclick = () => handleAnswerClick(isCorrect, button);\n            answerButtonsEl.appendChild(button);\n        });\n\n        navigationEl.style.display = 'none'; // Hide nav until answer is chosen\n        navigationEl.innerHTML = ''; // Clear previous nav buttons\n        updateScoreOverlay();\n    }\n\n    window.studyFramework_nextQuestion = function() {\n        window.studyData.currentIndex++;\n        showQuestion();\n    };\n\n    function initializeInnerStructure(targetArea) {\n        targetArea.innerHTML = `\n            <div id=\"subTopicDisplayInternal\"></div> <div id=\"questionTextInternal\" style=\"width: 100%; margin-top: 30px;\"></div> <div id=\"answerButtonsInternal\" style=\"width: 100%;\"></div>\n            <div id=\"navigationInternal\" style=\"width: 100%; margin-top: auto; display: flex; justify-content: center;\"></div>\n            <div id=\"scoreOverlayInternal\"></div>\n        `;\n        targetArea.style.display = 'flex';\n        targetArea.style.flexDirection = 'column';\n        targetArea.style.alignItems = 'center';\n        targetArea.style.padding = '20px';\n        targetArea.style.boxSizing = 'border-box';\n        // Ensure study area is relatively positioned for absolute children\n        if (!targetArea.style.position || targetArea.style.position === 'static') {\n            targetArea.style.position = 'relative';\n        }\n\n\n        questionTextEl = document.getElementById(\"questionTextInternal\");\n        answerButtonsEl = document.getElementById(\"answerButtonsInternal\");\n        navigationEl = document.getElementById(\"navigationInternal\");\n        scoreOverlayEl = document.getElementById(\"scoreOverlayInternal\");\n        subTopicDisplayEl = document.getElementById(\"subTopicDisplayInternal\"); // Get reference\n\n        // Style the sub-topic display\n        if (subTopicDisplayEl) {\n             subTopicDisplayEl.style.cssText = \"position: absolute; top: 10px; left: 10px; font-size: 14px; color: #555; background-color: rgba(230, 230, 230, 0.8); padding: 4px 8px; border-radius: 4px; z-index: 5; font-weight: bold; border: 1px solid #ccc;\";\n        }\n\n\n        if (scoreOverlayEl) {\n            scoreOverlayEl.style.cssText = \"position: absolute; bottom: 10px; right: 10px; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 8px 12px; border-radius: 5px; font-size: 14px; z-index: 10; display: none;\";\n        }\n    }\n\n\n    function startStudySession(selectedQuestions, config) {\n        // selectedQuestions should now be an array of { subTopic: \"Name\", data: [...] } objects\n        window.studyData.originalQuestions = [...selectedQuestions];\n        window.studyData.config = config;\n\n        if (config.randomOrder) {\n            window.studyData.questions = shuffleArray(window.studyData.originalQuestions);\n        } else {\n            window.studyData.questions = [...window.studyData.originalQuestions];\n        }\n\n        window.studyData.currentIndex = 0;\n        window.studyData.correctCount = 0;\n        window.studyData.incorrectCount = 0;\n\n        outputArea.innerHTML = `<div id=\"studyArea\" style=\"margin: 10px; border: 5px solid black; width: calc(100% - 20px); min-height: 300px; padding: 5px; border-radius: 8px; background-color: white; font-size: 22px; position: relative; display: flex; flex-direction: column; align-items: center;\">Loading...</div>`;\n        studyArea = document.getElementById(\"studyArea\");\n\n        if (!studyArea) {\n            console.error(\"Failed to create studyArea element.\");\n            outputArea.innerHTML = \"<p style='color: red;'>Error: Could not initialize study area.</p>\";\n            return;\n        }\n\n        initializeInnerStructure(studyArea); // Sets up internal elements including sub-topic display\n        showQuestion(); // Display the first question\n    }\n\n    function showTopicSelection() {\n        let topicCheckboxesHTML = '<h3 style=\"margin-top: 0; margin-bottom: 15px;\">Select Topics:</h3>';\n        const topicNames = Object.keys(topicObject);\n\n        if (topicNames.length === 0) {\n            outputArea.innerHTML = `\n                <div style=\"margin: 10px; border: 5px solid black; width: calc(100% - 20px); max-width: 800px; min-height: 150px; padding: 20px; border-radius: 8px; background-color: white; font-size: 22px; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1); box-sizing: border-box;\">\n                    <p style='color: orange; text-align: center; margin: 0;'>No study topics have been defined.</p>\n                </div>`;\n            return;\n        }\n\n\n        topicNames.forEach((topicName, index) => {\n            const safeId = `topic_${index}_${topicName.replace(/[^a-zA-Z0-9_-]/g, '')}`; // Ensure valid ID\n            topicCheckboxesHTML += `\n                <div style=\"margin-bottom: 10px;\">\n                    <input type=\"checkbox\" id=\"${safeId}\" name=\"topic\" value=\"${topicName}\" style=\"margin-right: 8px; vertical-align: middle; transform: scale(1.1);\">\n                    <label for=\"${safeId}\" style=\"vertical-align: middle; cursor: pointer;\">${topicName}</label>\n                </div>\n            `;\n        });\n\n\n        let optionsHTML = `\n            <h3 style=\"margin-top: 20px; margin-bottom: 15px;\">Options:</h3>\n            <div style=\"margin-bottom: 10px;\">\n                <input type=\"checkbox\" id=\"option_looping\" name=\"looping\" style=\"margin-right: 8px; vertical-align: middle; transform: scale(1.1);\">\n                <label for=\"option_looping\" style=\"vertical-align: middle; cursor: pointer;\">Looping (Restart questions when finished)</label>\n            </div>\n            <div>\n                <input type=\"checkbox\" id=\"option_randomOrder\" name=\"randomOrder\" style=\"margin-right: 8px; vertical-align: middle; transform: scale(1.1);\">\n                <label for=\"option_randomOrder\" style=\"vertical-align: middle; cursor: pointer;\">Random Order (Shuffle questions)</label>\n            </div>\n        `;\n\n\n        let startButtonHTML = `<button id=\"startStudyButton\" style=\"margin-top: 25px; padding: 12px 25px; font-size: 18px; cursor: pointer; background-color: #28a745; color: white; border: none; border-radius: 5px; transition: background-color 0.2s; font-weight: bold;\">Start Study Session</button>`;\n\n\n        outputArea.innerHTML = `\n            <div style=\"margin: 10px; border: 5px solid black; width: calc(100% - 20px); min-height: calc(100% - 20px); padding: 20px; border-radius: 8px; background-color: white; font-size: 18px; position: relative; display: flex; flex-direction: column; box-shadow: 0 4px 8px rgba(0,0,0,0.1); box-sizing: border-box;\">\n                <h1><b><u>${topicTitle}</u></b></h1>\n                ${topicCheckboxesHTML}\n                <hr style=\"margin: 20px 0; border: 0; border-top: 1px solid #ddd;\">\n                ${optionsHTML}\n                <hr style=\"margin: 20px 0; border: 0; border-top: 1px solid #ddd;\">\n                <div style=\"text-align: center; margin-top: auto; padding-top: 10px;\"> ${startButtonHTML}\n                </div>\n            </div>\n        `;\n\n        const startButton = document.getElementById('startStudyButton');\n        if (startButton) {\n            startButton.onmouseover = () => startButton.style.backgroundColor = '#218838';\n            startButton.onmouseout = () => startButton.style.backgroundColor = '#28a745';\n\n            startButton.addEventListener('click', () => {\n                const selectedTopics = [];\n                document.querySelectorAll('input[name=\"topic\"]:checked').forEach(checkbox => {\n                    selectedTopics.push(checkbox.value);\n                });\n\n                if (selectedTopics.length === 0) {\n                    alert(\"Please select at least one topic to study.\");\n                    return;\n                }\n\n                // --- Modified: Create structured question data ---\n                let combinedQuestionObjects = [];\n                selectedTopics.forEach(topicName => {\n                    if (topicObject[topicName] && Array.isArray(topicObject[topicName])) {\n                        // For each question array in this topic, create an object\n                        topicObject[topicName].forEach(questionArray => {\n                            if (Array.isArray(questionArray) && questionArray.length >= 3) { // Basic validation\n                                combinedQuestionObjects.push({\n                                    subTopic: topicName, // Store the sub-topic name\n                                    data: questionArray   // Store the original question array\n                                });\n                            } else {\n                                console.warn(`Skipping invalid question data in topic \"${topicName}\":`, questionArray);\n                            }\n                        });\n                    } else {\n                        console.warn(`Topic \"${topicName}\" selected but not found or is not an array in the provided topicObject.`);\n                    }\n                });\n                // ----------------------------------------------------\n\n                 if (combinedQuestionObjects.length === 0) {\n                    alert(\"No valid questions were found for the selected topic(s). Please check the topic data format (should be arrays like ['Q', 'A', 'Inc1', ..., 'Feedback']).\");\n                    return;\n                 }\n\n\n                const config = {\n                    looping: document.getElementById('option_looping').checked,\n                    randomOrder: document.getElementById('option_randomOrder').checked\n                };\n\n                // Pass the structured array to startStudySession\n                startStudySession(combinedQuestionObjects, config);\n            });\n        } else {\n            console.error(\"Could not find the #startStudyButton element to attach event listener.\");\n        }\n    }\n\n    // Initial call to display the topic selection screen\n    showTopicSelection();\n\n};",
        "File Handling": "J:// F I L E   H A N D L I N G\n\nwindow.previewFile = function() {\n    path.pop(); showOption();\n    const file = notes[\"Files\"][path[path.length - 1]];\n    const fileType = file[\"!Type\"];\n    if (fileType == \"Image\") {\n        outputArea.innerHTML = `<img src=\"${file[\"!Data\"]}\" style=\"width:calc(100% - 30px); margin:10px; border:solid black 5px; border-radius: 5px; image-rendering: pixelated;\"></img>`\n    } else if (fileType == \"Audio\") {\n        outputArea.innerHTML = `<audio controls style=\"margin:10px; width:calc(100% - 30px); border: solid black 5px; border-radius: 34px;\"><source src=\"${file[\"!Data\"]}\" type=\"audio/mpeg\"></audio>`\n    } else if (fileType == \"Video\") {\n        outputArea.innerHTML = `<video controls style=\"margin:10px; width:calc(100% - 30px); border: solid black 5px; border-radius: 34px;\"><source src=\"${file[\"!Data\"]}\" type=\"video/mp4\"></video>`;\n    } else if (fileType === \"Text\" || fileType === \"JS\") {\n        const textContent = atob(file[\"!Data\"].split(',')[1]);\n        outputArea.innerHTML = `<textarea readonly style=\"width:calc(100% - 18px); min-height: calc(100vh - 18px); margin:10px; border: solid black 5px; border-radius: 5px; padding: 5px; white-space: pre-wrap;\">${textContent}</textarea>`;\n    } else if (fileType == \"HTML\") {\n        const htmlContent = atob(file[\"!Data\"].split(',')[1]);\n        const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(htmlContent)}`;\n        outputArea.innerHTML = `<iframe src=\"${dataUrl}\" style=\"width:calc(100% - 30px); height: calc(100vh - 30px); margin:10px; border: solid black 5px; border-radius: 5px;\"></iframe>`;\n    } else {\n        alert(\"This file cannot be Previewed.\")\n    }\n}\n\nwindow.editFile = function() {\n    path.pop();\n    const file = notes[\"Files\"][path[path.length - 1]];\n    const fileType = file[\"!Type\"];\n\n    optionsArea.innerHTML = \"\";\n    outputArea.innerHTML = \"\";\n\n    if (fileType == \"Image\") {\n        const palette = [\n            '#000000', '#1D2B53', '#7E2553', '#008751',\n            '#AB5236', '#5F574F', '#C2C3C7', '#FFF1E8',\n            '#FF004D', '#FFA300', '#FFEC27', '#00E436',\n            '#29ADFF', '#83769C', '#FF77A8', '#FFCCAA'\n        ];\n        const gridSize = 16; // Configurable grid size\n        let selectedColor = palette[0];\n        let zoomLevel = 1;\n        const minZoom = 1;\n        const maxZoom = 32;\n        let panX = 0;\n        let panY = 0;\n        let isMouseLeftDown = false;\n        let isMouseMiddlePanning = false;\n        let isMouseLeftPanning = false;\n        let lastPointerX = 0;\n        let lastPointerY = 0;\n        let hoverPixelX = -1;\n        let hoverPixelY = -1;\n        let isPanModeActive = false;\n        let isEraseModeActive = false;\n        let isGridVisible = false;\n\n        let touchPoints = {};\n        let isPinching = false;\n        let initialPinchDistance = 0;\n        let pinchStartZoom = 1;\n        let touchActionIdentifier = null;\n        let isTouchPanning = false;\n        let potentialTap = false;\n        const tapThreshold = 10;\n\n        let isTouchDrawing = false;\n        let lastPinchMidpoint = null;\n\n        const dataCanvas = document.createElement('canvas');\n        const dataCtx = dataCanvas.getContext('2d', { willReadFrequently: true });\n        dataCtx.imageSmoothingEnabled = false;\n\n        outputArea.innerHTML = `\n            <div style=\"display: flex; flex-direction: column; align-items: center; padding: 10px; height: calc(100vh - 150px);\">\n                <div id=\"canvasContainer\" style=\"overflow: hidden; border: 1px solid black; margin-bottom: 10px; width: 90%; height: 80%; position: relative; background-color: #cccccc; touch-action: none;\">\n                    <canvas id=\"displayCanvas\" style=\"position: absolute; top: 0; left: 0; image-rendering: pixelated; image-rendering: crisp-edges; cursor: crosshair; display: block;\"></canvas>\n                </div>\n                <div style=\"display: flex; justify-content: center; align-items: center; margin-bottom: 10px; flex-wrap: wrap;\">\n                    <div id=\"paletteContainer\" style=\"line-height: 0; margin-right: 15px;\"></div>\n                    <button id=\"panModeButton\" style=\"padding: 5px 10px; margin-left: 5px; border: 1px solid #888; border-radius: 4px; background-color: #f0f0f0; cursor: pointer;\">Pan: OFF</button>\n                    <button id=\"eraseModeButton\" style=\"padding: 5px 10px; margin-left: 5px; border: 1px solid #888; border-radius: 4px; background-color: #f0f0f0; cursor: pointer;\">Erase: OFF</button>\n                    <button id=\"gridToggleButton\" style=\"padding: 5px 10px; margin-left: 5px; border: 1px solid #888; border-radius: 4px; background-color: #f0f0f0; cursor: pointer;\">Grid: OFF</button>\n                </div>\n                <div id=\"editorInfo\" style=\"font-size: 0.8em; color: #555; min-height: 1.2em;\"></div>\n            </div>\n        `;\n\n        const canvasContainer = document.getElementById('canvasContainer');\n        const displayCanvas = document.getElementById('displayCanvas');\n        const displayCtx = displayCanvas.getContext('2d');\n        displayCtx.imageSmoothingEnabled = false;\n        const paletteContainer = document.getElementById('paletteContainer');\n        const editorInfo = document.getElementById('editorInfo');\n        const panModeButton = document.getElementById('panModeButton');\n        const eraseModeButton = document.getElementById('eraseModeButton');\n        const gridToggleButton = document.getElementById('gridToggleButton'); // Get grid button\n\n        palette.forEach((color, index) => {\n            const swatch = document.createElement('div');\n            swatch.style.width = '20px';\n            swatch.style.height = '20px';\n            swatch.style.backgroundColor = color;\n            swatch.style.border = '1px solid #ccc';\n            swatch.style.display = 'inline-block';\n            swatch.style.margin = '1px';\n            swatch.style.cursor = 'pointer';\n            if (index === 0) { swatch.style.border = '2px solid blue'; }\n            swatch.addEventListener('click', () => {\n                isEraseModeActive = false;\n                eraseModeButton.textContent = `Erase: OFF`;\n                eraseModeButton.style.backgroundColor = '#f0f0f0';\n\n                selectedColor = color;\n                Array.from(paletteContainer.children).forEach((child, i) => {\n                    child.style.border = i === index ? '2px solid blue' : '1px solid #ccc';\n                });\n                if (!isPanModeActive) {\n                    displayCanvas.style.cursor = 'crosshair';\n                }\n            });\n            paletteContainer.appendChild(swatch);\n        });\n\n        panModeButton.addEventListener('click', () => {\n            isPanModeActive = !isPanModeActive;\n            panModeButton.textContent = `Pan: ${isPanModeActive ? 'ON' : 'OFF'}`;\n            panModeButton.style.backgroundColor = isPanModeActive ? '#a0d0a0' : '#f0f0f0';\n            if (isPanModeActive) {\n                 displayCanvas.style.cursor = 'grab';\n            } else {\n                 displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n            }\n            isMouseLeftDown = false;\n            isTouchDrawing = false;\n            isMouseLeftPanning = false;\n            isTouchPanning = false;\n        });\n\n        eraseModeButton.addEventListener('click', () => {\n            isEraseModeActive = !isEraseModeActive;\n            eraseModeButton.textContent = `Erase: ${isEraseModeActive ? 'ON' : 'OFF'}`;\n            eraseModeButton.style.backgroundColor = isEraseModeActive ? '#ffaaaa' : '#f0f0f0';\n            if (isEraseModeActive) {\n                Array.from(paletteContainer.children).forEach(child => {\n                     child.style.border = '1px solid #ccc';\n                });\n            }\n            if (!isPanModeActive) {\n                 displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n            }\n        });\n\n        gridToggleButton.addEventListener('click', () => {\n            isGridVisible = !isGridVisible;\n            gridToggleButton.textContent = `Grid: ${isGridVisible ? 'ON' : 'OFF'}`;\n            gridToggleButton.style.backgroundColor = isGridVisible ? '#a0a0d0' : '#f0f0f0';\n            redrawDisplayCanvas(); // Redraw to show/hide grid\n        });\n\n        function resizeAndRedraw() {\n            displayCanvas.width = canvasContainer.clientWidth;\n            displayCanvas.height = canvasContainer.clientHeight;\n            displayCtx.imageSmoothingEnabled = false;\n            redrawDisplayCanvas();\n        }\n\n        function redrawDisplayCanvas() {\n            if (!dataCanvas.width || !dataCanvas.height) return;\n            displayCtx.imageSmoothingEnabled = false;\n            displayCtx.fillStyle = '#cccccc';\n            displayCtx.fillRect(0, 0, displayCanvas.width, displayCanvas.height);\n            displayCtx.save();\n            displayCtx.scale(zoomLevel, zoomLevel);\n            displayCtx.translate(-panX, -panY);\n            displayCtx.drawImage(dataCanvas, 0, 0);\n\n            displayCtx.strokeStyle = 'rgba(0, 0, 0, 0.5)';\n            displayCtx.lineWidth = 1 / zoomLevel;\n            displayCtx.strokeRect(0, 0, dataCanvas.width, dataCanvas.height);\n\n            // Draw grid overlay if visible\n            if (isGridVisible) {\n                displayCtx.strokeStyle = 'rgba(0, 0, 0, 0.3)'; // Semi-transparent black grid\n                displayCtx.lineWidth = 1 / zoomLevel;\n                displayCtx.beginPath();\n                // Vertical lines\n                for (let x = gridSize; x < dataCanvas.width; x += gridSize) {\n                    displayCtx.moveTo(x, 0);\n                    displayCtx.lineTo(x, dataCanvas.height);\n                }\n                // Horizontal lines\n                for (let y = gridSize; y < dataCanvas.height; y += gridSize) {\n                    displayCtx.moveTo(0, y);\n                    displayCtx.lineTo(dataCanvas.width, y);\n                }\n                displayCtx.stroke();\n            }\n\n            if (hoverPixelX !== -1 && hoverPixelY !== -1 && !isPinching && Object.keys(touchPoints).length === 0 && !isMouseLeftDown && !isMouseMiddlePanning && !isMouseLeftPanning && !isTouchDrawing && !isTouchPanning) {\n                displayCtx.strokeStyle = \"rgba(255, 255, 255, 0.8)\";\n                displayCtx.lineWidth = 1 / zoomLevel;\n                 displayCtx.strokeRect(hoverPixelX + (0.5 / zoomLevel) / 2, hoverPixelY + (0.5 / zoomLevel) / 2, 1 - (0.5 / zoomLevel), 1 - (0.5 / zoomLevel));\n            }\n            displayCtx.restore();\n            editorInfo.textContent = `Image: ${dataCanvas.width}x${dataCanvas.height}px | Zoom: ${zoomLevel.toFixed(2)}x | View: (${Math.round(panX)}, ${Math.round(panY)}) | Hover: (${hoverPixelX}, ${hoverPixelY})`;\n        }\n\n        function getPixelCoords(clientX, clientY) {\n            const rect = displayCanvas.getBoundingClientRect();\n            const canvasX = clientX - rect.left;\n            const canvasY = clientY - rect.top;\n            const imgX = (canvasX / zoomLevel) + panX;\n            const imgY = (canvasY / zoomLevel) + panY;\n            return { x: Math.floor(imgX), y: Math.floor(imgY) };\n        }\n\n        function getDistance(p1, p2) {\n            const dx = p1.clientX - p2.clientX;\n            const dy = p1.clientY - p2.clientY;\n            return Math.sqrt(dx * dx + dy * dy);\n        }\n\n        function getMidpoint(p1, p2) {\n            return {\n                clientX: (p1.clientX + p2.clientX) / 2,\n                clientY: (p1.clientY + p2.clientY) / 2,\n            };\n        }\n\n        const img = new Image();\n        img.onload = () => {\n            dataCanvas.width = img.naturalWidth;\n            dataCanvas.height = img.naturalHeight;\n            dataCtx.imageSmoothingEnabled = false;\n            dataCtx.drawImage(img, 0, 0);\n            resizeAndRedraw();\n            window.addEventListener('resize', resizeAndRedraw);\n        };\n        img.onerror = () => { outputArea.innerHTML = `<p style=\"color: red;\">Error loading image data.</p>`; alert(\"Could not load the image for editing.\"); };\n        img.src = file[\"!Data\"];\n\n        function drawPixel(x, y) {\n            if (x >= 0 && x < dataCanvas.width && y >= 0 && y < dataCanvas.height) {\n                if (isEraseModeActive) {\n                    dataCtx.clearRect(x, y, 1, 1);\n                } else {\n                    dataCtx.imageSmoothingEnabled = false;\n                    dataCtx.fillStyle = selectedColor;\n                    dataCtx.fillRect(x, y, 1, 1);\n                }\n                redrawDisplayCanvas();\n            }\n        }\n\n        function handlePointerDown(identifier, clientX, clientY, isPrimary, eventSource) {\n            touchPoints[identifier] = { clientX, clientY, startX: clientX, startY: clientY, startTime: performance.now() };\n            const touchCount = Object.keys(touchPoints).length;\n\n            if (touchCount === 1 && isPrimary) {\n                touchActionIdentifier = identifier;\n                lastPointerX = clientX;\n                lastPointerY = clientY;\n                isTouchPanning = false;\n                isMouseLeftPanning = false;\n                isTouchDrawing = false;\n                potentialTap = true;\n\n                if (isPanModeActive) {\n                    if (eventSource === 'touch') { isTouchPanning = true; }\n                    if (eventSource === 'mouse') { isMouseLeftPanning = true; }\n                    displayCanvas.style.cursor = 'grabbing';\n                } else {\n                    const coords = getPixelCoords(clientX, clientY);\n                    if (eventSource === 'mouse') {\n                        isMouseLeftDown = true;\n                        drawPixel(coords.x, coords.y);\n                    } else if (eventSource === 'touch') {\n                        isTouchDrawing = true;\n                        drawPixel(coords.x, coords.y);\n                    }\n                    displayCanvas.style.cursor = isEraseModeActive ? 'cell' : 'crosshair';\n                }\n                hoverPixelX = -1;\n                hoverPixelY = -1;\n            } else if (touchCount === 2) {\n                isMouseLeftDown = false;\n                isTouchDrawing = false;\n                isTouchPanning = false;\n                isMouseLeftPanning = false;\n                isPinching = true;\n                potentialTap = false;\n                const touches = Object.values(touchPoints);\n                initialPinchDistance = getDistance(touches[0], touches[1]);\n                pinchStartZoom = zoomLevel;\n                lastPinchMidpoint = getMidpoint(touches[0], touches[1]);\n                displayCanvas.style.cursor = 'move';\n                hoverPixelX = -1;\n                hoverPixelY = -1;\n            }\n            if (isPinching || (!isPanModeActive && (isMouseLeftDown || isTouchDrawing))) {\n               redrawDisplayCanvas();\n            }\n        }\n\n        function handlePointerMove(identifier, clientX, clientY) {\n            if (identifier === 'mouse' && !isMouseLeftDown && !isMouseMiddlePanning && !isMouseLeftPanning && Object.keys(touchPoints).length === 0 && !isPinching && !isTouchDrawing && !isTouchPanning) {\n                const coords = getPixelCoords(clientX, clientY);\n                let needsRedraw = false;\n                let newHoverX = -1, newHoverY = -1;\n                if (coords.x >= 0 && coords.x < dataCanvas.width && coords.y >= 0 && coords.y < dataCanvas.height) {\n                    newHoverX = coords.x; newHoverY = coords.y;\n                }\n                if (newHoverX !== hoverPixelX || newHoverY !== hoverPixelY) {\n                    hoverPixelX = newHoverX; hoverPixelY = newHoverY; needsRedraw = true;\n                }\n                if (needsRedraw) redrawDisplayCanvas();\n                return;\n            }\n\n            if (!touchPoints[identifier]) return;\n\n            const currentPointer = touchPoints[identifier];\n            const startInfo = touchPoints[identifier];\n            currentPointer.clientX = clientX;\n            currentPointer.clientY = clientY;\n\n            const touchCount = Object.keys(touchPoints).length;\n\n            if (isPinching && touchCount === 2) {\n                potentialTap = false;\n                const touches = Object.values(touchPoints);\n                const currentDistance = getDistance(touches[0], touches[1]);\n                const currentMidpoint = getMidpoint(touches[0], touches[1]);\n\n                if (initialPinchDistance > 0 && lastPinchMidpoint) {\n                    const zoomRatio = currentDistance / initialPinchDistance;\n                    const newZoomLevelTarget = pinchStartZoom * zoomRatio;\n                    const newZoomLevel = Math.max(minZoom, Math.min(maxZoom, newZoomLevelTarget));\n\n                    const rect = displayCanvas.getBoundingClientRect();\n                    const canvasMidX = currentMidpoint.clientX - rect.left;\n                    const canvasMidY = currentMidpoint.clientY - rect.top;\n\n                    const imgXUnderMidpoint = (canvasMidX / zoomLevel) + panX;\n                    const imgYUnderMidpoint = (canvasMidY / zoomLevel) + panY;\n\n                    let zoomCorrectedPanX = imgXUnderMidpoint - (canvasMidX / newZoomLevel);\n                    let zoomCorrectedPanY = imgYUnderMidpoint - (canvasMidY / newZoomLevel);\n\n                    const deltaMidX = currentMidpoint.clientX - lastPinchMidpoint.clientX;\n                    const deltaMidY = currentMidpoint.clientY - lastPinchMidpoint.clientY;\n\n                    let finalPanX = zoomCorrectedPanX - (deltaMidX / newZoomLevel);\n                    let finalPanY = zoomCorrectedPanY - (deltaMidY / newZoomLevel);\n\n                    if (Math.abs(newZoomLevel - zoomLevel) > 0.001 || Math.abs(finalPanX - panX) > 0.1 || Math.abs(finalPanY - panY) > 0.1) {\n                        zoomLevel = newZoomLevel;\n                        panX = finalPanX;\n                        panY = finalPanY;\n                        redrawDisplayCanvas();\n                    }\n                }\n                lastPinchMidpoint = currentMidpoint;\n\n            }\n            else if (identifier === touchActionIdentifier && !isPinching) {\n                const dxPanDelta = clientX - lastPointerX;\n                const dyPanDelta = clientY - lastPointerY;\n\n                if (potentialTap) {\n                    const dxMoveTotal = clientX - startInfo.startX;\n                    const dyMoveTotal = clientY - startInfo.startY;\n                    const distanceMoved = Math.sqrt(dxMoveTotal * dxMoveTotal + dyMoveTotal * dyMoveTotal);\n                    if (distanceMoved > tapThreshold) {\n                        potentialTap = false;\n                        if (isPanModeActive && !isTouchPanning && !isMouseLeftPanning) {\n                             if (identifier === 'mouse') isMouseLeftPanning = true;\n                             else isTouchPanning = true;\n                             displayCanvas.style.cursor = 'grabbing';\n                        }\n                    }\n                }\n\n                if ((isTouchPanning || isMouseLeftPanning) && isPanModeActive) {\n                    potentialTap = false;\n                    panX -= dxPanDelta / zoomLevel;\n                    panY -= dyPanDelta / zoomLevel;\n                    if (displayCanvas.style.cursor !== 'grabbing') { displayCanvas.style.cursor = 'grabbing';}\n                    redrawDisplayCanvas();\n                }\n                else if (isMouseLeftDown && !isPanModeActive) {\n                    potentialTap = false;\n                    const coords = getPixelCoords(clientX, clientY);\n                    drawPixel(coords.x, coords.y);\n                }\n                else if (isTouchDrawing && !isPanModeActive) {\n                    potentialTap = false;\n                    const coords = getPixelCoords(clientX, clientY);\n                    drawPixel(coords.x, coords.y);\n                }\n\n                lastPointerX = clientX;\n                lastPointerY = clientY;\n            }\n        }\n\n        function handlePointerUp(identifier, clientX, clientY) {\n            const startInfo = touchPoints[identifier];\n            const touchCountBeforeEnd = Object.keys(touchPoints).length;\n\n            delete touchPoints[identifier];\n            const touchCountAfterEnd = Object.keys(touchPoints).length;\n\n            let cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n\n            if (isPinching && touchCountBeforeEnd === 2 && touchCountAfterEnd < 2) {\n                isPinching = false;\n                initialPinchDistance = 0;\n                lastPinchMidpoint = null;\n                if (touchCountAfterEnd === 1) {\n                    const remainingTouchId = Object.keys(touchPoints)[0];\n                    const remainingTouch = touchPoints[remainingTouchId];\n                    touchActionIdentifier = remainingTouchId;\n                    lastPointerX = remainingTouch.clientX;\n                    lastPointerY = remainingTouch.clientY;\n                    isTouchPanning = false;\n                    isTouchDrawing = false;\n                    potentialTap = false;\n\n                    if (isPanModeActive) {\n                        isTouchPanning = true;\n                        cursor = 'grabbing';\n                    } else {\n                         isTouchDrawing = false;\n                         cursor = isEraseModeActive ? 'cell' : 'crosshair';\n                    }\n                    remainingTouch.startX = remainingTouch.clientX;\n                    remainingTouch.startY = remainingTouch.clientY;\n                    remainingTouch.startTime = performance.now();\n                    potentialTap = true;\n\n                } else {\n                    touchActionIdentifier = null;\n                }\n            }\n            else if (identifier === touchActionIdentifier) {\n                if (!isPanModeActive && !isTouchDrawing && !isMouseLeftDown && potentialTap && startInfo) {\n                     const dxMoveTotal = clientX - startInfo.startX;\n                     const dyMoveTotal = clientY - startInfo.startY;\n                     const distanceMoved = Math.sqrt(dxMoveTotal * dxMoveTotal + dyMoveTotal * dyMoveTotal);\n\n                     if (distanceMoved <= tapThreshold) {\n                         const coords = getPixelCoords(clientX, clientY);\n                         drawPixel(coords.x, coords.y);\n                    }\n                }\n\n                isTouchPanning = false;\n                isMouseLeftDown = false;\n                isMouseLeftPanning = false;\n                isTouchDrawing = false;\n                potentialTap = false;\n                touchActionIdentifier = null;\n            }\n\n            if (touchCountAfterEnd === 0) {\n                isTouchPanning = false;\n                isMouseLeftDown = false;\n                isMouseLeftPanning = false;\n                isTouchDrawing = false;\n                isPinching = false;\n                potentialTap = false;\n                touchActionIdentifier = null;\n                lastPinchMidpoint = null;\n                cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n            }\n\n            displayCanvas.style.cursor = cursor;\n            redrawDisplayCanvas();\n        }\n\n        displayCanvas.addEventListener('mousedown', (e) => {\n            if (e.button === 0) {\n                handlePointerDown('mouse', e.clientX, e.clientY, true, 'mouse');\n            } else if (e.button === 1) {\n                isMouseMiddlePanning = true;\n                lastPointerX = e.clientX;\n                lastPointerY = e.clientY;\n                displayCanvas.style.cursor = 'grabbing';\n                e.preventDefault();\n            }\n        });\n\n        displayCanvas.addEventListener('mousemove', (e) => {\n             if (isMouseMiddlePanning && (e.buttons & 4)) {\n                 const dx = e.clientX - lastPointerX;\n                 const dy = e.clientY - lastPointerY;\n                 panX -= dx / zoomLevel;\n                 panY -= dy / zoomLevel;\n                 lastPointerX = e.clientX;\n                 lastPointerY = e.clientY;\n                 redrawDisplayCanvas();\n             }\n             else {\n                 handlePointerMove('mouse', e.clientX, e.clientY);\n             }\n        });\n\n        displayCanvas.addEventListener('mouseup', (e) => {\n            if (e.button === 0) {\n                handlePointerUp('mouse', e.clientX, e.clientY);\n            } else if (e.button === 1) {\n                isMouseMiddlePanning = false;\n                 displayCanvas.style.cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n                 redrawDisplayCanvas();\n            }\n        });\n\n        displayCanvas.addEventListener('mouseleave', (e) => {\n             if (touchPoints['mouse']) {\n                 handlePointerUp('mouse', e.clientX, e.clientY);\n             }\n             if (isMouseMiddlePanning) {\n                 isMouseMiddlePanning = false;\n                 displayCanvas.style.cursor = isPanModeActive ? 'grab' : (isEraseModeActive ? 'cell' : 'crosshair');\n             }\n             if (hoverPixelX !== -1 || hoverPixelY !== -1) {\n                 hoverPixelX = -1;\n                 hoverPixelY = -1;\n                 redrawDisplayCanvas();\n             }\n        });\n\n        displayCanvas.addEventListener('wheel', (e) => {\n            e.preventDefault();\n            const rect = displayCanvas.getBoundingClientRect();\n            const mouseX = e.clientX - rect.left;\n            const mouseY = e.clientY - rect.top;\n\n            const imgXBefore = (mouseX / zoomLevel) + panX;\n            const imgYBefore = (mouseY / zoomLevel) + panY;\n\n            const zoomFactor = 1.2;\n            let newZoomLevel;\n            if (e.deltaY < 0) {\n                newZoomLevel = Math.min(maxZoom, zoomLevel * zoomFactor);\n            } else {\n                newZoomLevel = Math.max(minZoom, zoomLevel / zoomFactor);\n            }\n\n            if(Math.abs(newZoomLevel - zoomLevel) < 0.001) return;\n\n            panX = imgXBefore - (mouseX / newZoomLevel);\n            panY = imgYBefore - (mouseY / newZoomLevel);\n\n            zoomLevel = newZoomLevel;\n\n            handlePointerMove('mouse', e.clientX, e.clientY);\n\n            redrawDisplayCanvas();\n        });\n\n        displayCanvas.addEventListener('touchstart', (e) => {\n            e.preventDefault();\n            for (let i = 0; i < e.changedTouches.length; i++) {\n                const touch = e.changedTouches[i];\n                const isPrimary = Object.keys(touchPoints).length === 0 && i === 0;\n                handlePointerDown(touch.identifier, touch.clientX, touch.clientY, isPrimary, 'touch');\n            }\n        }, { passive: false });\n\n        displayCanvas.addEventListener('touchmove', (e) => {\n            e.preventDefault();\n            for (let i = 0; i < e.changedTouches.length; i++) {\n                const touch = e.changedTouches[i];\n                 if (touchPoints[touch.identifier]) {\n                     handlePointerMove(touch.identifier, touch.clientX, touch.clientY);\n                 }\n            }\n        }, { passive: false });\n\n        displayCanvas.addEventListener('touchend', (e) => {\n            e.preventDefault();\n            for (let i = 0; i < e.changedTouches.length; i++) {\n                const touch = e.changedTouches[i];\n                 if (touchPoints[touch.identifier]) {\n                     handlePointerUp(touch.identifier, touch.clientX, touch.clientY);\n                 }\n            }\n        }, { passive: false });\n\n        displayCanvas.addEventListener('touchcancel', (e) => {\n           e.preventDefault();\n           for (let i = 0; i < e.changedTouches.length; i++) {\n               const touch = e.changedTouches[i];\n               if (touchPoints[touch.identifier]) {\n                  handlePointerUp(touch.identifier, touch.clientX, touch.clientY);\n               }\n           }\n        }, { passive: false });\n\n\n        const saveSprite = () => {\n            try {\n                const newDataUrl = dataCanvas.toDataURL();\n                file[\"!Data\"] = newDataUrl;\n                saveData();\n                path.pop(); showOption();\n                alert(\"Sprite saved successfully!\");\n            } catch (error) {\n                console.error(\"Error saving sprite:\", error);\n                alert(\"Error saving sprite.\");\n            }\n        };\n        newOptionButton(\"Save Sprite\", \"#393939\", saveSprite);\n\n    } else {\n        alert(\"This file type cannot be Edited.\");\n        path.pop(); showOption();\n    }\n};\n\nwindow.renameFile = function() {\n    path.pop();\n    const newFileName = prompt(\"Please enter the new name for the file.\");\n    if (!(newFileName in notes[\"Files\"])) {\n        notes[\"Files\"][newFileName] = notes[\"Files\"][path[path.length - 1]];\n        delete notes[\"Files\"][path.pop()];\n        const tempUpload = notes[\"Files\"][\"Upload\"];\n        const tempCustomImage = notes[\"Files\"][\"Create Image\"];\n        const tempCustomSFX = notes[\"Files\"][\"Create SFX\"];\n        delete notes[\"Files\"][\"Upload\"];\n        delete notes[\"Files\"][\"Create Image\"];\n        delete notes[\"Files\"][\"Create SFX\"];\n        notes[\"Files\"][\"Create Image\"] = tempCustomImage;\n        notes[\"Files\"][\"Create SFX\"] = tempCustomSFX;\n        notes[\"Files\"][\"Upload\"] = tempUpload;\n        saveData();\n    } else {\n        alert(\"File with that name already exists.\");\n    }\n    showOption();\n}\n\nwindow.downloadFile = function() {\n    const byteCharacters = atob(notes[\"Files\"][path[path.length - 1]][\"!Data\"].split(',')[1]);\n    const byteArrays = [];\n    for (let offset = 0; offset < byteCharacters.length; offset += 512) {\n        const slice = byteCharacters.slice(offset, offset + 512);\n        const byteNumbers = new Array(slice.length);\n        for (let i = 0; i < slice.length; i++) {\n            byteNumbers[i] = slice.charCodeAt(i);\n        }\n        const byteArray = new Uint8Array(byteNumbers);\n        byteArrays.push(byteArray);\n    }\n    const blob = new Blob(byteArrays, { type: notes[\"Files\"][path[path.length - 1]][\"!Data\"].split(',')[0].split(':')[1].split(';')[0] });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = notes[\"Files\"][path[path.length - 1]][\"!Name\"];\n    link.click();\n    URL.revokeObjectURL(url);\n    path.pop(); showOption();\n}\n\nwindow.deleteFile = function() {\n    path.pop()\n    delete notes[\"Files\"][path.pop()];\n    showOption();\n}"
    },
    "!Save": false
};
//MARK

        // D A T A B A S E   F O R   A U T O S A V E
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open("ToolKitDB", 1);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    window.db = request.result;
                    resolve();
                };
                request.onupgradeneeded = (event) => {
                    window.db = event.target.result;
                    window.db.createObjectStore("data", { keyPath: "id" });
                };
            });
        }
        
        function saveData() {
            return window.openDB().then(() => {
                const transaction = window.db.transaction(["data"], "readwrite");
                const objectStore = transaction.objectStore("data");
                const request = objectStore.put({
                    id: "allData",
                    notes: JSON.stringify(notes)
                });
                console.log("Saved Data")
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }
        
        function loadData() {
            return window.openDB().then(() => {
                const transaction = window.db.transaction(["data"], "readonly");
                const objectStore = transaction.objectStore("data");
                const request = objectStore.get("allData");
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        if (request.result) {
                            const oldNotes = JSON.parse(JSON.stringify(notes))
                            notes = JSON.parse(request.result.notes);
                            if (!notes["!Save"]) notes = oldNotes;
                            resolve({
                                notes: true
                            });
                        } else {
                            resolve({ notes : null });
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
            });
        }
        
        function resetData() {
            return new Promise((resolve, reject) => {
                console.log("Data Reset")
                const request = indexedDB.deleteDatabase("ScriptingDexDB");
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve();
            });
        }
        
        // S T A R T
        loadData().then(data => {
            if (data.notes === null) {
                window.saveData();
            }
            if (!notes["!Save"]) {
                console.log("Saving Disabled so running default Code.");
            } else {
                console.log("Saving Enabled so running most recent Auto-Save.");
            }
            const startJS = new Function(notes["!Functions"]["Start"].substring(2));
            startJS();
        });

    </script>
    <script>
        /*
        // Enable for offline Service Worker Functionality.
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('./service-worker.js')
            .then(registration => {
              console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch(error => {
              console.error('Service Worker registration failed:', error);
            });
        }
        */
    </script>
    <script>
        console.log(),
        /**
         * @license
         * Copyright 2010-2023 Three.js Authors
         * SPDX-License-Identifier: MIT
         */
        function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={})}(this,(function(t){"use strict";const e="160",n=1,i=2,r=3,s=0,a=1,o=100,l=204,c=205,h=0,u=1,d=2,p=0,m=1,f=2,g=3,_=4,v=5,x=6,y="attached",M="detached",S=300,b=301,T=302,E=303,w=304,A=306,R=1e3,C=1001,L=1002,P=1003,I=1004,U=1005,D=1006,N=1007,O=1008,F=1009,B=1012,z=1013,G=1014,H=1015,V=1016,k=1017,W=1018,X=1020,j=1023,q=1026,Y=1027,Z=1029,J=1031,K=1033,$=33776,Q=33777,tt=33778,et=33779,nt=35840,it=35841,rt=35842,st=35843,at=36196,ot=37492,lt=37496,ct=37808,ht=37809,ut=37810,dt=37811,pt=37812,mt=37813,ft=37814,gt=37815,_t=37816,vt=37817,xt=37818,yt=37819,Mt=37820,St=37821,bt=36492,Tt=36494,Et=36495,wt=36284,At=36285,Rt=36286,Ct=2300,Lt=2301,Pt=2302,It=2400,Ut=2401,Dt=2402,Nt=2500,Ot=2501,Ft=3e3,Bt=3001,zt="",Gt="srgb",Ht="srgb-linear",Vt="display-p3",kt="display-p3-linear",Wt="linear",Xt="srgb",jt="rec709",qt="p3",Yt=7680,Zt=35044,Jt="300 es",Kt=1035,$t=2e3,Qt=2001;class te{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const ee=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ne=1234567;const ie=Math.PI/180,re=180/Math.PI;function se(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ee[255&t]+ee[t>>8&255]+ee[t>>16&255]+ee[t>>24&255]+"-"+ee[255&e]+ee[e>>8&255]+"-"+ee[e>>16&15|64]+ee[e>>24&255]+"-"+ee[63&n|128]+ee[n>>8&255]+"-"+ee[n>>16&255]+ee[n>>24&255]+ee[255&i]+ee[i>>8&255]+ee[i>>16&255]+ee[i>>24&255]).toLowerCase()}function ae(t,e,n){return Math.max(e,Math.min(n,t))}function oe(t,e){return(t%e+e)%e}function le(t,e,n){return(1-n)*t+n*e}function ce(t){return 0==(t&t-1)&&0!==t}function he(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function ue(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function de(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const pe={DEG2RAD:ie,RAD2DEG:re,generateUUID:se,clamp:ae,euclideanModulo:oe,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:le,damp:function(t,e,n,i){return le(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(oe(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(ne=t);let e=ne+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*ie},radToDeg:function(t){return t*re},isPowerOfTwo:ce,ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:he,setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((e+i)/2),h=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),m=a((i-e)/2);switch(r){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*m,l*p,o*c);break;case"YXY":t.set(l*p,o*h,l*m,o*c);break;case"ZYZ":t.set(l*m,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:de,denormalize:ue};class me{constructor(t=0,e=0){me.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ae(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class fe{constructor(t,e,n,i,r,s,a,o,l){fe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l)}set(t,e,n,i,r,s,a,o,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],m=i[0],f=i[3],g=i[6],_=i[1],v=i[4],x=i[7],y=i[2],M=i[5],S=i[8];return r[0]=s*m+a*_+o*y,r[3]=s*f+a*v+o*M,r[6]=s*g+a*x+o*S,r[1]=l*m+c*_+h*y,r[4]=l*f+c*v+h*M,r[7]=l*g+c*x+h*S,r[2]=u*m+d*_+p*y,r[5]=u*f+d*v+p*M,r[8]=u*g+d*x+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=e*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*l-c*n)*m,t[2]=(a*n-i*s)*m,t[3]=u*m,t[4]=(c*e-i*o)*m,t[5]=(i*r-a*e)*m,t[6]=d*m,t[7]=(n*o-l*e)*m,t[8]=(s*e-n*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+t,-i*l,i*o,-i*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(ge.makeScale(t,e)),this}rotate(t){return this.premultiply(ge.makeRotation(-t)),this}translate(t,e){return this.premultiply(ge.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const ge=new fe;function _e(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const ve={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function xe(t,e){return new ve[t](e)}function ye(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Me(){const t=ye("canvas");return t.style.display="block",t}const Se={};function be(t){t in Se||(Se[t]=!0,console.warn(t))}const Te=(new fe).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Ee=(new fe).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),we={[Ht]:{transfer:Wt,primaries:jt,toReference:t=>t,fromReference:t=>t},[Gt]:{transfer:Xt,primaries:jt,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[kt]:{transfer:Wt,primaries:qt,toReference:t=>t.applyMatrix3(Ee),fromReference:t=>t.applyMatrix3(Te)},[Vt]:{transfer:Xt,primaries:qt,toReference:t=>t.convertSRGBToLinear().applyMatrix3(Ee),fromReference:t=>t.applyMatrix3(Te).convertLinearToSRGB()}},Ae=new Set([Ht,kt]),Re={enabled:!0,_workingColorSpace:Ht,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Ae.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const i=we[e].toReference;return(0,we[n].fromReference)(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return we[t].primaries},getTransfer:function(t){return t===zt?Wt:we[t].transfer}};function Ce(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Le(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Pe;class Ie{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Pe&&(Pe=ye("canvas")),Pe.width=t.width,Pe.height=t.height;const n=Pe.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Pe}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=ye("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*Ce(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ce(e[t]/255)):e[t]=Ce(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Ue=0;class De{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ue++}),this.uuid=se(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Ne(i[e].image)):t.push(Ne(i[e]))}else t=Ne(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function Ne(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Ie.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Oe=0;class Fe extends te{constructor(t=Fe.DEFAULT_IMAGE,e=Fe.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,a=1023,o=1009,l=Fe.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Oe++}),this.uuid=se(),this.name="",this.source=new De(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new me(0,0),this.repeat=new me(1,1),this.center=new me(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fe,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(be("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Bt?Gt:zt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==S)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case R:t.x=t.x-Math.floor(t.x);break;case C:t.x=t.x<0?0:1;break;case L:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case R:t.y=t.y-Math.floor(t.y);break;case C:t.y=t.y<0?0:1;break;case L:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return be("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Gt?Bt:Ft}set encoding(t){be("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Bt?Gt:zt}}Fe.DEFAULT_IMAGE=null,Fe.DEFAULT_MAPPING=S,Fe.DEFAULT_ANISOTROPY=1;class Be{constructor(t=0,e=0,n=0,i=1){Be.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,a=.1,o=t.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],m=o[2],f=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-m)<s&&Math.abs(p-f)<s){if(Math.abs(c+u)<a&&Math.abs(h+m)<a&&Math.abs(p+f)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,_=(g+1)/2,v=(c+u)/4,x=(h+m)/4,y=(p+f)/4;return t>o&&t>_?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=v/n,r=x/n):o>_?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=v/i,r=y/i):_<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=x/r,i=y/r),this.set(n,i,r,e),this}let _=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(_)<.001&&(_=1),this.x=(f-p)/_,this.y=(h-m)/_,this.z=(u-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ze extends te{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Be(0,0,t,e),this.scissorTest=!1,this.viewport=new Be(0,0,t,e);const i={width:t,height:e,depth:1};void 0!==n.encoding&&(be("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Bt?Gt:zt),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:D,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Fe(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new De(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ge extends ze{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class He extends Fe{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=P,this.minFilter=P,this.wrapR=C,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ve extends Fe{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=P,this.minFilter=P,this.wrapR=C,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ke{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],m=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(h!==m||o!==u||l!==d||c!==p){let t=1-a;const e=o*u+l*d+c*p+h*m,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+m*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=t,l*=t,c*=t,h*=t}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+c*h+o*d-l*u,t[e+1]=o*p+c*u+l*h-a*d,t[e+2]=l*p+c*d+a*u-o*h,t[e+3]=c*p-a*h-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=n+a+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-o)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>a&&n>h){const t=2*Math.sqrt(1+n-a-h);this._w=(c-o)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(a>h){const t=2*Math.sqrt(1+a-n-h);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+h-n-a);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ae(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class We{constructor(t=0,e=0,n=0){We.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(je.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(je.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=2*(s*i-a*n),c=2*(a*e-r*i),h=2*(r*n-s*e);return this.x=e+o*l+s*h-a*c,this.y=n+o*c+a*l-r*h,this.z=i+o*h+r*c-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Xe.copy(this).projectOnVector(t),this.sub(Xe)}reflect(t){return this.sub(Xe.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ae(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Xe=new We,je=new ke;class qe{constructor(t=new We(1/0,1/0,1/0),e=new We(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Ze.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Ze.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Ze.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Ze):Ze.fromBufferAttribute(i,e),Ze.applyMatrix4(t.matrixWorld),this.expandByPoint(Ze);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Je.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Je.copy(n.boundingBox)),Je.applyMatrix4(t.matrixWorld),this.union(Je)}const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ze),Ze.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(rn),sn.subVectors(this.max,rn),Ke.subVectors(t.a,rn),$e.subVectors(t.b,rn),Qe.subVectors(t.c,rn),tn.subVectors($e,Ke),en.subVectors(Qe,$e),nn.subVectors(Ke,Qe);let e=[0,-tn.z,tn.y,0,-en.z,en.y,0,-nn.z,nn.y,tn.z,0,-tn.x,en.z,0,-en.x,nn.z,0,-nn.x,-tn.y,tn.x,0,-en.y,en.x,0,-nn.y,nn.x,0];return!!ln(e,Ke,$e,Qe,sn)&&(e=[1,0,0,0,1,0,0,0,1],!!ln(e,Ke,$e,Qe,sn)&&(an.crossVectors(tn,en),e=[an.x,an.y,an.z],ln(e,Ke,$e,Qe,sn)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ze).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Ze).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Ye[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ye[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ye[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ye[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ye[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ye[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ye[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ye[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ye)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Ye=[new We,new We,new We,new We,new We,new We,new We,new We],Ze=new We,Je=new qe,Ke=new We,$e=new We,Qe=new We,tn=new We,en=new We,nn=new We,rn=new We,sn=new We,an=new We,on=new We;function ln(t,e,n,i,r){for(let s=0,a=t.length-3;s<=a;s+=3){on.fromArray(t,s);const a=r.x*Math.abs(on.x)+r.y*Math.abs(on.y)+r.z*Math.abs(on.z),o=e.dot(on),l=n.dot(on),c=i.dot(on);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const cn=new qe,hn=new We,un=new We;class dn{constructor(t=new We,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):cn.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;hn.subVectors(t,this.center);const e=hn.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(hn,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(un.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(hn.copy(t.center).add(un)),this.expandByPoint(hn.copy(t.center).sub(un))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const pn=new We,mn=new We,fn=new We,gn=new We,_n=new We,vn=new We,xn=new We;class yn{constructor(t=new We,e=new We(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,pn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=pn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pn.copy(this.origin).addScaledVector(this.direction,e),pn.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){mn.copy(t).add(e).multiplyScalar(.5),fn.copy(e).sub(t).normalize(),gn.copy(this.origin).sub(mn);const r=.5*t.distanceTo(e),s=-this.direction.dot(fn),a=gn.dot(this.direction),o=-gn.dot(fn),l=gn.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(mn).addScaledVector(fn,u),d}intersectSphere(t,e){pn.subVectors(t.center,this.origin);const n=pn.dot(this.direction),i=pn.dot(pn)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,pn)}intersectTriangle(t,e,n,i,r){_n.subVectors(e,t),vn.subVectors(n,t),xn.crossVectors(_n,vn);let s,a=this.direction.dot(xn);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}gn.subVectors(this.origin,t);const o=s*this.direction.dot(vn.crossVectors(gn,vn));if(o<0)return null;const l=s*this.direction.dot(_n.cross(gn));if(l<0)return null;if(o+l>a)return null;const c=-s*gn.dot(xn);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Mn{constructor(t,e,n,i,r,s,a,o,l,c,h,u,d,p,m,f){Mn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l,c,h,u,d,p,m,f)}set(t,e,n,i,r,s,a,o,l,c,h,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Mn).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Sn.setFromMatrixColumn(t,0).length(),r=1/Sn.setFromMatrixColumn(t,1).length(),s=1/Sn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,n=s*h,i=a*c,r=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*c,n=o*h,i=l*c,r=l*h;e[0]=t+r*a,e[4]=i*a-n,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*c,n=o*h,i=l*c,r=l*h;e[0]=t-r*a,e[4]=-s*h,e[8]=i+n*a,e[1]=n+i*a,e[5]=s*c,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*c,n=s*h,i=a*c,r=a*h;e[0]=o*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=o*h,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*c,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=n*h-i,e[2]=i*h-n,e[6]=a*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Tn,t,En)}lookAt(t,e,n){const i=this.elements;return Rn.subVectors(t,e),0===Rn.lengthSq()&&(Rn.z=1),Rn.normalize(),wn.crossVectors(n,Rn),0===wn.lengthSq()&&(1===Math.abs(n.z)?Rn.x+=1e-4:Rn.z+=1e-4,Rn.normalize(),wn.crossVectors(n,Rn)),wn.normalize(),An.crossVectors(Rn,wn),i[0]=wn.x,i[4]=An.x,i[8]=Rn.x,i[1]=wn.y,i[5]=An.y,i[9]=Rn.y,i[2]=wn.z,i[6]=An.z,i[10]=Rn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],m=n[6],f=n[10],g=n[14],_=n[3],v=n[7],x=n[11],y=n[15],M=i[0],S=i[4],b=i[8],T=i[12],E=i[1],w=i[5],A=i[9],R=i[13],C=i[2],L=i[6],P=i[10],I=i[14],U=i[3],D=i[7],N=i[11],O=i[15];return r[0]=s*M+a*E+o*C+l*U,r[4]=s*S+a*w+o*L+l*D,r[8]=s*b+a*A+o*P+l*N,r[12]=s*T+a*R+o*I+l*O,r[1]=c*M+h*E+u*C+d*U,r[5]=c*S+h*w+u*L+d*D,r[9]=c*b+h*A+u*P+d*N,r[13]=c*T+h*R+u*I+d*O,r[2]=p*M+m*E+f*C+g*U,r[6]=p*S+m*w+f*L+g*D,r[10]=p*b+m*A+f*P+g*N,r[14]=p*T+m*R+f*I+g*O,r[3]=_*M+v*E+x*C+y*U,r[7]=_*S+v*w+x*L+y*D,r[11]=_*b+v*A+x*P+y*N,r[15]=_*T+v*R+x*I+y*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-i*l*h-r*a*u+n*l*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-i*s*d+i*l*c-r*o*c)+t[11]*(+e*l*h-e*a*d-r*s*h+n*s*d+r*a*c-n*l*c)+t[15]*(-i*a*c-e*o*h+e*a*u+i*s*h-n*s*u+n*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],_=h*f*l-m*u*l+m*o*d-a*f*d-h*o*g+a*u*g,v=p*u*l-c*f*l-p*o*d+s*f*d+c*o*g-s*u*g,x=c*m*l-p*h*l+p*a*d-s*m*d-c*a*g+s*h*g,y=p*h*o-c*m*o-p*a*u+s*m*u+c*a*f-s*h*f,M=e*_+n*v+i*x+r*y;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/M;return t[0]=_*S,t[1]=(m*u*r-h*f*r-m*i*d+n*f*d+h*i*g-n*u*g)*S,t[2]=(a*f*r-m*o*r+m*i*l-n*f*l-a*i*g+n*o*g)*S,t[3]=(h*o*r-a*u*r-h*i*l+n*u*l+a*i*d-n*o*d)*S,t[4]=v*S,t[5]=(c*f*r-p*u*r+p*i*d-e*f*d-c*i*g+e*u*g)*S,t[6]=(p*o*r-s*f*r-p*i*l+e*f*l+s*i*g-e*o*g)*S,t[7]=(s*u*r-c*o*r+c*i*l-e*u*l-s*i*d+e*o*d)*S,t[8]=x*S,t[9]=(p*h*r-c*m*r-p*n*d+e*m*d+c*n*g-e*h*g)*S,t[10]=(s*m*r-p*a*r+p*n*l-e*m*l-s*n*g+e*a*g)*S,t[11]=(c*a*r-s*h*r-c*n*l+e*h*l+s*n*d-e*a*d)*S,t[12]=y*S,t[13]=(c*m*i-p*h*i+p*n*u-e*m*u-c*n*f+e*h*f)*S,t[14]=(p*a*i-s*m*i-p*n*o+e*m*o+s*n*f-e*a*f)*S,t[15]=(s*h*i-c*a*i+c*n*o-e*h*o-s*n*u+e*a*u)*S,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,m=s*c,f=s*h,g=a*h,_=o*l,v=o*c,x=o*h,y=n.x,M=n.y,S=n.z;return i[0]=(1-(m+g))*y,i[1]=(d+x)*y,i[2]=(p-v)*y,i[3]=0,i[4]=(d-x)*M,i[5]=(1-(u+g))*M,i[6]=(f+_)*M,i[7]=0,i[8]=(p+v)*S,i[9]=(f-_)*S,i[10]=(1-(u+m))*S,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Sn.set(i[0],i[1],i[2]).length();const s=Sn.set(i[4],i[5],i[6]).length(),a=Sn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],bn.copy(this);const o=1/r,l=1/s,c=1/a;return bn.elements[0]*=o,bn.elements[1]*=o,bn.elements[2]*=o,bn.elements[4]*=l,bn.elements[5]*=l,bn.elements[6]*=l,bn.elements[8]*=c,bn.elements[9]*=c,bn.elements[10]*=c,e.setFromRotationMatrix(bn),n.x=r,n.y=s,n.z=a,this}makePerspective(t,e,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(e-t),c=2*r/(n-i),h=(e+t)/(e-t),u=(n+i)/(n-i);let d,p;if(a===$t)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==Qt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s,a=2e3){const o=this.elements,l=1/(e-t),c=1/(n-i),h=1/(s-r),u=(e+t)*l,d=(n+i)*c;let p,m;if(a===$t)p=(s+r)*h,m=-2*h;else{if(a!==Qt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*h,m=-1*h}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=m,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Sn=new We,bn=new Mn,Tn=new We(0,0,0),En=new We(1,1,1),wn=new We,An=new We,Rn=new We,Cn=new Mn,Ln=new ke;class Pn{constructor(t=0,e=0,n=0,i=Pn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(ae(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ae(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(ae(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-ae(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ae(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ae(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Cn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Cn,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ln.setFromEuler(this),this.setFromQuaternion(Ln,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Pn.DEFAULT_ORDER="XYZ";class In{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Un=0;const Dn=new We,Nn=new ke,On=new Mn,Fn=new We,Bn=new We,zn=new We,Gn=new ke,Hn=new We(1,0,0),Vn=new We(0,1,0),kn=new We(0,0,1),Wn={type:"added"},Xn={type:"removed"};class jn extends te{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Un++}),this.uuid=se(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=jn.DEFAULT_UP.clone();const t=new We,e=new Pn,n=new ke,i=new We(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Mn},normalMatrix:{value:new fe}}),this.matrix=new Mn,this.matrixWorld=new Mn,this.matrixAutoUpdate=jn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=jn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new In,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Nn.setFromAxisAngle(t,e),this.quaternion.multiply(Nn),this}rotateOnWorldAxis(t,e){return Nn.setFromAxisAngle(t,e),this.quaternion.premultiply(Nn),this}rotateX(t){return this.rotateOnAxis(Hn,t)}rotateY(t){return this.rotateOnAxis(Vn,t)}rotateZ(t){return this.rotateOnAxis(kn,t)}translateOnAxis(t,e){return Dn.copy(t).applyQuaternion(this.quaternion),this.position.add(Dn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Hn,t)}translateY(t){return this.translateOnAxis(Vn,t)}translateZ(t){return this.translateOnAxis(kn,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(On.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Fn.copy(t):Fn.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Bn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?On.lookAt(Bn,Fn,this.up):On.lookAt(Fn,Bn,this.up),this.quaternion.setFromRotationMatrix(On),i&&(On.extractRotation(i.matrixWorld),Nn.setFromRotationMatrix(On),this.quaternion.premultiply(Nn.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Wn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Xn)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),On.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),On.multiply(t.parent.matrixWorld)),t.applyMatrix4(On),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bn,t,zn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bn,Gn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}jn.DEFAULT_UP=new We(0,1,0),jn.DEFAULT_MATRIX_AUTO_UPDATE=!0,jn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const qn=new We,Yn=new We,Zn=new We,Jn=new We,Kn=new We,$n=new We,Qn=new We,ti=new We,ei=new We,ni=new We;let ii=!1;class ri{constructor(t=new We,e=new We,n=new We){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),qn.subVectors(t,e),i.cross(qn);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){qn.subVectors(i,e),Yn.subVectors(n,e),Zn.subVectors(t,e);const s=qn.dot(qn),a=qn.dot(Yn),o=qn.dot(Zn),l=Yn.dot(Yn),c=Yn.dot(Zn),h=s*l-a*a;if(0===h)return r.set(0,0,0),null;const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,Jn)&&(Jn.x>=0&&Jn.y>=0&&Jn.x+Jn.y<=1)}static getUV(t,e,n,i,r,s,a,o){return!1===ii&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ii=!0),this.getInterpolation(t,e,n,i,r,s,a,o)}static getInterpolation(t,e,n,i,r,s,a,o){return null===this.getBarycoord(t,e,n,i,Jn)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Jn.x),o.addScaledVector(s,Jn.y),o.addScaledVector(a,Jn.z),o)}static isFrontFacing(t,e,n,i){return qn.subVectors(n,e),Yn.subVectors(t,e),qn.cross(Yn).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return qn.subVectors(this.c,this.b),Yn.subVectors(this.a,this.b),.5*qn.cross(Yn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ri.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ri.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return!1===ii&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ii=!0),ri.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}getInterpolation(t,e,n,i,r){return ri.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return ri.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ri.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,a;Kn.subVectors(i,n),$n.subVectors(r,n),ti.subVectors(t,n);const o=Kn.dot(ti),l=$n.dot(ti);if(o<=0&&l<=0)return e.copy(n);ei.subVectors(t,i);const c=Kn.dot(ei),h=$n.dot(ei);if(c>=0&&h<=c)return e.copy(i);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(n).addScaledVector(Kn,s);ni.subVectors(t,r);const d=Kn.dot(ni),p=$n.dot(ni);if(p>=0&&d<=p)return e.copy(r);const m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(n).addScaledVector($n,a);const f=c*p-d*h;if(f<=0&&h-c>=0&&d-p>=0)return Qn.subVectors(r,i),a=(h-c)/(h-c+(d-p)),e.copy(i).addScaledVector(Qn,a);const g=1/(f+m+u);return s=m*g,a=u*g,e.copy(n).addScaledVector(Kn,s).addScaledVector($n,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const si={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ai={h:0,s:0,l:0},oi={h:0,s:0,l:0};function li(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class ci{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Gt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Re.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=Re.workingColorSpace){return this.r=t,this.g=e,this.b=n,Re.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=Re.workingColorSpace){if(t=oe(t,1),e=ae(e,0,1),n=ae(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=li(r,i,t+1/3),this.g=li(r,i,t),this.b=li(r,i,t-1/3)}return Re.toWorkingColorSpace(this,i),this}setStyle(t,e=Gt){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===r)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Gt){const n=si[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ce(t.r),this.g=Ce(t.g),this.b=Ce(t.b),this}copyLinearToSRGB(t){return this.r=Le(t.r),this.g=Le(t.g),this.b=Le(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Gt){return Re.fromWorkingColorSpace(hi.copy(this),t),65536*Math.round(ae(255*hi.r,0,255))+256*Math.round(ae(255*hi.g,0,255))+Math.round(ae(255*hi.b,0,255))}getHexString(t=Gt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Re.workingColorSpace){Re.fromWorkingColorSpace(hi.copy(this),e);const n=hi.r,i=hi.g,r=hi.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=c<=.5?t/(s+a):t/(2-s-a),s){case n:o=(i-r)/t+(i<r?6:0);break;case i:o=(r-n)/t+2;break;case r:o=(n-i)/t+4}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=Re.workingColorSpace){return Re.fromWorkingColorSpace(hi.copy(this),e),t.r=hi.r,t.g=hi.g,t.b=hi.b,t}getStyle(t=Gt){Re.fromWorkingColorSpace(hi.copy(this),t);const e=hi.r,n=hi.g,i=hi.b;return t!==Gt?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(t,e,n){return this.getHSL(ai),this.setHSL(ai.h+t,ai.s+e,ai.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(ai),t.getHSL(oi);const n=le(ai.h,oi.h,e),i=le(ai.s,oi.s,e),r=le(ai.l,oi.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const hi=new ci;ci.NAMES=si;let ui=0;class di extends te{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ui++}),this.uuid=se(),this.name="",this.type="Material",this.blending=1,this.side=s,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=l,this.blendDst=c,this.blendEquation=o,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ci(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yt,this.stencilZFail=Yt,this.stencilZPass=Yt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==s&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==l&&(n.blendSrc=this.blendSrc),this.blendDst!==c&&(n.blendDst=this.blendDst),this.blendEquation!==o&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Yt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Yt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Yt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class pi extends di{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=h,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const mi=fi();function fi(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(i[t]=0,i[256|t]=32768,r[t]=24,r[256|t]=24):e<-14?(i[t]=1024>>-e-14,i[256|t]=1024>>-e-14|32768,r[t]=-e-1,r[256|t]=-e-1):e<=15?(i[t]=e+15<<10,i[256|t]=e+15<<10|32768,r[t]=13,r[256|t]=13):e<128?(i[t]=31744,i[256|t]=64512,r[t]=24,r[256|t]=24):(i[t]=31744,i[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;0==(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,s[t]=e|n}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)a[t]=t<<23;a[31]=1199570944,a[32]=2147483648;for(let t=33;t<63;++t)a[t]=2147483648+(t-32<<23);a[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(o[t]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function gi(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=ae(t,-65504,65504),mi.floatView[0]=t;const e=mi.uint32View[0],n=e>>23&511;return mi.baseTable[n]+((8388607&e)>>mi.shiftTable[n])}function _i(t){const e=t>>10;return mi.uint32View[0]=mi.mantissaTable[mi.offsetTable[e]+(1023&t)]+mi.exponentTable[e],mi.floatView[0]}const vi={toHalfFloat:gi,fromHalfFloat:_i},xi=new We,yi=new me;class Mi{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Zt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=H,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)yi.fromBufferAttribute(this,e),yi.applyMatrix3(t),this.setXY(e,yi.x,yi.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)xi.fromBufferAttribute(this,e),xi.applyMatrix3(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)xi.fromBufferAttribute(this,e),xi.applyMatrix4(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)xi.fromBufferAttribute(this,e),xi.applyNormalMatrix(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)xi.fromBufferAttribute(this,e),xi.transformDirection(t),this.setXYZ(e,xi.x,xi.y,xi.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=ue(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=de(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ue(e,this.array)),e}setX(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ue(e,this.array)),e}setY(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ue(e,this.array)),e}setZ(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ue(e,this.array)),e}setW(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array),r=de(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Zt&&(t.usage=this.usage),t}}class Si extends Mi{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class bi extends Mi{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Ti extends Mi{constructor(t,e,n){super(new Float32Array(t),e,n)}}let Ei=0;const wi=new Mn,Ai=new jn,Ri=new We,Ci=new qe,Li=new qe,Pi=new We;class Ii extends te{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ei++}),this.uuid=se(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(_e(t)?bi:Si)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new fe).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return wi.makeRotationFromQuaternion(t),this.applyMatrix4(wi),this}rotateX(t){return wi.makeRotationX(t),this.applyMatrix4(wi),this}rotateY(t){return wi.makeRotationY(t),this.applyMatrix4(wi),this}rotateZ(t){return wi.makeRotationZ(t),this.applyMatrix4(wi),this}translate(t,e,n){return wi.makeTranslation(t,e,n),this.applyMatrix4(wi),this}scale(t,e,n){return wi.makeScale(t,e,n),this.applyMatrix4(wi),this}lookAt(t){return Ai.lookAt(t),Ai.updateMatrix(),this.applyMatrix4(Ai.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ri).negate(),this.translate(Ri.x,Ri.y,Ri.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Ti(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qe);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new We(-1/0,-1/0,-1/0),new We(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Ci.setFromBufferAttribute(n),this.morphTargetsRelative?(Pi.addVectors(this.boundingBox.min,Ci.min),this.boundingBox.expandByPoint(Pi),Pi.addVectors(this.boundingBox.max,Ci.max),this.boundingBox.expandByPoint(Pi)):(this.boundingBox.expandByPoint(Ci.min),this.boundingBox.expandByPoint(Ci.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new dn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new We,1/0);if(t){const n=this.boundingSphere.center;if(Ci.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Li.setFromBufferAttribute(n),this.morphTargetsRelative?(Pi.addVectors(Ci.min,Li.min),Ci.expandByPoint(Pi),Pi.addVectors(Ci.max,Li.max),Ci.expandByPoint(Pi)):(Ci.expandByPoint(Li.min),Ci.expandByPoint(Li.max))}Ci.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Pi.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Pi));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Pi.fromBufferAttribute(s,e),a&&(Ri.fromBufferAttribute(t,e),Pi.add(Ri)),i=Math.max(i,n.distanceToSquared(Pi))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Mi(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<a;t++)l[t]=new We,c[t]=new We;const h=new We,u=new We,d=new We,p=new me,m=new me,f=new me,g=new We,_=new We;function v(t,e,n){h.fromArray(i,3*t),u.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),m.fromArray(s,2*e),f.fromArray(s,2*n),u.sub(h),d.sub(h),m.sub(p),f.sub(p);const r=1/(m.x*f.y-f.x*m.y);isFinite(r)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(r),_.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(_),c[e].add(_),c[n].add(_))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let t=0,e=x.length;t<e;++t){const e=x[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)v(n[t+0],n[t+1],n[t+2])}const y=new We,M=new We,S=new We,b=new We;function T(t){S.fromArray(r,3*t),b.copy(S);const e=l[t];y.copy(e),y.sub(S.multiplyScalar(S.dot(e))).normalize(),M.crossVectors(b,e);const n=M.dot(c[t])<0?-1:1;o[4*t]=y.x,o[4*t+1]=y.y,o[4*t+2]=y.z,o[4*t+3]=n}for(let t=0,e=x.length;t<e;++t){const e=x[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)T(n[t+0]),T(n[t+1]),T(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Mi(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new We,r=new We,s=new We,a=new We,o=new We,l=new We,c=new We,h=new We;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,m),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Pi.fromBufferAttribute(t,e),Pi.normalize(),t.setXYZ(e,Pi.x,Pi.y,Pi.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[o++]=n[a++]}return new Mi(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ii,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let e=0,i=a.length;e<i;e++){const i=t(a[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ui=new Mn,Di=new yn,Ni=new dn,Oi=new We,Fi=new We,Bi=new We,zi=new We,Gi=new We,Hi=new We,Vi=new me,ki=new me,Wi=new me,Xi=new We,ji=new We,qi=new We,Yi=new We,Zi=new We;class Ji extends jn{constructor(t=new Ii,e=new pi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(r&&a){Hi.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(Gi.fromBufferAttribute(o,t),s?Hi.addScaledVector(Gi,i):Hi.addScaledVector(Gi.sub(e),i))}e.add(Hi)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ni.copy(n.boundingSphere),Ni.applyMatrix4(r),Di.copy(t.ray).recast(t.near),!1===Ni.containsPoint(Di.origin)){if(null===Di.intersectSphere(Ni,Oi))return;if(Di.origin.distanceToSquared(Oi)>(t.far-t.near)**2)return}Ui.copy(r).invert(),Di.copy(t.ray).applyMatrix4(Ui),null!==n.boundingBox&&!1===Di.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Di)}}_computeIntersections(t,e,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let r=0,o=u.length;r<o;r++){const o=u[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3){i=Ki(this,p,t,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3){i=Ki(this,s,t,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let r=0,a=u.length;r<a;r++){const a=u[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3){i=Ki(this,p,t,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3){i=Ki(this,s,t,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}}}function Ki(t,e,n,i,r,o,l,c,h,u){t.getVertexPosition(c,Fi),t.getVertexPosition(h,Bi),t.getVertexPosition(u,zi);const d=function(t,e,n,i,r,o,l,c){let h;if(h=e.side===a?i.intersectTriangle(l,o,r,!0,c):i.intersectTriangle(r,o,l,e.side===s,c),null===h)return null;Zi.copy(c),Zi.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(Zi);return u<n.near||u>n.far?null:{distance:u,point:Zi.clone(),object:t}}(t,e,n,i,Fi,Bi,zi,Yi);if(d){r&&(Vi.fromBufferAttribute(r,c),ki.fromBufferAttribute(r,h),Wi.fromBufferAttribute(r,u),d.uv=ri.getInterpolation(Yi,Fi,Bi,zi,Vi,ki,Wi,new me)),o&&(Vi.fromBufferAttribute(o,c),ki.fromBufferAttribute(o,h),Wi.fromBufferAttribute(o,u),d.uv1=ri.getInterpolation(Yi,Fi,Bi,zi,Vi,ki,Wi,new me),d.uv2=d.uv1),l&&(Xi.fromBufferAttribute(l,c),ji.fromBufferAttribute(l,h),qi.fromBufferAttribute(l,u),d.normal=ri.getInterpolation(Yi,Fi,Bi,zi,Xi,ji,qi,new We),d.normal.dot(i.direction)>0&&d.normal.multiplyScalar(-1));const t={a:c,b:h,c:u,normal:new We,materialIndex:0};ri.getNormal(Fi,Bi,zi,t.normal),d.face=t}return d}class $i extends Ii{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,n,i,r,s,p,m,f,g,_){const v=s/f,x=p/g,y=s/2,M=p/2,S=m/2,b=f+1,T=g+1;let E=0,w=0;const A=new We;for(let s=0;s<T;s++){const a=s*x-M;for(let o=0;o<b;o++){const u=o*v-y;A[t]=u*i,A[e]=a*r,A[n]=S,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=m>0?1:-1,c.push(A.x,A.y,A.z),h.push(o/f),h.push(1-s/g),E+=1}}for(let t=0;t<g;t++)for(let e=0;e<f;e++){const n=u+e+b*t,i=u+e+b*(t+1),r=u+(e+1)+b*(t+1),s=u+(e+1)+b*t;o.push(n,i,s),o.push(i,r,s),w+=6}a.addGroup(d,w,_),d+=w,u+=E}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new Ti(l,3)),this.setAttribute("normal",new Ti(c,3)),this.setAttribute("uv",new Ti(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $i(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Qi(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function tr(t){const e={};for(let n=0;n<t.length;n++){const i=Qi(t[n]);for(const t in i)e[t]=i[t]}return e}function er(t){return null===t.getRenderTarget()?t.outputColorSpace:Re.workingColorSpace}const nr={clone:Qi,merge:tr};class ir extends di{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Qi(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class rr extends jn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Mn,this.projectionMatrix=new Mn,this.projectionMatrixInverse=new Mn,this.coordinateSystem=$t}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class sr extends rr{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*re*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*ie*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*re*Math.atan(Math.tan(.5*ie*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*ie*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/a,i*=s.width/t,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const ar=-90;class or extends jn{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new sr(ar,1,t,e);i.layers=this.layers,this.add(i);const r=new sr(ar,1,t,e);r.layers=this.layers,this.add(r);const s=new sr(ar,1,t,e);s.layers=this.layers,this.add(s);const a=new sr(ar,1,t,e);a.layers=this.layers,this.add(a);const o=new sr(ar,1,t,e);o.layers=this.layers,this.add(o);const l=new sr(ar,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,s,a,o]=e;for(const t of e)this.remove(t);if(t===$t)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(t!==Qt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,s),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,o),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=m,t.setRenderTarget(n,5,i),t.render(e,c),t.setRenderTarget(h,u,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class lr extends Fe{constructor(t,e,n,i,r,s,a,o,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:b,n,i,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class cr extends Ge{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];void 0!==e.encoding&&(be("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===Bt?Gt:zt),this.texture=new lr(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:D}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new $i(5,5,5),r=new ir({name:"CubemapFromEquirect",uniforms:Qi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:a,blending:0});r.uniforms.tEquirect.value=e;const s=new Ji(i,r),o=e.minFilter;e.minFilter===O&&(e.minFilter=D);return new or(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}const hr=new We,ur=new We,dr=new fe;class pr{constructor(t=new We(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=hr.subVectors(n,e).cross(ur.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(hr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||dr.getNormalMatrix(t),i=this.coplanarPoint(hr).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const mr=new dn,fr=new We;class gr{constructor(t=new pr,e=new pr,n=new pr,i=new pr,r=new pr,s=new pr){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,i=t.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],m=i[10],f=i[11],g=i[12],_=i[13],v=i[14],x=i[15];if(n[0].setComponents(o-r,u-l,f-d,x-g).normalize(),n[1].setComponents(o+r,u+l,f+d,x+g).normalize(),n[2].setComponents(o+s,u+c,f+p,x+_).normalize(),n[3].setComponents(o-s,u-c,f-p,x-_).normalize(),n[4].setComponents(o-a,u-h,f-m,x-v).normalize(),e===$t)n[5].setComponents(o+a,u+h,f+m,x+v).normalize();else{if(e!==Qt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,h,m,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),mr.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),mr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(mr)}intersectsSprite(t){return mr.center.set(0,0,0),mr.radius=.7071067811865476,mr.applyMatrix4(t.matrixWorld),this.intersectsSphere(mr)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(fr.x=i.normal.x>0?t.max.x:t.min.x,fr.y=i.normal.y>0?t.max.y:t.min.y,fr.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(fr)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function _r(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function vr(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);if(void 0===s)i.set(e,function(e,i){const r=e.array,s=e.usage,a=r.byteLength,o=t.createBuffer();let l;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)l=t.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=t.HALF_FLOAT}else l=t.UNSIGNED_SHORT;else if(r instanceof Int16Array)l=t.SHORT;else if(r instanceof Uint32Array)l=t.UNSIGNED_INT;else if(r instanceof Int32Array)l=t.INT;else if(r instanceof Int8Array)l=t.BYTE;else if(r instanceof Uint8Array)l=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);l=t.UNSIGNED_BYTE}return{buffer:o,type:l,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,size:a}}(e,r));else if(s.version<e.version){if(s.size!==e.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,i,r){const s=i.array,a=i._updateRange,o=i.updateRanges;if(t.bindBuffer(r,e),-1===a.count&&0===o.length&&t.bufferSubData(r,0,s),0!==o.length){for(let e=0,i=o.length;e<i;e++){const i=o[e];n?t.bufferSubData(r,i.start*s.BYTES_PER_ELEMENT,s,i.start,i.count):t.bufferSubData(r,i.start*s.BYTES_PER_ELEMENT,s.subarray(i.start,i.start+i.count))}i.clearUpdateRanges()}-1!==a.count&&(n?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback()}(s.buffer,e,r),s.version=e.version}}}}class xr extends Ii{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=t/a,u=e/o,d=[],p=[],m=[],f=[];for(let t=0;t<c;t++){const e=t*u-s;for(let n=0;n<l;n++){const i=n*h-r;p.push(i,-e,0),m.push(0,0,1),f.push(n/a),f.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xr(t.width,t.height,t.widthSegments,t.heightSegments)}}const yr={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor *= toneMappingExposure;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\treturn color;\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Mr={common:{diffuse:{value:new ci(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new fe},alphaMap:{value:null},alphaMapTransform:{value:new fe},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new fe}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new fe}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new fe}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new fe},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new fe},normalScale:{value:new me(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new fe},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new fe}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new fe}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new fe}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ci(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ci(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new fe},alphaTest:{value:0},uvTransform:{value:new fe}},sprite:{diffuse:{value:new ci(16777215)},opacity:{value:1},center:{value:new me(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new fe},alphaMap:{value:null},alphaMapTransform:{value:new fe},alphaTest:{value:0}}},Sr={basic:{uniforms:tr([Mr.common,Mr.specularmap,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.fog]),vertexShader:yr.meshbasic_vert,fragmentShader:yr.meshbasic_frag},lambert:{uniforms:tr([Mr.common,Mr.specularmap,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)}}]),vertexShader:yr.meshlambert_vert,fragmentShader:yr.meshlambert_frag},phong:{uniforms:tr([Mr.common,Mr.specularmap,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)},specular:{value:new ci(1118481)},shininess:{value:30}}]),vertexShader:yr.meshphong_vert,fragmentShader:yr.meshphong_frag},standard:{uniforms:tr([Mr.common,Mr.envmap,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.roughnessmap,Mr.metalnessmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag},toon:{uniforms:tr([Mr.common,Mr.aomap,Mr.lightmap,Mr.emissivemap,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.gradientmap,Mr.fog,Mr.lights,{emissive:{value:new ci(0)}}]),vertexShader:yr.meshtoon_vert,fragmentShader:yr.meshtoon_frag},matcap:{uniforms:tr([Mr.common,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,Mr.fog,{matcap:{value:null}}]),vertexShader:yr.meshmatcap_vert,fragmentShader:yr.meshmatcap_frag},points:{uniforms:tr([Mr.points,Mr.fog]),vertexShader:yr.points_vert,fragmentShader:yr.points_frag},dashed:{uniforms:tr([Mr.common,Mr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yr.linedashed_vert,fragmentShader:yr.linedashed_frag},depth:{uniforms:tr([Mr.common,Mr.displacementmap]),vertexShader:yr.depth_vert,fragmentShader:yr.depth_frag},normal:{uniforms:tr([Mr.common,Mr.bumpmap,Mr.normalmap,Mr.displacementmap,{opacity:{value:1}}]),vertexShader:yr.meshnormal_vert,fragmentShader:yr.meshnormal_frag},sprite:{uniforms:tr([Mr.sprite,Mr.fog]),vertexShader:yr.sprite_vert,fragmentShader:yr.sprite_frag},background:{uniforms:{uvTransform:{value:new fe},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yr.background_vert,fragmentShader:yr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:yr.backgroundCube_vert,fragmentShader:yr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yr.cube_vert,fragmentShader:yr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yr.equirect_vert,fragmentShader:yr.equirect_frag},distanceRGBA:{uniforms:tr([Mr.common,Mr.displacementmap,{referencePosition:{value:new We},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yr.distanceRGBA_vert,fragmentShader:yr.distanceRGBA_frag},shadow:{uniforms:tr([Mr.lights,Mr.fog,{color:{value:new ci(0)},opacity:{value:1}}]),vertexShader:yr.shadow_vert,fragmentShader:yr.shadow_frag}};Sr.physical={uniforms:tr([Sr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new fe},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new fe},clearcoatNormalScale:{value:new me(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new fe},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new fe},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new fe},sheen:{value:0},sheenColor:{value:new ci(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new fe},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new fe},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new fe},transmissionSamplerSize:{value:new me},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new fe},attenuationDistance:{value:0},attenuationColor:{value:new ci(0)},specularColor:{value:new ci(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new fe},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new fe},anisotropyVector:{value:new me},anisotropyMap:{value:null},anisotropyMapTransform:{value:new fe}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag};const br={r:0,b:0,g:0};function Tr(t,e,n,i,r,o,l){const c=new ci(0);let h,u,d=!0===o?0:1,p=null,m=0,f=null;function g(e,n){e.getRGB(br,er(t)),i.buffers.color.setClear(br.r,br.g,br.b,n,l)}return{getClearColor:function(){return c},setClearColor:function(t,e=1){c.set(t),d=e,g(c,d)},getClearAlpha:function(){return d},setClearAlpha:function(t){d=t,g(c,d)},render:function(o,_){let v=!1,x=!0===_.isScene?_.background:null;if(x&&x.isTexture){x=(_.backgroundBlurriness>0?n:e).get(x)}null===x?g(c,d):x&&x.isColor&&(g(x,1),v=!0);const y=t.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,l):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,l),(t.autoClear||v)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===A)?(void 0===u&&(u=new Ji(new $i(1,1,1),new ir({name:"BackgroundCubeMaterial",uniforms:Qi(Sr.backgroundCube.uniforms),vertexShader:Sr.backgroundCube.vertexShader,fragmentShader:Sr.backgroundCube.fragmentShader,side:a,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&!1===x.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,u.material.toneMapped=Re.getTransfer(x.colorSpace)!==Xt,p===x&&m===x.version&&f===t.toneMapping||(u.material.needsUpdate=!0,p=x,m=x.version,f=t.toneMapping),u.layers.enableAll(),o.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(void 0===h&&(h=new Ji(new xr(2,2),new ir({name:"BackgroundMaterial",uniforms:Qi(Sr.background.uniforms),vertexShader:Sr.background.vertexShader,fragmentShader:Sr.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=x,h.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,h.material.toneMapped=Re.getTransfer(x.colorSpace)!==Xt,!0===x.matrixAutoUpdate&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),p===x&&m===x.version&&f===t.toneMapping||(h.material.needsUpdate=!0,p=x,m=x.version,f=t.toneMapping),h.layers.enableAll(),o.unshift(h,h.geometry,h.material,0,0,null))}}}function Er(t,e,n,i){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=p(null);let c=l,h=!1;function u(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function m(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){g(t,0)}function g(n,r){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),o[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r}}function _(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,i,r,s,a,o){!0===o?t.vertexAttribIPointer(e,n,i,s,a):t.vertexAttribPointer(e,n,i,r,s,a)}function x(){y(),h=!0,c!==l&&(c=l,u(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,y){let M=!1;if(a){const e=function(e,n,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[a];void 0===h&&(h=p(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[a]=h);return h}(x,d,l);c!==e&&(c=e,u(c.object)),M=function(t,e,n,i){const r=c.attributes,s=e.attributes;let a=0;const o=n.getAttributes();for(const e in o){if(o[e].location>=0){const n=r[e];let i=s[e];if(void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;a++}}return c.attributesNum!==a||c.index!==i}(r,x,d,y),M&&function(t,e,n,i){const r={},s=e.attributes;let a=0;const o=n.getAttributes();for(const e in o){if(o[e].location>=0){let n=s[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[e]=i,a++}}c.attributes=r,c.attributesNum=a,c.index=i}(r,x,d,y)}else{const t=!0===l.wireframe;c.geometry===x.id&&c.program===d.id&&c.wireframe===t||(c.geometry=x.id,c.program=d.id,c.wireframe=t,M=!0)}null!==y&&n.update(y,t.ELEMENT_ARRAY_BUFFER),(M||h)&&(h=!1,function(r,s,a,o){if(!1===i.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;m();const l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const s=c[e];if(s.location>=0){let a=l[e];if(void 0===a&&("instanceMatrix"===e&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const e=a.normalized,l=a.itemSize,c=n.get(a);if(void 0===c)continue;const h=c.buffer,u=c.type,d=c.bytesPerElement,p=!0===i.isWebGL2&&(u===t.INT||u===t.UNSIGNED_INT||a.gpuType===z);if(a.isInterleavedBufferAttribute){const n=a.data,i=n.stride,c=a.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<s.locationSize;t++)g(s.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<s.locationSize;t++)f(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<s.locationSize;t++)v(s.location+t,l/s.locationSize,u,e,i*d,(c+l/s.locationSize*t)*d,p)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<s.locationSize;t++)g(s.location+t,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<s.locationSize;t++)f(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<s.locationSize;t++)v(s.location+t,l/s.locationSize,u,e,l*d,l/s.locationSize*t*d,p)}}else if(void 0!==h){const n=h[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(s.location,n);break;case 3:t.vertexAttrib3fv(s.location,n);break;case 4:t.vertexAttrib4fv(s.location,n);break;default:t.vertexAttrib1fv(s.location,n)}}}}_()}(r,l,d,x),null!==y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const t in o){const e=o[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const n=o[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)d(i[t].object),delete i[t];delete n[t.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:_}}function wr(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,a,o),n.update(a,s,o)},this.renderMultiDraw=function(t,i,r){if(0===r)return;const a=e.get("WEBGL_multi_draw");if(null===a)for(let e=0;e<r;e++)this.render(t[e],i[e]);else{a.multiDrawArraysWEBGL(s,t,0,i,0,r);let e=0;for(let t=0;t<r;t++)e+=i[t];n.update(e,s,1)}}}function Ar(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;let a=void 0!==n.precision?n.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),m=t.getParameter(t.MAX_VERTEX_ATTRIBS),f=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),_=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,x=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:v&&x,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function Rr(t){const e=this;let n=null,i=0,r=!1,s=!1;const a=new pr,o=new fe,l={value:null,needsUpdate:!1};function c(t,n,i,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=c(t,e,0)},this.setState=function(a,o,h){const u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,m=t.get(a);if(!r||null===u||0===u.length||s&&!p)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0}();else{const t=s?0:i,e=4*t;let r=m.clippingState||null;l.value=r,r=c(u,o,e,h);for(let t=0;t!==e;++t)r[t]=n[t];m.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Cr(t){let e=new WeakMap;function n(t,e){return e===E?t.mapping=b:e===w&&(t.mapping=T),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===E||s===w){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new cr(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class Lr extends rr{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,a=i+e,o=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Pr=[.125,.215,.35,.446,.526,.582],Ir=20,Ur=new Lr,Dr=new ci;let Nr=null,Or=0,Fr=0;const Br=(1+Math.sqrt(5))/2,zr=1/Br,Gr=[new We(1,1,1),new We(-1,1,1),new We(1,1,-1),new We(-1,1,-1),new We(0,Br,zr),new We(0,Br,-zr),new We(zr,0,Br),new We(-zr,0,Br),new We(Br,zr,0),new We(-Br,zr,0)];class Hr{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Nr=this._renderer.getRenderTarget(),Or=this._renderer.getActiveCubeFace(),Fr=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Xr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Wr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Nr,Or,Fr),t.scissorTest=!1,kr(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===b||t.mapping===T?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Nr=this._renderer.getRenderTarget(),Or=this._renderer.getActiveCubeFace(),Fr=this._renderer.getActiveMipmapLevel();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:D,minFilter:D,generateMipmaps:!1,type:V,format:j,colorSpace:Ht,depthBuffer:!1},i=Vr(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Vr(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+Pr.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>t-4?o=Pr[a-t+4-1]:0===a&&(o=0),i.push(o);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,m=3,f=2,g=1,_=new Float32Array(m*p*d),v=new Float32Array(f*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];_.set(i,m*p*t),v.set(u,f*p*t);const r=[t,t,t,t,t,t];x.set(r,g*p*t)}const y=new Ii;y.setAttribute("position",new Mi(_,m)),y.setAttribute("uv",new Mi(v,f)),y.setAttribute("faceIndex",new Mi(x,g)),e.push(y),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(Ir),r=new We(0,1,0),s=new ir({name:"SphericalGaussianBlur",defines:{n:Ir,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(i,t,e)}return i}_compileMaterial(t){const e=new Ji(this._lodPlanes[0],t);this._renderer.compile(e,Ur)}_sceneToCubeUV(t,e,n,i){const r=new sr(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(Dr),l.toneMapping=p,l.autoClear=!1;const u=new pi({name:"PMREM.Background",side:a,depthWrite:!1,depthTest:!1}),d=new Ji(new $i,u);let m=!1;const f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,m=!0):(u.color.copy(Dr),m=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1===n?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e]));const a=this._cubeSize;kr(i,n*a,e>2?a:0,a,a),l.setRenderTarget(i),m&&l.render(d,r),l.render(t,r)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=h,l.autoClear=c,t.background=f}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===b||t.mapping===T;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Xr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Wr());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Ji(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const a=this._cubeSize;kr(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(s,Ur)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=Gr[(e-1)%Gr.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Ji(this._lodPlanes[i],l),h=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,m=isFinite(r)?1+Math.floor(3*p):Ir;m>Ir&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let t=0;t<Ir;++t){const e=t/p,n=Math.exp(-e*e/2);f.push(n),0===t?g+=n:t<m&&(g+=2*n)}for(let t=0;t<f.length;t++)f[t]=f[t]/g;h.envMap.value=t.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:_}=this;h.dTheta.value=d,h.mipInt.value=_-n;const v=this._sizeLods[i];kr(e,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(e),o.render(c,Ur)}}function Vr(t,e,n){const i=new Ge(t,e,n);return i.texture.mapping=A,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function kr(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Wr(){return new ir({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Xr(){return new ir({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function jr(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function qr(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===E||s===w,o=s===b||s===T;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=e.get(r);return null===n&&(n=new Hr(t)),i=a?n.fromEquirectangular(r,i):n.fromCubemap(r,i),e.set(r,i),i.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(a&&s&&s.height>0||o&&s&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(s)){null===n&&(n=new Hr(t));const s=a?n.fromEquirectangular(r):n.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Yr(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?(n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance")):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Zr(t,e,n,i){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);for(const t in o.morphAttributes){const n=o.morphAttributes[t];for(let t=0,i=n.length;t<i;t++)e.remove(n[t])}o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(t){const n=[],i=t.index,r=t.attributes.position;let a=0;if(null!==i){const t=i.array;a=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const t=r.array;a=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const o=new(_e(n)?bi:Si)(n,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const n in i)e.update(i[n],t.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)e.update(i[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&o(t)}else o(t);return s.get(t)}}}function Jr(t,e,n,i){const r=i.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,a,e*o),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,i*o,c),n.update(l,s,c)},this.renderMultiDraw=function(t,i,r){if(0===r)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<r;e++)this.render(t[e]/o,i[e]);else{l.multiDrawElementsWEBGL(s,i,0,a,t,0,r);let e=0;for(let t=0;t<r;t++)e+=i[t];n.update(e,s,1)}}}function Kr(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function $r(t,e){return t[0]-e[0]}function Qr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function ts(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,a=new Be,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,c,h){const u=l.morphTargetInfluences;if(!0===e.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let m=s.get(c);if(void 0===m||m.count!==p){void 0!==m&&m.texture.dispose();const _=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,x=void 0!==c.morphAttributes.color,y=c.morphAttributes.position||[],M=c.morphAttributes.normal||[],S=c.morphAttributes.color||[];let b=0;!0===_&&(b=1),!0===v&&(b=2),!0===x&&(b=3);let T=c.attributes.position.count*b,E=1;T>e.maxTextureSize&&(E=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const w=new Float32Array(T*E*4*p),A=new He(w,T,E,p);A.type=H,A.needsUpdate=!0;const R=4*b;for(let L=0;L<p;L++){const P=y[L],I=M[L],U=S[L],D=T*E*4*L;for(let N=0;N<P.count;N++){const O=N*R;!0===_&&(a.fromBufferAttribute(P,N),w[D+O+0]=a.x,w[D+O+1]=a.y,w[D+O+2]=a.z,w[D+O+3]=0),!0===v&&(a.fromBufferAttribute(I,N),w[D+O+4]=a.x,w[D+O+5]=a.y,w[D+O+6]=a.z,w[D+O+7]=0),!0===x&&(a.fromBufferAttribute(U,N),w[D+O+8]=a.x,w[D+O+9]=a.y,w[D+O+10]=a.z,w[D+O+11]=4===U.itemSize?a.w:1)}}function C(){A.dispose(),s.delete(c),c.removeEventListener("dispose",C)}m={count:p,texture:A,size:new me(T,E)},s.set(c,m),c.addEventListener("dispose",C)}let f=0;for(let F=0;F<u.length;F++)f+=u[F];const g=c.morphTargetsRelative?1:1-f;h.getUniforms().setValue(t,"morphTargetBaseInfluence",g),h.getUniforms().setValue(t,"morphTargetInfluences",u),h.getUniforms().setValue(t,"morphTargetsTexture",m.texture,n),h.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const B=void 0===u?0:u.length;let z=i[c.id];if(void 0===z||z.length!==B){z=[];for(let X=0;X<B;X++)z[X]=[X,0];i[c.id]=z}for(let j=0;j<B;j++){const q=z[j];q[0]=j,q[1]=u[j]}z.sort(Qr);for(let Y=0;Y<8;Y++)Y<B&&z[Y][1]?(o[Y][0]=z[Y][0],o[Y][1]=z[Y][1]):(o[Y][0]=Number.MAX_SAFE_INTEGER,o[Y][1]=0);o.sort($r);const G=c.morphAttributes.position,V=c.morphAttributes.normal;let k=0;for(let Z=0;Z<8;Z++){const J=o[Z],K=J[0],$=J[1];K!==Number.MAX_SAFE_INTEGER&&$?(G&&c.getAttribute("morphTarget"+Z)!==G[K]&&c.setAttribute("morphTarget"+Z,G[K]),V&&c.getAttribute("morphNormal"+Z)!==V[K]&&c.setAttribute("morphNormal"+Z,V[K]),r[Z]=$,k+=$):(G&&!0===c.hasAttribute("morphTarget"+Z)&&c.deleteAttribute("morphTarget"+Z),V&&!0===c.hasAttribute("morphNormal"+Z)&&c.deleteAttribute("morphNormal"+Z),r[Z]=0)}const W=c.morphTargetsRelative?1:1-k;h.getUniforms().setValue(t,"morphTargetBaseInfluence",W),h.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function es(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=e.get(a,l);if(r.get(c)!==o&&(e.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const t=a.skeleton;r.get(t)!==o&&(t.update(),r.set(t,o))}return c},dispose:function(){r=new WeakMap}}}class ns extends Fe{constructor(t,e,n,i,r,s,a,o,l,c){if((c=void 0!==c?c:q)!==q&&c!==Y)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===q&&(n=G),void 0===n&&c===Y&&(n=X),super(null,i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:P,this.minFilter=void 0!==o?o:P,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const is=new Fe,rs=new ns(1,1);rs.compareFunction=515;const ss=new He,as=new Ve,os=new lr,ls=[],cs=[],hs=new Float32Array(16),us=new Float32Array(9),ds=new Float32Array(4);function ps(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=ls[r];if(void 0===s&&(s=new Float32Array(r),ls[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function ms(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function fs(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function gs(t,e){let n=cs[e];void 0===n&&(n=new Int32Array(e),cs[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function _s(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function vs(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ms(n,e))return;t.uniform2fv(this.addr,e),fs(n,e)}}function xs(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ms(n,e))return;t.uniform3fv(this.addr,e),fs(n,e)}}function ys(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ms(n,e))return;t.uniform4fv(this.addr,e),fs(n,e)}}function Ms(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ms(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),fs(n,e)}else{if(ms(n,i))return;ds.set(i),t.uniformMatrix2fv(this.addr,!1,ds),fs(n,i)}}function Ss(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ms(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),fs(n,e)}else{if(ms(n,i))return;us.set(i),t.uniformMatrix3fv(this.addr,!1,us),fs(n,i)}}function bs(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ms(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),fs(n,e)}else{if(ms(n,i))return;hs.set(i),t.uniformMatrix4fv(this.addr,!1,hs),fs(n,i)}}function Ts(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Es(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ms(n,e))return;t.uniform2iv(this.addr,e),fs(n,e)}}function ws(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ms(n,e))return;t.uniform3iv(this.addr,e),fs(n,e)}}function As(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ms(n,e))return;t.uniform4iv(this.addr,e),fs(n,e)}}function Rs(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Cs(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ms(n,e))return;t.uniform2uiv(this.addr,e),fs(n,e)}}function Ls(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ms(n,e))return;t.uniform3uiv(this.addr,e),fs(n,e)}}function Ps(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ms(n,e))return;t.uniform4uiv(this.addr,e),fs(n,e)}}function Is(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);const s=this.type===t.SAMPLER_2D_SHADOW?rs:is;n.setTexture2D(e||s,r)}function Us(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||as,r)}function Ds(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||os,r)}function Ns(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||ss,r)}function Os(t,e){t.uniform1fv(this.addr,e)}function Fs(t,e){const n=ps(e,this.size,2);t.uniform2fv(this.addr,n)}function Bs(t,e){const n=ps(e,this.size,3);t.uniform3fv(this.addr,n)}function zs(t,e){const n=ps(e,this.size,4);t.uniform4fv(this.addr,n)}function Gs(t,e){const n=ps(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Hs(t,e){const n=ps(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Vs(t,e){const n=ps(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function ks(t,e){t.uniform1iv(this.addr,e)}function Ws(t,e){t.uniform2iv(this.addr,e)}function Xs(t,e){t.uniform3iv(this.addr,e)}function js(t,e){t.uniform4iv(this.addr,e)}function qs(t,e){t.uniform1uiv(this.addr,e)}function Ys(t,e){t.uniform2uiv(this.addr,e)}function Zs(t,e){t.uniform3uiv(this.addr,e)}function Js(t,e){t.uniform4uiv(this.addr,e)}function Ks(t,e,n){const i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(let t=0;t!==r;++t)n.setTexture2D(e[t]||is,s[t])}function $s(t,e,n){const i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(let t=0;t!==r;++t)n.setTexture3D(e[t]||as,s[t])}function Qs(t,e,n){const i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(let t=0;t!==r;++t)n.setTextureCube(e[t]||os,s[t])}function ta(t,e,n){const i=this.cache,r=e.length,s=gs(n,r);ms(i,s)||(t.uniform1iv(this.addr,s),fs(i,s));for(let t=0;t!==r;++t)n.setTexture2DArray(e[t]||ss,s[t])}class ea{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return _s;case 35664:return vs;case 35665:return xs;case 35666:return ys;case 35674:return Ms;case 35675:return Ss;case 35676:return bs;case 5124:case 35670:return Ts;case 35667:case 35671:return Es;case 35668:case 35672:return ws;case 35669:case 35673:return As;case 5125:return Rs;case 36294:return Cs;case 36295:return Ls;case 36296:return Ps;case 35678:case 36198:case 36298:case 36306:case 35682:return Is;case 35679:case 36299:case 36307:return Us;case 35680:case 36300:case 36308:case 36293:return Ds;case 36289:case 36303:case 36311:case 36292:return Ns}}(e.type)}}class na{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Os;case 35664:return Fs;case 35665:return Bs;case 35666:return zs;case 35674:return Gs;case 35675:return Hs;case 35676:return Vs;case 5124:case 35670:return ks;case 35667:case 35671:return Ws;case 35668:case 35672:return Xs;case 35669:case 35673:return js;case 5125:return qs;case 36294:return Ys;case 36295:return Zs;case 36296:return Js;case 35678:case 36198:case 36298:case 36306:case 35682:return Ks;case 35679:case 36299:case 36307:return $s;case 35680:case 36300:case 36308:case 36293:return Qs;case 36289:case 36303:case 36311:case 36292:return ta}}(e.type)}}class ia{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const ra=/(\w+)(\])?(\[|\.)?/g;function sa(t,e){t.seq.push(e),t.map[e.id]=e}function aa(t,e,n){const i=t.name,r=i.length;for(ra.lastIndex=0;;){const s=ra.exec(i),a=ra.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){sa(n,void 0===c?new ea(o,t,e):new na(o,t,e));break}{let t=n.map[o];void 0===t&&(t=new ia(o),sa(n,t)),n=t}}}class oa{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);aa(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function la(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const ca=37297;let ha=0;function ua(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=r;t<s;t++){const r=t+1;i.push(`${r===e?">":" "} ${r}: ${n[t]}`)}return i.join("\n")}(t.getShaderSource(e),i)}return r}function da(t,e){const n=function(t){const e=Re.getPrimaries(Re.workingColorSpace),n=Re.getPrimaries(t);let i;switch(e===n?i="":e===qt&&n===jt?i="LinearDisplayP3ToLinearSRGB":e===jt&&n===qt&&(i="LinearSRGBToLinearDisplayP3"),t){case Ht:case kt:return[i,"LinearTransferOETF"];case Gt:case Vt:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function pa(t,e){let n;switch(e){case m:n="Linear";break;case f:n="Reinhard";break;case g:n="OptimizedCineon";break;case _:n="ACESFilmic";break;case x:n="AgX";break;case v:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ma(t){return""!==t}function fa(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ga(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const _a=/^[ \t]*#include +<([\w\d./]+)>/gm;function va(t){return t.replace(_a,ya)}const xa=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function ya(t,e){let n=yr[e];if(void 0===n){const t=xa.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=yr[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return va(n)}const Ma=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Sa(t){return t.replace(Ma,ba)}function ba(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Ta(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Ea(t,e,s,a){const o=t.getContext(),l=s.defines;let c=s.vertexShader,m=s.fragmentShader;const f=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===n?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===i?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===r&&(e="SHADOWMAP_TYPE_VSM"),e}(s),g=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case b:case T:e="ENVMAP_TYPE_CUBE";break;case A:e="ENVMAP_TYPE_CUBE_UV"}return e}(s),_=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===T&&(e="ENVMAP_MODE_REFRACTION");return e}(s),v=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case h:e="ENVMAP_BLENDING_MULTIPLY";break;case u:e="ENVMAP_BLENDING_MIX";break;case d:e="ENVMAP_BLENDING_ADD"}return e}(s),x=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(s),y=s.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ma).join("\n")}(s),M=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(ma).join("\n")}(s),S=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(l),E=o.createProgram();let w,R,C=s.glslVersion?"#version "+s.glslVersion+"\n":"";s.isRawShaderMaterial?(w=["#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S].filter(ma).join("\n"),w.length>0&&(w+="\n"),R=[y,"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S].filter(ma).join("\n"),R.length>0&&(R+="\n")):(w=[Ta(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S,s.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",s.batching?"#define USE_BATCHING":"",s.instancing?"#define USE_INSTANCING":"",s.instancingColor?"#define USE_INSTANCING_COLOR":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+_:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.displacementMap?"#define USE_DISPLACEMENTMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.mapUv?"#define MAP_UV "+s.mapUv:"",s.alphaMapUv?"#define ALPHAMAP_UV "+s.alphaMapUv:"",s.lightMapUv?"#define LIGHTMAP_UV "+s.lightMapUv:"",s.aoMapUv?"#define AOMAP_UV "+s.aoMapUv:"",s.emissiveMapUv?"#define EMISSIVEMAP_UV "+s.emissiveMapUv:"",s.bumpMapUv?"#define BUMPMAP_UV "+s.bumpMapUv:"",s.normalMapUv?"#define NORMALMAP_UV "+s.normalMapUv:"",s.displacementMapUv?"#define DISPLACEMENTMAP_UV "+s.displacementMapUv:"",s.metalnessMapUv?"#define METALNESSMAP_UV "+s.metalnessMapUv:"",s.roughnessMapUv?"#define ROUGHNESSMAP_UV "+s.roughnessMapUv:"",s.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+s.anisotropyMapUv:"",s.clearcoatMapUv?"#define CLEARCOATMAP_UV "+s.clearcoatMapUv:"",s.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+s.clearcoatNormalMapUv:"",s.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+s.clearcoatRoughnessMapUv:"",s.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+s.iridescenceMapUv:"",s.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+s.iridescenceThicknessMapUv:"",s.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+s.sheenColorMapUv:"",s.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+s.sheenRoughnessMapUv:"",s.specularMapUv?"#define SPECULARMAP_UV "+s.specularMapUv:"",s.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+s.specularColorMapUv:"",s.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+s.specularIntensityMapUv:"",s.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+s.transmissionMapUv:"",s.thicknessMapUv?"#define THICKNESSMAP_UV "+s.thicknessMapUv:"",s.vertexTangents&&!1===s.flatShading?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&!1===s.flatShading?"#define USE_MORPHNORMALS":"",s.morphColors&&s.isWebGL2?"#define USE_MORPHCOLORS":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+s.morphTextureStride:"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_COUNT "+s.morphTargetsCount:"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+f:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.numLightProbes>0?"#define USE_LIGHT_PROBES":"",s.useLegacyLights?"#define LEGACY_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ma).join("\n"),R=[y,Ta(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,S,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.matcap?"#define USE_MATCAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+g:"",s.envMap?"#define "+_:"",s.envMap?"#define "+v:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoat?"#define USE_CLEARCOAT":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescence?"#define USE_IRIDESCENCE":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaTest?"#define USE_ALPHATEST":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.sheen?"#define USE_SHEEN":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.vertexTangents&&!1===s.flatShading?"#define USE_TANGENT":"",s.vertexColors||s.instancingColor?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.gradientMap?"#define USE_GRADIENTMAP":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+f:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.numLightProbes>0?"#define USE_LIGHT_PROBES":"",s.useLegacyLights?"#define LEGACY_LIGHTS":"",s.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",s.toneMapping!==p?"#define TONE_MAPPING":"",s.toneMapping!==p?yr.tonemapping_pars_fragment:"",s.toneMapping!==p?pa("toneMapping",s.toneMapping):"",s.dithering?"#define DITHERING":"",s.opaque?"#define OPAQUE":"",yr.colorspace_pars_fragment,da("linearToOutputTexel",s.outputColorSpace),s.useDepthPacking?"#define DEPTH_PACKING "+s.depthPacking:"","\n"].filter(ma).join("\n")),c=va(c),c=fa(c,s),c=ga(c,s),m=va(m),m=fa(m,s),m=ga(m,s),c=Sa(c),m=Sa(m),s.isWebGL2&&!0!==s.isRawShaderMaterial&&(C="#version 300 es\n",w=[M,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+w,R=["precision mediump sampler2DArray;","#define varying in",s.glslVersion===Jt?"":"layout(location = 0) out highp vec4 pc_fragColor;",s.glslVersion===Jt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+R);const L=C+w+c,P=C+R+m,I=la(o,o.VERTEX_SHADER,L),U=la(o,o.FRAGMENT_SHADER,P);function D(e){if(t.debug.checkShaderErrors){const n=o.getProgramInfoLog(E).trim(),i=o.getShaderInfoLog(I).trim(),r=o.getShaderInfoLog(U).trim();let s=!0,a=!0;if(!1===o.getProgramParameter(E,o.LINK_STATUS))if(s=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(o,E,I,U);else{const t=ua(o,I,"vertex"),e=ua(o,U,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(E,o.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+e)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==r||(a=!1);a&&(e.diagnostics={runnable:s,programLog:n,vertexShader:{log:i,prefix:w},fragmentShader:{log:r,prefix:R}})}o.deleteShader(I),o.deleteShader(U),N=new oa(o,E),O=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let a=1;i.type===t.FLOAT_MAT2&&(a=2),i.type===t.FLOAT_MAT3&&(a=3),i.type===t.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:a}}return n}(o,E)}let N,O;o.attachShader(E,I),o.attachShader(E,U),void 0!==s.index0AttributeName?o.bindAttribLocation(E,0,s.index0AttributeName):!0===s.morphTargets&&o.bindAttribLocation(E,0,"position"),o.linkProgram(E),this.getUniforms=function(){return void 0===N&&D(this),N},this.getAttributes=function(){return void 0===O&&D(this),O};let F=!1===s.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===F&&(F=o.getProgramParameter(E,ca)),F},this.destroy=function(){a.releaseStatesOfProgram(this),o.deleteProgram(E),this.program=void 0},this.type=s.shaderType,this.name=s.shaderName,this.id=ha++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=I,this.fragmentShader=U,this}let wa=0;class Aa{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new Ra(t),e.set(t,n)),n}}class Ra{constructor(t){this.id=wa++,this.code=t,this.usedTimes=0}}function Ca(t,e,n,i,r,s,o){const l=new In,c=new Aa,h=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,m=r.vertexTextures;let f=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(t){return 0===t?"uv":`uv${t}`}return{getParameters:function(s,l,h,v,x){const y=v.fog,M=x.geometry,S=s.isMeshStandardMaterial?v.environment:null,b=(s.isMeshStandardMaterial?n:e).get(s.envMap||S),T=b&&b.mapping===A?b.image.height:null,E=g[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const w=M.morphAttributes.position||M.morphAttributes.normal||M.morphAttributes.color,R=void 0!==w?w.length:0;let C,L,P,I,U=0;if(void 0!==M.morphAttributes.position&&(U=1),void 0!==M.morphAttributes.normal&&(U=2),void 0!==M.morphAttributes.color&&(U=3),E){const t=Sr[E];C=t.vertexShader,L=t.fragmentShader}else C=s.vertexShader,L=s.fragmentShader,c.update(s),P=c.getVertexShaderID(s),I=c.getFragmentShaderID(s);const D=t.getRenderTarget(),N=!0===x.isInstancedMesh,O=!0===x.isBatchedMesh,F=!!s.map,B=!!s.matcap,z=!!b,G=!!s.aoMap,H=!!s.lightMap,V=!!s.bumpMap,k=!!s.normalMap,W=!!s.displacementMap,X=!!s.emissiveMap,j=!!s.metalnessMap,q=!!s.roughnessMap,Y=s.anisotropy>0,Z=s.clearcoat>0,J=s.iridescence>0,K=s.sheen>0,$=s.transmission>0,Q=Y&&!!s.anisotropyMap,tt=Z&&!!s.clearcoatMap,et=Z&&!!s.clearcoatNormalMap,nt=Z&&!!s.clearcoatRoughnessMap,it=J&&!!s.iridescenceMap,rt=J&&!!s.iridescenceThicknessMap,st=K&&!!s.sheenColorMap,at=K&&!!s.sheenRoughnessMap,ot=!!s.specularMap,lt=!!s.specularColorMap,ct=!!s.specularIntensityMap,ht=$&&!!s.transmissionMap,ut=$&&!!s.thicknessMap,dt=!!s.gradientMap,pt=!!s.alphaMap,mt=s.alphaTest>0,ft=!!s.alphaHash,gt=!!s.extensions,_t=!!M.attributes.uv1,vt=!!M.attributes.uv2,xt=!!M.attributes.uv3;let yt=p;return s.toneMapped&&(null!==D&&!0!==D.isXRRenderTarget||(yt=t.toneMapping)),{isWebGL2:u,shaderID:E,shaderType:s.type,shaderName:s.name,vertexShader:C,fragmentShader:L,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,batching:O,instancing:N,instancingColor:N&&null!==x.instanceColor,supportsVertexTextures:m,outputColorSpace:null===D?t.outputColorSpace:!0===D.isXRRenderTarget?D.texture.colorSpace:Ht,map:F,matcap:B,envMap:z,envMapMode:z&&b.mapping,envMapCubeUVHeight:T,aoMap:G,lightMap:H,bumpMap:V,normalMap:k,displacementMap:m&&W,emissiveMap:X,normalMapObjectSpace:k&&1===s.normalMapType,normalMapTangentSpace:k&&0===s.normalMapType,metalnessMap:j,roughnessMap:q,anisotropy:Y,anisotropyMap:Q,clearcoat:Z,clearcoatMap:tt,clearcoatNormalMap:et,clearcoatRoughnessMap:nt,iridescence:J,iridescenceMap:it,iridescenceThicknessMap:rt,sheen:K,sheenColorMap:st,sheenRoughnessMap:at,specularMap:ot,specularColorMap:lt,specularIntensityMap:ct,transmission:$,transmissionMap:ht,thicknessMap:ut,gradientMap:dt,opaque:!1===s.transparent&&1===s.blending,alphaMap:pt,alphaTest:mt,alphaHash:ft,combine:s.combine,mapUv:F&&_(s.map.channel),aoMapUv:G&&_(s.aoMap.channel),lightMapUv:H&&_(s.lightMap.channel),bumpMapUv:V&&_(s.bumpMap.channel),normalMapUv:k&&_(s.normalMap.channel),displacementMapUv:W&&_(s.displacementMap.channel),emissiveMapUv:X&&_(s.emissiveMap.channel),metalnessMapUv:j&&_(s.metalnessMap.channel),roughnessMapUv:q&&_(s.roughnessMap.channel),anisotropyMapUv:Q&&_(s.anisotropyMap.channel),clearcoatMapUv:tt&&_(s.clearcoatMap.channel),clearcoatNormalMapUv:et&&_(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:nt&&_(s.clearcoatRoughnessMap.channel),iridescenceMapUv:it&&_(s.iridescenceMap.channel),iridescenceThicknessMapUv:rt&&_(s.iridescenceThicknessMap.channel),sheenColorMapUv:st&&_(s.sheenColorMap.channel),sheenRoughnessMapUv:at&&_(s.sheenRoughnessMap.channel),specularMapUv:ot&&_(s.specularMap.channel),specularColorMapUv:lt&&_(s.specularColorMap.channel),specularIntensityMapUv:ct&&_(s.specularIntensityMap.channel),transmissionMapUv:ht&&_(s.transmissionMap.channel),thicknessMapUv:ut&&_(s.thicknessMap.channel),alphaMapUv:pt&&_(s.alphaMap.channel),vertexTangents:!!M.attributes.tangent&&(k||Y),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!M.attributes.color&&4===M.attributes.color.itemSize,vertexUv1s:_t,vertexUv2s:vt,vertexUv3s:xt,pointsUvs:!0===x.isPoints&&!!M.attributes.uv&&(F||pt),fog:!!y,useFog:!0===s.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==M.morphAttributes.position,morphNormals:void 0!==M.morphAttributes.normal,morphColors:void 0!==M.morphAttributes.color,morphTargetsCount:R,morphTextureStride:U,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:yt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:F&&!0===s.map.isVideoTexture&&Re.getTransfer(s.map.colorSpace)===Xt,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:s.side===a,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:gt&&!0===s.extensions.derivatives,extensionFragDepth:gt&&!0===s.extensions.fragDepth,extensionDrawBuffers:gt&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:gt&&!0===s.extensions.shaderTextureLOD,extensionClipCullDistance:gt&&s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){l.disableAll(),e.isWebGL2&&l.enable(0);e.supportsVertexTextures&&l.enable(1);e.instancing&&l.enable(2);e.instancingColor&&l.enable(3);e.matcap&&l.enable(4);e.envMap&&l.enable(5);e.normalMapObjectSpace&&l.enable(6);e.normalMapTangentSpace&&l.enable(7);e.clearcoat&&l.enable(8);e.iridescence&&l.enable(9);e.alphaTest&&l.enable(10);e.vertexColors&&l.enable(11);e.vertexAlphas&&l.enable(12);e.vertexUv1s&&l.enable(13);e.vertexUv2s&&l.enable(14);e.vertexUv3s&&l.enable(15);e.vertexTangents&&l.enable(16);e.anisotropy&&l.enable(17);e.alphaHash&&l.enable(18);e.batching&&l.enable(19);t.push(l.mask),l.disableAll(),e.fog&&l.enable(0);e.useFog&&l.enable(1);e.flatShading&&l.enable(2);e.logarithmicDepthBuffer&&l.enable(3);e.skinning&&l.enable(4);e.morphTargets&&l.enable(5);e.morphNormals&&l.enable(6);e.morphColors&&l.enable(7);e.premultipliedAlpha&&l.enable(8);e.shadowMapEnabled&&l.enable(9);e.useLegacyLights&&l.enable(10);e.doubleSided&&l.enable(11);e.flipSided&&l.enable(12);e.useDepthPacking&&l.enable(13);e.dithering&&l.enable(14);e.transmission&&l.enable(15);e.sheen&&l.enable(16);e.opaque&&l.enable(17);e.pointsUvs&&l.enable(18);e.decodeVideoTexture&&l.enable(19);t.push(l.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=g[t.type];let n;if(e){const t=Sr[e];n=nr.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new Ea(t,n,e,s),h.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function La(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Pa(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ia(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ua(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h)},unshift:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Pa),i.length>1&&i.sort(e||Ia),r.length>1&&r.sort(e||Ia)}}}function Da(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new Ua,t.set(e,[r])):n>=i.length?(r=new Ua,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function Na(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new We,color:new ci};break;case"SpotLight":n={position:new We,direction:new We,color:new ci,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new We,color:new ci,distance:0,decay:0};break;case"HemisphereLight":n={direction:new We,skyColor:new ci,groundColor:new ci};break;case"RectAreaLight":n={color:new ci,position:new We,halfWidth:new We,halfHeight:new We}}return t[e.id]=n,n}}}let Oa=0;function Fa(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Ba(t,e){const n=new Na,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)r.probe.push(new We);const s=new We,a=new Mn,o=new Mn;return{setup:function(s,a){let o=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,m=0,f=0,g=0,_=0,v=0,x=0,y=0;s.sort(Fa);const M=!0===a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,S=e.intensity,b=e.distance,T=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*S*M,l+=a.g*S*M,c+=a.b*S*M;else if(e.isLightProbe){for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],S);y++}else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*M),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[h]=n,r.directionalShadowMap[h]=T,r.directionalShadowMatrix[h]=e.shadow.matrix,f++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=n.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(S*M),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,r.spot[d]=t;const s=e.shadow;if(e.map&&(r.spotLightMap[v]=e.map,v++,s.updateMatrices(e),e.castShadow&&x++),r.spotLightMatrix[d]=s.matrix,e.castShadow){const t=i.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,r.spotShadow[d]=t,r.spotShadowMap[d]=T,_++}d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(a).multiplyScalar(S),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*M),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=T,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(S*M),t.groundColor.copy(e.groundColor).multiplyScalar(S*M),r.hemi[m]=t,m++}}p>0&&(e.isWebGL2?!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Mr.LTC_FLOAT_1,r.rectAreaLTC2=Mr.LTC_FLOAT_2):(r.rectAreaLTC1=Mr.LTC_HALF_1,r.rectAreaLTC2=Mr.LTC_HALF_2):!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Mr.LTC_FLOAT_1,r.rectAreaLTC2=Mr.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Mr.LTC_HALF_1,r.rectAreaLTC2=Mr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;const S=r.hash;S.directionalLength===h&&S.pointLength===u&&S.spotLength===d&&S.rectAreaLength===p&&S.hemiLength===m&&S.numDirectionalShadows===f&&S.numPointShadows===g&&S.numSpotShadows===_&&S.numSpotMaps===v&&S.numLightProbes===y||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=m,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+v-x,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=x,r.numLightProbes=y,S.directionalLength=h,S.pointLength=u,S.spotLength=d,S.rectAreaLength=p,S.hemiLength=m,S.numDirectionalShadows=f,S.numPointShadows=g,S.numSpotShadows=_,S.numSpotMaps=v,S.numLightProbes=y,r.version=Oa++)},setupView:function(t,e){let n=0,i=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:r}}function za(t,e){const n=new Ba(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function Ga(t,e){let n=new WeakMap;return{get:function(i,r=0){const s=n.get(i);let a;return void 0===s?(a=new za(t,e),n.set(i,[a])):r>=s.length?(a=new za(t,e),s.push(a)):a=s[r],a},dispose:function(){n=new WeakMap}}}class Ha extends di{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Va extends di{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function ka(t,e,i){let o=new gr;const l=new me,c=new me,h=new Be,u=new Ha({depthPacking:3201}),d=new Va,p={},m=i.maxTextureSize,f={[s]:a,[a]:s,2:2},g=new ir({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new me},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=g.clone();_.defines.HORIZONTAL_PASS=1;const v=new Ii;v.setAttribute("position",new Mi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Ji(v,g),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n;let M=this.type;function S(n,i){const r=e.update(x);g.defines.VSM_SAMPLES!==n.blurSamples&&(g.defines.VSM_SAMPLES=n.blurSamples,_.defines.VSM_SAMPLES=n.blurSamples,g.needsUpdate=!0,_.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Ge(l.x,l.y)),g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,g,x,null),_.uniforms.shadow_pass.value=n.mapPass.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,_,x,null)}function b(e,n,i,s){let a=null;const o=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?d:u,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=a.uuid,e=n.uuid;let i=p[t];void 0===i&&(i={},p[t]=i);let r=i[e];void 0===r&&(r=a.clone(),i[e]=r,n.addEventListener("dispose",E)),a=r}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=s===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:f[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){t.properties.get(a).light=i}return a}function T(n,i,s,a,l){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&l===r)&&(!n.frustumCulled||o.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),o=n.material;if(Array.isArray(o)){const e=r.groups;for(let c=0,h=e.length;c<h;c++){const h=e[c],u=o[h.materialIndex];if(u&&u.visible){const e=b(n,u,a,l);n.onBeforeShadow(t,n,i,s,r,e,h),t.renderBufferDirect(s,null,r,e,n,h),n.onAfterShadow(t,n,i,s,r,e,h)}}}else if(o.visible){const e=b(n,o,a,l);n.onBeforeShadow(t,n,i,s,r,e,null),t.renderBufferDirect(s,null,r,e,n,null),n.onAfterShadow(t,n,i,s,r,e,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)T(c[t],i,s,a,l)}function E(t){t.target.removeEventListener("dispose",E);for(const e in p){const n=p[e],i=t.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(e,n,i){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===e.length)return;const s=t.getRenderTarget(),a=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=M!==r&&this.type===r,f=M===r&&this.type!==r;for(let s=0,a=e.length;s<a;s++){const a=e[s],u=a.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",a,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;l.copy(u.mapSize);const g=u.getFrameExtents();if(l.multiply(g),c.copy(u.mapSize),(l.x>m||l.y>m)&&(l.x>m&&(c.x=Math.floor(m/g.x),l.x=c.x*g.x,u.mapSize.x=c.x),l.y>m&&(c.y=Math.floor(m/g.y),l.y=c.y*g.y,u.mapSize.y=c.y)),null===u.map||!0===p||!0===f){const t=this.type!==r?{minFilter:P,magFilter:P}:{};null!==u.map&&u.map.dispose(),u.map=new Ge(l.x,l.y,t),u.map.texture.name=a.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const _=u.getViewportCount();for(let t=0;t<_;t++){const e=u.getViewport(t);h.set(c.x*e.x,c.y*e.y,c.x*e.z,c.y*e.w),d.viewport(h),u.updateMatrices(a,t),o=u.getFrustum(),T(n,i,u.camera,a,this.type)}!0!==u.isPointLightShadow&&this.type===r&&S(u,i),u.needsUpdate=!1}M=this.type,y.needsUpdate=!1,t.setRenderTarget(s,a,u)}}function Wa(t,e,n){const i=n.isWebGL2;const r=new function(){let e=!1;const n=new Be;let i=null;const r=new Be(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,a,o){!0===o&&(e*=a,i*=a,s*=a),n.set(e,i,s,a),!1===r.equals(n)&&(t.clearColor(e,i,s,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(e){e?j(t.DEPTH_TEST):q(t.DEPTH_TEST)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},h=new function(){let e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){e||(n?j(t.STENCIL_TEST):q(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&s===a||(t.stencilFunc(e,n,a),i=e,r=n,s=a)},setOp:function(e,n,i){a===e&&o===n&&l===i||(t.stencilOp(e,n,i),a=e,o=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},u=new WeakMap,d=new WeakMap;let p={},m={},f=new WeakMap,g=[],_=null,v=!1,x=null,y=null,M=null,S=null,b=null,T=null,E=null,w=new ci(0,0,0),A=0,R=!1,C=null,L=null,P=null,I=null,U=null;const D=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,O=0;const F=t.getParameter(t.VERSION);-1!==F.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(F)[1]),N=O>=1):-1!==F.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),N=O>=2);let B=null,z={};const G=t.getParameter(t.SCISSOR_BOX),H=t.getParameter(t.VIEWPORT),V=(new Be).fromArray(G),k=(new Be).fromArray(H);function W(e,n,r,s){const a=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<r;o++)!i||e!==t.TEXTURE_3D&&e!==t.TEXTURE_2D_ARRAY?t.texImage2D(n+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a):t.texImage3D(n,0,t.RGBA,1,1,s,0,t.RGBA,t.UNSIGNED_BYTE,a);return o}const X={};function j(e){!0!==p[e]&&(t.enable(e),p[e]=!0)}function q(e){!1!==p[e]&&(t.disable(e),p[e]=!1)}X[t.TEXTURE_2D]=W(t.TEXTURE_2D,t.TEXTURE_2D,1),X[t.TEXTURE_CUBE_MAP]=W(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(X[t.TEXTURE_2D_ARRAY]=W(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),X[t.TEXTURE_3D]=W(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),s.setClear(1),h.setClear(0),j(t.DEPTH_TEST),s.setFunc(3),K(!1),$(1),j(t.CULL_FACE),J(0);const Y={[o]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(i)Y[103]=t.MIN,Y[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(Y[103]=t.MIN_EXT,Y[104]=t.MAX_EXT)}const Z={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,[l]:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,[c]:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA,211:t.CONSTANT_COLOR,212:t.ONE_MINUS_CONSTANT_COLOR,213:t.CONSTANT_ALPHA,214:t.ONE_MINUS_CONSTANT_ALPHA};function J(e,n,i,r,s,a,l,c,h,u){if(0!==e){if(!1===v&&(j(t.BLEND),v=!0),5===e)s=s||n,a=a||i,l=l||r,n===y&&s===b||(t.blendEquationSeparate(Y[n],Y[s]),y=n,b=s),i===M&&r===S&&a===T&&l===E||(t.blendFuncSeparate(Z[i],Z[r],Z[a],Z[l]),M=i,S=r,T=a,E=l),!1!==c.equals(w)&&h===A||(t.blendColor(c.r,c.g,c.b,h),w.copy(c),A=h),x=e,R=!1;else if(e!==x||u!==R){if(y===o&&b===o||(t.blendEquation(t.FUNC_ADD),y=o,b=o),u)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}M=null,S=null,T=null,E=null,w.set(0,0,0),A=0,x=e,R=u}}else!0===v&&(q(t.BLEND),v=!1)}function K(e){C!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),C=e)}function $(e){0!==e?(j(t.CULL_FACE),e!==L&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):q(t.CULL_FACE),L=e}function Q(e,n,i){e?(j(t.POLYGON_OFFSET_FILL),I===n&&U===i||(t.polygonOffset(n,i),I=n,U=i)):q(t.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:s,stencil:h},enable:j,disable:q,bindFramebuffer:function(e,n){return m[e]!==n&&(t.bindFramebuffer(e,n),m[e]=n,i&&(e===t.DRAW_FRAMEBUFFER&&(m[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(m[t.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let s=g,a=!1;if(i)if(s=f.get(r),void 0===s&&(s=[],f.set(r,s)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let n=0,i=e.length;n<i;n++)s[n]=t.COLOR_ATTACHMENT0+n;s.length=e.length,a=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,a=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,a=!0);a&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return _!==e&&(t.useProgram(e),_=e,!0)},setBlending:J,setMaterial:function(e,n){2===e.side?q(t.CULL_FACE):j(t.CULL_FACE);let i=e.side===a;n&&(i=!i),K(i),1===e.blending&&!1===e.transparent?J(0):J(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const o=e.stencilWrite;h.setTest(o),o&&(h.setMask(e.stencilWriteMask),h.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),h.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?j(t.SAMPLE_ALPHA_TO_COVERAGE):q(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:K,setCullFace:$,setLineWidth:function(e){e!==P&&(N&&t.lineWidth(e),P=e)},setPolygonOffset:Q,setScissorTest:function(e){e?j(t.SCISSOR_TEST):q(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+D-1),B!==e&&(t.activeTexture(e),B=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===B?t.TEXTURE0+D-1:B);let r=z[i];void 0===r&&(r={type:void 0,texture:void 0},z[i]=r),r.type===e&&r.texture===n||(B!==i&&(t.activeTexture(i),B=i),t.bindTexture(e,n||X[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=z[B];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let i=d.get(n);void 0===i&&(i=new WeakMap,d.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=d.get(n).get(e);u.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),u.set(n,i))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===V.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),V.copy(e))},viewport:function(e){!1===k.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),k.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===i&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),p={},B=null,z={},m={},f=new WeakMap,g=[],_=null,v=!1,x=null,y=null,M=null,S=null,b=null,T=null,E=null,w=new ci(0,0,0),A=0,R=!1,C=null,L=null,P=null,I=null,U=null,V.set(0,0,t.canvas.width,t.canvas.height),k.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),h.reset()}}}function Xa(t,e,n,i,r,s,a){const o=r.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return p?new OffscreenCanvas(t,e):ye("canvas")}function f(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?he:Math.floor,s=i(r*t.width),a=i(r*t.height);void 0===u&&(u=m(s,a));const o=n?m(s,a):u;o.width=s,o.height=a;return o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function g(t){return ce(t.width)&&ce(t.height)}function _(t,e){return t.generateMipmaps&&e&&t.minFilter!==P&&t.minFilter!==D}function v(e){t.generateMipmap(e)}function x(n,i,r,s,a=!1){if(!1===o)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;if(i===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(l=t.R8UI),r===t.UNSIGNED_SHORT&&(l=t.R16UI),r===t.UNSIGNED_INT&&(l=t.R32UI),r===t.BYTE&&(l=t.R8I),r===t.SHORT&&(l=t.R16I),r===t.INT&&(l=t.R32I)),i===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),i===t.RGBA){const e=a?Wt:Re.getTransfer(s);r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=e===Xt?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)}return l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function y(t,e,n){return!0===_(t,n)||t.isFramebufferTexture&&t.minFilter!==P&&t.minFilter!==D?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(e){return e===P||e===I||e===U?t.NEAREST:t.LINEAR}function S(t){const e=t.target;e.removeEventListener("dispose",S),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=d.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&T(t),0===Object.keys(r).length&&d.delete(n)}i.remove(t)}(e),e.isVideoTexture&&h.delete(e)}function b(e){const n=e.target;n.removeEventListener("dispose",b),function(e){const n=e.texture,r=i.get(e),s=i.get(n);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(r.__webglFramebuffer[e]))for(let n=0;n<r.__webglFramebuffer[e].length;n++)t.deleteFramebuffer(r.__webglFramebuffer[e][n]);else t.deleteFramebuffer(r.__webglFramebuffer[e]);r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e])}else{if(Array.isArray(r.__webglFramebuffer))for(let e=0;e<r.__webglFramebuffer.length;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}(n)}function T(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete d.get(r)[n.__cacheKey],a.memory.textures--}let E=0;function w(e,r){const s=i.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void J(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r)}const A={[R]:t.REPEAT,[C]:t.CLAMP_TO_EDGE,[L]:t.MIRRORED_REPEAT},z={[P]:t.NEAREST,[I]:t.NEAREST_MIPMAP_NEAREST,[U]:t.NEAREST_MIPMAP_LINEAR,[D]:t.LINEAR,[N]:t.LINEAR_MIPMAP_NEAREST,[O]:t.LINEAR_MIPMAP_LINEAR},k={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL};function W(n,s,a){if(a?(t.texParameteri(n,t.TEXTURE_WRAP_S,A[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,A[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,A[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,z[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,z[s.minFilter])):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===C&&s.wrapT===C||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,t.TEXTURE_MAG_FILTER,M(s.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,M(s.minFilter)),s.minFilter!==P&&s.minFilter!==D&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,k[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.magFilter===P)return;if(s.minFilter!==U&&s.minFilter!==O)return;if(s.type===H&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===V&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function Z(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",S));const r=n.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&T(n)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return i}function J(e,a,l){let c=t.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(c=t.TEXTURE_2D_ARRAY),a.isData3DTexture&&(c=t.TEXTURE_3D);const h=Z(e,a),u=a.source;n.bindTexture(c,e.__webglTexture,t.TEXTURE0+l);const d=i.get(u);if(u.version!==d.__version||!0===h){n.activeTexture(t.TEXTURE0+l);const e=Re.getPrimaries(Re.workingColorSpace),i=a.colorSpace===zt?null:Re.getPrimaries(a.colorSpace),p=a.colorSpace===zt||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const m=function(t){return!o&&(t.wrapS!==C||t.wrapT!==C||t.minFilter!==P&&t.minFilter!==D)}(a)&&!1===g(a.image);let M=f(a.image,m,!1,r.maxTextureSize);M=nt(a,M);const S=g(M)||o,b=s.convert(a.format,a.colorSpace);let T,E=s.convert(a.type),w=x(a.internalFormat,b,E,a.colorSpace,a.isVideoTexture);W(c,a,S);const A=a.mipmaps,R=o&&!0!==a.isVideoTexture&&w!==at,L=void 0===d.__version||!0===h,I=y(a,M,S);if(a.isDepthTexture)w=t.DEPTH_COMPONENT,o?w=a.type===H?t.DEPTH_COMPONENT32F:a.type===G?t.DEPTH_COMPONENT24:a.type===X?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:a.type===H&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),a.format===q&&w===t.DEPTH_COMPONENT&&a.type!==B&&a.type!==G&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),a.type=G,E=s.convert(a.type)),a.format===Y&&w===t.DEPTH_COMPONENT&&(w=t.DEPTH_STENCIL,a.type!==X&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),a.type=X,E=s.convert(a.type))),L&&(R?n.texStorage2D(t.TEXTURE_2D,1,w,M.width,M.height):n.texImage2D(t.TEXTURE_2D,0,w,M.width,M.height,0,b,E,null));else if(a.isDataTexture)if(A.length>0&&S){R&&L&&n.texStorage2D(t.TEXTURE_2D,I,w,A[0].width,A[0].height);for(let e=0,i=A.length;e<i;e++)T=A[e],R?n.texSubImage2D(t.TEXTURE_2D,e,0,0,T.width,T.height,b,E,T.data):n.texImage2D(t.TEXTURE_2D,e,w,T.width,T.height,0,b,E,T.data);a.generateMipmaps=!1}else R?(L&&n.texStorage2D(t.TEXTURE_2D,I,w,M.width,M.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,M.width,M.height,b,E,M.data)):n.texImage2D(t.TEXTURE_2D,0,w,M.width,M.height,0,b,E,M.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){R&&L&&n.texStorage3D(t.TEXTURE_2D_ARRAY,I,w,A[0].width,A[0].height,M.depth);for(let e=0,i=A.length;e<i;e++)T=A[e],a.format!==j?null!==b?R?n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,T.width,T.height,M.depth,b,T.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,w,T.width,T.height,M.depth,0,T.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):R?n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,T.width,T.height,M.depth,b,E,T.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,w,T.width,T.height,M.depth,0,b,E,T.data)}else{R&&L&&n.texStorage2D(t.TEXTURE_2D,I,w,A[0].width,A[0].height);for(let e=0,i=A.length;e<i;e++)T=A[e],a.format!==j?null!==b?R?n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,T.width,T.height,b,T.data):n.compressedTexImage2D(t.TEXTURE_2D,e,w,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):R?n.texSubImage2D(t.TEXTURE_2D,e,0,0,T.width,T.height,b,E,T.data):n.texImage2D(t.TEXTURE_2D,e,w,T.width,T.height,0,b,E,T.data)}else if(a.isDataArrayTexture)R?(L&&n.texStorage3D(t.TEXTURE_2D_ARRAY,I,w,M.width,M.height,M.depth),n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,M.width,M.height,M.depth,b,E,M.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,w,M.width,M.height,M.depth,0,b,E,M.data);else if(a.isData3DTexture)R?(L&&n.texStorage3D(t.TEXTURE_3D,I,w,M.width,M.height,M.depth),n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,M.width,M.height,M.depth,b,E,M.data)):n.texImage3D(t.TEXTURE_3D,0,w,M.width,M.height,M.depth,0,b,E,M.data);else if(a.isFramebufferTexture){if(L)if(R)n.texStorage2D(t.TEXTURE_2D,I,w,M.width,M.height);else{let e=M.width,i=M.height;for(let r=0;r<I;r++)n.texImage2D(t.TEXTURE_2D,r,w,e,i,0,b,E,null),e>>=1,i>>=1}}else if(A.length>0&&S){R&&L&&n.texStorage2D(t.TEXTURE_2D,I,w,A[0].width,A[0].height);for(let e=0,i=A.length;e<i;e++)T=A[e],R?n.texSubImage2D(t.TEXTURE_2D,e,0,0,b,E,T):n.texImage2D(t.TEXTURE_2D,e,w,b,E,T);a.generateMipmaps=!1}else R?(L&&n.texStorage2D(t.TEXTURE_2D,I,w,M.width,M.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,b,E,M)):n.texImage2D(t.TEXTURE_2D,0,w,b,E,M);_(a,S)&&v(c),d.__version=u.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}function K(e,r,a,o,c,h){const u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=x(a.internalFormat,u,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){const e=Math.max(1,r.width>>h),i=Math.max(1,r.height>>h);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?n.texImage3D(c,h,p,e,i,r.depth,0,u,d,null):n.texImage2D(c,h,p,e,i,0,u,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),et(r)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,c,i.get(a).__webglTexture,0,tt(r)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,o,c,i.get(a).__webglTexture,h),n.bindFramebuffer(t.FRAMEBUFFER,null)}function $(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){let r=!0===o?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT16;if(i||et(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===H?r=t.DEPTH_COMPONENT32F:e.type===G&&(r=t.DEPTH_COMPONENT24));const i=tt(n);et(n)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,i,r,n.width,n.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,i,r,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=tt(n);i&&!1===et(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,n.width,n.height):et(n)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<e.length;r++){const a=e[r],o=s.convert(a.format,a.colorSpace),c=s.convert(a.type),h=x(a.internalFormat,o,c,a.colorSpace),u=tt(n);i&&!1===et(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,h,n.width,n.height):et(n)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,h,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,h,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Q(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),w(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=tt(r);if(r.depthTexture.format===q)et(r)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==Y)throw new Error("Unknown depthTexture format");et(r)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),$(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),$(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function tt(t){return Math.min(r.maxSamples,t.samples)}function et(t){const n=i.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function nt(t,n){const i=t.colorSpace,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===Kt||i!==Ht&&i!==zt&&(Re.getTransfer(i)===Xt?!1===o?!0===e.has("EXT_sRGB")&&r===j?(t.format=Kt,t.minFilter=D,t.generateMipmaps=!1):n=Ie.sRGBToLinear(n):r===j&&s===F||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const t=E;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=w,this.setTexture2DArray=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?J(s,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?J(s,e,r):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,a){const l=i.get(e);e.version>0&&l.__version!==e.version?function(e,a,l){if(6!==a.image.length)return;const c=Z(e,a),h=a.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+l);const u=i.get(h);if(h.version!==u.__version||!0===c){n.activeTexture(t.TEXTURE0+l);const e=Re.getPrimaries(Re.workingColorSpace),i=a.colorSpace===zt?null:Re.getPrimaries(a.colorSpace),d=a.colorSpace===zt||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const p=a.isCompressedTexture||a.image[0].isCompressedTexture,m=a.image[0]&&a.image[0].isDataTexture,M=[];for(let t=0;t<6;t++)M[t]=p||m?m?a.image[t].image:a.image[t]:f(a.image[t],!1,!0,r.maxCubemapSize),M[t]=nt(a,M[t]);const S=M[0],b=g(S)||o,T=s.convert(a.format,a.colorSpace),E=s.convert(a.type),w=x(a.internalFormat,T,E,a.colorSpace),A=o&&!0!==a.isVideoTexture,R=void 0===u.__version||!0===c;let C,L=y(a,S,b);if(W(t.TEXTURE_CUBE_MAP,a,b),p){A&&R&&n.texStorage2D(t.TEXTURE_CUBE_MAP,L,w,S.width,S.height);for(let e=0;e<6;e++){C=M[e].mipmaps;for(let i=0;i<C.length;i++){const r=C[i];a.format!==j?null!==T?A?n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,T,r.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,w,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):A?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,T,E,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,w,r.width,r.height,0,T,E,r.data)}}}else{C=a.mipmaps,A&&R&&(C.length>0&&L++,n.texStorage2D(t.TEXTURE_CUBE_MAP,L,w,M[0].width,M[0].height));for(let e=0;e<6;e++)if(m){A?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,M[e].width,M[e].height,T,E,M[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,w,M[e].width,M[e].height,0,T,E,M[e].data);for(let i=0;i<C.length;i++){const r=C[i].image[e].image;A?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,T,E,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,w,r.width,r.height,0,T,E,r.data)}}else{A?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,T,E,M[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,w,T,E,M[e]);for(let i=0;i<C.length;i++){const r=C[i];A?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,T,E,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,w,T,E,r.image[e])}}}_(a,b)&&v(t.TEXTURE_CUBE_MAP),u.__version=h.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}(l,e,a):n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture,t.TEXTURE0+a)},this.rebindTextures=function(e,n,r){const s=i.get(e);void 0!==n&&K(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&Q(e)},this.setupRenderTarget=function(e){const l=e.texture,c=i.get(e),h=i.get(l);e.addEventListener("dispose",b),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=g(e)||o;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[e]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[e][n]=t.createFramebuffer()}else c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let e=0;e<l.mipmaps.length;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else c.__webglFramebuffer=t.createFramebuffer();if(d)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&e.samples>0&&!1===et(e)){const i=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const a=s.convert(r.format,r.colorSpace),o=s.convert(r.type),l=x(r.internalFormat,a,o,r.colorSpace,!0===e.isXRRenderTarget),h=tt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,c.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),$(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(u){n.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture),W(t.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)K(c.__webglFramebuffer[n][i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else K(c.__webglFramebuffer[n],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);_(l,p)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const r=e.texture;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=i.get(a);n.bindTexture(t.TEXTURE_2D,o.__webglTexture),W(t.TEXTURE_2D,a,p),K(c.__webglFramebuffer,e,a,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D,0),_(a,p)&&v(t.TEXTURE_2D)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,h.__webglTexture),W(i,l,p),o&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)K(c.__webglFramebuffer[n],e,l,t.COLOR_ATTACHMENT0,i,n);else K(c.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,i,0);_(l,p)&&v(i),n.unbindTexture()}e.depthBuffer&&Q(e)},this.updateRenderTargetMipmap=function(e){const r=g(e)||o,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(_(o,r)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=i.get(o).__webglTexture;n.bindTexture(r,s),v(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===et(e)){const r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,a=e.height;let o=t.COLOR_BUFFER_BIT;const l=[],h=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=i.get(e),d=!0===e.isWebGLMultipleRenderTargets;if(d)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&l.push(h);const p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(e.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(o|=t.STENCIL_BUFFER_BIT)),d&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===p&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[h]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[h])),d){const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,t.NEAREST),c&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),d)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,u.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Q,this.setupFrameBufferTexture=K,this.useMultisampledRTT=et}function ja(t,e,n){const i=n.isWebGL2;return{convert:function(n,r=""){let s;const a=Re.getTransfer(r);if(n===F)return t.UNSIGNED_BYTE;if(n===k)return t.UNSIGNED_SHORT_4_4_4_4;if(n===W)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(n===B)return t.UNSIGNED_SHORT;if(n===z)return t.INT;if(n===G)return t.UNSIGNED_INT;if(n===H)return t.FLOAT;if(n===V)return i?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return t.ALPHA;if(n===j)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===q)return t.DEPTH_COMPONENT;if(n===Y)return t.DEPTH_STENCIL;if(n===Kt)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1028===n)return t.RED;if(n===Z)return t.RED_INTEGER;if(1030===n)return t.RG;if(n===J)return t.RG_INTEGER;if(n===K)return t.RGBA_INTEGER;if(n===$||n===Q||n===tt||n===et)if(a===Xt){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===$)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Q)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===tt)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===et)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===$)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Q)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===tt)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===et)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===nt||n===it||n===rt||n===st){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===nt)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===it)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===rt)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===st)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===at)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===ot||n===lt){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===ot)return a===Xt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===lt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===ct||n===ht||n===ut||n===dt||n===pt||n===mt||n===ft||n===gt||n===_t||n===vt||n===xt||n===yt||n===Mt||n===St){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===ct)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ht)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ut)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===dt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===pt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===mt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ft)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===gt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===_t)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===vt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===xt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===yt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Mt)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===St)return a===Xt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===bt||n===Tt||n===Et){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(n===bt)return a===Xt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Tt)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Et)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===wt||n===At||n===Rt){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===bt)return s.COMPRESSED_RED_RGTC1_EXT;if(n===wt)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===At)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Rt)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===X?i?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[n]?t[n]:null}}}class qa extends sr{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Ya extends jn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Za={type:"move"};class Ja{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ya,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ya,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new We,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new We),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ya,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new We,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new We),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n),r=this._getHandJoint(l,i);null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=t.radius),r.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Za)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new Ya;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class Ka extends te{constructor(t,e){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null;const m=e.getContextAttributes();let f=null,g=null;const _=[],v=[],x=new me;let y=null;const M=new sr;M.layers.enable(1),M.viewport=new Be;const S=new sr;S.layers.enable(2),S.viewport=new Be;const b=[M,S],T=new qa;T.layers.enable(1),T.layers.enable(2);let E=null,w=null;function A(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const n=_[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function R(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",C);for(let t=0;t<_.length;t++){const e=v[t];null!==e&&(v[t]=null,_[t].disconnect(e))}E=null,w=null,t.setRenderTarget(f),d=null,u=null,h=null,i=null,g=null,D.stop(),n.isPresenting=!1,t.setPixelRatio(y),t.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function C(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=v.indexOf(n);i>=0&&(v[i]=null,_[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=v.indexOf(n);if(-1===i){for(let t=0;t<_.length;t++){if(t>=v.length){v.push(n),i=t;break}if(null===v[t]){v[t]=n,i=t;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new Ja,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new Ja,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new Ja,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(f=t.getRenderTarget(),i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",R),i.addEventListener("inputsourceschange",C),!0!==m.xrCompatible&&await e.makeXRCompatible(),y=t.getPixelRatio(),t.getSize(x),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new Ge(d.framebufferWidth,d.framebufferHeight,{format:j,type:F,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,s=null,a=null;m.depth&&(a=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=m.stencil?Y:q,s=m.stencil?X:G);const o={colorFormat:e.RGBA8,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(i,e),u=h.createProjectionLayer(o),i.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),g=new Ge(u.textureWidth,u.textureHeight,{format:j,type:F,depthTexture:new ns(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0});t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const L=new We,P=new We;function I(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;T.near=S.near=M.near=t.near,T.far=S.far=M.far=t.far,E===T.near&&w===T.far||(i.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,w=T.far);const e=t.parent,n=T.cameras;I(T,e);for(let t=0;t<n.length;t++)I(n[t],e);2===n.length?function(t,e,n){L.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const i=L.distanceTo(P),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,m=i/(-h+u),f=m*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+m,_=o+m,v=d-f,x=p+(i-f),y=l*o/_*g,M=c*o/_*g;t.projectionMatrix.makePerspective(v,x,y,M,g,_),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(T,M,S):T.projectionMatrix.copy(M.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*re*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,T,e)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(t){o=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)};let U=null;const D=new _r;D.setAnimationLoop((function(e,i){if(c=i.getViewerPose(l||s),p=i,null!==c){const e=c.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let n=!1;e.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==d)s=d.getViewport(r);else{const e=h.getViewSubImage(u,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(g,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}let a=b[i];void 0===a&&(a=new sr,a.layers.enable(i),a.viewport=new Be,b[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(T.matrix.copy(a.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(a)}}for(let t=0;t<_.length;t++){const e=v[t],n=_[t];null!==e&&void 0!==n&&n.update(e,i,l||s)}U&&U(e,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(t){U=t},this.dispose=function(){}}}function $a(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===a&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===a&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const s=e.get(r).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*e,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,er(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,s,o,l){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,i){t.metalness.value=i.metalness,i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,t.metalnessMapTransform));t.roughness.value=i.roughness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,t.roughnessMapTransform));const r=e.get(i).envMap;r&&(t.envMapIntensity.value=i.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===a&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,l)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,s,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Qa(t,e,n,i){let r={},s={},a=[];const o=n.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(t,e,n,i){const r=t.value,s=e+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const t=i[s];if("number"==typeof r||"boolean"==typeof r){if(t!==r)return i[s]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function c(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const n=e.target;n.removeEventListener("dispose",h);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,u){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;for(let t=0,r=e.length;t<r;t++){const r=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=r.length;t<e;t++){const e=r[t],s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,r=s.length;t<r;t++){const r=c(s[t]),a=n%i;0!==a&&i-a<r.boundary&&(n+=i-a),e.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,n+=r.storage}}}const r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",h));const p=u.program;i.updateUBOMapping(n,p);const m=e.render.frame;s[n.id]!==m&&(!function(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=i.length;e<n;e++){const n=Array.isArray(i[e])?i[e]:[i[e]];for(let i=0,r=n.length;i<r;i++){const r=n[i];if(!0===l(r,e,i,s)){const e=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let s=0;s<n.length;s++){const a=n[s],o=c(a);"number"==typeof a||"boolean"==typeof a?(r.__data[0]=a,t.bufferSubData(t.UNIFORM_BUFFER,e+i,r.__data)):a.isMatrix3?(r.__data[0]=a.elements[0],r.__data[1]=a.elements[1],r.__data[2]=a.elements[2],r.__data[3]=0,r.__data[4]=a.elements[3],r.__data[5]=a.elements[4],r.__data[6]=a.elements[5],r.__data[7]=0,r.__data[8]=a.elements[6],r.__data[9]=a.elements[7],r.__data[10]=a.elements[8],r.__data[11]=0):(a.toArray(r.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,r.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=m)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}class to{constructor(t={}){const{canvas:n=Me(),context:i=null,depth:r=!0,stencil:o=!0,alpha:l=!1,antialias:c=!1,premultipliedAlpha:h=!0,preserveDrawingBuffer:u=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:m=!1}=t;let f;this.isWebGLRenderer=!0,f=null!==i?i.getContextAttributes().alpha:l;const g=new Uint32Array(4),_=new Int32Array(4);let v=null,x=null;const y=[],M=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Gt,this._useLegacyLights=!1,this.toneMapping=p,this.toneMappingExposure=1;const S=this;let b=!1,T=0,E=0,w=null,A=-1,R=null;const C=new Be,L=new Be;let P=null;const I=new ci(0);let U=0,D=n.width,N=n.height,z=1,q=null,Y=null;const $=new Be(0,0,D,N),Q=new Be(0,0,D,N);let tt=!1;const et=new gr;let nt=!1,it=!1,rt=null;const st=new Mn,at=new me,ot=new We,lt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ct(){return null===w?z:1}let ht,ut,dt,pt,mt,ft,gt,_t,vt,xt,yt,Mt,St,bt,Tt,Et,wt,At,Rt,Ct,Lt,Pt,It,Ut,Dt=i;function Nt(t,e){for(let i=0;i<t.length;i++){const r=t[i],s=n.getContext(r,e);if(null!==s)return s}return null}try{const t={alpha:!0,depth:r,stencil:o,antialias:c,premultipliedAlpha:h,preserveDrawingBuffer:u,powerPreference:d,failIfMajorPerformanceCaveat:m};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${e}`),n.addEventListener("webglcontextlost",Bt,!1),n.addEventListener("webglcontextrestored",zt,!1),n.addEventListener("webglcontextcreationerror",Vt,!1),null===Dt){const e=["webgl2","webgl","experimental-webgl"];if(!0===S.isWebGL1Renderer&&e.shift(),Dt=Nt(e,t),null===Dt)throw Nt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&Dt instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Dt.getShaderPrecisionFormat&&(Dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Ot(){ht=new Yr(Dt),ut=new Ar(Dt,ht,t),ht.init(ut),Pt=new ja(Dt,ht,ut),dt=new Wa(Dt,ht,ut),pt=new Kr(Dt),mt=new La,ft=new Xa(Dt,ht,dt,mt,ut,Pt,pt),gt=new Cr(S),_t=new qr(S),vt=new vr(Dt,ut),It=new Er(Dt,ht,vt,ut),xt=new Zr(Dt,vt,pt,It),yt=new es(Dt,xt,vt,pt),Rt=new ts(Dt,ut,ft),Et=new Rr(mt),Mt=new Ca(S,gt,_t,ht,ut,It,Et),St=new $a(S,mt),bt=new Da,Tt=new Ga(ht,ut),At=new Tr(S,gt,_t,dt,yt,f,h),wt=new ka(S,yt,ut),Ut=new Qa(Dt,pt,ut,dt),Ct=new wr(Dt,ht,pt,ut),Lt=new Jr(Dt,ht,pt,ut),pt.programs=Mt.programs,S.capabilities=ut,S.extensions=ht,S.properties=mt,S.renderLists=bt,S.shadowMap=wt,S.state=dt,S.info=pt}Ot();const Ft=new Ka(S,Dt);function Bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function zt(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const t=pt.autoReset,e=wt.enabled,n=wt.autoUpdate,i=wt.needsUpdate,r=wt.type;Ot(),pt.autoReset=t,wt.enabled=e,wt.autoUpdate=n,wt.needsUpdate=i,wt.type=r}function Vt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function kt(t){const e=t.target;e.removeEventListener("dispose",kt),function(t){(function(t){const e=mt.get(t).programs;void 0!==e&&(e.forEach((function(t){Mt.releaseProgram(t)})),t.isShaderMaterial&&Mt.releaseShaderCache(t))})(t),mt.remove(t)}(e)}function Wt(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=a,t.needsUpdate=!0,Qt(t,e,n),t.side=s,t.needsUpdate=!0,Qt(t,e,n),t.side=2):Qt(t,e,n)}this.xr=Ft,this.getContext=function(){return Dt},this.getContextAttributes=function(){return Dt.getContextAttributes()},this.forceContextLoss=function(){const t=ht.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=ht.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(t){void 0!==t&&(z=t,this.setSize(D,N,!1))},this.getSize=function(t){return t.set(D,N)},this.setSize=function(t,e,i=!0){Ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=t,N=e,n.width=Math.floor(t*z),n.height=Math.floor(e*z),!0===i&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(D*z,N*z).floor()},this.setDrawingBufferSize=function(t,e,i){D=t,N=e,z=i,n.width=Math.floor(t*i),n.height=Math.floor(e*i),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(C)},this.getViewport=function(t){return t.copy($)},this.setViewport=function(t,e,n,i){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,n,i),dt.viewport(C.copy($).multiplyScalar(z).floor())},this.getScissor=function(t){return t.copy(Q)},this.setScissor=function(t,e,n,i){t.isVector4?Q.set(t.x,t.y,t.z,t.w):Q.set(t,e,n,i),dt.scissor(L.copy(Q).multiplyScalar(z).floor())},this.getScissorTest=function(){return tt},this.setScissorTest=function(t){dt.setScissorTest(tt=t)},this.setOpaqueSort=function(t){q=t},this.setTransparentSort=function(t){Y=t},this.getClearColor=function(t){return t.copy(At.getClearColor())},this.setClearColor=function(){At.setClearColor.apply(At,arguments)},this.getClearAlpha=function(){return At.getClearAlpha()},this.setClearAlpha=function(){At.setClearAlpha.apply(At,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;if(t){let t=!1;if(null!==w){const e=w.texture.format;t=e===K||e===J||e===Z}if(t){const t=w.texture.type,e=t===F||t===G||t===B||t===X||t===k||t===W,n=At.getClearColor(),i=At.getClearAlpha(),r=n.r,s=n.g,a=n.b;e?(g[0]=r,g[1]=s,g[2]=a,g[3]=i,Dt.clearBufferuiv(Dt.COLOR,0,g)):(_[0]=r,_[1]=s,_[2]=a,_[3]=i,Dt.clearBufferiv(Dt.COLOR,0,_))}else i|=Dt.COLOR_BUFFER_BIT}e&&(i|=Dt.DEPTH_BUFFER_BIT),n&&(i|=Dt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Dt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Bt,!1),n.removeEventListener("webglcontextrestored",zt,!1),n.removeEventListener("webglcontextcreationerror",Vt,!1),bt.dispose(),Tt.dispose(),mt.dispose(),gt.dispose(),_t.dispose(),yt.dispose(),It.dispose(),Ut.dispose(),Mt.dispose(),Ft.dispose(),Ft.removeEventListener("sessionstart",jt),Ft.removeEventListener("sessionend",qt),rt&&(rt.dispose(),rt=null),Yt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=lt);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,n,i,r){!0!==e.isScene&&(e=lt);ft.resetTextureUnits();const s=e.fog,a=i.isMeshStandardMaterial?e.environment:null,o=null===w?S.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Ht,l=(i.isMeshStandardMaterial?_t:gt).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,m=!!n.morphAttributes.color;let f=p;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=S.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==g?g.length:0,v=mt.get(i),y=x.state.lights;if(!0===nt&&(!0===it||t!==R)){const e=t===R&&i.id===A;Et.setState(i,t,e)}let M=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==y.state.version||v.outputColorSpace!==o||r.isBatchedMesh&&!1===v.batching?M=!0:r.isBatchedMesh||!0!==v.batching?r.isInstancedMesh&&!1===v.instancing?M=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?M=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||v.envMap!==l||!0===i.fog&&v.fog!==s?M=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===Et.numPlanes&&v.numIntersection===Et.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==h||v.morphTargets!==u||v.morphNormals!==d||v.morphColors!==m||v.toneMapping!==f||!0===ut.isWebGL2&&v.morphTargetsCount!==_)&&(M=!0):M=!0:M=!0:M=!0:M=!0:(M=!0,v.__version=i.version);let b=v.currentProgram;!0===M&&(b=Qt(i,e,r));let T=!1,E=!1,C=!1;const L=b.getUniforms(),P=v.uniforms;dt.useProgram(b.program)&&(T=!0,E=!0,C=!0);i.id!==A&&(A=i.id,E=!0);if(T||R!==t){L.setValue(Dt,"projectionMatrix",t.projectionMatrix),L.setValue(Dt,"viewMatrix",t.matrixWorldInverse);const e=L.map.cameraPosition;void 0!==e&&e.setValue(Dt,ot.setFromMatrixPosition(t.matrixWorld)),ut.logarithmicDepthBuffer&&L.setValue(Dt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&L.setValue(Dt,"isOrthographic",!0===t.isOrthographicCamera),R!==t&&(R=t,E=!0,C=!0)}if(r.isSkinnedMesh){L.setOptional(Dt,r,"bindMatrix"),L.setOptional(Dt,r,"bindMatrixInverse");const t=r.skeleton;t&&(ut.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),L.setValue(Dt,"boneTexture",t.boneTexture,ft)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}r.isBatchedMesh&&(L.setOptional(Dt,r,"batchingTexture"),L.setValue(Dt,"batchingTexture",r._matricesTexture,ft));const I=n.morphAttributes;(void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===ut.isWebGL2)&&Rt.update(r,n,b);(E||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,L.setValue(Dt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);E&&(L.setValue(Dt,"toneMappingExposure",S.toneMappingExposure),v.needsLights&&(D=C,(U=P).ambientLightColor.needsUpdate=D,U.lightProbe.needsUpdate=D,U.directionalLights.needsUpdate=D,U.directionalLightShadows.needsUpdate=D,U.pointLights.needsUpdate=D,U.pointLightShadows.needsUpdate=D,U.spotLights.needsUpdate=D,U.spotLightShadows.needsUpdate=D,U.rectAreaLights.needsUpdate=D,U.hemisphereLights.needsUpdate=D),s&&!0===i.fog&&St.refreshFogUniforms(P,s),St.refreshMaterialUniforms(P,i,z,N,rt),oa.upload(Dt,te(v),P,ft));var U,D;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(oa.upload(Dt,te(v),P,ft),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&L.setValue(Dt,"center",r.center);if(L.setValue(Dt,"modelViewMatrix",r.modelViewMatrix),L.setValue(Dt,"normalMatrix",r.normalMatrix),L.setValue(Dt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++)if(ut.isWebGL2){const n=t[e];Ut.update(n,b),Ut.bind(n,b)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return b}(t,e,n,i,r);dt.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=xt.getWireframeAttribute(n),void 0===l)return;c=2}const h=n.drawRange,u=n.attributes.position;let d=h.start*c,m=(h.start+h.count)*c;null!==s&&(d=Math.max(d,s.start*c),m=Math.min(m,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),m=Math.min(m,l.count)):null!=u&&(d=Math.max(d,0),m=Math.min(m,u.count));const f=m-d;if(f<0||f===1/0)return;let g;It.setup(r,i,o,n,l);let _=Ct;if(null!==l&&(g=vt.get(l),_=Lt,_.setIndex(g)),r.isMesh)!0===i.wireframe?(dt.setLineWidth(i.wireframeLinewidth*ct()),_.setMode(Dt.LINES)):_.setMode(Dt.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),dt.setLineWidth(t*ct()),r.isLineSegments?_.setMode(Dt.LINES):r.isLineLoop?_.setMode(Dt.LINE_LOOP):_.setMode(Dt.LINE_STRIP)}else r.isPoints?_.setMode(Dt.POINTS):r.isSprite&&_.setMode(Dt.TRIANGLES);if(r.isBatchedMesh)_.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else if(r.isInstancedMesh)_.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);_.renderInstances(d,f,e)}else _.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),x=Tt.get(n),x.init(),M.push(x),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(x.pushLight(t),t.castShadow&&x.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(x.pushLight(t),t.castShadow&&x.pushShadow(t))})),x.setupLights(S._useLegacyLights);const i=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const s=e[r];Wt(s,n,t),i.add(s)}else Wt(e,n,t),i.add(e)})),M.pop(),x=null,i},this.compileAsync=function(t,e,n=null){const i=this.compile(t,e,n);return new Promise((e=>{function n(){i.forEach((function(t){mt.get(t).currentProgram.isReady()&&i.delete(t)})),0!==i.size?setTimeout(n,10):e(t)}null!==ht.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Xt=null;function jt(){Yt.stop()}function qt(){Yt.start()}const Yt=new _r;function Zt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)x.pushLight(t),t.castShadow&&x.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||et.intersectsSprite(t)){i&&ot.setFromMatrixPosition(t.matrixWorld).applyMatrix4(st);const e=yt.update(t),r=t.material;r.visible&&v.push(t,e,r,n,ot.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||et.intersectsObject(t))){const e=yt.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),ot.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),ot.copy(e.boundingSphere.center)),ot.applyMatrix4(t.matrixWorld).applyMatrix4(st)),Array.isArray(r)){const i=e.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&v.push(t,e,o,n,ot.z,a)}}else r.visible&&v.push(t,e,r,n,ot.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Zt(r[t],e,n,i)}function Jt(t,e,n,i){const r=t.opaque,s=t.transmissive,o=t.transparent;x.setupLightsView(n),!0===nt&&Et.setGlobalState(S.clippingPlanes,n),s.length>0&&function(t,e,n,i){const r=!0===n.isScene?n.overrideMaterial:null;if(null!==r)return;const s=ut.isWebGL2;null===rt&&(rt=new Ge(1,1,{generateMipmaps:!0,type:ht.has("EXT_color_buffer_half_float")?V:F,minFilter:O,samples:s?4:0}));S.getDrawingBufferSize(at),s?rt.setSize(at.x,at.y):rt.setSize(he(at.x),he(at.y));const o=S.getRenderTarget();S.setRenderTarget(rt),S.getClearColor(I),U=S.getClearAlpha(),U<1&&S.setClearColor(16777215,.5);S.clear();const l=S.toneMapping;S.toneMapping=p,Kt(t,n,i),ft.updateMultisampleRenderTarget(rt),ft.updateRenderTargetMipmap(rt);let c=!1;for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.object,o=r.geometry,l=r.material,h=r.group;if(2===l.side&&s.layers.test(i.layers)){const t=l.side;l.side=a,l.needsUpdate=!0,$t(s,n,i,o,l,h),l.side=t,l.needsUpdate=!0,c=!0}}!0===c&&(ft.updateMultisampleRenderTarget(rt),ft.updateRenderTargetMipmap(rt));S.setRenderTarget(o),S.setClearColor(I,U),S.toneMapping=l}(r,s,e,n),i&&dt.viewport(C.copy(i)),r.length>0&&Kt(r,e,n),s.length>0&&Kt(s,e,n),o.length>0&&Kt(o,e,n),dt.buffers.depth.setTest(!0),dt.buffers.depth.setMask(!0),dt.buffers.color.setMask(!0),dt.setPolygonOffset(!1)}function Kt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===i?s.material:i,c=s.group;a.layers.test(n.layers)&&$t(a,e,n,o,l,c)}}function $t(t,e,n,i,r,o){t.onBeforeRender(S,e,n,i,r,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(S,e,n,i,t,o),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=a,r.needsUpdate=!0,S.renderBufferDirect(n,e,i,r,t,o),r.side=s,r.needsUpdate=!0,S.renderBufferDirect(n,e,i,r,t,o),r.side=2):S.renderBufferDirect(n,e,i,r,t,o),t.onAfterRender(S,e,n,i,r,o)}function Qt(t,e,n){!0!==e.isScene&&(e=lt);const i=mt.get(t),r=x.state.lights,s=x.state.shadowsArray,a=r.state.version,o=Mt.getParameters(t,r.state,s,e,n),l=Mt.getProgramCacheKey(o);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?_t:gt).get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",kt),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return ee(t,o),h}else o.uniforms=Mt.getUniforms(t),t.onBuild(n,o,S),t.onBeforeCompile(o,S),h=Mt.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;const u=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=Et.uniform),ee(t,o),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=h,i.uniformsList=null,h}function te(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=oa.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function ee(t,e){const n=mt.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Yt.setAnimationLoop((function(t){Xt&&Xt(t)})),"undefined"!=typeof self&&Yt.setContext(self),this.setAnimationLoop=function(t){Xt=t,Ft.setAnimationLoop(t),null===t?Yt.stop():Yt.start()},Ft.addEventListener("sessionstart",jt),Ft.addEventListener("sessionend",qt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Ft.enabled&&!0===Ft.isPresenting&&(!0===Ft.cameraAutoUpdate&&Ft.updateCamera(e),e=Ft.getCamera()),!0===t.isScene&&t.onBeforeRender(S,t,e,w),x=Tt.get(t,M.length),x.init(),M.push(x),st.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),et.setFromProjectionMatrix(st),it=this.localClippingEnabled,nt=Et.init(this.clippingPlanes,it),v=bt.get(t,y.length),v.init(),y.push(v),Zt(t,e,0,S.sortObjects),v.finish(),!0===S.sortObjects&&v.sort(q,Y),this.info.render.frame++,!0===nt&&Et.beginShadows();const n=x.state.shadowsArray;if(wt.render(n,t,e),!0===nt&&Et.endShadows(),!0===this.info.autoReset&&this.info.reset(),At.render(v,t),x.setupLights(S._useLegacyLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Jt(v,t,i,i.viewport)}}else Jt(v,t,e);null!==w&&(ft.updateMultisampleRenderTarget(w),ft.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(S,t,e),It.resetDefaultState(),A=-1,R=null,M.pop(),x=M.length>0?M[M.length-1]:null,y.pop(),v=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(t,e,n){mt.get(t.texture).__webglTexture=e,mt.get(t.depthTexture).__webglTexture=n;const i=mt.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===ht.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=mt.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){w=t,T=e,E=n;let i=!0,r=null,s=!1,a=!1;if(t){const o=mt.get(t);void 0!==o.__useDefaultFramebuffer?(dt.bindFramebuffer(Dt.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?ft.setupRenderTarget(t):o.__hasExternalTextures&&ft.rebindTextures(t,mt.get(t.texture).__webglTexture,mt.get(t.depthTexture).__webglTexture);const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=mt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(c[e])?c[e][n]:c[e],s=!0):r=ut.isWebGL2&&t.samples>0&&!1===ft.useMultisampledRTT(t)?mt.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,C.copy(t.viewport),L.copy(t.scissor),P=t.scissorTest}else C.copy($).multiplyScalar(z).floor(),L.copy(Q).multiplyScalar(z).floor(),P=tt;if(dt.bindFramebuffer(Dt.FRAMEBUFFER,r)&&ut.drawBuffers&&i&&dt.drawBuffers(t,r),dt.viewport(C),dt.scissor(L),dt.setScissorTest(P),s){const i=mt.get(t.texture);Dt.framebufferTexture2D(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,Dt.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(a){const i=mt.get(t.texture),r=e||0;Dt.framebufferTextureLayer(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}A=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=mt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){dt.bindFramebuffer(Dt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==j&&Pt.convert(o)!==Dt.getParameter(Dt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===V&&(ht.has("EXT_color_buffer_half_float")||ut.isWebGL2&&ht.has("EXT_color_buffer_float"));if(!(l===F||Pt.convert(l)===Dt.getParameter(Dt.IMPLEMENTATION_COLOR_READ_TYPE)||l===H&&(ut.isWebGL2||ht.has("OES_texture_float")||ht.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Dt.readPixels(e,n,i,r,Pt.convert(o),Pt.convert(l),s)}finally{const t=null!==w?mt.get(w).__webglFramebuffer:null;dt.bindFramebuffer(Dt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);ft.setTexture2D(e,0),Dt.copyTexSubImage2D(Dt.TEXTURE_2D,n,0,0,t.x,t.y,r,s),dt.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,a=Pt.convert(n.format),o=Pt.convert(n.type);ft.setTexture2D(n,0),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,n.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?Dt.texSubImage2D(Dt.TEXTURE_2D,i,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?Dt.compressedTexSubImage2D(Dt.TEXTURE_2D,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):Dt.texSubImage2D(Dt.TEXTURE_2D,i,t.x,t.y,a,o,e.image),0===i&&n.generateMipmaps&&Dt.generateMipmap(Dt.TEXTURE_2D),dt.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(S.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=Pt.convert(i.format),c=Pt.convert(i.type);let h;if(i.isData3DTexture)ft.setTexture3D(i,0),h=Dt.TEXTURE_3D;else{if(!i.isDataArrayTexture&&!i.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ft.setTexture2DArray(i,0),h=Dt.TEXTURE_2D_ARRAY}Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,i.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,i.unpackAlignment);const u=Dt.getParameter(Dt.UNPACK_ROW_LENGTH),d=Dt.getParameter(Dt.UNPACK_IMAGE_HEIGHT),p=Dt.getParameter(Dt.UNPACK_SKIP_PIXELS),m=Dt.getParameter(Dt.UNPACK_SKIP_ROWS),f=Dt.getParameter(Dt.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[r]:n.image;Dt.pixelStorei(Dt.UNPACK_ROW_LENGTH,g.width),Dt.pixelStorei(Dt.UNPACK_IMAGE_HEIGHT,g.height),Dt.pixelStorei(Dt.UNPACK_SKIP_PIXELS,t.min.x),Dt.pixelStorei(Dt.UNPACK_SKIP_ROWS,t.min.y),Dt.pixelStorei(Dt.UNPACK_SKIP_IMAGES,t.min.z),n.isDataTexture||n.isData3DTexture?Dt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Dt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,g.data)):Dt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,g),Dt.pixelStorei(Dt.UNPACK_ROW_LENGTH,u),Dt.pixelStorei(Dt.UNPACK_IMAGE_HEIGHT,d),Dt.pixelStorei(Dt.UNPACK_SKIP_PIXELS,p),Dt.pixelStorei(Dt.UNPACK_SKIP_ROWS,m),Dt.pixelStorei(Dt.UNPACK_SKIP_IMAGES,f),0===r&&i.generateMipmaps&&Dt.generateMipmap(h),dt.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?ft.setTextureCube(t,0):t.isData3DTexture?ft.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?ft.setTexture2DArray(t,0):ft.setTexture2D(t,0),dt.unbindTexture()},this.resetState=function(){T=0,E=0,w=null,dt.reset(),It.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $t}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===Vt?"display-p3":"srgb",e.unpackColorSpace=Re.workingColorSpace===kt?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Gt?Bt:Ft}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===Bt?Gt:Ht}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}class eo extends to{}eo.prototype.isWebGL1Renderer=!0;class no{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new ci(t),this.density=e}clone(){return new no(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class io{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new ci(t),this.near=e,this.far=n}clone(){return new io(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ro extends jn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}}class so{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Zt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=se()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=se()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=se()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ao=new We;class oo{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)ao.fromBufferAttribute(this,e),ao.applyMatrix4(t),this.setXYZ(e,ao.x,ao.y,ao.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)ao.fromBufferAttribute(this,e),ao.applyNormalMatrix(t),this.setXYZ(e,ao.x,ao.y,ao.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)ao.fromBufferAttribute(this,e),ao.transformDirection(t),this.setXYZ(e,ao.x,ao.y,ao.z);return this}setX(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=de(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ue(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ue(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ue(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ue(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=de(e,this.array),n=de(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array),r=de(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Mi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new oo(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class lo extends di{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ci(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let co;const ho=new We,uo=new We,po=new We,mo=new me,fo=new me,go=new Mn,_o=new We,vo=new We,xo=new We,yo=new me,Mo=new me,So=new me;class bo extends jn{constructor(t=new lo){if(super(),this.isSprite=!0,this.type="Sprite",void 0===co){co=new Ii;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new so(t,5);co.setIndex([0,1,2,0,2,3]),co.setAttribute("position",new oo(e,3,0,!1)),co.setAttribute("uv",new oo(e,2,3,!1))}this.geometry=co,this.material=t,this.center=new me(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),uo.setFromMatrixScale(this.matrixWorld),go.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),po.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&uo.multiplyScalar(-po.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;To(_o.set(-.5,-.5,0),po,s,uo,i,r),To(vo.set(.5,-.5,0),po,s,uo,i,r),To(xo.set(.5,.5,0),po,s,uo,i,r),yo.set(0,0),Mo.set(1,0),So.set(1,1);let a=t.ray.intersectTriangle(_o,vo,xo,!1,ho);if(null===a&&(To(vo.set(-.5,.5,0),po,s,uo,i,r),Mo.set(0,1),a=t.ray.intersectTriangle(_o,xo,vo,!1,ho),null===a))return;const o=t.ray.origin.distanceTo(ho);o<t.near||o>t.far||e.push({distance:o,point:ho.clone(),uv:ri.getInterpolation(ho,_o,vo,xo,yo,Mo,So,new me),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function To(t,e,n,i,r,s){mo.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(fo.x=s*mo.x-r*mo.y,fo.y=r*mo.x+s*mo.y):fo.copy(mo),t.copy(e),t.x+=fo.x,t.y+=fo.y,t.applyMatrix4(go)}const Eo=new We,wo=new We;class Ao extends jn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,n=0){e=Math.abs(e);const i=this.levels;let r;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i;n++){let i=e[n].distance;if(e[n].object.visible&&(i-=i*e[n].hysteresis),t<i)break}return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Eo.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Eo);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Eo.setFromMatrixPosition(t.matrixWorld),wo.setFromMatrixPosition(this.matrixWorld);const n=Eo.distanceTo(wo)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r;i++){let t=e[i].distance;if(e[i].object.visible&&(t-=t*e[i].hysteresis),!(n>=t))break;e[i-1].object.visible=!1,e[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,i=n.length;t<i;t++){const i=n[t];e.object.levels.push({object:i.object.uuid,distance:i.distance,hysteresis:i.hysteresis})}return e}}const Ro=new We,Co=new Be,Lo=new Be,Po=new We,Io=new Mn,Uo=new We,Do=new dn,No=new Mn,Oo=new yn;class Fo extends Ji{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=y,this.bindMatrix=new Mn,this.bindMatrixInverse=new Mn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new qe),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Uo),this.boundingBox.expandByPoint(Uo)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new dn),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Uo),this.boundingSphere.expandByPoint(Uo)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Do.copy(this.boundingSphere),Do.applyMatrix4(i),!1!==t.ray.intersectsSphere(Do)&&(No.copy(i).invert(),Oo.copy(t.ray).applyMatrix4(No),null!==this.boundingBox&&!1===Oo.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Oo)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Be,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===y?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===M?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;Co.fromBufferAttribute(i.attributes.skinIndex,t),Lo.fromBufferAttribute(i.attributes.skinWeight,t),Ro.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=Lo.getComponent(t);if(0!==i){const r=Co.getComponent(t);Io.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Po.copy(Ro).applyMatrix4(Io),i)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e)}}class Bo extends jn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class zo extends Fe{constructor(t=null,e=1,n=1,i,r,s,a,o,l=1003,c=1003,h,u){super(null,s,a,o,l,c,i,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Go=new Mn,Ho=new Mn;class Vo{constructor(t=[],e=[]){this.uuid=se(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Mn)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Mn;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:Ho;Go.multiplyMatrices(r,e[i]),Go.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Vo(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new zo(e,t,t,j,H);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Bo),this.bones.push(r),this.boneInverses.push((new Mn).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class ko extends Mi{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Wo=new Mn,Xo=new Mn,jo=[],qo=new qe,Yo=new Mn,Zo=new Ji,Jo=new dn;class Ko extends Ji{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new ko(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<n;t++)this.setMatrixAt(t,Yo)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new qe),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Wo),qo.copy(t.boundingBox).applyMatrix4(Wo),this.boundingBox.union(qo)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new dn),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Wo),Jo.copy(t.boundingSphere).applyMatrix4(Wo),this.boundingSphere.union(Jo)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Zo.geometry=this.geometry,Zo.material=this.material,void 0!==Zo.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Jo.copy(this.boundingSphere),Jo.applyMatrix4(n),!1!==t.ray.intersectsSphere(Jo)))for(let r=0;r<i;r++){this.getMatrixAt(r,Wo),Xo.multiplyMatrices(n,Wo),Zo.matrixWorld=Xo,Zo.raycast(t,jo);for(let t=0,n=jo.length;t<n;t++){const n=jo[t];n.instanceId=r,n.object=this,e.push(n)}jo.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new ko(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function $o(t,e){return t.z-e.z}function Qo(t,e){return e.z-t.z}class tl{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e){const n=this.pool,i=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const r=n[this.index];i.push(r),this.index++,r.start=t.start,r.count=t.count,r.z=e}reset(){this.list.length=0,this.index=0}}const el="batchId",nl=new Mn,il=new Mn,rl=new Mn,sl=new Mn,al=new gr,ol=new qe,ll=new dn,cl=new We,hl=new tl,ul=new Ji,dl=[];function pl(t,e,n=0){const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let s=0;s<r;s++)for(let r=0;r<i;r++)e.setComponent(s+n,r,t.getComponent(s,r))}else e.array.set(t.array,n*i);e.needsUpdate=!0}class ml extends Ji{get maxGeometryCount(){return this._maxGeometryCount}constructor(t,e,n=2*e,i){super(new Ii,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let t=Math.sqrt(4*this._maxGeometryCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new zo(e,t,t,j,H);this._matricesTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,i=this._maxGeometryCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const r=t.getAttribute(i),{array:s,itemSize:a,normalized:o}=r,l=new s.constructor(n*a),c=new r.constructor(l,a,o);c.setUsage(r.usage),e.setAttribute(i,c)}if(null!==t.getIndex()){const t=n>65536?new Uint32Array(r):new Uint16Array(r);e.setIndex(new Mi(t,1))}const s=i>65536?new Uint32Array(n):new Uint16Array(n);e.setAttribute(el,new Mi(s,1)),this._geometryInitialized=!0}}_validateGeometry(t){if(t.getAttribute(el))throw new Error(`BatchedMesh: Geometry cannot use attribute "${el}"`);const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(n===el)continue;if(!t.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=t.getAttribute(n),r=e.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qe);const t=this._geometryCount,e=this.boundingBox,n=this._active;e.makeEmpty();for(let i=0;i<t;i++)!1!==n[i]&&(this.getMatrixAt(i,nl),this.getBoundingBoxAt(i,ol).applyMatrix4(nl),e.union(ol))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new dn);const t=this._geometryCount,e=this.boundingSphere,n=this._active;e.makeEmpty();for(let i=0;i<t;i++)!1!==n[i]&&(this.getMatrixAt(i,nl),this.getBoundingSphereAt(i,ll).applyMatrix4(nl),e.union(ll))}addGeometry(t,e=-1,n=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const s=this._reservedRanges,a=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(r=s[s.length-1]),i.vertexCount=-1===e?t.getAttribute("position").count:e,i.vertexStart=null===r?0:r.vertexStart+r.vertexCount;const l=t.getIndex(),c=null!==l;if(c&&(i.indexCount=-1===n?l.count:n,i.indexStart=null===r?0:r.indexStart+r.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,u=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;h.push(!0),u.push(!0);const m=this._geometryCount;this._geometryCount++,rl.toArray(p,16*m),d.needsUpdate=!0,s.push(i),a.push({start:c?i.indexStart:i.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new qe,sphereInitialized:!1,sphere:new dn});const f=this.geometry.getAttribute(el);for(let t=0;t<i.vertexCount;t++)f.setX(i.vertexStart+t,m);return f.needsUpdate=!0,this.setGeometryAt(m,t),m}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),s=e.getIndex(),a=this._reservedRanges[t];if(i&&s.count>a.indexCount||e.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const o=a.vertexStart,l=a.vertexCount;for(const t in n.attributes){if(t===el)continue;const i=e.getAttribute(t),r=n.getAttribute(t);pl(i,r,o);const s=i.itemSize;for(let t=i.count,e=l;t<e;t++){const e=o+t;for(let t=0;t<s;t++)r.setComponent(e,t,0)}r.needsUpdate=!0}if(i){const t=a.indexStart;for(let e=0;e<s.count;e++)r.setX(t+e,o+s.getX(e));for(let e=s.count,n=a.indexCount;e<n;e++)r.setX(t+e,o);r.needsUpdate=!0}const c=this._bounds[t];null!==e.boundingBox?(c.box.copy(e.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,null!==e.boundingSphere?(c.sphere.copy(e.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const h=this._drawRanges[t],u=e.getAttribute("position");return h.count=i?s.count:u.count,this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._active;return t>=e.length||!1===e[t]||(e[t]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(t,e){if(!1===this._active[t])return this;const n=this._bounds[t],i=n.box,r=this.geometry;if(!1===n.boxInitialized){i.makeEmpty();const e=r.index,s=r.attributes.position,a=this._drawRanges[t];for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),i.expandByPoint(cl.fromBufferAttribute(s,n))}n.boxInitialized=!0}return e.copy(i),e}getBoundingSphereAt(t,e){if(!1===this._active[t])return this;const n=this._bounds[t],i=n.sphere,r=this.geometry;if(!1===n.sphereInitialized){i.makeEmpty(),this.getBoundingBoxAt(t,ol),ol.getCenter(i.center);const e=r.index,s=r.attributes.position,a=this._drawRanges[t];let o=0;for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),cl.fromBufferAttribute(s,n),o=Math.max(o,i.center.distanceToSquared(cl))}i.radius=Math.sqrt(o),n.sphereInitialized=!0}return e.copy(i),e}setMatrixAt(t,e){const n=this._active,i=this._matricesTexture,r=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(r,16*t),i.needsUpdate=!0),this}getMatrixAt(t,e){const n=this._active,i=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(i,16*t)}setVisibleAt(t,e){const n=this._visibility,i=this._active;return t>=this._geometryCount||!1===i[t]||n[t]===e||(n[t]=e,this._visibilityChanged=!0),this}getVisibleAt(t){const e=this._visibility,n=this._active;return!(t>=this._geometryCount||!1===n[t])&&e[t]}raycast(t,e){const n=this._visibility,i=this._active,r=this._drawRanges,s=this._geometryCount,a=this.matrixWorld,o=this.geometry;ul.material=this.material,ul.geometry.index=o.index,ul.geometry.attributes=o.attributes,null===ul.geometry.boundingBox&&(ul.geometry.boundingBox=new qe),null===ul.geometry.boundingSphere&&(ul.geometry.boundingSphere=new dn);for(let o=0;o<s;o++){if(!n[o]||!i[o])continue;const s=r[o];ul.geometry.setDrawRange(s.start,s.count),this.getMatrixAt(o,ul.matrixWorld).premultiply(a),this.getBoundingBoxAt(o,ul.geometry.boundingBox),this.getBoundingSphereAt(o,ul.geometry.boundingSphere),ul.raycast(t,dl);for(let t=0,n=dl.length;t<n;t++){const n=dl[t];n.object=this,n.batchId=o,e.push(n)}dl.length=0}ul.material=null,ul.geometry.index=null,ul.geometry.attributes={},ul.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map((t=>({...t}))),this._reservedRanges=t._reservedRanges.map((t=>({...t}))),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map((t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()}))),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(t,e,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._visibility,l=this._multiDrawStarts,c=this._multiDrawCounts,h=this._drawRanges,u=this.perObjectFrustumCulled;u&&(sl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),al.setFromProjectionMatrix(sl,t.isWebGPURenderer?Qt:$t));let d=0;if(this.sortObjects){il.copy(this.matrixWorld).invert(),cl.setFromMatrixPosition(n.matrixWorld).applyMatrix4(il);for(let t=0,e=o.length;t<e;t++)if(o[t]){this.getMatrixAt(t,nl),this.getBoundingSphereAt(t,ll).applyMatrix4(nl);let e=!1;if(u&&(e=!al.intersectsSphere(ll)),!e){const e=cl.distanceTo(ll.center);hl.push(h[t],e)}}const t=hl.list,e=this.customSort;null===e?t.sort(r.transparent?Qo:$o):e.call(this,t,n);for(let e=0,n=t.length;e<n;e++){const n=t[e];l[d]=n.start*a,c[d]=n.count,d++}hl.reset()}else for(let t=0,e=o.length;t<e;t++)if(o[t]){let e=!1;if(u&&(this.getMatrixAt(t,nl),this.getBoundingSphereAt(t,ll).applyMatrix4(nl),e=!al.intersectsSphere(ll)),!e){const e=h[t];l[d]=e.start*a,c[d]=e.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(t,e,n,i,r,s){this.onBeforeRender(t,null,i,r,s)}}class fl extends di{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ci(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const gl=new We,_l=new We,vl=new Mn,xl=new yn,yl=new dn;class Ml extends jn{constructor(t=new Ii,e=new fl){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)gl.fromBufferAttribute(e,t-1),_l.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=gl.distanceTo(_l);t.setAttribute("lineDistance",new Ti(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),yl.copy(n.boundingSphere),yl.applyMatrix4(i),yl.radius+=r,!1===t.ray.intersectsSphere(yl))return;vl.copy(i).invert(),xl.copy(t.ray).applyMatrix4(vl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new We,c=new We,h=new We,u=new We,d=this.isLineSegments?2:1,p=n.index,m=n.attributes.position;if(null!==p){for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);l.fromBufferAttribute(m,i),c.fromBufferAttribute(m,r);if(xl.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(u);s<t.near||s>t.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(m.count,s.start+s.count)-1;n<i;n+=d){l.fromBufferAttribute(m,n),c.fromBufferAttribute(m,n+1);if(xl.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const Sl=new We,bl=new We;class Tl extends Ml{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Sl.fromBufferAttribute(e,t),bl.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Sl.distanceTo(bl);t.setAttribute("lineDistance",new Ti(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class El extends Ml{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class wl extends di{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ci(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Al=new Mn,Rl=new yn,Cl=new dn,Ll=new We;class Pl extends jn{constructor(t=new Ii,e=new wl){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cl.copy(n.boundingSphere),Cl.applyMatrix4(i),Cl.radius+=r,!1===t.ray.intersectsSphere(Cl))return;Al.copy(i).invert(),Rl.copy(t.ray).applyMatrix4(Al);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);Ll.fromBufferAttribute(c,r),Il(Ll,r,o,i,t,e,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)Ll.fromBufferAttribute(c,n),Il(Ll,n,o,i,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Il(t,e,n,i,r,s,a){const o=Rl.distanceSqToPoint(t);if(o<n){const n=new We;Rl.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:e,face:null,object:a})}}class Ul extends Fe{constructor(t,e,n,i,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,i,r,h,u),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class Dl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=e||(s.isVector2?new me:new We);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new We,i=[],r=[],s=[],a=new We,o=new Mn;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new We)}r[0]=new We,s[0]=new We;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(i[e-1],i[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(ae(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(ae(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Nl extends Dl{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const n=e||new me,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Ol extends Nl{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function Fl(){let t=0,e=0,n=0,i=0;function r(r,s,a,o){t=r,e=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,a,o){let l=(e-t)/s-(n-t)/(s+a)+(n-e)/a,c=(n-e)/a-(i-e)/(a+o)+(i-n)/o;l*=a,c*=a,r(e,n,l,c)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}const Bl=new We,zl=new Fl,Gl=new Fl,Hl=new Fl;class Vl extends Dl{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new We){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(Bl.subVectors(i[0],i[1]).add(i[0]),a=Bl);const h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(Bl.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=Bl),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),zl.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,e,n,i),Gl.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,e,n,i),Hl.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(zl.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),Gl.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),Hl.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(zl.calc(c),Gl.calc(c),Hl.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new We).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function kl(t,e,n,i,r){const s=.5*(i-e),a=.5*(r-n),o=t*t;return(2*n-2*i+s+a)*(t*o)+(-3*n+3*i-2*s-a)*o+s*t+n}function Wl(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Xl(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class jl extends Dl{constructor(t=new me,e=new me,n=new me,i=new me){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new me){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Xl(t,i.x,r.x,s.x,a.x),Xl(t,i.y,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class ql extends Dl{constructor(t=new We,e=new We,n=new We,i=new We){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new We){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Xl(t,i.x,r.x,s.x,a.x),Xl(t,i.y,r.y,s.y,a.y),Xl(t,i.z,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Yl extends Dl{constructor(t=new me,e=new me){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new me){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new me){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Zl extends Dl{constructor(t=new We,e=new We){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new We){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new We){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Jl extends Dl{constructor(t=new me,e=new me,n=new me){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new me){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Wl(t,i.x,r.x,s.x),Wl(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Kl extends Dl{constructor(t=new We,e=new We,n=new We){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new We){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Wl(t,i.x,r.x,s.x),Wl(t,i.y,r.y,s.y),Wl(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class $l extends Dl{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new me){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(kl(a,o.x,l.x,c.x,h.x),kl(a,o.y,l.y,c.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new me).fromArray(n))}return this}}var Ql=Object.freeze({__proto__:null,ArcCurve:Ol,CatmullRomCurve3:Vl,CubicBezierCurve:jl,CubicBezierCurve3:ql,EllipseCurve:Nl,LineCurve:Yl,LineCurve3:Zl,QuadraticBezierCurve:Jl,QuadraticBezierCurve3:Kl,SplineCurve:$l});class tc extends Dl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ql[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const i=o[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Ql[n.type]).fromJSON(n))}return this}}class ec extends tc{constructor(t){super(),this.type="Path",this.currentPoint=new me,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new Yl(this.currentPoint.clone(),new me(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new Jl(this.currentPoint.clone(),new me(t,e),new me(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const a=new jl(this.currentPoint.clone(),new me(t,e),new me(n,i),new me(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new $l(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,s,a,o),this}absellipse(t,e,n,i,r,s,a,o){const l=new Nl(t,e,n,i,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class nc extends Ii{constructor(t=[new me(0,-.5),new me(.5,0),new me(0,.5)],e=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=ae(i,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/e,h=new We,u=new me,d=new We,p=new We,m=new We;let f=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:f=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-f,d.z=0*g,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(m.x,m.y,m.z);break;default:f=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-f,d.z=0*g,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(p)}for(let r=0;r<=e;r++){const d=n+r*c*i,p=Math.sin(d),m=Math.cos(d);for(let n=0;n<=t.length-1;n++){h.x=t[n].x*p,h.y=t[n].y,h.z=t[n].x*m,s.push(h.x,h.y,h.z),u.x=r/e,u.y=n/(t.length-1),a.push(u.x,u.y);const i=o[3*n+0]*p,c=o[3*n+1],d=o[3*n+0]*m;l.push(i,c,d)}}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const i=e+n*t.length,s=i,a=i+t.length,o=i+t.length+1,l=i+1;r.push(s,a,l),r.push(o,l,a)}this.setIndex(r),this.setAttribute("position",new Ti(s,3)),this.setAttribute("uv",new Ti(a,2)),this.setAttribute("normal",new Ti(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new nc(t.points,t.segments,t.phiStart,t.phiLength)}}class ic extends nc{constructor(t=1,e=1,n=4,i=8){const r=new ec;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:n,radialSegments:i}}static fromJSON(t){return new ic(t.radius,t.length,t.capSegments,t.radialSegments)}}class rc extends Ii{constructor(t=1,e=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new We,c=new me;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=n+r/e*i;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,o.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Ti(s,3)),this.setAttribute("normal",new Ti(a,3)),this.setAttribute("uv",new Ti(o,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new rc(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class sc extends Ii{constructor(t=1,e=1,n=1,i=32,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const m=[],f=n/2;let g=0;function _(n){const r=p,s=new me,m=new We;let _=0;const v=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=i;t++)h.push(0,f*x,0),u.push(0,x,0),d.push(.5,.5),p++;const y=p;for(let t=0;t<=i;t++){const e=t/i*o+a,n=Math.cos(e),r=Math.sin(e);m.x=v*r,m.y=f*x,m.z=v*n,h.push(m.x,m.y,m.z),u.push(0,x,0),s.x=.5*n+.5,s.y=.5*r*x+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=y+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const s=new We,_=new We;let v=0;const x=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*o+a,l=Math.sin(r),m=Math.cos(r);_.x=v*l,_.y=-g*n+f,_.z=v*m,h.push(_.x,_.y,_.z),s.set(l,x,m).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}m.push(c)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=m[e][t],i=m[e+1][t],r=m[e+1][t+1],s=m[e][t+1];c.push(n,i,s),c.push(i,r,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Ti(h,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new sc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ac extends sc{constructor(t=1,e=1,n=32,i=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new ac(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class oc extends Ii{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function a(t,e,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const a=t.clone().lerp(n,i/r),o=e.clone().lerp(n,i/r),l=r-i;for(let t=0;t<=l;t++)s[i][t]=0===t&&i===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(o(s[t][n+1]),o(s[t+1][n]),o(s[t][n])):(o(s[t][n+1]),o(s[t+1][n+1]),o(s[t+1][n]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new We,i=new We,r=new We;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),a(n,i,r,t)}(i),function(t){const e=new We;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new We;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=h(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-a)}var e;(function(){const t=new We,e=new We,n=new We,i=new We,a=new me,o=new me,l=new me;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=h(i);c(a,d+0,t,p),c(o,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),a=Math.min(e,n,i);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Ti(r,3)),this.setAttribute("normal",new Ti(r.slice(),3)),this.setAttribute("uv",new Ti(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new oc(t.vertices,t.indices,t.radius,t.details)}}class lc extends oc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new lc(t.radius,t.detail)}}const cc=new We,hc=new We,uc=new We,dc=new ri;class pc extends Ii{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(ie*e),s=t.getIndex(),a=t.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:o}=dc;if(e.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),dc.getNormal(uc),h[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,h[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,h[2]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=h[t],i=h[e],s=dc[c[t]],a=dc[c[e]],o=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(uc.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:uc.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];cc.fromBufferAttribute(a,e),hc.fromBufferAttribute(a,n),d.push(cc.x,cc.y,cc.z),d.push(hc.x,hc.y,hc.z)}this.setAttribute("position",new Ti(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class mc extends ec{constructor(t){super(t),this.uuid=se(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new ec).fromJSON(n))}return this}}const fc=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=gc(t,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:t.length,c=gc(t,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ac(c));for(r.sort(bc),s=0;s<r.length;s++)n=Tc(r[s],n);return n}(t,e,s,n)),t.length>80*n){o=c=t[0],l=h=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?32767/p:0}return vc(s,a,n,o,l,p,0),a};function gc(t,e,n,i,r){let s,a;if(r===function(t,e,n,i){let r=0;for(let s=e,a=n-i;s<n;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)a=Fc(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=Fc(s,t[s],t[s+1],a);return a&&Pc(a,a.next)&&(Bc(a),a=a.next),a}function _c(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Pc(i,i.next)&&0!==Lc(i.prev,i,i.next))i=i.next;else{if(Bc(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function vc(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=wc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,a,o,l,c=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;e<c&&(o++,i=i.nextZ,i);e++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(t,i,r,s);let o,l,c=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?yc(t,i,r,s):xc(t))e.push(o.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),Bc(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?vc(t=Mc(_c(t),e,n),e,n,i,r,s,2):2===a&&Sc(t,e,n,i,r,s):vc(_c(t),e,n,i,r,s,1);break}}function xc(t){const e=t.prev,n=t,i=t.next;if(Lc(e,n,i)>=0)return!1;const r=e.x,s=n.x,a=i.x,o=e.y,l=n.y,c=i.y,h=r<s?r<a?r:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let m=i.next;for(;m!==e;){if(m.x>=h&&m.x<=d&&m.y>=u&&m.y<=p&&Rc(r,o,s,l,a,c,m.x,m.y)&&Lc(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function yc(t,e,n,i){const r=t.prev,s=t,a=t.next;if(Lc(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,h=r.y,u=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,m=h<u?h<d?h:d:u<d?u:d,f=o>l?o>c?o:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,_=wc(p,m,e,n,i),v=wc(f,g,e,n,i);let x=t.prevZ,y=t.nextZ;for(;x&&x.z>=_&&y&&y.z<=v;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==r&&x!==a&&Rc(o,h,l,u,c,d,x.x,x.y)&&Lc(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,y.x>=p&&y.x<=f&&y.y>=m&&y.y<=g&&y!==r&&y!==a&&Rc(o,h,l,u,c,d,y.x,y.y)&&Lc(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;x&&x.z>=_;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==r&&x!==a&&Rc(o,h,l,u,c,d,x.x,x.y)&&Lc(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;y&&y.z<=v;){if(y.x>=p&&y.x<=f&&y.y>=m&&y.y<=g&&y!==r&&y!==a&&Rc(o,h,l,u,c,d,y.x,y.y)&&Lc(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function Mc(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Pc(r,s)&&Ic(r,i,i.next,s)&&Nc(r,s)&&Nc(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Bc(i),Bc(i.next),i=t=s),i=i.next}while(i!==t);return _c(i)}function Sc(t,e,n,i,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Cc(a,t)){let o=Oc(a,t);return a=_c(a,a.next),o=_c(o,o.next),vc(a,e,n,i,r,s,0),void vc(o,e,n,i,r,s,0)}t=t.next}a=a.next}while(a!==t)}function bc(t,e){return t.x-e.x}function Tc(t,e){const n=function(t,e){let n,i=e,r=-1/0;const s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const t=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>r&&(r=t,n=i.x<i.next.x?i:i.next,t===s))return n}i=i.next}while(i!==e);if(!n)return null;const o=n,l=n.x,c=n.y;let h,u=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&Rc(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Nc(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Ec(n,i)))&&(n=i,u=h)),i=i.next}while(i!==o);return n}(t,e);if(!n)return e;const i=Oc(n,t);return _c(i,i.next),_c(n,n.next)}function Ec(t,e){return Lc(t.prev,t,e.prev)<0&&Lc(e.next,t,t.next)<0}function wc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ac(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Rc(t,e,n,i,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Cc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ic(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Nc(t,e)&&Nc(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Lc(t.prev,t,e.prev)||Lc(t,e.prev,e))||Pc(t,e)&&Lc(t.prev,t,t.next)>0&&Lc(e.prev,e,e.next)>0)}function Lc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Pc(t,e){return t.x===e.x&&t.y===e.y}function Ic(t,e,n,i){const r=Dc(Lc(t,e,n)),s=Dc(Lc(t,e,i)),a=Dc(Lc(n,i,t)),o=Dc(Lc(n,i,e));return r!==s&&a!==o||(!(0!==r||!Uc(t,n,e))||(!(0!==s||!Uc(t,i,e))||(!(0!==a||!Uc(n,t,i))||!(0!==o||!Uc(n,e,i)))))}function Uc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Dc(t){return t>0?1:t<0?-1:0}function Nc(t,e){return Lc(t.prev,t,t.next)<0?Lc(t,e,t.next)>=0&&Lc(t,t.prev,e)>=0:Lc(t,e,t.prev)<0||Lc(t,t.next,e)<0}function Oc(t,e){const n=new zc(t.i,t.x,t.y),i=new zc(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Fc(t,e,n,i){const r=new zc(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Bc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function zc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Gc{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return Gc.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];Hc(t),Vc(n,t);let s=t.length;e.forEach(Hc);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,Vc(n,e[t]);const a=fc(n,i);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function Hc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Vc(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class kc extends Ii{constructor(t=new mc([new me(.5,.5),new me(-.5,.5),new me(-.5,-.5),new me(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){s(t[e])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:Wc;let g,_,v,x,y,M=!1;m&&(g=m.getSpacedPoints(o),M=!0,c=!1,_=m.computeFrenetFrames(o,!1),v=new We,x=new We,y=new We),c||(p=0,h=0,u=0,d=0);const S=t.extractPoints(a);let b=S.shape;const T=S.holes;if(!Gc.isClockWise(b)){b=b.reverse();for(let t=0,e=T.length;t<e;t++){const e=T[t];Gc.isClockWise(e)&&(T[t]=e.reverse())}}const E=Gc.triangulateShape(b,T),w=b;for(let t=0,e=T.length;t<e;t++){const e=T[t];b=b.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n)}const R=b.length,C=E.length;function L(t,e,n){let i,r,s;const a=t.x-e.x,o=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-o/u,m=e.y+a/u,f=((n.x-c/d-p)*c-(n.y+l/d-m)*l)/(a*c-o*l);i=p+a*f-t.x,r=m+o*f-t.y;const g=i*i+r*r;if(g<=2)return new me(i,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(c)&&(t=!0),t?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2))}return new me(i/s,r/s)}const P=[];for(let t=0,e=w.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),P[t]=L(w[t],w[n],w[i]);const I=[];let U,D=P.concat();for(let t=0,e=T.length;t<e;t++){const e=T[t];U=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),U[t]=L(e[t],e[i],e[r]);I.push(U),D=D.concat(U)}for(let t=0;t<p;t++){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=w.length;t<e;t++){const e=A(w[t],P[t],i);F(e.x,e.y,-n)}for(let t=0,e=T.length;t<e;t++){const e=T[t];U=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],U[t],i);F(r.x,r.y,-n)}}}const N=u+d;for(let t=0;t<R;t++){const e=c?A(b[t],D[t],N):b[t];M?(x.copy(_.normals[0]).multiplyScalar(e.x),v.copy(_.binormals[0]).multiplyScalar(e.y),y.copy(g[0]).add(x).add(v),F(y.x,y.y,y.z)):F(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<R;e++){const n=c?A(b[e],D[e],N):b[e];M?(x.copy(_.normals[t]).multiplyScalar(n.x),v.copy(_.binormals[t]).multiplyScalar(n.y),y.copy(g[t]).add(x).add(v),F(y.x,y.y,y.z)):F(n.x,n.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=w.length;t<e;t++){const e=A(w[t],P[t],i);F(e.x,e.y,l+n)}for(let t=0,e=T.length;t<e;t++){const e=T[t];U=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],U[t],i);M?F(r.x,r.y+g[o-1].y,g[o-1].x+n):F(r.x,r.y,l+n)}}}function O(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=o+2*p;t<n;t++){const n=R*t,s=R*(t+1);z(e+i+n,e+r+n,e+r+s,e+i+s)}}}function F(t,e,n){s.push(t),s.push(e),s.push(n)}function B(t,e,r){G(t),G(e),G(r);const s=i.length/3,a=f.generateTopUV(n,i,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[2])}function z(t,e,r,s){G(t),G(e),G(s),G(e),G(r),G(s);const a=i.length/3,o=f.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function G(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=R*t;for(let t=0;t<C;t++){const n=E[t];B(n[2]+e,n[1]+e,n[0]+e)}t=o+2*p,e=R*t;for(let t=0;t<C;t++){const n=E[t];B(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<C;t++){const e=E[t];B(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=E[t];B(e[0]+R*o,e[1]+R*o,e[2]+R*o)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;O(w,e),e+=w.length;for(let t=0,n=T.length;t<n;t++){const n=T[t];O(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Ti(i,3)),this.setAttribute("uv",new Ti(r,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Ql[i.type]).fromJSON(i)),new kc(n,t.options)}}const Wc={generateTopUV:function(t,e,n,i,r){const s=e[3*n],a=e[3*n+1],o=e[3*i],l=e[3*i+1],c=e[3*r],h=e[3*r+1];return[new me(s,a),new me(o,l),new me(c,h)]},generateSideWallUV:function(t,e,n,i,r,s){const a=e[3*n],o=e[3*n+1],l=e[3*n+2],c=e[3*i],h=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],m=e[3*r+2],f=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new me(a,1-l),new me(c,1-u),new me(d,1-m),new me(f,1-_)]:[new me(o,1-l),new me(h,1-u),new me(p,1-m),new me(g,1-_)]}};class Xc extends oc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Xc(t.radius,t.detail)}}class jc extends oc{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new jc(t.radius,t.detail)}}class qc extends Ii{constructor(t=.5,e=1,n=32,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let h=t;const u=(e-t)/(i=Math.max(1,i)),d=new We,p=new me;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){const i=r+t/n*s;d.x=h*Math.cos(i),d.y=h*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let t=0;t<i;t++){const e=t*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new Ti(o,3)),this.setAttribute("normal",new Ti(l,3)),this.setAttribute("uv",new Ti(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qc(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Yc extends Ii{constructor(t=new mc([new me(0,.5),new me(-.5,-.5),new me(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=i.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===Gc.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===Gc.isClockWise(e)&&(h[t]=e.reverse())}const u=Gc.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+a,r=e[1]+a,s=e[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new Ti(i,3)),this.setAttribute("normal",new Ti(r,3)),this.setAttribute("uv",new Ti(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Yc(n,t.curveSegments)}}class Zc extends Ii{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new We,u=new We,d=[],p=[],m=[],f=[];for(let d=0;d<=n;d++){const g=[],_=d/n;let v=0;0===d&&0===s?v=.5/e:d===n&&o===Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const o=n/e;h.x=-t*Math.cos(i+o*r)*Math.sin(s+_*a),h.y=t*Math.cos(s+_*a),h.z=t*Math.sin(i+o*r)*Math.sin(s+_*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),m.push(u.x,u.y,u.z),f.push(o+v,1-_),g.push(l++)}c.push(g)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=c[t][i+1],r=c[t][i],a=c[t+1][i],l=c[t+1][i+1];(0!==t||s>0)&&d.push(e,r,l),(t!==n-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Zc(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Jc extends oc{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Jc(t.radius,t.detail)}}class Kc extends Ii{constructor(t=1,e=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new We,h=new We,u=new We;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,m=s/n*Math.PI*2;h.x=(t+e*Math.cos(m))*Math.cos(p),h.y=(t+e*Math.cos(m))*Math.sin(p),h.z=e*Math.sin(m),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,a=(i+1)*(t-1)+e,o=(i+1)*t+e;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Ti(a,3)),this.setAttribute("normal",new Ti(o,3)),this.setAttribute("uv",new Ti(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Kc(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class $c extends Ii{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new We,u=new We,d=new We,p=new We,m=new We,f=new We,g=new We;for(let a=0;a<=n;++a){const v=a/n*r*Math.PI*2;_(v,r,s,t,d),_(v+.01,r,s,t,p),f.subVectors(p,d),g.addVectors(p,d),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*m.x),h.y=d.y+(s*g.y+p*m.y),h.z=d.z+(s*g.z+p*m.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/n),c.push(t/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,o=(i+1)*(t-1)+e;a.push(n,r,o),a.push(r,s,o)}function _(t,e,n,i,r){const s=Math.cos(t),a=Math.sin(t),o=n/e*t,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Ti(o,3)),this.setAttribute("normal",new Ti(l,3)),this.setAttribute("uv",new Ti(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $c(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Qc extends Ii{constructor(t=new Kl(new We(-1,-1,0),new We(-1,1,0),new We(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new We,o=new We,l=new me;let c=new We;const h=[],u=[],d=[],p=[];function m(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)m(t);m(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,a=(i+1)*(t-1)+e;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Ti(h,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Qc((new Ql[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class th extends Ii{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new We,r=new We;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],c=l.start;for(let t=c,o=c+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),c=a.getX(t+(o+1)%3);i.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===eh(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===eh(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Ti(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function eh(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var nh=Object.freeze({__proto__:null,BoxGeometry:$i,CapsuleGeometry:ic,CircleGeometry:rc,ConeGeometry:ac,CylinderGeometry:sc,DodecahedronGeometry:lc,EdgesGeometry:pc,ExtrudeGeometry:kc,IcosahedronGeometry:Xc,LatheGeometry:nc,OctahedronGeometry:jc,PlaneGeometry:xr,PolyhedronGeometry:oc,RingGeometry:qc,ShapeGeometry:Yc,SphereGeometry:Zc,TetrahedronGeometry:Jc,TorusGeometry:Kc,TorusKnotGeometry:$c,TubeGeometry:Qc,WireframeGeometry:th});class ih extends di{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ci(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class rh extends ir{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class sh extends di{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ci(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class ah extends sh{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new me(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ae(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ci(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ci(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ci(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class oh extends di{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ci(16777215),this.specular=new ci(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=h,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class lh extends di{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ci(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class ch extends di{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class hh extends di{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=h,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class uh extends di{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ci(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class dh extends fl{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function ph(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function mh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function fh(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n}function gh(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[a++]=t[i+n]}return r}function _h(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(e.push(s.time),n.push.apply(n,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(e.push(s.time),a.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(e.push(s.time),n.push(a)),s=t[r++]}while(void 0!==s)}const vh={convertArray:ph,isTypedArray:mh,getKeyframeOrder:fh,sortedArray:gh,flattenJSON:_h,subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<n||s>=i)){l.push(e.times[t]);for(let n=0;n<o;++n)c.push(e.values[t*o+n])}}0!==l.length&&(e.times=ph(l,e.times.constructor),e.values=ph(c,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=i.times.length-1;let d;if(s<=i.times[0]){const t=o,e=l-o;d=i.values.slice(t,e)}else if(s>=i.times[u]){const t=u*l+o,e=t+l-o;d=i.values.slice(t,e)}else{const t=i.createInterpolant(),e=o,n=l-o;t.evaluate(s),d=t.resultBuffer.slice(e,n)}if("quaternion"===r){(new ke).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)ke.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=h-2*c;for(let n=0;n<t;++n)a.values[e+n]-=d[n]}}}return t.blendMode=Ot,t}};class xh{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const a=e[1];t<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class yh extends xh{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:It,endingEnd:It}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case Ut:r=t,a=2*e-n;break;case Dt:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Ut:s=t,o=2*n-e;break;case Dt:s=1,o=n+i[1]-i[0];break;default:s=t-1,o=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,_=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,v=(-1-d)*f+(1.5+d)*m+.5*p,x=d*f-d*m;for(let t=0;t!==a;++t)r[t]=g*s[c+t]+_*s[l+t]+v*s[o+t]+x*s[h+t];return r}}class Mh extends xh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(n-e)/(i-e),h=1-c;for(let t=0;t!==a;++t)r[t]=s[l+t]*h+s[o+t]*c;return r}}class Sh extends xh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class bh{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ph(e,this.TimeBufferType),this.values=ph(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:ph(t.times,Array),values:ph(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Sh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Mh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new yh(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Ct:e=this.InterpolantFactoryMethodDiscrete;break;case Lt:e=this.InterpolantFactoryMethodLinear;break;case Pt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ct;case this.InterpolantFactoryMethodLinear:return Lt;case this.InterpolantFactoryMethodSmooth:return Pt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&mh(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Pt,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(i)r=!0;else{const t=a*n,i=t-n,s=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[i+a]||n!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const i=a*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,a=0;a!==n;++a)e[i+a]=e[t+a];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}bh.prototype.TimeBufferType=Float32Array,bh.prototype.ValueBufferType=Float32Array,bh.prototype.DefaultInterpolation=Lt;class Th extends bh{}Th.prototype.ValueTypeName="bool",Th.prototype.ValueBufferType=Array,Th.prototype.DefaultInterpolation=Ct,Th.prototype.InterpolantFactoryMethodLinear=void 0,Th.prototype.InterpolantFactoryMethodSmooth=void 0;class Eh extends bh{}Eh.prototype.ValueTypeName="color";class wh extends bh{}wh.prototype.ValueTypeName="number";class Ah extends xh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e);let l=t*a;for(let t=l+a;l!==t;l+=4)ke.slerpFlat(r,0,s,l-a,s,l,o);return r}}class Rh extends bh{InterpolantFactoryMethodLinear(t){return new Ah(this.times,this.values,this.getValueSize(),t)}}Rh.prototype.ValueTypeName="quaternion",Rh.prototype.DefaultInterpolation=Lt,Rh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ch extends bh{}Ch.prototype.ValueTypeName="string",Ch.prototype.ValueBufferType=Array,Ch.prototype.DefaultInterpolation=Ct,Ch.prototype.InterpolantFactoryMethodLinear=void 0,Ch.prototype.InterpolantFactoryMethodSmooth=void 0;class Lh extends bh{}Lh.prototype.ValueTypeName="vector";class Ph{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=se(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(Ih(n[t]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(bh.toJSON(n[t]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=fh(a);a=gh(a,1,l),o=gh(o,1,l),i||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new wh(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(r);if(s&&s.length>1){const t=s[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const s=[];for(const t in i)s.push(this.CreateFromMorphTargetSequence(t,i[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],a=[];_h(n,s,a,i),0!==s.length&&r.push(new t(e,s,a))}},i=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new wh(".morphTargetInfluence["+n+"]",t,s))}o=t.length*s}else{const s=".bones["+e[t].name+"]";n(Lh,s+".position",r,"pos",i),n(Rh,s+".quaternion",r,"rot",i),n(Lh,s+".scale",r,"scl",i)}}if(0===i.length)return null;return new this(r,o,i,a)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ih(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wh;case"vector":case"vector2":case"vector3":case"vector4":return Lh;case"color":return Eh;case"quaternion":return Rh;case"bool":case"boolean":return Th;case"string":return Ch}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];_h(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Uh={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Dh{constructor(t,e,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===s&&void 0!==i.onStart&&i.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const Nh=new Dh;class Oh{constructor(t){this.manager=void 0!==t?t:Nh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Oh.DEFAULT_MATERIAL_NAME="__DEFAULT";const Fh={};class Bh extends Error{constructor(t,e){super(t),this.response=e}}class zh extends Oh{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Uh.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==Fh[t])return void Fh[t].push({onLoad:e,onProgress:n,onError:i});Fh[t]=[],Fh[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=Fh[t],i=e.body.getReader(),r=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw new Bh(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{Uh.add(t,e);const n=Fh[t];delete Fh[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=Fh[t];if(void 0===n)throw this.manager.itemError(t),e;delete Fh[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Gh extends Oh{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Uh.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=ye("img");function o(){c(),Uh.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class Hh extends jn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new ci(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class Vh extends Hh{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(jn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ci(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const kh=new Mn,Wh=new We,Xh=new We;class jh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new me(512,512),this.map=null,this.mapPass=null,this.matrix=new Mn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new gr,this._frameExtents=new me(1,1),this._viewportCount=1,this._viewports=[new Be(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Wh.setFromMatrixPosition(t.matrixWorld),e.position.copy(Wh),Xh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Xh),e.updateMatrixWorld(),kh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(kh)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class qh extends jh{constructor(){super(new sr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*re*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Yh extends Hh{constructor(t,e,n=0,i=Math.PI/3,r=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(jn.DEFAULT_UP),this.updateMatrix(),this.target=new jn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new qh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const Zh=new Mn,Jh=new We,Kh=new We;class $h extends jh{constructor(){super(new sr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new me(4,2),this._viewportCount=6,this._viewports=[new Be(2,1,1,1),new Be(0,1,1,1),new Be(3,1,1,1),new Be(1,1,1,1),new Be(3,0,1,1),new Be(1,0,1,1)],this._cubeDirections=[new We(1,0,0),new We(-1,0,0),new We(0,0,1),new We(0,0,-1),new We(0,1,0),new We(0,-1,0)],this._cubeUps=[new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,0,1),new We(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Jh.setFromMatrixPosition(t.matrixWorld),n.position.copy(Jh),Kh.copy(n.position),Kh.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Kh),n.updateMatrixWorld(),i.makeTranslation(-Jh.x,-Jh.y,-Jh.z),Zh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zh)}}class Qh extends Hh{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new $h}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class tu extends jh{constructor(){super(new Lr(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class eu extends Hh{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(jn.DEFAULT_UP),this.updateMatrix(),this.target=new jn,this.shadow=new tu}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class nu extends Hh{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class iu extends Hh{constructor(t,e,n=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class ru{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new We)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}class su extends Hh{constructor(t=new ru,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class au extends Oh{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,s=new zh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=au.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new ci).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(i.uniforms[e]={},r.type){case"t":i.uniforms[e].value=n(r.value);break;case"c":i.uniforms[e].value=(new ci).setHex(r.value);break;case"v2":i.uniforms[e].value=(new me).fromArray(r.value);break;case"v3":i.uniforms[e].value=(new We).fromArray(r.value);break;case"v4":i.uniforms[e].value=(new Be).fromArray(r.value);break;case"m3":i.uniforms[e].value=(new fe).fromArray(r.value);break;case"m4":i.uniforms[e].value=(new Mn).fromArray(r.value);break;default:i.uniforms[e].value=r.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new me).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new me).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=n(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){return new{ShadowMaterial:ih,SpriteMaterial:lo,RawShaderMaterial:rh,ShaderMaterial:ir,PointsMaterial:wl,MeshPhysicalMaterial:ah,MeshStandardMaterial:sh,MeshPhongMaterial:oh,MeshToonMaterial:lh,MeshNormalMaterial:ch,MeshLambertMaterial:hh,MeshDepthMaterial:Ha,MeshDistanceMaterial:Va,MeshBasicMaterial:pi,MeshMatcapMaterial:uh,LineDashedMaterial:dh,LineBasicMaterial:fl,Material:di}[t]}}class ou{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class lu extends Ii{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class cu extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new zh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],s=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers,r=i[e],s=new Uint32Array(r).buffer;return n[e]=s,s}(t,r.buffer),a=xe(r.type,s),o=new so(a,r.stride);return o.uuid=r.uuid,e[i]=o,o}const r=t.isInstancedBufferGeometry?new lu:new Ii,s=t.data.index;if(void 0!==s){const t=xe(s.type,s.array);r.setIndex(new Mi(t,1))}const a=t.data.attributes;for(const e in a){const n=a[e];let s;if(n.isInterleavedBufferAttribute){const e=i(t.data,n.data);s=new oo(e,n.itemSize,n.offset,n.normalized)}else{const t=xe(n.type,n.array);s=new(n.isInstancedBufferAttribute?ko:Mi)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const n=o[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];let a;if(r.isInterleavedBufferAttribute){const e=i(t.data,r.data);a=new oo(e,r.itemSize,r.offset,r.normalized)}else{const t=xe(r.type,r.array);a=new Mi(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new We;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new dn(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const hu={UVMapping:S,CubeReflectionMapping:b,CubeRefractionMapping:T,EquirectangularReflectionMapping:E,EquirectangularRefractionMapping:w,CubeUVReflectionMapping:A},uu={RepeatWrapping:R,ClampToEdgeWrapping:C,MirroredRepeatWrapping:L},du={NearestFilter:P,NearestMipmapNearestFilter:I,NearestMipmapLinearFilter:U,LinearFilter:D,LinearMipmapNearestFilter:N,LinearMipmapLinearFilter:O};let pu;class mu{static getContext(){return void 0===pu&&(pu=new(window.AudioContext||window.webkitAudioContext)),pu}static setContext(t){pu=t}}const fu=new Mn,gu=new Mn,_u=new Mn;class vu{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=xu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=xu();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function xu(){return("undefined"==typeof performance?Date:performance).now()}const yu=new We,Mu=new ke,Su=new We,bu=new We;class Tu extends jn{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Eu=new We,wu=new ke,Au=new We,Ru=new We;class Cu{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){a.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]}_slerp(t,e,n,i){ke.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;ke.multiplyQuaternionsFlat(t,s,t,e,t,n),ke.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[n+a]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const Lu="\\[\\]\\.:\\/",Pu=new RegExp("["+Lu+"]","g"),Iu="[^"+Lu+"]",Uu="[^"+Lu.replace("\\.","")+"]",Du=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Iu)+/(WCOD+)?/.source.replace("WCOD",Uu)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Iu)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Iu)+"$"),Nu=["material","materials","bones","map"];class Ou{constructor(t,e,n){this.path=e,this.parsedPath=n||Ou.parseTrackName(e),this.node=Ou.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Ou.Composite(t,e,n):new Ou(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Pu,"")}static parseTrackName(t){const e=Du.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==Nu.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=Ou.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ou.Composite=class{constructor(t,e,n){const i=n||Ou.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Ou.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ou.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ou.prototype.GetterByBindingType=[Ou.prototype._getValue_direct,Ou.prototype._getValue_array,Ou.prototype._getValue_arrayElement,Ou.prototype._getValue_toArray],Ou.prototype.SetterByBindingTypeAndVersioning=[[Ou.prototype._setValue_direct,Ou.prototype._setValue_direct_setNeedsUpdate,Ou.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ou.prototype._setValue_array,Ou.prototype._setValue_array_setNeedsUpdate,Ou.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ou.prototype._setValue_arrayElement,Ou.prototype._setValue_arrayElement_setNeedsUpdate,Ou.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ou.prototype._setValue_fromArray,Ou.prototype._setValue_fromArray_setNeedsUpdate,Ou.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Fu{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:It,endingEnd:It};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===Ot)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(a);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=Ut,i.endingEnd=Ut):(i.endingStart=t?this.zeroSlopeAtStart?Ut:It:Dt,i.endingEnd=e?this.zeroSlopeAtEnd?Ut:It:Dt)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=n,this}}const Bu=new Float32Array(1);class zu{constructor(t){this.value=t}clone(){return new zu(void 0===this.value.clone?this.value:this.value.clone())}}let Gu=0;function Hu(t,e){return t.distance-e.distance}function Vu(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)Vu(i[t],e,n,!0)}}const ku=new me;const Wu=new We,Xu=new We;const ju=new We;const qu=new We,Yu=new Mn,Zu=new Mn;function Ju(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Ju(t.children[n]));return e}const Ku=new We,$u=new ci,Qu=new ci;const td=new We,ed=new We,nd=new We;const id=new We,rd=new rr;function sd(t,e,n,i,r,s,a){id.set(r,s,a).unproject(i);const o=e[t];if(void 0!==o){const t=n.getAttribute("position");for(let e=0,n=o.length;e<n;e++)t.setXYZ(o[e],id.x,id.y,id.z)}}const ad=new qe;const od=new We;let ld,cd;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e),t.ACESFilmicToneMapping=_,t.AddEquation=o,t.AddOperation=d,t.AdditiveAnimationBlendMode=Ot,t.AdditiveBlending=2,t.AgXToneMapping=x,t.AlphaFormat=1021,t.AlwaysCompare=519,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=nu,t.AnimationAction=Fu,t.AnimationClip=Ph,t.AnimationLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new zh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=Ph.parse(t[n]);e.push(i)}return e}},t.AnimationMixer=class extends te{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,a=t._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let t=0;t!==r;++t){const r=i[t],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;h=new Cu(Ou.create(n,l,i),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),s[t]=h}a[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new Mh(new Float32Array(2),new Float32Array(2),1,Bu),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?Ph.findByName(i,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Nt),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Fu(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?Ph.findByName(n,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==n;++a){e[a]._update(i,t,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},t.AnimationObjectGroup=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=se(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new Ou(h,n[t],i[t]))}else if(d<l){a=t[d];const o=--l,c=t[o];e[c.uuid]=d,t[d]=c,e[u]=o,t[o]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new Ou(h,n[t],i[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[o]=s,t[s]=a;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[l];e[l]=i,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],c=--s,h=t[c];e[o.uuid]=l,t[l]=o,e[h.uuid]=a,t[a]=h,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[a],r=e[c];e[l]=i,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);i=r.length,n[t]=i,s.push(t),a.push(e),r.push(h);for(let n=c,i=o.length;n!==i;++n){const i=o[n];h[n]=new Ou(i,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}},t.AnimationUtils=vh,t.ArcCurve=Ol,t.ArrayCamera=qa,t.ArrowHelper=class extends jn{constructor(t=new We(0,0,1),e=new We(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===ld&&(ld=new Ii,ld.setAttribute("position",new Ti([0,0,0,0,1,0],3)),cd=new sc(0,.5,1,5,1),cd.translate(0,-.5,0)),this.position.copy(e),this.line=new Ml(ld,new fl({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ji(cd,new pi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{od.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(od,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},t.AttachedBindMode=y,t.Audio=Tu,t.AudioAnalyser=class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}},t.AudioContext=mu,t.AudioListener=class extends jn{constructor(){super(),this.type="AudioListener",this.context=mu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new vu}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(yu,Mu,Su),bu.set(0,0,-1).applyQuaternion(Mu),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(yu.x,t),e.positionY.linearRampToValueAtTime(yu.y,t),e.positionZ.linearRampToValueAtTime(yu.z,t),e.forwardX.linearRampToValueAtTime(bu.x,t),e.forwardY.linearRampToValueAtTime(bu.y,t),e.forwardZ.linearRampToValueAtTime(bu.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(yu.x,yu.y,yu.z),e.setOrientation(bu.x,bu.y,bu.z,n.x,n.y,n.z)}},t.AudioLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new zh(this.manager);function a(e){i?i(e):console.error(e),r.manager.itemError(t)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){try{const n=t.slice(0);mu.getContext().decodeAudioData(n,(function(t){e(t)})).catch(a)}catch(t){a(t)}}),n,i)}},t.AxesHelper=class extends Tl{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Ii;n.setAttribute("position",new Ti(e,3)),n.setAttribute("color",new Ti([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new fl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new ci,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BackSide=a,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BatchedMesh=ml,t.Bone=Bo,t.BooleanKeyframeTrack=Th,t.Box2=class{constructor(t=new me(1/0,1/0),e=new me(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=ku.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,ku).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},t.Box3=qe,t.Box3Helper=class extends Tl{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Ii;i.setIndex(new Mi(n,1)),i.setAttribute("position",new Ti([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new fl({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BoxGeometry=$i,t.BoxHelper=class extends Tl{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Ii;r.setIndex(new Mi(n,1)),r.setAttribute("position",new Mi(i,3)),super(r,new fl({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ad.setFromObject(this.object),ad.isEmpty())return;const e=ad.min,n=ad.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BufferAttribute=Mi,t.BufferGeometry=Ii,t.BufferGeometryLoader=cu,t.ByteType=1010,t.Cache=Uh,t.Camera=rr,t.CameraHelper=class extends Tl{constructor(t){const e=new Ii,n=new fl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){i.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Ti(i,3)),e.setAttribute("color",new Ti(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new ci(16755200),c=new ci(16711680),h=new ci(43775),u=new ci(16777215),d=new ci(3355443);this.setColors(l,c,h,u,d)}setColors(t,e,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;rd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),sd("c",e,t,rd,0,0,-1),sd("t",e,t,rd,0,0,1),sd("n1",e,t,rd,-1,-1,-1),sd("n2",e,t,rd,1,-1,-1),sd("n3",e,t,rd,-1,1,-1),sd("n4",e,t,rd,1,1,-1),sd("f1",e,t,rd,-1,-1,1),sd("f2",e,t,rd,1,-1,1),sd("f3",e,t,rd,-1,1,1),sd("f4",e,t,rd,1,1,1),sd("u1",e,t,rd,.7,1.1,-1),sd("u2",e,t,rd,-.7,1.1,-1),sd("u3",e,t,rd,0,2,-1),sd("cf1",e,t,rd,-1,0,1),sd("cf2",e,t,rd,1,0,1),sd("cf3",e,t,rd,0,-1,1),sd("cf4",e,t,rd,0,1,1),sd("cn1",e,t,rd,-1,0,-1),sd("cn2",e,t,rd,1,0,-1),sd("cn3",e,t,rd,0,-1,-1),sd("cn4",e,t,rd,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},t.CanvasTexture=class extends Fe{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},t.CapsuleGeometry=ic,t.CatmullRomCurve3=Vl,t.CineonToneMapping=g,t.CircleGeometry=rc,t.ClampToEdgeWrapping=C,t.Clock=vu,t.Color=ci,t.ColorKeyframeTrack=Eh,t.ColorManagement=Re,t.CompressedArrayTexture=class extends Ul{constructor(t,e,n,i,r,s){super(t,e,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=C}},t.CompressedCubeTexture=class extends Ul{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,b),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}},t.CompressedTexture=Ul,t.CompressedTextureLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=[],a=new Ul,o=new zh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(t[c],(function(t){const n=r.parse(t,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=D),a.image=s,a.format=n.format,a.needsUpdate=!0,e&&e(a))}),n,i)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else o.load(t,(function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=D),a.format=n.format,a.needsUpdate=!0,e&&e(a)}),n,i);return a}},t.ConeGeometry=ac,t.ConstantAlphaFactor=213,t.ConstantColorFactor=211,t.CubeCamera=or,t.CubeReflectionMapping=b,t.CubeRefractionMapping=T,t.CubeTexture=lr,t.CubeTextureLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=new lr;r.colorSpace=Gt;const s=new Gh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(t[n],(function(t){r.images[n]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(let e=0;e<t.length;++e)o(e);return r}},t.CubeUVReflectionMapping=A,t.CubicBezierCurve=jl,t.CubicBezierCurve3=ql,t.CubicInterpolant=yh,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=Dl,t.CurvePath=tc,t.CustomBlending=5,t.CustomToneMapping=v,t.CylinderGeometry=sc,t.Cylindrical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}},t.Data3DTexture=Ve,t.DataArrayTexture=He,t.DataTexture=zo,t.DataTextureLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new zo,a=new zh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){let n;try{n=r.parse(t)}catch(t){if(void 0===i)return void console.error(t);i(t)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:C,s.wrapT=void 0!==n.wrapT?n.wrapT:C,s.magFilter=void 0!==n.magFilter?n.magFilter:D,s.minFilter=void 0!==n.minFilter?n.minFilter:D,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?s.colorSpace=n.colorSpace:void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=O),1===n.mipmapCount&&(s.minFilter=D),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n)}),n,i),s}},t.DataUtils=vi,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=Nh,t.DepthFormat=q,t.DepthStencilFormat=Y,t.DepthTexture=ns,t.DetachedBindMode=M,t.DirectionalLight=eu,t.DirectionalLightHelper=class extends jn{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===e&&(e=1);let i=new Ii;i.setAttribute("position",new Ti([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new fl({fog:!1,toneMapped:!1});this.lightPlane=new Ml(i,r),this.add(this.lightPlane),i=new Ii,i.setAttribute("position",new Ti([0,0,0,0,0,1],3)),this.targetLine=new Ml(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),td.setFromMatrixPosition(this.light.matrixWorld),ed.setFromMatrixPosition(this.light.target.matrixWorld),nd.subVectors(ed,td),this.lightPlane.lookAt(ed),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ed),this.targetLine.scale.z=nd.length()}},t.DiscreteInterpolant=Sh,t.DisplayP3ColorSpace=Vt,t.DodecahedronGeometry=lc,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=pc,t.EllipseCurve=Nl,t.EqualCompare=514,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=E,t.EquirectangularRefractionMapping=w,t.Euler=Pn,t.EventDispatcher=te,t.ExtrudeGeometry=kc,t.FileLoader=zh,t.Float16BufferAttribute=class extends Mi{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=_i(this.array[t*this.itemSize]);return this.normalized&&(e=ue(e,this.array)),e}setX(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize]=gi(e),this}getY(t){let e=_i(this.array[t*this.itemSize+1]);return this.normalized&&(e=ue(e,this.array)),e}setY(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+1]=gi(e),this}getZ(t){let e=_i(this.array[t*this.itemSize+2]);return this.normalized&&(e=ue(e,this.array)),e}setZ(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+2]=gi(e),this}getW(t){let e=_i(this.array[t*this.itemSize+3]);return this.normalized&&(e=ue(e,this.array)),e}setW(t,e){return this.normalized&&(e=de(e,this.array)),this.array[t*this.itemSize+3]=gi(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array)),this.array[t+0]=gi(e),this.array[t+1]=gi(n),this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array)),this.array[t+0]=gi(e),this.array[t+1]=gi(n),this.array[t+2]=gi(i),this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=de(e,this.array),n=de(n,this.array),i=de(i,this.array),r=de(r,this.array)),this.array[t+0]=gi(e),this.array[t+1]=gi(n),this.array[t+2]=gi(i),this.array[t+3]=gi(r),this}},t.Float32BufferAttribute=Ti,t.Float64BufferAttribute=class extends Mi{constructor(t,e,n){super(new Float64Array(t),e,n)}},t.FloatType=H,t.Fog=io,t.FogExp2=no,t.FramebufferTexture=class extends Fe{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=P,this.minFilter=P,this.generateMipmaps=!1,this.needsUpdate=!0}},t.FrontSide=s,t.Frustum=gr,t.GLBufferAttribute=class{constructor(t,e,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}},t.GLSL1="100",t.GLSL3=Jt,t.GreaterCompare=516,t.GreaterDepth=6,t.GreaterEqualCompare=518,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=class extends Tl{constructor(t=10,e=10,n=4473924,i=8947848){n=new ci(n),i=new ci(i);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,c=0,h=-a;t<=e;t++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const e=t===r?n:i;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Ii;c.setAttribute("position",new Ti(o,3)),c.setAttribute("color",new Ti(l,3));super(c,new fl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},t.Group=Ya,t.HalfFloatType=V,t.HemisphereLight=Vh,t.HemisphereLightHelper=class extends jn{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new jc(e);i.rotateY(.5*Math.PI),this.material=new pi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new Mi(s,3)),this.add(new Ji(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");$u.copy(this.light.color),Qu.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?$u:Qu;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(Ku.setFromMatrixPosition(this.light.matrixWorld).negate())}},t.IcosahedronGeometry=Xc,t.ImageBitmapLoader=class extends Oh{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Uh.get(t);if(void 0!==s)return r.manager.itemStart(t),s.then?void s.then((n=>{e&&e(n),r.manager.itemEnd(t)})).catch((t=>{i&&i(t)})):(setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){return Uh.add(t,n),e&&e(n),r.manager.itemEnd(t),n})).catch((function(e){i&&i(e),Uh.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)}));Uh.add(t,o),r.manager.itemStart(t)}},t.ImageLoader=Gh,t.ImageUtils=Ie,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=ko,t.InstancedBufferGeometry=lu,t.InstancedInterleavedBuffer=class extends so{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}},t.InstancedMesh=Ko,t.Int16BufferAttribute=class extends Mi{constructor(t,e,n){super(new Int16Array(t),e,n)}},t.Int32BufferAttribute=class extends Mi{constructor(t,e,n){super(new Int32Array(t),e,n)}},t.Int8BufferAttribute=class extends Mi{constructor(t,e,n){super(new Int8Array(t),e,n)}},t.IntType=z,t.InterleavedBuffer=so,t.InterleavedBufferAttribute=oo,t.Interpolant=xh,t.InterpolateDiscrete=Ct,t.InterpolateLinear=Lt,t.InterpolateSmooth=Pt,t.InvertStencilOp=5386,t.KeepStencilOp=Yt,t.KeyframeTrack=bh,t.LOD=Ao,t.LatheGeometry=nc,t.Layers=In,t.LessCompare=513,t.LessDepth=2,t.LessEqualCompare=515,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=Hh,t.LightProbe=su,t.Line=Ml,t.Line3=class{constructor(t=new We,e=new We){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Wu.subVectors(t,this.start),Xu.subVectors(this.end,this.start);const n=Xu.dot(Xu);let i=Xu.dot(Wu)/n;return e&&(i=ae(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},t.LineBasicMaterial=fl,t.LineCurve=Yl,t.LineCurve3=Zl,t.LineDashedMaterial=dh,t.LineLoop=El,t.LineSegments=Tl,t.LinearDisplayP3ColorSpace=kt,t.LinearEncoding=Ft,t.LinearFilter=D,t.LinearInterpolant=Mh,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=O,t.LinearMipmapNearestFilter=N,t.LinearSRGBColorSpace=Ht,t.LinearToneMapping=m,t.LinearTransfer=Wt,t.Loader=Oh,t.LoaderUtils=ou,t.LoadingManager=Dh,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=di,t.MaterialLoader=au,t.MathUtils=pe,t.Matrix3=fe,t.Matrix4=Mn,t.MaxEquation=104,t.Mesh=Ji,t.MeshBasicMaterial=pi,t.MeshDepthMaterial=Ha,t.MeshDistanceMaterial=Va,t.MeshLambertMaterial=hh,t.MeshMatcapMaterial=uh,t.MeshNormalMaterial=ch,t.MeshPhongMaterial=oh,t.MeshPhysicalMaterial=ah,t.MeshStandardMaterial=sh,t.MeshToonMaterial=lh,t.MinEquation=103,t.MirroredRepeatWrapping=L,t.MixOperation=u,t.MultiplyBlending=4,t.MultiplyOperation=h,t.NearestFilter=P,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=U,t.NearestMipmapNearestFilter=I,t.NeverCompare=512,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColorSpace=zt,t.NoToneMapping=p,t.NormalAnimationBlendMode=Nt,t.NormalBlending=1,t.NotEqualCompare=517,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=wh,t.Object3D=jn,t.ObjectLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===this.path?ou.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new zh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);r.parse(s,e)}),n,i)}async loadAsync(t,e){const n=""===this.path?ou.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const i=new zh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(t,e),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,i,a,s,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new mc).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse((function(t){t.isBone&&(i[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Vo).fromJSON(t[e],i);n[r.uuid]=r}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new cu;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;default:a.type in nh?s=nh[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new au;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=Ph.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),r.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:xe(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new Dh(e);r=new Gh(n),r.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n.url;if(Array.isArray(r)){const t=[];for(let e=0,n=r.length;e<n;e++){const n=s(r[e]);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new zo(n.data,n.width,n.height)))}i[n.uuid]=new De(t)}else{const t=s(n.url);i[n.uuid]=new De(t)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(t){if("string"==typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await i.loadAsync(r)}return t.data?{data:xe(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new Gh(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.url;if(Array.isArray(s)){const t=[];for(let e=0,n=s.length;e<n;e++){const n=s[e],i=await r(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new zo(i.data,i.width,i.height)))}n[i.uuid]=new De(t)}else{const t=await r(i.url);n[i.uuid]=new De(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image],o=a.data;let l;Array.isArray(o)?(l=new lr,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new zo:new Fe,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,hu)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],uu),l.wrapT=n(s.wrap[1],uu)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,du)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,du)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(t,e,n,i,r){let s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function h(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":s=new ro,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new ci(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new io(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new no(t.fog.color,t.fog.density)),""!==t.fog.name&&(s.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":s=new sr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Lr(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new nu(t.color,t.intensity);break;case"DirectionalLight":s=new eu(t.color,t.intensity);break;case"PointLight":s=new Qh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new iu(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Yh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new Vh(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new su).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=c(t.material),s=new Fo(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=c(t.material),s=new Ji(a,o);break;case"InstancedMesh":a=l(t.geometry),o=c(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;s=new Ko(a,o,e),s.instanceMatrix=new ko(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new ko(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":a=l(t.geometry),o=c(t.material),s=new ml(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=t.perObjectFrustumCulled,s.sortObjects=t.sortObjects,s._drawRanges=t.drawRanges,s._reservedRanges=t.reservedRanges,s._visibility=t.visibility,s._active=t.active,s._bounds=t.bounds.map((t=>{const e=new qe;e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);const n=new dn;return n.radius=t.sphereRadius,n.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:n}})),s._maxGeometryCount=t.maxGeometryCount,s._maxVertexCount=t.maxVertexCount,s._maxIndexCount=t.maxIndexCount,s._geometryInitialized=t.geometryInitialized,s._geometryCount=t.geometryCount,s._matricesTexture=h(t.matricesTexture.uuid);break;case"LOD":s=new Ao;break;case"Line":s=new Ml(l(t.geometry),c(t.material));break;case"LineLoop":s=new El(l(t.geometry),c(t.material));break;case"LineSegments":s=new Tl(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new Pl(l(t.geometry),c(t.material));break;case"Sprite":s=new bo(c(t.material));break;case"Group":s=new Ya;break;case"Bone":s=new Bo;break;default:s=new jn}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance,n.hysteresis)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}},t.ObjectSpaceNormalMap=1,t.OctahedronGeometry=jc,t.OneFactor=201,t.OneMinusConstantAlphaFactor=214,t.OneMinusConstantColorFactor=212,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=c,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Lr,t.P3Primaries=qt,t.PCFShadowMap=n,t.PCFSoftShadowMap=i,t.PMREMGenerator=Hr,t.Path=ec,t.PerspectiveCamera=sr,t.Plane=pr,t.PlaneGeometry=xr,t.PlaneHelper=class extends Ml{constructor(t,e=1,n=16776960){const i=n,r=new Ii;r.setAttribute("position",new Ti([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new fl({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Ii;s.setAttribute("position",new Ti([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Ji(s,new pi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},t.PointLight=Qh,t.PointLightHelper=class extends Ji{constructor(t,e,n){super(new Zc(e,4,2),new pi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t.Points=Pl,t.PointsMaterial=wl,t.PolarGridHelper=class extends Tl{constructor(t=10,e=16,n=8,i=64,r=4473924,s=8947848){r=new ci(r),s=new ci(s);const a=[],o=[];if(e>1)for(let n=0;n<e;n++){const i=n/e*(2*Math.PI),l=Math.sin(i)*t,c=Math.cos(i)*t;a.push(0,0,0),a.push(l,0,c);const h=1&n?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let e=0;e<n;e++){const l=1&e?r:s,c=t-t/n*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),n=Math.sin(e)*c,r=Math.cos(e)*c;a.push(n,0,r),o.push(l.r,l.g,l.b),e=(t+1)/i*(2*Math.PI),n=Math.sin(e)*c,r=Math.cos(e)*c,a.push(n,0,r),o.push(l.r,l.g,l.b)}}const l=new Ii;l.setAttribute("position",new Ti(a,3)),l.setAttribute("color",new Ti(o,3));super(l,new fl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},t.PolyhedronGeometry=oc,t.PositionalAudio=class extends Tu{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Eu,wu,Au),Ru.set(0,0,1).applyQuaternion(wu);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Eu.x,t),e.positionY.linearRampToValueAtTime(Eu.y,t),e.positionZ.linearRampToValueAtTime(Eu.z,t),e.orientationX.linearRampToValueAtTime(Ru.x,t),e.orientationY.linearRampToValueAtTime(Ru.y,t),e.orientationZ.linearRampToValueAtTime(Ru.z,t)}else e.setPosition(Eu.x,Eu.y,Eu.z),e.setOrientation(Ru.x,Ru.y,Ru.z)}},t.PropertyBinding=Ou,t.PropertyMixer=Cu,t.QuadraticBezierCurve=Jl,t.QuadraticBezierCurve3=Kl,t.Quaternion=ke,t.QuaternionKeyframeTrack=Rh,t.QuaternionLinearInterpolant=Ah,t.RED_GREEN_RGTC2_Format=At,t.RED_RGTC1_Format=36283,t.REVISION=e,t.RGBADepthPacking=3201,t.RGBAFormat=j,t.RGBAIntegerFormat=K,t.RGBA_ASTC_10x10_Format=yt,t.RGBA_ASTC_10x5_Format=_t,t.RGBA_ASTC_10x6_Format=vt,t.RGBA_ASTC_10x8_Format=xt,t.RGBA_ASTC_12x10_Format=Mt,t.RGBA_ASTC_12x12_Format=St,t.RGBA_ASTC_4x4_Format=ct,t.RGBA_ASTC_5x4_Format=ht,t.RGBA_ASTC_5x5_Format=ut,t.RGBA_ASTC_6x5_Format=dt,t.RGBA_ASTC_6x6_Format=pt,t.RGBA_ASTC_8x5_Format=mt,t.RGBA_ASTC_8x6_Format=ft,t.RGBA_ASTC_8x8_Format=gt,t.RGBA_BPTC_Format=bt,t.RGBA_ETC2_EAC_Format=lt,t.RGBA_PVRTC_2BPPV1_Format=st,t.RGBA_PVRTC_4BPPV1_Format=rt,t.RGBA_S3TC_DXT1_Format=Q,t.RGBA_S3TC_DXT3_Format=tt,t.RGBA_S3TC_DXT5_Format=et,t.RGB_BPTC_SIGNED_Format=Tt,t.RGB_BPTC_UNSIGNED_Format=Et,t.RGB_ETC1_Format=at,t.RGB_ETC2_Format=ot,t.RGB_PVRTC_2BPPV1_Format=it,t.RGB_PVRTC_4BPPV1_Format=nt,t.RGB_S3TC_DXT1_Format=$,t.RGFormat=1030,t.RGIntegerFormat=J,t.RawShaderMaterial=rh,t.Ray=yn,t.Raycaster=class{constructor(t,e,n=0,i=1/0){this.ray=new yn(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new In,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return Vu(t,this,n,e),n.sort(Hu),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)Vu(t[i],this,n,e);return n.sort(Hu),n}},t.Rec709Primaries=jt,t.RectAreaLight=iu,t.RedFormat=1028,t.RedIntegerFormat=Z,t.ReinhardToneMapping=f,t.RenderTarget=ze,t.RepeatWrapping=R,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingGeometry=qc,t.SIGNED_RED_GREEN_RGTC2_Format=Rt,t.SIGNED_RED_RGTC1_Format=wt,t.SRGBColorSpace=Gt,t.SRGBTransfer=Xt,t.Scene=ro,t.ShaderChunk=yr,t.ShaderLib=Sr,t.ShaderMaterial=ir,t.ShadowMaterial=ih,t.Shape=mc,t.ShapeGeometry=Yc,t.ShapePath=class{constructor(){this.type="ShapePath",this.color=new ci,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new ec,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],a=e[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],o=-o,a=e[r],l=-l),t.y<n.y||t.y>a.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-o*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(a.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=a.x)return!0}}return i}const n=Gc.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new mc,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=t?!l:l;const c=[],h=[];let u,d,p=[],m=0;h[m]=void 0,p[m]=[];for(let e=0,a=i.length;e<a;e++)s=i[e],u=s.getPoints(),r=n(u),r=t?!r:r,r?(!l&&h[m]&&m++,h[m]={s:new mc,p:u},h[m].s.curves=s.curves,l&&m++,p[m]=[]):p[m].push({h:s,p:u[0]});if(!h[0])return function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new mc;r.curves=i.curves,e.push(r)}return e}(i);if(h.length>1){let t=!1,n=0;for(let t=0,e=h.length;t<e;t++)c[t]=[];for(let i=0,r=h.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<h.length;r++)e(a.p,h[r].p)&&(i!==r&&n++,o?(o=!1,c[r].push(a)):t=!0);o&&c[i].push(a)}}n>0&&!1===t&&(p=c)}for(let t=0,e=h.length;t<e;t++){a=h[t].s,o.push(a),d=p[t];for(let t=0,e=d.length;t<e;t++)a.holes.push(d[t].h)}return o}},t.ShapeUtils=Gc,t.ShortType=1011,t.Skeleton=Vo,t.SkeletonHelper=class extends Tl{constructor(t){const e=Ju(t),n=new Ii,i=[],r=[],s=new ci(0,0,1),a=new ci(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new Ti(i,3)),n.setAttribute("color",new Ti(r,3));super(n,new fl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Zu.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Yu.multiplyMatrices(Zu,r.matrixWorld),qu.setFromMatrixPosition(Yu),i.setXYZ(n,qu.x,qu.y,qu.z),Yu.multiplyMatrices(Zu,r.parent.matrixWorld),qu.setFromMatrixPosition(Yu),i.setXYZ(n+1,qu.x,qu.y,qu.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}},t.SkinnedMesh=Fo,t.Source=De,t.Sphere=dn,t.SphereGeometry=Zc,t.Spherical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(ae(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},t.SphericalHarmonics3=ru,t.SplineCurve=$l,t.SpotLight=Yh,t.SpotLightHelper=class extends jn{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new Ii,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,s=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Ti(i,3));const r=new fl({fog:!1,toneMapped:!1});this.cone=new Tl(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),ju.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ju),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},t.Sprite=bo,t.SpriteMaterial=lo,t.SrcAlphaFactor=l,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=Zt,t.StaticReadUsage=35045,t.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,_u.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(ie*e.fov*.5)/e.zoom;let s,a;gu.elements[12]=-n,fu.elements[12]=n,s=-r*e.aspect+i,a=r*e.aspect+i,_u.elements[0]=2*e.near/(a-s),_u.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(_u),s=-r*e.aspect-i,a=r*e.aspect-i,_u.elements[0]=2*e.near/(a-s),_u.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(_u)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(gu),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(fu)}},t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Ch,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronGeometry=Jc,t.Texture=Fe,t.TextureLoader=class extends Oh{constructor(t){super(t)}load(t,e,n,i){const r=new Fe,s=new Gh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}},t.TorusGeometry=Kc,t.TorusKnotGeometry=$c,t.Triangle=ri,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeGeometry=Qc,t.TwoPassDoubleSide=2,t.UVMapping=S,t.Uint16BufferAttribute=Si,t.Uint32BufferAttribute=bi,t.Uint8BufferAttribute=class extends Mi{constructor(t,e,n){super(new Uint8Array(t),e,n)}},t.Uint8ClampedBufferAttribute=class extends Mi{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}},t.Uniform=zu,t.UniformsGroup=class extends te{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Gu++}),this.name="",this.usage=Zt,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,n=e.length;t<n;t++){const n=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0;t<n.length;t++)this.uniforms.push(n[t].clone())}return this}clone(){return(new this.constructor).copy(this)}},t.UniformsLib=Mr,t.UniformsUtils=nr,t.UnsignedByteType=F,t.UnsignedInt248Type=X,t.UnsignedIntType=G,t.UnsignedShort4444Type=k,t.UnsignedShort5551Type=W,t.UnsignedShortType=B,t.VSMShadowMap=r,t.Vector2=me,t.Vector3=We,t.Vector4=Be,t.VectorKeyframeTrack=Lh,t.VideoTexture=class extends Fe{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:D,this.magFilter=void 0!==r?r:D,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},t.WebGL1Renderer=eo,t.WebGL3DRenderTarget=class extends Ge{constructor(t=1,e=1,n=1,i={}){super(t,e,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Ve(null,t,e,n),this.texture.isRenderTargetTexture=!0}},t.WebGLArrayRenderTarget=class extends Ge{constructor(t=1,e=1,n=1,i={}){super(t,e,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new He(null,t,e,n),this.texture.isRenderTargetTexture=!0}},t.WebGLCoordinateSystem=$t,t.WebGLCubeRenderTarget=cr,t.WebGLMultipleRenderTargets=class extends Ge{constructor(t=1,e=1,n=1,i={}){super(t,e,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},t.WebGLRenderTarget=Ge,t.WebGLRenderer=to,t.WebGLUtils=ja,t.WebGPUCoordinateSystem=Qt,t.WireframeGeometry=th,t.WrapAroundEnding=Dt,t.ZeroCurvatureEnding=It,t.ZeroFactor=200,t.ZeroSlopeEnding=Ut,t.ZeroStencilOp=0,t._SRGBAFormat=Kt,t.createCanvasElement=Me,t.sRGBEncoding=Bt}));
    </script>





</body></html>